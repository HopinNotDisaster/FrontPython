
<!DOCTYPE html>

<html lang="zh_Hans">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Django 1.10 版本发行说明 &#8212; Django 5.0.4.dev20240329153429 文档</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/default.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Django 1.9.13 版本发行说明" href="1.9.13.html" />
    <link rel="prev" title="Django 1.10.1 版本发行说明" href="1.10.1.html" />



 
<script src="../templatebuiltins.js"></script>
<script>
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);</script>

  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../index.html">Django 5.0.4.dev20240329153429 文档</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../index.html">Home</a>  |
        <a title="Table of contents" href="../contents.html">Table of contents</a>  |
        <a title="Global index" href="../genindex.html">Index</a>  |
        <a title="Module index" href="../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="1.10.1.html" title="Django 1.10.1 版本发行说明">previous</a>
     |
    <a href="index.html" title="发行说明" accesskey="U">up</a>
   |
    <a href="1.9.13.html" title="Django 1.9.13 版本发行说明">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="releases-1.10">
            
  <div class="section" id="s-django-1-10-release-notes">
<span id="django-1-10-release-notes"></span><h1>Django 1.10 版本发行说明<a class="headerlink" href="#django-1-10-release-notes" title="永久链接至标题">¶</a></h1>
<p><em>2016 年 8 月 1 日</em></p>
<p>欢迎来到 Django 1.10 版本！</p>
<p>这些发布说明涵盖了 <a class="reference internal" href="#whats-new-1-10"><span class="std std-ref">新功能</span></a>，以及一些 <a class="reference internal" href="#backwards-incompatible-1-10"><span class="std std-ref">不兼容的更改</span></a>，在从 Django 1.9 或更早版本升级时，您需要注意这些更改。我们已经 <a class="reference internal" href="#removed-features-1-10"><span class="std std-ref">放弃了一些功能</span></a>，它们已经达到了停用周期的末尾，同时我们已经 <a class="reference internal" href="#deprecated-features-1-10"><span class="std std-ref">开始了一些功能的停用过程</span></a>。</p>
<p>如果你要更新现有的项目，请看 <a class="reference internal" href="../howto/upgrade-version.html"><span class="doc">如何将 Django 更新至新的版本</span></a> 指南。</p>
<div class="section" id="s-python-compatibility">
<span id="python-compatibility"></span><h2>Python 兼容性<a class="headerlink" href="#python-compatibility" title="永久链接至标题">¶</a></h2>
<p>与 Django 1.9 一样，Django 1.10 需要 Python 2.7、3.4 或 3.5。我们 <strong>强烈建议</strong> 并且只正式支持每个系列的最新版本。</p>
</div>
<div class="section" id="s-what-s-new-in-django-1-10">
<span id="s-whats-new-1-10"></span><span id="what-s-new-in-django-1-10"></span><span id="whats-new-1-10"></span><h2>Django 1.10 新特性<a class="headerlink" href="#what-s-new-in-django-1-10" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-full-text-search-for-postgresql">
<span id="full-text-search-for-postgresql"></span><h3>PostgreSQL 的全文搜索<a class="headerlink" href="#full-text-search-for-postgresql" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">django.contrib.postgres</span></code> 现在包括一个 <a class="reference internal" href="../ref/contrib/postgres/search.html"><span class="doc">数据库函数集合</span></a>，允许使用全文搜索引擎。您可以在关系数据库中跨多个字段进行搜索，将搜索与其他查找组合使用，使用不同的语言配置和权重，以及按相关性对结果进行排名。</p>
<p>它还现在包括 trigram 支持，使用 <a class="reference internal" href="../ref/contrib/postgres/lookups.html#std-fieldlookup-trigram_similar"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">trigram_similar</span></code></a> 查找以及 <a class="reference internal" href="../ref/contrib/postgres/search.html#django.contrib.postgres.search.TrigramSimilarity" title="django.contrib.postgres.search.TrigramSimilarity"><code class="xref py py-class docutils literal notranslate"><span class="pre">TrigramSimilarity</span></code></a> 和 <a class="reference internal" href="../ref/contrib/postgres/search.html#django.contrib.postgres.search.TrigramDistance" title="django.contrib.postgres.search.TrigramDistance"><code class="xref py py-class docutils literal notranslate"><span class="pre">TrigramDistance</span></code></a> 表达式。</p>
</div>
<div class="section" id="s-new-style-middleware">
<span id="new-style-middleware"></span><h3>新式中间件<a class="headerlink" href="#new-style-middleware" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../topics/http/middleware.html"><span class="doc">引入了一种新的中间件风格</span></a>，以解决旧式中间件的请求/响应层次不严格的问题，这在 <a class="reference external" href="https://github.com/django/deps/blob/main/final/0005-improved-middleware.rst">DEP 0005</a> 中有描述。您需要 <a class="reference internal" href="../topics/http/middleware.html#upgrading-middleware"><span class="std std-ref">调整旧的自定义中间件</span></a>，并从 <code class="docutils literal notranslate"><span class="pre">MIDDLEWARE_CLASSES</span></code> 设置切换到新的 <a class="reference internal" href="../ref/settings.html#std-setting-MIDDLEWARE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">MIDDLEWARE</span></code></a> 设置以充分利用这些改进。</p>
</div>
<div class="section" id="s-official-support-for-unicode-usernames">
<span id="official-support-for-unicode-usernames"></span><h3>官方支持 Unicode 用户名<a class="headerlink" href="#official-support-for-unicode-usernames" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">django.contrib.auth</span></code> 中的 <a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">User</span></code></a> 模型最初只接受用户名中的 ASCII 字母和数字。尽管这不是一个故意的选择，在使用 Python 3 时，Unicode 字符一直都被接受。</p>
<p>用户名验证器现在默认情况下仅在 Python 3 上明确接受 Unicode 字符。</p>
<p>自定义用户模型可以使用新的 <a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.validators.ASCIIUsernameValidator" title="django.contrib.auth.validators.ASCIIUsernameValidator"><code class="xref py py-class docutils literal notranslate"><span class="pre">ASCIIUsernameValidator</span></code></a> 或 <a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.validators.UnicodeUsernameValidator" title="django.contrib.auth.validators.UnicodeUsernameValidator"><code class="xref py py-class docutils literal notranslate"><span class="pre">UnicodeUsernameValidator</span></code></a>。</p>
</div>
<div class="section" id="s-minor-features">
<span id="minor-features"></span><h3>次要特性<a class="headerlink" href="#minor-features" title="永久链接至标题">¶</a></h3>
<div class="section" id="s-django-contrib-admin">
<span id="django-contrib-admin"></span><h4><a class="reference internal" href="../ref/contrib/admin/index.html#module-django.contrib.admin" title="django.contrib.admin: Django's admin site."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a><a class="headerlink" href="#django-contrib-admin" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>对于运行在子路径上的站点，每个管理页面顶部的默认 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.AdminSite.site_url" title="django.contrib.admin.AdminSite.site_url"><code class="xref py py-attr docutils literal notranslate"><span class="pre">&quot;查看站点&quot;链接的</span> <span class="pre">URL</span></code></a> 现在将指向 <code class="docutils literal notranslate"><span class="pre">request.META['SCRIPT_NAME']</span></code> （如果设置了），而不是 <code class="docutils literal notranslate"><span class="pre">/</span></code>。</li>
<li>现在，在添加或编辑对象后出现的成功消息中包含到对象的更改表单的链接。</li>
<li>所有内联 JavaScript 都已移除，因此您可以启用 <code class="docutils literal notranslate"><span class="pre">Content-Security-Policy</span></code> HTTP 标头（如果需要的话）。</li>
<li>新的 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.InlineModelAdmin.classes" title="django.contrib.admin.InlineModelAdmin.classes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">InlineModelAdmin.classes</span></code></a> 属性允许在内联字段集上指定类。具有 <code class="docutils literal notranslate"><span class="pre">collapse</span></code> 类的内联将初始折叠，并且它们的标题将有一个小的 &quot;显示&quot; 链接。</li>
<li>如果用户没有添加权限，模型的更改列表上的 <code class="docutils literal notranslate"><span class="pre">object-tools</span></code> 区块现在将被呈现（没有添加按钮）。这在这种情况下更容易添加自定义工具。</li>
<li><a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.models.LogEntry" title="django.contrib.admin.models.LogEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogEntry</span></code></a> 模型现在将更改消息存储在 JSON 结构中，以便可以使用当前活动的语言动态翻译消息。现在，首选的检索更改消息的方式是使用新的 <code class="docutils literal notranslate"><span class="pre">LogEntry.get_change_message()</span></code> 方法。</li>
<li>在 <code class="docutils literal notranslate"><span class="pre">ModelAdmin.raw_id_fields</span></code> 中选定的字段的对象现在具有指向对象的更改表单的链接。</li>
<li>如果字段可为空，为 <code class="docutils literal notranslate"><span class="pre">DateFieldListFilter</span></code> 添加了 &quot;无日期&quot; 和 &quot;有日期&quot; 选项。</li>
<li>管理后台中嵌入的 jQuery 库已经从 2.1.4 版本升级到 2.2.3 版本。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-auth">
<span id="django-contrib-auth"></span><h4><a class="reference internal" href="../topics/auth/index.html#module-django.contrib.auth" title="django.contrib.auth: Django's authentication framework."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a><a class="headerlink" href="#django-contrib-auth" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>增加了对 <a class="reference internal" href="../topics/auth/passwords.html#argon2-usage"><span class="std std-ref">Argon2 密码哈希</span></a> 的支持。它被推荐用于替代 PBKDF2，但不是默认选项，因为它需要一个第三方库。</li>
<li>PBKDF2 密码哈希的默认迭代次数已增加 25%。这个向后兼容的更改不会影响那些已经子类化了 <code class="docutils literal notranslate"><span class="pre">django.contrib.auth.hashers.PBKDF2PasswordHasher</span></code> 以更改默认值的用户。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.auth.views.logout()</span></code> 视图发送 &quot;no-cache&quot; 标头，以防止 Safari 缓存重定向并阻止用户注销的问题。</li>
<li>新增了可选的 <code class="docutils literal notranslate"><span class="pre">backend</span></code> 参数以供 <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.login" title="django.contrib.auth.login"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.contrib.auth.login()</span></code></a> 使用，允许在没有凭据的情况下使用它。</li>
<li>新的 <a class="reference internal" href="../ref/settings.html#std-setting-LOGOUT_REDIRECT_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOGOUT_REDIRECT_URL</span></code></a> 设置控制了 <code class="docutils literal notranslate"><span class="pre">django.contrib.auth.views.logout()</span></code> 视图的重定向，如果视图没有得到一个 <code class="docutils literal notranslate"><span class="pre">next_page</span></code> 参数。</li>
<li>新的 <code class="docutils literal notranslate"><span class="pre">redirect_authenticated_user</span></code> 参数用于 <code class="docutils literal notranslate"><span class="pre">django.contrib.auth.views.login()</span></code> 视图，允许重定向已经经过身份验证的用户访问登录页面。</li>
<li>新的 <a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.backends.AllowAllUsersModelBackend" title="django.contrib.auth.backends.AllowAllUsersModelBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">AllowAllUsersModelBackend</span></code></a> 和 <a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.backends.AllowAllUsersRemoteUserBackend" title="django.contrib.auth.backends.AllowAllUsersRemoteUserBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">AllowAllUsersRemoteUserBackend</span></code></a> 忽略了 <code class="docutils literal notranslate"><span class="pre">User.is_active</span></code> 的值，而 <a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.backends.ModelBackend" title="django.contrib.auth.backends.ModelBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelBackend</span></code></a> 和 <a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.backends.RemoteUserBackend" title="django.contrib.auth.backends.RemoteUserBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">RemoteUserBackend</span></code></a> 现在拒绝不活动的用户。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-gis">
<span id="django-contrib-gis"></span><h4><a class="reference internal" href="../ref/contrib/gis/index.html#module-django.contrib.gis" title="django.contrib.gis: Geographic Information System (GIS) extensions for Django"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a><a class="headerlink" href="#django-contrib-gis" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/contrib/gis/geoquerysets.html#distance-lookups"><span class="std std-ref">距离查找</span></a> 现在接受表达式作为距离值参数。</li>
<li>新的 <a class="reference internal" href="../ref/contrib/gis/geos.html#django.contrib.gis.geos.GEOSGeometry.unary_union" title="django.contrib.gis.geos.GEOSGeometry.unary_union"><code class="xref py py-attr docutils literal notranslate"><span class="pre">GEOSGeometry.unary_union</span></code></a> 属性计算了此几何对象的所有元素的并集。</li>
<li>新增了 <a class="reference internal" href="../ref/contrib/gis/geos.html#django.contrib.gis.geos.GEOSGeometry.covers" title="django.contrib.gis.geos.GEOSGeometry.covers"><code class="xref py py-meth docutils literal notranslate"><span class="pre">GEOSGeometry.covers()</span></code></a> 二元谓词。</li>
<li>新增了 <a class="reference internal" href="../ref/contrib/gis/gdal.html#django.contrib.gis.gdal.GDALBand.statistics" title="django.contrib.gis.gdal.GDALBand.statistics"><code class="xref py py-meth docutils literal notranslate"><span class="pre">GDALBand.statistics()</span></code></a> 方法以及 <a class="reference internal" href="../ref/contrib/gis/gdal.html#django.contrib.gis.gdal.GDALBand.mean" title="django.contrib.gis.gdal.GDALBand.mean"><code class="xref py py-attr docutils literal notranslate"><span class="pre">mean</span></code></a> 和 <a class="reference internal" href="../ref/contrib/gis/gdal.html#django.contrib.gis.gdal.GDALBand.std" title="django.contrib.gis.gdal.GDALBand.std"><code class="xref py py-attr docutils literal notranslate"><span class="pre">std</span></code></a> 属性。</li>
<li>在 SpatiaLite 上新增了对 <a class="reference internal" href="../ref/contrib/gis/geoquerysets.html#django.contrib.gis.db.models.MakeLine" title="django.contrib.gis.db.models.MakeLine"><code class="xref py py-class docutils literal notranslate"><span class="pre">MakeLine</span></code></a> 聚合和 <a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.GeoHash" title="django.contrib.gis.db.models.functions.GeoHash"><code class="xref py py-class docutils literal notranslate"><span class="pre">GeoHash</span></code></a> 函数的支持。</li>
<li>在 MySQL 上新增了对 <a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.Difference" title="django.contrib.gis.db.models.functions.Difference"><code class="xref py py-class docutils literal notranslate"><span class="pre">Difference</span></code></a>、<a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.Intersection" title="django.contrib.gis.db.models.functions.Intersection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Intersection</span></code></a> 和 <a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.SymDifference" title="django.contrib.gis.db.models.functions.SymDifference"><code class="xref py py-class docutils literal notranslate"><span class="pre">SymDifference</span></code></a> 函数的支持。</li>
<li>新增支持实例化空的 GEOS 几何对象。</li>
<li><a class="reference internal" href="../ref/contrib/gis/geos.html#django.contrib.gis.geos.WKTWriter" title="django.contrib.gis.geos.WKTWriter"><code class="xref py py-class docutils literal notranslate"><span class="pre">WKTWriter</span></code></a> 的新属性 <a class="reference internal" href="../ref/contrib/gis/geos.html#django.contrib.gis.geos.WKTWriter.trim" title="django.contrib.gis.geos.WKTWriter.trim"><code class="xref py py-attr docutils literal notranslate"><span class="pre">trim</span></code></a> 和 <a class="reference internal" href="../ref/contrib/gis/geos.html#django.contrib.gis.geos.WKTWriter.precision" title="django.contrib.gis.geos.WKTWriter.precision"><code class="xref py py-attr docutils literal notranslate"><span class="pre">precision</span></code></a> 允许控制 WKT 中坐标的小数部分的输出。</li>
<li>新增了 <a class="reference internal" href="../ref/contrib/gis/geos.html#django.contrib.gis.geos.LineString.closed" title="django.contrib.gis.geos.LineString.closed"><code class="xref py py-attr docutils literal notranslate"><span class="pre">LineString.closed</span></code></a> 和 <a class="reference internal" href="../ref/contrib/gis/geos.html#django.contrib.gis.geos.MultiLineString.closed" title="django.contrib.gis.geos.MultiLineString.closed"><code class="xref py py-attr docutils literal notranslate"><span class="pre">MultiLineString.closed</span></code></a> 属性。</li>
<li>如果没有指定特定字段， <a class="reference internal" href="../ref/contrib/gis/serializers.html"><span class="doc">GeoJSON 序列化程序</span></a> 现在会在 <code class="docutils literal notranslate"><span class="pre">properties</span></code> 字典中输出对象的主键。</li>
<li>现在可以在 <a class="reference internal" href="../ref/contrib/gis/gdal.html#django.contrib.gis.gdal.GDALBand.data" title="django.contrib.gis.gdal.GDALBand.data"><code class="xref py py-meth docutils literal notranslate"><span class="pre">GDALBand.data()</span></code></a> 方法上复制输入数据。可以高效地使用重复的值更新带数据。</li>
<li>新增了数据库函数 <a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.IsValid" title="django.contrib.gis.db.models.functions.IsValid"><code class="xref py py-class docutils literal notranslate"><span class="pre">IsValid</span></code></a> 和 <a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.MakeValid" title="django.contrib.gis.db.models.functions.MakeValid"><code class="xref py py-class docutils literal notranslate"><span class="pre">MakeValid</span></code></a>，以及 <a class="reference internal" href="../ref/contrib/gis/geoquerysets.html#std-fieldlookup-isvalid"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">isvalid</span></code></a> 查找，都用于 PostGIS。这允许在数据库端对无效的几何对象进行过滤和修复。</li>
<li>新增了所有 <a class="reference internal" href="../ref/contrib/gis/geoquerysets.html"><span class="doc">空间查找</span></a> 的栅格支持。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-postgres">
<span id="django-contrib-postgres"></span><h4><a class="reference internal" href="../ref/contrib/postgres/index.html#module-django.contrib.postgres" title="django.contrib.postgres: PostgreSQL-specific fields and features"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.postgres</span></code></a><a class="headerlink" href="#django-contrib-postgres" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>为了方便起见，<a class="reference internal" href="../ref/contrib/postgres/fields.html#django.contrib.postgres.fields.HStoreField" title="django.contrib.postgres.fields.HStoreField"><code class="xref py py-class docutils literal notranslate"><span class="pre">HStoreField</span></code></a> 现在将其键和值转换为字符串。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-sessions">
<span id="django-contrib-sessions"></span><h4><a class="reference internal" href="../topics/http/sessions.html#module-django.contrib.sessions" title="django.contrib.sessions: Provides session management for Django projects."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sessions</span></code></a><a class="headerlink" href="#django-contrib-sessions" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-clearsessions"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">clearsessions</span></code></a> 管理命令现在会删除基于文件的会话。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-sites">
<span id="django-contrib-sites"></span><h4><a class="reference internal" href="../ref/contrib/sites.html#module-django.contrib.sites" title="django.contrib.sites: Lets you operate multiple websites from the same database and Django project"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sites</span></code></a><a class="headerlink" href="#django-contrib-sites" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/contrib/sites.html#django.contrib.sites.models.Site" title="django.contrib.sites.models.Site"><code class="xref py py-class docutils literal notranslate"><span class="pre">Site</span></code></a> 模型现在支持 <a class="reference internal" href="../topics/serialization.html#topics-serialization-natural-keys"><span class="std std-ref">自然键</span></a>。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-staticfiles">
<span id="django-contrib-staticfiles"></span><h4><a class="reference internal" href="../ref/contrib/staticfiles.html#module-django.contrib.staticfiles" title="django.contrib.staticfiles: An app for handling static files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.staticfiles</span></code></a><a class="headerlink" href="#django-contrib-staticfiles" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/templates/builtins.html#std-templatetag-static"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">static</span></code></a> 模板标签现在如果在 <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code> 中，将使用 <code class="docutils literal notranslate"><span class="pre">django.contrib.staticfiles</span></code>。这对于第三方应用程序特别有用，现在它们可以始终使用 <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">load</span> <span class="pre">static</span> <span class="pre">%}``（而不是</span> <span class="pre">``{%</span> <span class="pre">load</span> <span class="pre">staticfiles</span> <span class="pre">%}</span></code> 或 <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">load</span> <span class="pre">static</span> <span class="pre">from</span> <span class="pre">staticfiles</span> <span class="pre">%}</span></code>），并且不必担心是否安装了 <code class="docutils literal notranslate"><span class="pre">staticfiles</span></code> 应用程序。</li>
<li>您可以通过自定义 <code class="docutils literal notranslate"><span class="pre">AppConfig</span></code> 更容易地 <a class="reference internal" href="../ref/contrib/staticfiles.html#customize-staticfiles-ignore-patterns"><span class="std std-ref">自定义</span></a> <code class="docutils literal notranslate"><span class="pre">collectstatic</span> <span class="pre">--ignore</span></code> 选项。</li>
</ul>
</div>
<div class="section" id="s-cache">
<span id="cache"></span><h4>缓存<a class="headerlink" href="#cache" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>基于文件的缓存后端现在使用最高的 pickling 协议。</li>
</ul>
</div>
<div class="section" id="s-csrf">
<span id="csrf"></span><h4>CSRF<a class="headerlink" href="#csrf" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>默认的 <a class="reference internal" href="../ref/settings.html#std-setting-CSRF_FAILURE_VIEW"><code class="xref std std-setting docutils literal notranslate"><span class="pre">CSRF_FAILURE_VIEW</span></code></a>，<code class="docutils literal notranslate"><span class="pre">views.csrf.csrf_failure()</span></code> 现在接受一个可选的 <code class="docutils literal notranslate"><span class="pre">template_name</span></code> 参数，默认为 <code class="docutils literal notranslate"><span class="pre">'403_csrf.html'</span></code>，用于控制渲染页面的模板。</li>
<li>为了防止 <a class="reference external" href="https://www.breachattack.com/">BREACH</a> 攻击，CSRF 保护机制现在会在每个请求中更改表单令牌的值（同时保持不变的秘密，可用于验证不同的令牌）。</li>
</ul>
</div>
<div class="section" id="s-database-backends">
<span id="database-backends"></span><h4>数据库后端<a class="headerlink" href="#database-backends" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>临时数据减法在所有后端上得到了统一。</li>
<li>如果数据库支持，后端可以设置 <code class="docutils literal notranslate"><span class="pre">DatabaseFeatures.can_return_ids_from_bulk_insert=True</span></code> 并实现 <code class="docutils literal notranslate"><span class="pre">DatabaseOperations.fetch_returned_insert_ids()</span></code>，以便在使用 <code class="docutils literal notranslate"><span class="pre">QuerySet.bulk_create()</span></code> 创建的对象上设置主键。</li>
<li>为各种表达式（<code class="docutils literal notranslate"><span class="pre">Func</span></code>、<code class="docutils literal notranslate"><span class="pre">When</span></code>、<code class="docutils literal notranslate"><span class="pre">Case</span></code> 和 <code class="docutils literal notranslate"><span class="pre">OrderBy</span></code>）的 <code class="docutils literal notranslate"><span class="pre">as_sql()</span></code> 方法添加了关键字参数，允许数据库后端在不更改 <code class="docutils literal notranslate"><span class="pre">self</span></code> 的情况下自定义它们，这在使用不同的数据库后端时不安全。参见 <a class="reference internal" href="../ref/models/expressions.html#django.db.models.Func.as_sql" title="django.db.models.Func.as_sql"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Func.as_sql()</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">arg_joiner</span></code> 和 <code class="docutils literal notranslate"><span class="pre">**extra_context</span></code> 参数的示例。</li>
</ul>
</div>
<div class="section" id="s-file-storage">
<span id="file-storage"></span><h4>文件存储<a class="headerlink" href="#file-storage" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>存储后端现在提供一个时区感知的 API，具有新的方法 <a class="reference internal" href="../ref/files/storage.html#django.core.files.storage.Storage.get_accessed_time" title="django.core.files.storage.Storage.get_accessed_time"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_accessed_time()</span></code></a>、<a class="reference internal" href="../ref/files/storage.html#django.core.files.storage.Storage.get_created_time" title="django.core.files.storage.Storage.get_created_time"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_created_time()</span></code></a> 和 <a class="reference internal" href="../ref/files/storage.html#django.core.files.storage.Storage.get_modified_time" title="django.core.files.storage.Storage.get_modified_time"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_modified_time()</span></code></a>。如果 <a class="reference internal" href="../ref/settings.html#std-setting-USE_TZ"><code class="xref std std-setting docutils literal notranslate"><span class="pre">USE_TZ</span></code></a> 为 <code class="docutils literal notranslate"><span class="pre">True</span></code>，则它们返回一个时区感知的 <code class="docutils literal notranslate"><span class="pre">datetime</span></code>，否则返回本地时区的非时区感知的 <code class="docutils literal notranslate"><span class="pre">datetime</span></code>。</li>
<li>新的 <a class="reference internal" href="../ref/files/storage.html#django.core.files.storage.Storage.generate_filename" title="django.core.files.storage.Storage.generate_filename"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Storage.generate_filename()</span></code></a> 方法使得更容易实现不使用以前在 <a class="reference internal" href="../ref/models/fields.html#django.db.models.FileField" title="django.db.models.FileField"><code class="xref py py-class docutils literal notranslate"><span class="pre">FileField</span></code></a> 中的 <code class="docutils literal notranslate"><span class="pre">os.path</span></code> 调用的自定义存储。</li>
</ul>
</div>
<div class="section" id="s-forms">
<span id="forms"></span><h4>表单<a class="headerlink" href="#forms" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>如果安装了 <a class="reference internal" href="../ref/contrib/staticfiles.html#module-django.contrib.staticfiles" title="django.contrib.staticfiles: An app for handling static files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.staticfiles</span></code></a>，则现在会使用它来提供表单和小部件的 <code class="docutils literal notranslate"><span class="pre">Media</span></code>。</li>
<li>由 <a class="reference internal" href="../ref/forms/fields.html#django.forms.CharField" title="django.forms.CharField"><code class="xref py py-class docutils literal notranslate"><span class="pre">CharField</span></code></a> 渲染的 <code class="docutils literal notranslate"><span class="pre">&lt;input&gt;</span></code> 标签现在如果字段具有 <code class="docutils literal notranslate"><span class="pre">min_length</span></code>，则会包含一个 <code class="docutils literal notranslate"><span class="pre">minlength</span></code> 属性。</li>
<li>现在，必填表单字段具有 <code class="docutils literal notranslate"><span class="pre">required</span></code> HTML 属性。将新的 <a class="reference internal" href="../ref/forms/api.html#django.forms.Form.use_required_attribute" title="django.forms.Form.use_required_attribute"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Form.use_required_attribute</span></code></a> 属性设置为 <code class="docutils literal notranslate"><span class="pre">False</span></code> 可以禁用它。在表单集的表单上不包括 <code class="docutils literal notranslate"><span class="pre">required</span></code> 属性，因为在添加和删除表单集时，浏览器验证可能不正确。</li>
</ul>
</div>
<div class="section" id="s-generic-views">
<span id="generic-views"></span><h4>通用视图<a class="headerlink" href="#generic-views" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/class-based-views/base.html#django.views.generic.base.View" title="django.views.generic.base.View"><code class="xref py py-class docutils literal notranslate"><span class="pre">View</span></code></a> 类现在可以从 <code class="docutils literal notranslate"><span class="pre">django.views</span></code> 中导入。</li>
</ul>
</div>
<div class="section" id="s-internationalization">
<span id="internationalization"></span><h4>国际化<a class="headerlink" href="#internationalization" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../topics/i18n/translation.html#django.conf.urls.i18n.i18n_patterns" title="django.conf.urls.i18n.i18n_patterns"><code class="xref py py-func docutils literal notranslate"><span class="pre">i18n_patterns()</span></code></a> 辅助函数现在可以在使用 <a class="reference internal" href="../ref/request-response.html#django.http.HttpRequest.urlconf" title="django.http.HttpRequest.urlconf"><code class="xref py py-attr docutils literal notranslate"><span class="pre">request.urlconf</span></code></a> 指定的根 URL 配置中使用。</li>
<li>通过将 <a class="reference internal" href="../topics/i18n/translation.html#django.conf.urls.i18n.i18n_patterns" title="django.conf.urls.i18n.i18n_patterns"><code class="xref py py-func docutils literal notranslate"><span class="pre">i18n_patterns()</span></code></a> 的新参数 <code class="docutils literal notranslate"><span class="pre">prefix_default_language</span></code> 设置为 <code class="docutils literal notranslate"><span class="pre">False</span></code>，您可以允许在没有 URL 前缀的情况下访问默认语言。</li>
<li>现在，当在 <code class="docutils literal notranslate"><span class="pre">POST</span></code> 或 <code class="docutils literal notranslate"><span class="pre">GET</span></code> 中没有 <code class="docutils literal notranslate"><span class="pre">next</span></code> 参数时，<a class="reference internal" href="../topics/i18n/translation.html#django.views.i18n.set_language" title="django.views.i18n.set_language"><code class="xref py py-func docutils literal notranslate"><span class="pre">set_language()</span></code></a> 对于 AJAX 请求会返回 204 状态码（No Content）。</li>
<li><a class="reference internal" href="../topics/i18n/translation.html#django.views.i18n.JavaScriptCatalog" title="django.views.i18n.JavaScriptCatalog"><code class="xref py py-class docutils literal notranslate"><span class="pre">JavaScriptCatalog</span></code></a> 和 <a class="reference internal" href="../topics/i18n/translation.html#django.views.i18n.JSONCatalog" title="django.views.i18n.JSONCatalog"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSONCatalog</span></code></a> 类视图取代了不推荐使用的 <code class="docutils literal notranslate"><span class="pre">javascript_catalog()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">json_catalog()</span></code> 函数视图。新视图与旧视图几乎相同，唯一的区别是，默认情况下，新视图会从所有已安装的应用程序中收集 <code class="docutils literal notranslate"><span class="pre">djangojs</span></code> 翻译域中的所有 JavaScript 字符串，而不仅仅是来自 <a class="reference internal" href="../ref/settings.html#std-setting-LOCALE_PATHS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOCALE_PATHS</span></code></a> 的 JavaScript 字符串。</li>
</ul>
</div>
<div class="section" id="s-management-commands">
<span id="management-commands"></span><h4>管理命令<a class="headerlink" href="#management-commands" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>现在，<a class="reference internal" href="../ref/django-admin.html#django.core.management.call_command" title="django.core.management.call_command"><code class="xref py py-func docutils literal notranslate"><span class="pre">call_command()</span></code></a> 会返回从 <code class="docutils literal notranslate"><span class="pre">command.handle()</span></code> 方法返回的值。</li>
<li>新的 <a class="reference internal" href="../ref/django-admin.html#cmdoption-check-fail-level"><code class="xref std std-option docutils literal notranslate"><span class="pre">check</span> <span class="pre">--fail-level</span></code></a> 选项允许指定消息级别，该级别将导致命令以非零状态退出。</li>
<li>新的 <a class="reference internal" href="../ref/django-admin.html#cmdoption-makemigrations-check"><code class="xref std std-option docutils literal notranslate"><span class="pre">makemigrations</span> <span class="pre">--check</span></code></a> 选项在检测到模型更改而没有迁移时，使命令以非零状态退出。</li>
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-makemigrations"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">makemigrations</span></code></a> 现在会显示生成的迁移文件的路径。</li>
<li><a class="reference internal" href="../ref/django-admin.html#cmdoption-shell-interface"><code class="xref std std-option docutils literal notranslate"><span class="pre">shell</span> <span class="pre">--interface</span></code></a> 选项现在接受 <code class="docutils literal notranslate"><span class="pre">python</span></code>，以强制使用 &quot;plain&quot; Python 解释器。</li>
<li>新的 <a class="reference internal" href="../ref/django-admin.html#cmdoption-shell-command"><code class="xref std std-option docutils literal notranslate"><span class="pre">shell</span> <span class="pre">--command</span></code></a> 选项允许您以 Django 用户身份运行命令并退出，而不是打开交互式 shell。</li>
<li>如果指定了代理模型（导致没有输出）而没有指定其具体的父模型，<a class="reference internal" href="../ref/django-admin.html#django-admin-dumpdata"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">dumpdata</span></code></a> 现在会显示警告。</li>
<li>新的 <a class="reference internal" href="../howto/custom-management-commands.html#django.core.management.BaseCommand.requires_migrations_checks" title="django.core.management.BaseCommand.requires_migrations_checks"><code class="xref py py-attr docutils literal notranslate"><span class="pre">BaseCommand.requires_migrations_checks</span></code></a> 属性可以设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code>，如果您希望您的命令在磁盘上的迁移集与数据库中的迁移不匹配时打印警告，就像 <a class="reference internal" href="../ref/django-admin.html#django-admin-runserver"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">runserver</span></code></a> 一样。</li>
<li>为了辅助测试，<a class="reference internal" href="../ref/django-admin.html#django.core.management.call_command" title="django.core.management.call_command"><code class="xref py py-func docutils literal notranslate"><span class="pre">call_command()</span></code></a> 现在接受一个命令对象作为第一个参数。</li>
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-shell"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">shell</span></code></a> 命令在使用 <code class="docutils literal notranslate"><span class="pre">libedit</span></code> 的系统上支持制表符自动完成，例如 macOS。</li>
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-inspectdb"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">inspectdb</span></code></a> 命令允许您通过将表的名称指定为参数来选择应该进行检查的表。</li>
</ul>
</div>
<div class="section" id="s-migrations">
<span id="migrations"></span><h4>迁移<a class="headerlink" href="#migrations" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新增支持序列化 <code class="docutils literal notranslate"><span class="pre">enum.Enum</span></code> 对象。</li>
<li>在 <a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.RunSQL" title="django.db.migrations.operations.RunSQL"><code class="xref py py-class docutils literal notranslate"><span class="pre">RunSQL</span></code></a> 和 <a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.RunPython" title="django.db.migrations.operations.RunPython"><code class="xref py py-class docutils literal notranslate"><span class="pre">RunPython</span></code></a> 操作中添加了 <code class="docutils literal notranslate"><span class="pre">elidable</span></code> 参数，以允许在压缩迁移时删除它们。</li>
<li>通过在 <code class="docutils literal notranslate"><span class="pre">Migration</span></code> 上设置 <code class="docutils literal notranslate"><span class="pre">atomic</span></code> 属性，添加了对 <a class="reference internal" href="../howto/writing-migrations.html#non-atomic-migrations"><span class="std std-ref">非原子迁移</span></a> 的支持。</li>
<li><code class="docutils literal notranslate"><span class="pre">migrate</span></code> 和 <code class="docutils literal notranslate"><span class="pre">makemigrations</span></code> 命令现在会 <a class="reference internal" href="../topics/migrations.html#migration-history-consistency"><span class="std std-ref">检查一致的迁移历史</span></a>。如果它们发现某些已应用的迁移存在未应用的依赖项，将会引发 <code class="docutils literal notranslate"><span class="pre">InconsistentMigrationHistory</span></code> 异常。</li>
<li><a class="reference internal" href="../ref/signals.html#django.db.models.signals.pre_migrate" title="django.db.models.signals.pre_migrate"><code class="xref py py-func docutils literal notranslate"><span class="pre">pre_migrate()</span></code></a> 和 <a class="reference internal" href="../ref/signals.html#django.db.models.signals.post_migrate" title="django.db.models.signals.post_migrate"><code class="xref py py-func docutils literal notranslate"><span class="pre">post_migrate()</span></code></a> 信号现在会分发它们的迁移 <code class="docutils literal notranslate"><span class="pre">plan</span></code> 和 <code class="docutils literal notranslate"><span class="pre">apps</span></code>。</li>
</ul>
</div>
<div class="section" id="s-models">
<span id="models"></span><h4>模型<a class="headerlink" href="#models" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>来自代理模型的反向外键现在会传播到它们的具体类。指向代理模型的 <a class="reference internal" href="../ref/models/fields.html#django.db.models.ForeignKey" title="django.db.models.ForeignKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKey</span></code></a> 所附加的反向关系现在可以作为描述符在代理模型类上访问，并且可以在查询集过滤中引用。</li>
<li>新的 <a class="reference internal" href="../ref/models/fields.html#django.db.models.Field.rel_db_type" title="django.db.models.Field.rel_db_type"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Field.rel_db_type()</span></code></a> 方法返回了诸如 <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code> 和 <code class="docutils literal notranslate"><span class="pre">OneToOneField</span></code> 这样指向另一个字段的字段的数据库列数据类型。</li>
<li><a class="reference internal" href="../ref/models/expressions.html#django.db.models.Func" title="django.db.models.Func"><code class="xref py py-class docutils literal notranslate"><span class="pre">Func</span></code></a> 添加了 <a class="reference internal" href="../ref/models/expressions.html#django.db.models.Func.arity" title="django.db.models.Func.arity"><code class="xref py py-attr docutils literal notranslate"><span class="pre">arity</span></code></a> 类属性。此属性可用于设置函数接受的参数数量。</li>
<li>新增了 <a class="reference internal" href="../ref/models/fields.html#django.db.models.BigAutoField" title="django.db.models.BigAutoField"><code class="xref py py-class docutils literal notranslate"><span class="pre">BigAutoField</span></code></a>，它的行为类似于 <a class="reference internal" href="../ref/models/fields.html#django.db.models.AutoField" title="django.db.models.AutoField"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoField</span></code></a>，但它保证适合于范围从 <code class="docutils literal notranslate"><span class="pre">1</span></code> 到 <code class="docutils literal notranslate"><span class="pre">9223372036854775807</span></code> 的数字。</li>
<li>可以不带任何参数调用 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.in_bulk" title="django.db.models.query.QuerySet.in_bulk"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.in_bulk()</span></code></a>，以返回查询集中的所有对象。</li>
<li><a class="reference internal" href="../ref/models/fields.html#django.db.models.ForeignKey.related_query_name" title="django.db.models.ForeignKey.related_query_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">related_query_name</span></code></a> 现在支持使用 <code class="docutils literal notranslate"><span class="pre">'%(app_label)s'</span></code> 和 <code class="docutils literal notranslate"><span class="pre">'%(class)s'</span></code> 字符串进行应用标签和类的插值。</li>
<li>允许覆盖从抽象基类继承的模型字段。</li>
<li><a class="reference internal" href="../ref/models/querysets.html#django.db.models.prefetch_related_objects" title="django.db.models.prefetch_related_objects"><code class="xref py py-func docutils literal notranslate"><span class="pre">prefetch_related_objects()</span></code></a> 函数现在是一个公共 API。</li>
<li><a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.bulk_create" title="django.db.models.query.QuerySet.bulk_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.bulk_create()</span></code></a> 在使用 PostgreSQL 时会设置对象的主键。</li>
<li>新增了 <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Cast" title="django.db.models.functions.Cast"><code class="xref py py-class docutils literal notranslate"><span class="pre">Cast</span></code></a> 数据库函数。</li>
<li>现在，代理模型可以继承多个共享非抽象父类的代理模型。</li>
<li>新增了 <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Extract" title="django.db.models.functions.Extract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Extract</span></code></a> 函数，用于提取日期时间组件作为整数，例如年份和小时。</li>
<li>新增了 <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Trunc" title="django.db.models.functions.Trunc"><code class="xref py py-class docutils literal notranslate"><span class="pre">Trunc</span></code></a> 函数，用于将日期或日期时间截断到一个重要的组件。它们使得可以执行类似每天销售或每小时销售的查询。</li>
<li><code class="docutils literal notranslate"><span class="pre">Model.__init__()</span></code> 现在会从关键字参数中设置虚拟字段的值。</li>
<li>新的 <a class="reference internal" href="../ref/models/options.html#django.db.models.Options.base_manager_name" title="django.db.models.Options.base_manager_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Meta.base_manager_name</span></code></a> 和 <a class="reference internal" href="../ref/models/options.html#django.db.models.Options.default_manager_name" title="django.db.models.Options.default_manager_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Meta.default_manager_name</span></code></a> 选项允许分别控制 <a class="reference internal" href="../topics/db/managers.html#django.db.models.Model._base_manager" title="django.db.models.Model._base_manager"><code class="xref py py-attr docutils literal notranslate"><span class="pre">_base_manager</span></code></a> 和 <a class="reference internal" href="../topics/db/managers.html#django.db.models.Model._default_manager" title="django.db.models.Model._default_manager"><code class="xref py py-attr docutils literal notranslate"><span class="pre">_default_manager</span></code></a>。</li>
</ul>
</div>
<div class="section" id="s-requests-and-responses">
<span id="requests-and-responses"></span><h4>请求和响应<a class="headerlink" href="#requests-and-responses" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>在调试视图中添加了 <code class="docutils literal notranslate"><span class="pre">request.user</span></code>。</li>
<li>添加了 <a class="reference internal" href="../ref/request-response.html#django.http.HttpResponse" title="django.http.HttpResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpResponse</span></code></a> 的方法 <a class="reference internal" href="../ref/request-response.html#django.http.HttpResponse.readable" title="django.http.HttpResponse.readable"><code class="xref py py-meth docutils literal notranslate"><span class="pre">readable()</span></code></a> 和 <a class="reference internal" href="../ref/request-response.html#django.http.HttpResponse.seekable" title="django.http.HttpResponse.seekable"><code class="xref py py-meth docutils literal notranslate"><span class="pre">seekable()</span></code></a>，以使实例成为类似流的对象，并允许将其包装在 <a class="reference external" href="https://docs.python.org/3/library/io.html#io.TextIOWrapper" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">io.TextIOWrapper</span></code></a> 中。</li>
<li>添加了 <a class="reference internal" href="../ref/request-response.html#django.http.HttpRequest.content_type" title="django.http.HttpRequest.content_type"><code class="xref py py-attr docutils literal notranslate"><span class="pre">HttpRequest.content_type</span></code></a> 和 <a class="reference internal" href="../ref/request-response.html#django.http.HttpRequest.content_params" title="django.http.HttpRequest.content_params"><code class="xref py py-attr docutils literal notranslate"><span class="pre">content_params</span></code></a> 属性，这些属性从 <code class="docutils literal notranslate"><span class="pre">CONTENT_TYPE</span></code> 标头中解析而来。</li>
<li><code class="docutils literal notranslate"><span class="pre">request.COOKIES</span></code> 的解析器被简化，以更好地匹配浏览器的行为。<code class="docutils literal notranslate"><span class="pre">request.COOKIES</span></code> 现在可以包含根据 <span class="target" id="index-6"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc6265.html"><strong>RFC 6265</strong></a> 无效但可以通过 <code class="docutils literal notranslate"><span class="pre">document.cookie</span></code> 设置的 cookie。</li>
</ul>
</div>
<div class="section" id="s-serialization">
<span id="serialization"></span><h4>序列化<a class="headerlink" href="#serialization" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">django.core.serializers.json.DjangoJSONEncoder</span></code> 现在知道如何序列化懒惰字符串，通常用于可翻译的内容。</li>
</ul>
</div>
<div class="section" id="s-templates">
<span id="templates"></span><h4>模板<a class="headerlink" href="#templates" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>在 <a class="reference internal" href="../topics/templates.html#django.template.backends.django.DjangoTemplates" title="django.template.backends.django.DjangoTemplates"><code class="xref py py-class docutils literal notranslate"><span class="pre">DjangoTemplates</span></code></a> 后端和 <a class="reference internal" href="../ref/templates/api.html#django.template.Engine" title="django.template.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> 类中添加了 <code class="docutils literal notranslate"><span class="pre">autoescape</span></code> 选项。</li>
<li>在 <a class="reference internal" href="../ref/templates/builtins.html#std-templatetag-if"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">if</span></code></a> 标签中添加了 <code class="docutils literal notranslate"><span class="pre">is</span></code> 和 <code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">not</span></code> 比较运算符。</li>
<li>允许使用 <a class="reference internal" href="../ref/templates/builtins.html#std-templatefilter-dictsort"><code class="xref std std-tfilter docutils literal notranslate"><span class="pre">dictsort</span></code></a> 根据指定索引处的元素对列表中的列表进行排序。</li>
<li><a class="reference internal" href="../ref/templates/api.html#django.template.context_processors.debug" title="django.template.context_processors.debug"><code class="xref py py-func docutils literal notranslate"><span class="pre">debug()</span></code></a> 上下文处理器包含了所有数据库别名的查询，而不仅仅是默认别名。</li>
<li>对 <a class="reference internal" href="../ref/templates/builtins.html#std-templatetag-extends"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">extends</span></code></a> 和 <a class="reference internal" href="../ref/templates/builtins.html#std-templatetag-include"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">include</span></code></a> 模板标签的字符串参数添加了相对路径支持。</li>
</ul>
</div>
<div class="section" id="s-tests">
<span id="tests"></span><h4>测试<a class="headerlink" href="#tests" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>为了更好地捕获错误，<a class="reference internal" href="../topics/testing/tools.html#django.test.TestCase" title="django.test.TestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestCase</span></code></a> 现在在每个测试结束时检查可延迟的数据库约束。</li>
<li>测试和测试用例可以被 <a class="reference internal" href="../topics/testing/tools.html#topics-tagging-tests"><span class="std std-ref">标记为标签</span></a> 并可以使用新的 <a class="reference internal" href="../ref/django-admin.html#cmdoption-test-tag"><code class="xref std std-option docutils literal notranslate"><span class="pre">test</span> <span class="pre">--tag</span></code></a> 和 <a class="reference internal" href="../ref/django-admin.html#cmdoption-test-exclude-tag"><code class="xref std std-option docutils literal notranslate"><span class="pre">test</span> <span class="pre">--exclude-tag</span></code></a> 选项进行选择性运行。</li>
<li>即使 <a class="reference internal" href="../topics/http/sessions.html#module-django.contrib.sessions" title="django.contrib.sessions: Provides session management for Django projects."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sessions</span></code></a> 不在 <a class="reference internal" href="../ref/settings.html#std-setting-INSTALLED_APPS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code></a> 中，您现在也可以使用测试客户端登录并使用会话。</li>
</ul>
</div>
<div class="section" id="s-urls">
<span id="urls"></span><h4>URLs<a class="headerlink" href="#urls" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>在 <a class="reference internal" href="../ref/applications.html#django.setup" title="django.setup"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.setup()</span></code></a> 中的一个新添加允许在请求/响应周期之外发生的 URL 解析（例如在管理命令和独立脚本中）在设置 <a class="reference internal" href="../ref/settings.html#std-setting-FORCE_SCRIPT_NAME"><code class="xref std std-setting docutils literal notranslate"><span class="pre">FORCE_SCRIPT_NAME</span></code></a> 时考虑到它。</li>
</ul>
</div>
<div class="section" id="s-validators">
<span id="validators"></span><h4>验证器<a class="headerlink" href="#validators" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/validators.html#django.core.validators.URLValidator" title="django.core.validators.URLValidator"><code class="xref py py-class docutils literal notranslate"><span class="pre">URLValidator</span></code></a> 现在将域名标签的长度限制为 63 个字符，域名的总长度限制为 253 个字符，符合 <span class="target" id="index-7"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1034.html"><strong>RFC 1034</strong></a> 的规定。</li>
<li><a class="reference internal" href="../ref/validators.html#django.core.validators.int_list_validator" title="django.core.validators.int_list_validator"><code class="xref py py-func docutils literal notranslate"><span class="pre">int_list_validator()</span></code></a> 现在接受一个可选的布尔参数 <code class="docutils literal notranslate"><span class="pre">allow_negative</span></code>，默认为 <code class="docutils literal notranslate"><span class="pre">False</span></code>，以允许负整数。</li>
</ul>
</div>
</div>
</div>
<div class="section" id="s-backwards-incompatible-changes-in-1-10">
<span id="s-backwards-incompatible-1-10"></span><span id="backwards-incompatible-changes-in-1-10"></span><span id="backwards-incompatible-1-10"></span><h2>1.10 中的不向后兼容的变更<a class="headerlink" href="#backwards-incompatible-changes-in-1-10" title="永久链接至标题">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">除了本节中概述的更改之外，请务必查看 <a class="reference internal" href="#removed-features-1-10"><span class="std std-ref">在 1.10 中移除的功能</span></a>，了解已经到达了弃用周期终点并因此被移除的功能。如果您没有在给定功能的弃用时间表内更新您的代码，它的移除可能会被视为不兼容的更改。</p>
</div>
<div class="section" id="s-database-backend-api">
<span id="database-backend-api"></span><h3>数据库后端 API<a class="headerlink" href="#database-backend-api" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>GIS 的 <code class="docutils literal notranslate"><span class="pre">AreaField</span></code> 使用一个未指定的底层数字类型，实际上可以是任何 Python 数值类型。从数据库中检索到的 <code class="docutils literal notranslate"><span class="pre">decimal.Decimal</span></code> 值现在被转换为 <code class="docutils literal notranslate"><span class="pre">float</span></code>，以便更容易将它们与 GIS 库使用的值结合在一起。</li>
<li>为了启用时间减法，您必须将数据库功能标志 <code class="docutils literal notranslate"><span class="pre">supports_temporal_subtraction</span></code> 设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code>，并实现 <code class="docutils literal notranslate"><span class="pre">DatabaseOperations.subtract_temporals()</span></code> 方法。该方法应返回计算``lhs`` 和 <code class="docutils literal notranslate"><span class="pre">rhs</span></code> 参数之间差异的微秒数所需的 SQL 和参数，其数据类型用于存储 <a class="reference internal" href="../ref/models/fields.html#django.db.models.DurationField" title="django.db.models.DurationField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DurationField</span></code></a>。</li>
</ul>
</div>
<div class="section" id="s-select-related-prohibits-non-relational-fields-for-nested-relations">
<span id="select-related-prohibits-non-relational-fields-for-nested-relations"></span><h3><code class="docutils literal notranslate"><span class="pre">select_related()</span></code> 禁止嵌套关系的非关系字段。<a class="headerlink" href="#select-related-prohibits-non-relational-fields-for-nested-relations" title="永久链接至标题">¶</a></h3>
<p>Django 1.8 添加了 <code class="docutils literal notranslate"><span class="pre">select_related()</span></code> 中非关系字段的验证：</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">FieldError</span>: <span class="n">Non-relational field given in select_related: &#39;title&#39;</span>
</pre></div>
</div>
<p>但是现在它禁止了嵌套的非关系字段，而之前没有禁止。</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="s2">&quot;author__name&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">FieldError</span>: <span class="n">Non-relational field given in select_related: &#39;name&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="s-meta-get-fields-returns-consistent-reverse-fields-for-proxy-models">
<span id="meta-get-fields-returns-consistent-reverse-fields-for-proxy-models"></span><h3><code class="docutils literal notranslate"><span class="pre">_meta.get_fields()</span></code> 为代理模型返回一致的反向字段。<a class="headerlink" href="#meta-get-fields-returns-consistent-reverse-fields-for-proxy-models" title="永久链接至标题">¶</a></h3>
<p>在 Django 1.10 之前，当在代理模型上调用 <a class="reference internal" href="../ref/models/meta.html#django.db.models.options.Options.get_fields" title="django.db.models.options.Options.get_fields"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_fields()</span></code></a> 方法时，返回的反向字段与其代理的具体类相比是不同的。这种不一致性已经通过在两种情况下都返回指向具体类或其代理之一的字段的完整集合来修复。</p>
</div>
<div class="section" id="s-abstractuser-username-max-length-increased-to-150">
<span id="abstractuser-username-max-length-increased-to-150"></span><h3><a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.models.User.username" title="django.contrib.auth.models.User.username"><code class="xref py py-attr docutils literal notranslate"><span class="pre">AbstractUser.username</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">max_length</span></code> 增加到了 150。<a class="headerlink" href="#abstractuser-username-max-length-increased-to-150" title="永久链接至标题">¶</a></h3>
<p>包括了一个针对 <a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.models.User.username" title="django.contrib.auth.models.User.username"><code class="xref py py-attr docutils literal notranslate"><span class="pre">django.contrib.auth.models.User.username</span></code></a> 的迁移。如果您有一个继承自 <code class="docutils literal notranslate"><span class="pre">AbstractUser</span></code> 的自定义用户模型，您需要为您的用户模型生成并应用一个数据库迁移。</p>
<p>我们考虑将用户名的最大长度增加到 254 个字符，以更容易允许使用电子邮件地址（限制为 254 个字符）作为用户名，但由于 MySQL 的限制而拒绝了这个提案。当使用 <code class="docutils literal notranslate"><span class="pre">utf8mb4</span></code> 编码（推荐用于正确支持 Unicode）时，默认情况下，MySQL 只能创建包含 191 个字符的唯一索引。因此，如果您需要更长的长度，请使用自定义用户模型。</p>
<p>如果您想保留用户名的 30 个字符限制，请在创建用户或更改用户名时使用自定义表单：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">UserCreationForm</span>


<span class="k">class</span> <span class="nc">MyUserCreationForm</span><span class="p">(</span><span class="n">UserCreationForm</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Required. 30 characters or fewer. Letters, digits and @/./+/-/_ only.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>如果您希望在管理员中保留这个限制，可以将 <code class="docutils literal notranslate"><span class="pre">UserAdmin.add_form</span></code> 设置为使用以下表单：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.admin</span> <span class="kn">import</span> <span class="n">UserAdmin</span> <span class="k">as</span> <span class="n">BaseUserAdmin</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>


<span class="k">class</span> <span class="nc">UserAdmin</span><span class="p">(</span><span class="n">BaseUserAdmin</span><span class="p">):</span>
    <span class="n">add_form</span> <span class="o">=</span> <span class="n">MyUserCreationForm</span>


<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">unregister</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">UserAdmin</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-dropped-support-for-postgresql-9-1">
<span id="dropped-support-for-postgresql-9-1"></span><h3>停止支持 PostgreSQL 9.1<a class="headerlink" href="#dropped-support-for-postgresql-9-1" title="永久链接至标题">¶</a></h3>
<p>PostgreSQL 9.1 的上游支持将在 2016 年 9 月结束。因此，Django 1.10 将 PostgreSQL 9.2 设置为其正式支持的最低版本。</p>
</div>
<div class="section" id="s-runserver-output-goes-through-logging">
<span id="runserver-output-goes-through-logging"></span><h3><code class="docutils literal notranslate"><span class="pre">runserver</span></code> 输出经过日志记录<a class="headerlink" href="#runserver-output-goes-through-logging" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">runserver</span></code> 命令的请求和响应处理发送到 <a class="reference internal" href="../ref/logging.html#django-server-logger"><span class="std std-ref">django.server</span></a> 日志记录器，而不是发送到 <code class="docutils literal notranslate"><span class="pre">sys.stderr</span></code>。如果您禁用了 Django 的日志配置或使用自己的配置覆盖了它，如果您想看到该输出，您需要添加适当的日志配置：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LOGGING</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s2">&quot;formatters&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;django.server&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;()&quot;</span><span class="p">:</span> <span class="s2">&quot;django.utils.log.ServerFormatter&quot;</span><span class="p">,</span>
            <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;[</span><span class="si">%(server_time)s</span><span class="s2">] </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;handlers&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;django.server&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;logging.StreamHandler&quot;</span><span class="p">,</span>
            <span class="s2">&quot;formatter&quot;</span><span class="p">:</span> <span class="s2">&quot;django.server&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s2">&quot;loggers&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;django.server&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;handlers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;django.server&quot;</span><span class="p">],</span>
            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;propagate&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="s-auth-customuser-and-auth-extensionuser-test-models-were-removed">
<span id="auth-customuser-and-auth-extensionuser-test-models-were-removed"></span><h3><code class="docutils literal notranslate"><span class="pre">auth.CustomUser</span></code> 和 <code class="docutils literal notranslate"><span class="pre">auth.ExtensionUser</span></code> 测试模型已被移除。<a class="headerlink" href="#auth-customuser-and-auth-extensionuser-test-models-were-removed" title="永久链接至标题">¶</a></h3>
<p>自 Django 1.8 开始为 contrib 应用程序引入迁移以来，这些自定义用户测试模型的表不再创建，使它们无法在测试环境中使用。</p>
</div>
<div class="section" id="s-apps-registry-is-no-longer-auto-populated-when-unpickling-models-outside-of-django">
<span id="apps-registry-is-no-longer-auto-populated-when-unpickling-models-outside-of-django"></span><h3>在 Django 之外反序列化模型时，应用程序注册表不再自动填充。<a class="headerlink" href="#apps-registry-is-no-longer-auto-populated-when-unpickling-models-outside-of-django" title="永久链接至标题">¶</a></h3>
<p>在反序列化模型时，不再自动填充应用程序注册表。这在 Django 1.7.2 中添加，是为了允许在 Django 之外反序列化模型，比如在 RQ worker 中，而不需要调用 <code class="docutils literal notranslate"><span class="pre">django.setup()</span></code>，但这会导致死锁的可能性。在 RQ 的情况下，为了适应您的代码，您可以 <a class="reference external" href="https://python-rq.org/docs/workers/">提供自己的工作脚本</a>，其中调用 <code class="docutils literal notranslate"><span class="pre">django.setup()</span></code>。</p>
</div>
<div class="section" id="s-removed-null-assignment-check-for-non-null-foreign-key-fields">
<span id="removed-null-assignment-check-for-non-null-foreign-key-fields"></span><h3>删除了非空外键字段的空值赋值检查。<a class="headerlink" href="#removed-null-assignment-check-for-non-null-foreign-key-fields" title="永久链接至标题">¶</a></h3>
<p>在旧版本中，将 <code class="docutils literal notranslate"><span class="pre">None</span></code> 分配给非空 <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code> 或 <code class="docutils literal notranslate"><span class="pre">OneToOneField</span></code> 会引发 <code class="docutils literal notranslate"><span class="pre">ValueError('Cannot</span> <span class="pre">assign</span> <span class="pre">None:</span> <span class="pre">&quot;model.field&quot;</span> <span class="pre">does</span> <span class="pre">not</span> <span class="pre">allow</span> <span class="pre">null</span> <span class="pre">values.')</span></code>。为了与没有类似检查的其他模型字段保持一致，此检查已被移除。</p>
</div>
<div class="section" id="s-removed-weak-password-hashers-from-the-default-password-hashers-setting">
<span id="removed-weak-password-hashers-from-the-default-password-hashers-setting"></span><h3>从默认的 <code class="docutils literal notranslate"><span class="pre">PASSWORD_HASHERS</span></code> 设置中移除了弱密码哈希器。<a class="headerlink" href="#removed-weak-password-hashers-from-the-default-password-hashers-setting" title="永久链接至标题">¶</a></h3>
<p>Django 0.90 将密码存储为未加盐的 MD5 。 Django 0.91 添加了对加盐 SHA1 的支持，并在用户登录时自动升级密码。 Django 1.4 将 PBKDF2 作为默认密码哈希器。</p>
<p>如果您有一个旧的 Django 项目，其中包含使用 MD5 或 SHA1（即使使用了盐值）编码的密码，请注意，这些密码可以在今天的硬件上相对容易地被破解。为了让 Django 用户确认继续使用弱哈希器，以下哈希器已从默认的 <a class="reference internal" href="../ref/settings.html#std-setting-PASSWORD_HASHERS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">PASSWORD_HASHERS</span></code></a> 设置中移除：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;django.contrib.auth.hashers.SHA1PasswordHasher&quot;</span>
<span class="s2">&quot;django.contrib.auth.hashers.MD5PasswordHasher&quot;</span>
<span class="s2">&quot;django.contrib.auth.hashers.UnsaltedSHA1PasswordHasher&quot;</span>
<span class="s2">&quot;django.contrib.auth.hashers.UnsaltedMD5PasswordHasher&quot;</span>
<span class="s2">&quot;django.contrib.auth.hashers.CryptPasswordHasher&quot;</span>
</pre></div>
</div>
<p>考虑使用一个 <a class="reference internal" href="../topics/auth/passwords.html#wrapping-password-hashers"><span class="std std-ref">包装的密码哈希器</span></a> 来加强数据库中的哈希值。如果这不可行，可以将 <a class="reference internal" href="../ref/settings.html#std-setting-PASSWORD_HASHERS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">PASSWORD_HASHERS</span></code></a> 设置添加到您的项目中，并添加回您需要的任何哈希器。</p>
<p>您可以像这样检查您的数据库是否具有任何已删除的哈希器：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">get_user_model</span>

<span class="n">User</span> <span class="o">=</span> <span class="n">get_user_model</span><span class="p">()</span>

<span class="c1"># Unsalted MD5/SHA1:</span>
<span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">password__startswith</span><span class="o">=</span><span class="s2">&quot;md5$$&quot;</span><span class="p">)</span>
<span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">password__startswith</span><span class="o">=</span><span class="s2">&quot;sha1$$&quot;</span><span class="p">)</span>
<span class="c1"># Salted MD5/SHA1:</span>
<span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">password__startswith</span><span class="o">=</span><span class="s2">&quot;md5$&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">password__startswith</span><span class="o">=</span><span class="s2">&quot;md5$$&quot;</span><span class="p">)</span>
<span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">password__startswith</span><span class="o">=</span><span class="s2">&quot;sha1$&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">password__startswith</span><span class="o">=</span><span class="s2">&quot;sha1$$&quot;</span><span class="p">)</span>
<span class="c1"># Crypt hasher:</span>
<span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">password__startswith</span><span class="o">=</span><span class="s2">&quot;crypt$$&quot;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">CharField</span>
<span class="kn">from</span> <span class="nn">django.db.models.functions</span> <span class="kn">import</span> <span class="n">Length</span>

<span class="n">CharField</span><span class="o">.</span><span class="n">register_lookup</span><span class="p">(</span><span class="n">Length</span><span class="p">)</span>
<span class="c1"># Unsalted MD5 passwords might not have an &#39;md5$$&#39; prefix:</span>
<span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">password__length</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-field-get-prep-lookup-and-field-get-db-prep-lookup-methods-are-removed">
<span id="field-get-prep-lookup-and-field-get-db-prep-lookup-methods-are-removed"></span><h3><code class="docutils literal notranslate"><span class="pre">Field.get_prep_lookup()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Field.get_db_prep_lookup()</span></code> 方法已被移除。<a class="headerlink" href="#field-get-prep-lookup-and-field-get-db-prep-lookup-methods-are-removed" title="永久链接至标题">¶</a></h3>
<p>如果您有一个自定义字段实现了这两种方法中的任何一种，请为其注册一个自定义查找。例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Field</span>
<span class="kn">from</span> <span class="nn">django.db.models.lookups</span> <span class="kn">import</span> <span class="n">Exact</span>


<span class="k">class</span> <span class="nc">MyField</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span> <span class="o">...</span>


<span class="k">class</span> <span class="nc">MyFieldExact</span><span class="p">(</span><span class="n">Exact</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_prep_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># do_custom_stuff_for_myfield</span>
        <span class="o">...</span>


<span class="n">MyField</span><span class="o">.</span><span class="n">register_lookup</span><span class="p">(</span><span class="n">MyFieldExact</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-id1">
<span id="id1"></span><h3><a class="reference internal" href="../ref/contrib/gis/index.html#module-django.contrib.gis" title="django.contrib.gis: Geographic Information System (GIS) extensions for Django"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a><a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>不再支持 SpatiaLite &lt; 3.0 和 GEOS &lt; 3.3 。</li>
<li><code class="docutils literal notranslate"><span class="pre">add_postgis_srs()</span></code> 的向后兼容别名已被移除，应使用 <code class="docutils literal notranslate"><span class="pre">django.contrib.gis.utils.add_srs_entry()</span></code>。</li>
<li>在 Oracle/GIS 上，<a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.Area" title="django.contrib.gis.db.models.functions.Area"><code class="xref py py-class docutils literal notranslate"><span class="pre">Area</span></code></a> 聚合函数现在返回一个 <code class="docutils literal notranslate"><span class="pre">float</span></code>，而不再是 <code class="docutils literal notranslate"><span class="pre">decimal.Decimal</span></code>。（它仍然以平方米为单位包装。）</li>
<li>默认情况下，<a class="reference internal" href="../ref/contrib/gis/geos.html#django.contrib.gis.geos.GEOSGeometry" title="django.contrib.gis.geos.GEOSGeometry"><code class="xref py py-class docutils literal notranslate"><span class="pre">GEOSGeometry</span></code></a> 的表示形式（WKT 输出）现在默认被修剪。也就是说，不再是 <code class="docutils literal notranslate"><span class="pre">POINT</span> <span class="pre">(23.0000000000000000</span> <span class="pre">5.5000000000000000)</span></code>，而是 <code class="docutils literal notranslate"><span class="pre">POINT</span> <span class="pre">(23</span> <span class="pre">5.5)</span></code>。</li>
</ul>
</div>
<div class="section" id="s-maximum-size-of-a-request-body-and-the-number-of-get-post-parameters-is-limited">
<span id="maximum-size-of-a-request-body-and-the-number-of-get-post-parameters-is-limited"></span><h3>请求体的最大大小以及 GET/POST 参数的数量受到限制。<a class="headerlink" href="#maximum-size-of-a-request-body-and-the-number-of-get-post-parameters-is-limited" title="永久链接至标题">¶</a></h3>
<p>两个新配置有助于减轻通过大型请求发起的拒绝服务攻击：</p>
<ul class="simple">
<li><a class="reference internal" href="../ref/settings.html#std-setting-DATA_UPLOAD_MAX_MEMORY_SIZE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DATA_UPLOAD_MAX_MEMORY_SIZE</span></code></a> 限制请求主体的大小。文件上传不计入此限制。</li>
<li><a class="reference internal" href="../ref/settings.html#std-setting-DATA_UPLOAD_MAX_NUMBER_FIELDS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DATA_UPLOAD_MAX_NUMBER_FIELDS</span></code></a> 限制解析的 GET/POST 参数的数量。</li>
</ul>
<p>接收异常大表单提交的应用程序可能需要调整这些设置。</p>
</div>
<div class="section" id="s-miscellaneous">
<span id="miscellaneous"></span><h3>杂项<a class="headerlink" href="#miscellaneous" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">QuerySet</span></code> 的 <code class="docutils literal notranslate"><span class="pre">repr()</span></code> 现在在调试时会包装在 <code class="docutils literal notranslate"><span class="pre">&lt;QuerySet</span> <span class="pre">&gt;</span></code> 中，以便与普通列表进行区分。</li>
<li><code class="docutils literal notranslate"><span class="pre">utils.version.get_version()</span></code> 返回符合 <span class="target" id="index-8"></span><a class="pep reference external" href="https://peps.python.org/pep-0440/"><strong>PEP 440</strong></a> 的候选版本（例如 '1.10rc1' 而不是 '1.10c1'）。</li>
<li>现在要求 CSRF 令牌值必须是 64 个字母数字字符串；默认情况下，由旧版 Django 设置的 32 个字母数字值将自动替换为 64 个字符的字符串。其他值将被视为无效。这应该只会影响替换这些令牌的开发人员或用户。</li>
<li><code class="docutils literal notranslate"><span class="pre">LOGOUT_URL</span></code> 设置已删除，因为自 1.0 版本以来 Django 不再使用它。如果你在项目中使用了它，可以将其添加到项目的设置中。默认值是 <code class="docutils literal notranslate"><span class="pre">'/accounts/logout/'</span></code>。</li>
<li>具有 <code class="docutils literal notranslate"><span class="pre">close()</span></code> 方法的对象，例如文件和生成器，传递给 <a class="reference internal" href="../ref/request-response.html#django.http.HttpResponse" title="django.http.HttpResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpResponse</span></code></a> 现在会立即关闭，而不是在 WSGI 服务器调用响应的 <code class="docutils literal notranslate"><span class="pre">close()</span></code> 方法时关闭。</li>
<li>在 <code class="docutils literal notranslate"><span class="pre">QuerySet.update_or_create()</span></code> 中删除了多余的 <code class="docutils literal notranslate"><span class="pre">transaction.atomic()</span></code> 调用。这可能会影响 <code class="docutils literal notranslate"><span class="pre">TransactionTestCase.assertNumQueries()</span></code> 测试的查询计数。</li>
<li>在 <code class="docutils literal notranslate"><span class="pre">BaseCommand.execute(**options)</span></code> 中删除了对 <code class="docutils literal notranslate"><span class="pre">skip_validation</span></code> 的支持。请改用 <code class="docutils literal notranslate"><span class="pre">skip_checks</span></code> （Django 1.7 中添加）来代替。</li>
<li>现在，在指定的夹具文件未找到时，<a class="reference internal" href="../ref/django-admin.html#django-admin-loaddata"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">loaddata</span></code></a> 将引发一个 <code class="docutils literal notranslate"><span class="pre">CommandError</span></code>，而不是显示警告。</li>
<li>现在，最好调用 <code class="docutils literal notranslate"><span class="pre">LogEntry.get_change_message()</span></code> 方法来获取日志条目的消息，而不是直接访问 <code class="docutils literal notranslate"><span class="pre">LogEntry.change_message</span></code> 属性，这样可以提供当前语言的消息。</li>
<li>如果指定了不存在的 <code class="docutils literal notranslate"><span class="pre">template_name</span></code>，默认错误视图现在会引发 <code class="docutils literal notranslate"><span class="pre">TemplateDoesNotExist</span></code> 异常。</li>
<li><code class="docutils literal notranslate"><span class="pre">Select</span></code> 和 <code class="docutils literal notranslate"><span class="pre">SelectMultiple</span></code> 小部件的 <code class="docutils literal notranslate"><span class="pre">render()</span></code> 方法中未使用的 <code class="docutils literal notranslate"><span class="pre">choices</span></code> 关键字参数已被移除。 <code class="docutils literal notranslate"><span class="pre">render_options()</span></code> 方法中的 <code class="docutils literal notranslate"><span class="pre">choices</span></code> 参数也已被移除，现在 <code class="docutils literal notranslate"><span class="pre">selected_choices</span></code> 是第一个参数。</li>
<li>现在，在支持可延迟约束的数据库上运行的违反可延迟数据库约束的测试将会出现错误。</li>
<li>内置管理命令现在使用 <code class="docutils literal notranslate"><span class="pre">options</span></code> 中键的索引，例如 <code class="docutils literal notranslate"><span class="pre">options['verbosity']</span></code>，而不是 <code class="docutils literal notranslate"><span class="pre">options.get()</span></code>，并且不再执行任何类型强制转换。如果你正在使用 <code class="docutils literal notranslate"><span class="pre">Command.execute()</span></code> 调用命令（绕过设置默认值的参数解析器），而不是 <a class="reference internal" href="../ref/django-admin.html#django.core.management.call_command" title="django.core.management.call_command"><code class="xref py py-func docutils literal notranslate"><span class="pre">call_command()</span></code></a>，这可能会导致问题。不要调用 <code class="docutils literal notranslate"><span class="pre">Command.execute()</span></code>，而是将命令对象作为第一个参数传递给 <code class="docutils literal notranslate"><span class="pre">call_command()</span></code>。</li>
<li><a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.backends.ModelBackend" title="django.contrib.auth.backends.ModelBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelBackend</span></code></a> 和 <a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.backends.RemoteUserBackend" title="django.contrib.auth.backends.RemoteUserBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">RemoteUserBackend</span></code></a> 现在会拒绝不活跃的用户。这意味着不活跃的用户无法登录，如果将他们从 <code class="docutils literal notranslate"><span class="pre">is_active=True</span></code> 更改为 <code class="docutils literal notranslate"><span class="pre">False</span></code>，他们将被登出。如果需要以前的行为，请在 <a class="reference internal" href="../ref/settings.html#std-setting-AUTHENTICATION_BACKENDS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">AUTHENTICATION_BACKENDS</span></code></a> 中使用新的 <a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.backends.AllowAllUsersModelBackend" title="django.contrib.auth.backends.AllowAllUsersModelBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">AllowAllUsersModelBackend</span></code></a> 或 <a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.backends.AllowAllUsersRemoteUserBackend" title="django.contrib.auth.backends.AllowAllUsersRemoteUserBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">AllowAllUsersRemoteUserBackend</span></code></a>。</li>
<li>鉴于先前的更改，测试客户端的 <a class="reference internal" href="../topics/testing/tools.html#django.test.Client.login" title="django.test.Client.login"><code class="xref py py-meth docutils literal notranslate"><span class="pre">login()</span></code></a> 方法不再始终拒绝不活跃的用户，而是将这个决定委托给身份验证后端。 <a class="reference internal" href="../topics/testing/tools.html#django.test.Client.force_login" title="django.test.Client.force_login"><code class="xref py py-meth docutils literal notranslate"><span class="pre">force_login()</span></code></a> 也将决定委托给身份验证后端，因此如果你使用默认的后端，你需要使用一个活跃的用户。</li>
<li><a class="reference internal" href="../topics/i18n/translation.html#django.views.i18n.set_language" title="django.views.i18n.set_language"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.views.i18n.set_language()</span></code></a> 现在可以为 AJAX 请求返回一个 204 状态码。</li>
<li><a class="reference internal" href="../ref/contrib/postgres/fields.html#django.contrib.postgres.fields.RangeField" title="django.contrib.postgres.fields.RangeField"><code class="xref py py-class docutils literal notranslate"><span class="pre">RangeField</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">base_field</span></code> 属性现在是一个字段类型，而不是字段的实例。如果你创建了 <a class="reference internal" href="../ref/contrib/postgres/fields.html#django.contrib.postgres.fields.RangeField" title="django.contrib.postgres.fields.RangeField"><code class="xref py py-class docutils literal notranslate"><span class="pre">RangeField</span></code></a> 的自定义子类，你应该更改 <code class="docutils literal notranslate"><span class="pre">base_field</span></code> 属性。</li>
<li>现在，中间件类在服务器启动时初始化，而不是在第一个请求期间。</li>
<li>如果你在自定义用户模型中重写了 <code class="docutils literal notranslate"><span class="pre">is_authenticated()</span></code> 或 <code class="docutils literal notranslate"><span class="pre">is_anonymous()</span></code> 方法，你必须将它们转换为属性或属性，如 <a class="reference internal" href="#user-is-auth-anon-deprecation"><span class="std std-ref">弃用说明</span></a> 中所述。</li>
<li>当使用 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.save_as" title="django.contrib.admin.ModelAdmin.save_as"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ModelAdmin.save_as=True</span></code></a> 时，&quot;Save as new&quot; 按钮现在会重定向到新对象的修改视图，而不是模型的变更列表。如果你需要之前的行为，请将新的 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.save_as_continue" title="django.contrib.admin.ModelAdmin.save_as_continue"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ModelAdmin.save_as_continue</span></code></a> 属性设置为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。</li>
<li>必填的表单字段现在具有 <code class="docutils literal notranslate"><span class="pre">required</span></code> HTML 属性。如果要禁用它，请将 <a class="reference internal" href="../ref/forms/api.html#django.forms.Form.use_required_attribute" title="django.forms.Form.use_required_attribute"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Form.use_required_attribute</span></code></a> 属性设置为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。如果不想要浏览器验证，还可以在 <code class="docutils literal notranslate"><span class="pre">&lt;form&gt;</span></code> 中添加 <code class="docutils literal notranslate"><span class="pre">novalidate</span></code> 属性。如果要在自定义小部件上禁用 <code class="docutils literal notranslate"><span class="pre">required</span></code> 属性，请重写 <a class="reference internal" href="../ref/forms/widgets.html#django.forms.Widget.use_required_attribute" title="django.forms.Widget.use_required_attribute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Widget.use_required_attribute()</span></code></a> 方法。</li>
<li>WSGI 处理程序不再从 <code class="docutils literal notranslate"><span class="pre">HEAD</span></code> 请求或具有 <code class="docutils literal notranslate"><span class="pre">status_code</span></code> 为 100-199、204 或 304 的响应中删除内容。大多数 Web 服务器已经实现了这种行为。使用 Django 测试客户端检索的响应仍然会应用这些 &quot;响应修复&quot;。</li>
<li><code class="docutils literal notranslate"><span class="pre">Model.__init__()</span></code> 现在会将 <code class="docutils literal notranslate"><span class="pre">django.db.models.DEFERRED</span></code> 作为延迟字段的值。</li>
<li><code class="docutils literal notranslate"><span class="pre">Model._deferred</span></code> 属性在使用 <code class="docutils literal notranslate"><span class="pre">QuerySet.defer()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">only()</span></code> 时动态模型类被移除。</li>
<li><a class="reference internal" href="../ref/files/storage.html#django.core.files.storage.Storage.save" title="django.core.files.storage.Storage.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Storage.save()</span></code></a> 不再将 <code class="docutils literal notranslate"><span class="pre">'\'</span></code> 替换为 <code class="docutils literal notranslate"><span class="pre">'/'</span></code>。这个行为已经移到 <a class="reference internal" href="../ref/files/storage.html#django.core.files.storage.FileSystemStorage" title="django.core.files.storage.FileSystemStorage"><code class="xref py py-class docutils literal notranslate"><span class="pre">FileSystemStorage</span></code></a> 中，因为这是一个与存储相关的具体实现细节。如果有自定义存储实现依赖这个行为的 Windows 用户，需要在自定义存储的 <code class="docutils literal notranslate"><span class="pre">save()</span></code> 方法中实现这个行为。</li>
<li>私有的 <a class="reference internal" href="../ref/models/fields.html#django.db.models.FileField" title="django.db.models.FileField"><code class="xref py py-class docutils literal notranslate"><span class="pre">FileField</span></code></a> 方法 <code class="docutils literal notranslate"><span class="pre">get_directory_name()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">get_filename()</span></code> 不再被调用（并且现在已被弃用），这对于在自定义字段上重写这些方法的用户来说是一个不兼容的变更。要适应这种代码，可以重写 <code class="docutils literal notranslate"><span class="pre">FileField.generate_filename()</span></code> 或 <a class="reference internal" href="../ref/files/storage.html#django.core.files.storage.Storage.generate_filename" title="django.core.files.storage.Storage.generate_filename"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Storage.generate_filename()</span></code></a>。也可能可以使用 <a class="reference internal" href="../ref/models/fields.html#django.db.models.FileField.upload_to" title="django.db.models.FileField.upload_to"><code class="xref py py-attr docutils literal notranslate"><span class="pre">upload_to</span></code></a>。</li>
<li>由 <code class="docutils literal notranslate"><span class="pre">AdminEmailHandler</span></code> 发送的邮件主题不再在 989 个字符处截断。如果你依赖于有限的长度，请自行截断主题。</li>
<li>私有表达式 <code class="docutils literal notranslate"><span class="pre">django.db.models.expressions.Date</span></code> 和 <code class="docutils literal notranslate"><span class="pre">DateTime</span></code> 已被移除。新的 <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Trunc" title="django.db.models.functions.Trunc"><code class="xref py py-class docutils literal notranslate"><span class="pre">Trunc</span></code></a> 表达式提供了相同的功能。</li>
<li>模型实例中的 <code class="docutils literal notranslate"><span class="pre">_base_manager</span></code> 和 <code class="docutils literal notranslate"><span class="pre">_default_manager</span></code> 属性已被移除。您仍然可以在模型类上访问它们。</li>
<li>在模型实例上访问已删除的字段（例如，在执行 <code class="docutils literal notranslate"><span class="pre">del</span> <span class="pre">obj.field</span></code> 后）将重新加载字段的值，而不会引发 <code class="docutils literal notranslate"><span class="pre">AttributeError</span></code>。</li>
<li>如果您子类化了 <code class="docutils literal notranslate"><span class="pre">AbstractBaseUser</span></code> 并覆盖了 <code class="docutils literal notranslate"><span class="pre">clean()</span></code> 方法，请确保在其中调用 <code class="docutils literal notranslate"><span class="pre">super()</span></code>。现在在新的 <a class="reference internal" href="../topics/auth/customizing.html#django.contrib.auth.models.AbstractBaseUser.clean" title="django.contrib.auth.models.AbstractBaseUser.clean"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AbstractBaseUser.clean()</span></code></a> 方法中调用了 <a class="reference internal" href="../topics/auth/customizing.html#django.contrib.auth.models.AbstractBaseUser.normalize_username" title="django.contrib.auth.models.AbstractBaseUser.normalize_username"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AbstractBaseUser.normalize_username()</span></code></a>。</li>
<li>私有 API <code class="docutils literal notranslate"><span class="pre">django.forms.models.model_to_dict()</span></code> 现在返回一个查询集而不是 <code class="docutils literal notranslate"><span class="pre">ManyToManyField</span></code> 的主键列表。</li>
<li>如果安装了 <code class="docutils literal notranslate"><span class="pre">django.contrib.staticfiles</span></code>，那么 <a class="reference internal" href="../ref/templates/builtins.html#std-templatetag-static"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">static</span></code></a> 模板标签将使用 <code class="docutils literal notranslate"><span class="pre">staticfiles</span></code> 存储来构建 URL，而不仅仅是与 <code class="docutils literal notranslate"><span class="pre">STATIC_ROOT</span></code> 连接。这种新方法对URL进行了编码，可能在包含路径中的片段的情况下存在向后不兼容性，例如 <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">static</span> <span class="pre">'img.svg#fragment'</span> <span class="pre">%}</span></code>，因为 <code class="docutils literal notranslate"><span class="pre">#</span></code> 被编码为 <code class="docutils literal notranslate"><span class="pre">%23</span></code>。要进行适应，将片段移到模板标签之外：<code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">static</span> <span class="pre">'img.svg'</span> <span class="pre">%}#fragment</span></code>。</li>
<li>当 <code class="docutils literal notranslate"><span class="pre">USE_L10N</span></code> 为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 时，如果没有指定格式字符串，则 <a class="reference internal" href="../ref/templates/builtins.html#std-templatefilter-date"><code class="xref std std-tfilter docutils literal notranslate"><span class="pre">date</span></code></a> 和 <a class="reference internal" href="../ref/templates/builtins.html#std-templatefilter-time"><code class="xref std std-tfilter docutils literal notranslate"><span class="pre">time</span></code></a> 过滤器现在会应用本地化。它们将使用活动区域设置中的 <code class="docutils literal notranslate"><span class="pre">DATE_FORMAT</span></code> 和 <code class="docutils literal notranslate"><span class="pre">TIME_FORMAT</span></code> 指示符，而不是同名的设置。</li>
</ul>
</div>
</div>
<div class="section" id="s-features-deprecated-in-1-10">
<span id="s-deprecated-features-1-10"></span><span id="features-deprecated-in-1-10"></span><span id="deprecated-features-1-10"></span><h2>在 1.10 中被废弃的功能<a class="headerlink" href="#features-deprecated-in-1-10" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-direct-assignment-to-a-reverse-foreign-key-or-many-to-many-relation">
<span id="direct-assignment-to-a-reverse-foreign-key-or-many-to-many-relation"></span><h3>直接分配给反向外键或多对多关系<a class="headerlink" href="#direct-assignment-to-a-reverse-foreign-key-or-many-to-many-relation" title="永久链接至标题">¶</a></h3>
<p>不要使用直接分配来分配相关对象：</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">new_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">,</span> <span class="n">obj3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e</span><span class="o">.</span><span class="n">related_set</span> <span class="o">=</span> <span class="n">new_list</span>
</pre></div>
</div>
<p>使用 Django 1.9 中添加的 <a class="reference internal" href="../ref/models/relations.html#django.db.models.fields.related.RelatedManager.set" title="django.db.models.fields.related.RelatedManager.set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set()</span></code></a> 方法：</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">e</span><span class="o">.</span><span class="n">related_set</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">,</span> <span class="n">obj3</span><span class="p">])</span>
</pre></div>
</div>
<p>这可以避免因隐式保存导致的分配混淆。</p>
</div>
<div class="section" id="s-non-timezone-aware-storage-api">
<span id="non-timezone-aware-storage-api"></span><h3>非时区感知的 <a class="reference internal" href="../ref/files/storage.html#django.core.files.storage.Storage" title="django.core.files.storage.Storage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Storage</span></code></a> API<a class="headerlink" href="#non-timezone-aware-storage-api" title="永久链接至标题">¶</a></h3>
<p>旧的、非时区感知的方法 <code class="docutils literal notranslate"><span class="pre">accessed_time()</span></code>, <code class="docutils literal notranslate"><span class="pre">created_time()</span></code>, 和 <code class="docutils literal notranslate"><span class="pre">modified_time()</span></code> 已被弃用，推荐使用新的 <code class="docutils literal notranslate"><span class="pre">get_*_time()</span></code> 方法。</p>
<p>第三方存储后端应该实现新的方法并将旧的方法标记为弃用。在此之前，基础的 <a class="reference internal" href="../ref/files/storage.html#django.core.files.storage.Storage" title="django.core.files.storage.Storage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Storage</span></code></a> 类上的新的 <code class="docutils literal notranslate"><span class="pre">get_*_time()</span></code> 方法将根据需要将来自旧方法的 <code class="docutils literal notranslate"><span class="pre">datetime</span></code> 转换并在这样做时发出弃用警告。</p>
<p>只要第三方存储后端希望支持早期版本的 Django，它们就可以保留旧方法。</p>
</div>
<div class="section" id="s-id2">
<span id="id2"></span><h3><a class="reference internal" href="../ref/contrib/gis/index.html#module-django.contrib.gis" title="django.contrib.gis: Geographic Information System (GIS) extensions for Django"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a><a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><a class="reference internal" href="../ref/contrib/gis/geos.html#django.contrib.gis.geos.GEOSGeometry" title="django.contrib.gis.geos.GEOSGeometry"><code class="xref py py-class docutils literal notranslate"><span class="pre">GEOSGeometry</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">get_srid()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">set_srid()</span></code> 方法已被弃用，推荐使用 <a class="reference internal" href="../ref/contrib/gis/geos.html#django.contrib.gis.geos.GEOSGeometry.srid" title="django.contrib.gis.geos.GEOSGeometry.srid"><code class="xref py py-attr docutils literal notranslate"><span class="pre">srid</span></code></a> 属性。</li>
<li><a class="reference internal" href="../ref/contrib/gis/geos.html#django.contrib.gis.geos.Point" title="django.contrib.gis.geos.Point"><code class="xref py py-class docutils literal notranslate"><span class="pre">Point</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">get_x()</span></code>, <code class="docutils literal notranslate"><span class="pre">set_x()</span></code>, <code class="docutils literal notranslate"><span class="pre">get_y()</span></code>, <code class="docutils literal notranslate"><span class="pre">set_y()</span></code>, <code class="docutils literal notranslate"><span class="pre">get_z()</span></code>, 和 <code class="docutils literal notranslate"><span class="pre">set_z()</span></code> 方法已被弃用，推荐使用 <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code>, 和 <code class="docutils literal notranslate"><span class="pre">z</span></code> 属性。</li>
<li><a class="reference internal" href="../ref/contrib/gis/geos.html#django.contrib.gis.geos.Point" title="django.contrib.gis.geos.Point"><code class="xref py py-class docutils literal notranslate"><span class="pre">Point</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">get_coords()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">set_coords()</span></code> 方法已被弃用，推荐使用 <code class="docutils literal notranslate"><span class="pre">tuple</span></code> 属性。</li>
<li><a class="reference internal" href="../ref/contrib/gis/geos.html#django.contrib.gis.geos.MultiPolygon" title="django.contrib.gis.geos.MultiPolygon"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiPolygon</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">cascaded_union</span></code> 属性已被弃用，推荐使用 <a class="reference internal" href="../ref/contrib/gis/geos.html#django.contrib.gis.geos.GEOSGeometry.unary_union" title="django.contrib.gis.geos.GEOSGeometry.unary_union"><code class="xref py py-attr docutils literal notranslate"><span class="pre">unary_union</span></code></a> 属性。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.gis.utils.precision_wkt()</span></code> 函数已被弃用，推荐使用 <a class="reference internal" href="../ref/contrib/gis/geos.html#django.contrib.gis.geos.WKTWriter" title="django.contrib.gis.geos.WKTWriter"><code class="xref py py-class docutils literal notranslate"><span class="pre">WKTWriter</span></code></a>。</li>
</ul>
</div>
<div class="section" id="s-commaseparatedintegerfield-model-field">
<span id="commaseparatedintegerfield-model-field"></span><h3><code class="docutils literal notranslate"><span class="pre">CommaSeparatedIntegerField</span></code> 模型字段<a class="headerlink" href="#commaseparatedintegerfield-model-field" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">CommaSeparatedIntegerField</span></code> 已被弃用，推荐使用 <a class="reference internal" href="../ref/models/fields.html#django.db.models.CharField" title="django.db.models.CharField"><code class="xref py py-class docutils literal notranslate"><span class="pre">CharField</span></code></a> 并配合 <a class="reference internal" href="../ref/validators.html#django.core.validators.validate_comma_separated_integer_list" title="django.core.validators.validate_comma_separated_integer_list"><code class="xref py py-func docutils literal notranslate"><span class="pre">validate_comma_separated_integer_list()</span></code></a> 验证器使用：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.core.validators</span> <span class="kn">import</span> <span class="n">validate_comma_separated_integer_list</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">numbers</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">validate_comma_separated_integer_list</span><span class="p">])</span>
</pre></div>
</div>
<p>如果您使用的是 Oracle 数据库，<code class="docutils literal notranslate"><span class="pre">CharField</span></code> 使用不同的数据库字段类型（<code class="docutils literal notranslate"><span class="pre">NVARCHAR2</span></code>）而不是 <code class="docutils literal notranslate"><span class="pre">CommaSeparatedIntegerField</span></code> （<code class="docutils literal notranslate"><span class="pre">VARCHAR2</span></code>）。根据您的数据库设置，这可能意味着相同内容的不同编码，从而导致相同内容的不同字节长度。如果您存储的值长于 <code class="docutils literal notranslate"><span class="pre">NVARCHAR2</span></code> 的 4000 字节限制，您应该改用 <code class="docutils literal notranslate"><span class="pre">TextField</span></code> （<code class="docutils literal notranslate"><span class="pre">NCLOB</span></code>）。在这种情况下，如果您有任何按字段分组的查询（例如，使用聚合注释模型或使用 <code class="docutils literal notranslate"><span class="pre">distinct()</span></code>），您需要更改它们（以延迟字段）。</p>
</div>
<div class="section" id="s-using-a-model-name-as-a-query-lookup-when-default-related-name-is-set">
<span id="using-a-model-name-as-a-query-lookup-when-default-related-name-is-set"></span><h3>当设置了 <code class="docutils literal notranslate"><span class="pre">default_related_name</span></code> 时，可以使用模型名称作为查询查找。<a class="headerlink" href="#using-a-model-name-as-a-query-lookup-when-default-related-name-is-set" title="永久链接至标题">¶</a></h3>
<p>假设以下模型：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">Bar</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">foo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Foo</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">default_related_name</span> <span class="o">=</span> <span class="s2">&quot;bars&quot;</span>
</pre></div>
</div>
<p>在较旧的版本中，不能将 <a class="reference internal" href="../ref/models/options.html#django.db.models.Options.default_related_name" title="django.db.models.Options.default_related_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">default_related_name</span></code></a> 用作查询查找。这已经得到修复，并且不再支持旧的查找名称。例如，由于在模型 <code class="docutils literal notranslate"><span class="pre">Bar</span></code> 中设置了 <code class="docutils literal notranslate"><span class="pre">default_related_name</span></code>，所以不再使用模型名称 <code class="docutils literal notranslate"><span class="pre">bar</span></code> 作为查找：</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bar</span> <span class="o">=</span> <span class="n">Bar</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Foo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bar</span><span class="o">=</span><span class="n">bar</span><span class="p">)</span>
</pre></div>
</div>
<p>使用 <code class="docutils literal notranslate"><span class="pre">default_related_name</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">bars</span></code>：</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Foo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bars</span><span class="o">=</span><span class="n">bar</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-search-query-lookup">
<span id="s-search-lookup-replacement"></span><span id="search-query-lookup"></span><span id="search-lookup-replacement"></span><h3><code class="docutils literal notranslate"><span class="pre">__search</span></code> 查询查找<a class="headerlink" href="#search-query-lookup" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">search</span></code> 查询查找已被弃用，它仅支持 MySQL，并且功能非常有限。请将其替换为自定义查询查找：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span> <span class="nc">Search</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Lookup</span><span class="p">):</span>
    <span class="n">lookup_name</span> <span class="o">=</span> <span class="s2">&quot;search&quot;</span>

    <span class="k">def</span> <span class="nf">as_mysql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
        <span class="n">lhs</span><span class="p">,</span> <span class="n">lhs_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_lhs</span><span class="p">(</span><span class="n">compiler</span><span class="p">,</span> <span class="n">connection</span><span class="p">)</span>
        <span class="n">rhs</span><span class="p">,</span> <span class="n">rhs_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_rhs</span><span class="p">(</span><span class="n">compiler</span><span class="p">,</span> <span class="n">connection</span><span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">lhs_params</span> <span class="o">+</span> <span class="n">rhs_params</span>
        <span class="k">return</span> <span class="s2">&quot;MATCH (</span><span class="si">%s</span><span class="s2">) AGAINST (</span><span class="si">%s</span><span class="s2"> IN BOOLEAN MODE)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">),</span> <span class="n">params</span>


<span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="o">.</span><span class="n">register_lookup</span><span class="p">(</span><span class="n">Search</span><span class="p">)</span>
<span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="o">.</span><span class="n">register_lookup</span><span class="p">(</span><span class="n">Search</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-using-user-is-authenticated-and-user-is-anonymous-as-methods">
<span id="s-user-is-auth-anon-deprecation"></span><span id="using-user-is-authenticated-and-user-is-anonymous-as-methods"></span><span id="user-is-auth-anon-deprecation"></span><h3>使用 <code class="docutils literal notranslate"><span class="pre">User.is_authenticated()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">User.is_anonymous()</span></code> 作为方法。<a class="headerlink" href="#using-user-is-authenticated-and-user-is-anonymous-as-methods" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../topics/auth/customizing.html#django.contrib.auth.models.AbstractBaseUser" title="django.contrib.auth.models.AbstractBaseUser"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractBaseUser</span></code></a> 和 <a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.models.AnonymousUser" title="django.contrib.auth.models.AnonymousUser"><code class="xref py py-class docutils literal notranslate"><span class="pre">AnonymousUser</span></code></a> 类的 <code class="docutils literal notranslate"><span class="pre">is_authenticated()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">is_anonymous()</span></code> 方法现在已经变成属性。它们在 Django 2.0 之前仍然作为方法使用，但在 Django 中的所有用法现在都使用属性访问。</p>
<p>例如，如果您使用 <a class="reference internal" href="../ref/middleware.html#django.contrib.auth.middleware.AuthenticationMiddleware" title="django.contrib.auth.middleware.AuthenticationMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">AuthenticationMiddleware</span></code></a> 并想知道用户当前是否已登录，您可以使用以下方式：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
    <span class="o">...</span>  <span class="c1"># Do something for logged-in users.</span>
<span class="k">else</span><span class="p">:</span>
    <span class="o">...</span>  <span class="c1"># Do something for anonymous users.</span>
</pre></div>
</div>
<p>而不是 <code class="docutils literal notranslate"><span class="pre">request.user.is_authenticated()</span></code>。</p>
<p>此更改可以避免在您忘记调用方法时意外泄露信息，例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">sensitive_information</span>
</pre></div>
</div>
<p>如果你在自定义用户模型中重写了这些方法，你必须将它们更改为属性或特性。</p>
<p>Django 使用一个 <code class="docutils literal notranslate"><span class="pre">CallableBool</span></code> 对象，以使这些属性同时可以作为属性和方法工作。因此，在弃用期结束之前，您不能使用 <code class="docutils literal notranslate"><span class="pre">is</span></code> 运算符比较这些属性。也就是说，以下操作不起作用：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="s-custom-manager-classes-available-through-prefetch-related-must-define-a-apply-rel-filters-method">
<span id="custom-manager-classes-available-through-prefetch-related-must-define-a-apply-rel-filters-method"></span><h3>通过 <code class="docutils literal notranslate"><span class="pre">prefetch_related</span></code> 可用的自定义管理器类必须定义一个 <code class="docutils literal notranslate"><span class="pre">_apply_rel_filters()</span></code> 方法。<a class="headerlink" href="#custom-manager-classes-available-through-prefetch-related-must-define-a-apply-rel-filters-method" title="永久链接至标题">¶</a></h3>
<p>如果您定义了一个通过 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.prefetch_related" title="django.db.models.query.QuerySet.prefetch_related"><code class="xref py py-meth docutils literal notranslate"><span class="pre">prefetch_related()</span></code></a> 可用的自定义管理器类，您必须确保它定义了一个 <code class="docutils literal notranslate"><span class="pre">_apply_rel_filters()</span></code> 方法。</p>
<p>这个方法必须接受一个 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet" title="django.db.models.query.QuerySet"><code class="xref py py-class docutils literal notranslate"><span class="pre">QuerySet</span></code></a> 实例作为其唯一参数，并返回与管理器绑定的模型实例的经过筛选的查询集的版本。</p>
</div>
<div class="section" id="s-the-escape-half-of-django-utils-safestring">
<span id="the-escape-half-of-django-utils-safestring"></span><h3><code class="docutils literal notranslate"><span class="pre">django.utils.safestring</span></code> 的 &quot;escape&quot; 部分<a class="headerlink" href="#the-escape-half-of-django-utils-safestring" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">mark_for_escaping()</span></code> 函数以及它使用的类：<code class="docutils literal notranslate"><span class="pre">EscapeData</span></code>、<code class="docutils literal notranslate"><span class="pre">EscapeBytes</span></code>、<code class="docutils literal notranslate"><span class="pre">EscapeText</span></code>、<code class="docutils literal notranslate"><span class="pre">EscapeString</span></code> 和 <code class="docutils literal notranslate"><span class="pre">EscapeUnicode</span></code> 已被弃用。</p>
<p>因此，<code class="docutils literal notranslate"><span class="pre">escape</span></code> 过滤器的 &quot;懒惰&quot; 行为（无论在过滤器链的哪个位置，它始终作为最后一个过滤器应用）已被弃用。在 Django 2.0 中，该过滤器将立即应用 <a class="reference internal" href="../ref/utils.html#django.utils.html.conditional_escape" title="django.utils.html.conditional_escape"><code class="xref py py-func docutils literal notranslate"><span class="pre">conditional_escape()</span></code></a>。</p>
</div>
<div class="section" id="s-manager-use-for-related-fields-and-inheritance-changes">
<span id="manager-use-for-related-fields-and-inheritance-changes"></span><h3><code class="docutils literal notranslate"><span class="pre">Manager.use_for_related_fields</span></code> 和继承方面的变化<a class="headerlink" href="#manager-use-for-related-fields-and-inheritance-changes" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Manager.use_for_related_fields</span></code> 已被弃用，推荐在模型上设置 <a class="reference internal" href="../ref/models/options.html#django.db.models.Options.base_manager_name" title="django.db.models.Options.base_manager_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Meta.base_manager_name</span></code></a>。</p>
<p>在 Django 2.0 中，模型 <code class="docutils literal notranslate"><span class="pre">Manager</span></code> 的继承将遵循 MRO 继承规则，改变了当前的行为，其中在非抽象基类上定义的管理器不会被子类继承。如果您有任何受影响的管理器，将会引发一个带有关于如何调整代码的弃用警告。您可以在子类上重新声明来自抽象模型的管理器，以覆盖来自具体模型的管理器，或者您可以设置模型的 <code class="docutils literal notranslate"><span class="pre">Meta.manager_inheritance_from_future=True</span></code> 选项，以选择新的继承行为。</p>
<p>在弃用期间，即使设置了 <code class="docutils literal notranslate"><span class="pre">base_manager_name</span></code>，也会尊重 <code class="docutils literal notranslate"><span class="pre">use_for_related_fields</span></code> 并引发警告。这允许第三方代码在过渡到新的 API 时保留传统行为。可以通过在管理器上设置 <code class="docutils literal notranslate"><span class="pre">silence_use_for_related_fields_deprecation=True</span></code> 来消除警告。</p>
</div>
<div class="section" id="s-id3">
<span id="id3"></span><h3>杂项<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">makemigrations</span> <span class="pre">--exit</span></code> 选项已被弃用，推荐使用 <a class="reference internal" href="../ref/django-admin.html#cmdoption-makemigrations-check"><code class="xref std std-option docutils literal notranslate"><span class="pre">makemigrations</span> <span class="pre">--check</span></code></a> 选项。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.functional.allow_lazy()</span></code> 已被弃用，推荐使用新的 <a class="reference internal" href="../ref/utils.html#django.utils.functional.keep_lazy" title="django.utils.functional.keep_lazy"><code class="xref py py-func docutils literal notranslate"><span class="pre">keep_lazy()</span></code></a> 函数，它可以使用更自然的装饰器语法。</li>
<li><code class="docutils literal notranslate"><span class="pre">shell</span> <span class="pre">--plain</span></code> 选项已被弃用，推荐使用 <code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">python</span></code> 或 <code class="docutils literal notranslate"><span class="pre">--interface</span> <span class="pre">python</span></code>。</li>
<li>从 <code class="docutils literal notranslate"><span class="pre">django.core.urlresolvers</span></code> 模块导入已被弃用，推荐使用其新位置 <a class="reference internal" href="../ref/urlresolvers.html#module-django.urls" title="django.urls"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.urls</span></code></a>。</li>
<li>模板中的 <code class="docutils literal notranslate"><span class="pre">Context.has_key()</span></code> 方法已被弃用，推荐使用 <code class="docutils literal notranslate"><span class="pre">in</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">Model._meta</span></code> 的私有属性 <code class="docutils literal notranslate"><span class="pre">virtual_fields</span></code> 已被弃用，推荐使用 <code class="docutils literal notranslate"><span class="pre">private_fields</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">Field.contribute_to_class()</span></code> 中的私有关键字参数 <code class="docutils literal notranslate"><span class="pre">virtual_only</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Model._meta.add_field()</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">virtual</span></code> 已被弃用，分别推荐使用 <code class="docutils literal notranslate"><span class="pre">private_only</span></code> 和 <code class="docutils literal notranslate"><span class="pre">private</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">javascript_catalog()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">json_catalog()</span></code> 视图已被弃用，推荐使用基于类的视图 <a class="reference internal" href="../topics/i18n/translation.html#django.views.i18n.JavaScriptCatalog" title="django.views.i18n.JavaScriptCatalog"><code class="xref py py-class docutils literal notranslate"><span class="pre">JavaScriptCatalog</span></code></a> 和 <a class="reference internal" href="../topics/i18n/translation.html#django.views.i18n.JSONCatalog" title="django.views.i18n.JSONCatalog"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSONCatalog</span></code></a>。</li>
<li>在多表继承中，将一个 <code class="docutils literal notranslate"><span class="pre">OneToOneField</span></code> 隐式提升为 <code class="docutils literal notranslate"><span class="pre">parent_link</span></code> 已被弃用。应该在这些字段上添加 <code class="docutils literal notranslate"><span class="pre">parent_link=True</span></code>。</li>
<li>私有 API <code class="docutils literal notranslate"><span class="pre">Widget._format_value()</span></code> 已被公开，并重命名为 <a class="reference internal" href="../ref/forms/widgets.html#django.forms.Widget.format_value" title="django.forms.Widget.format_value"><code class="xref py py-meth docutils literal notranslate"><span class="pre">format_value()</span></code></a>。旧名称将在弃用期间继续工作。</li>
<li>私有的 <code class="docutils literal notranslate"><span class="pre">FileField</span></code> 方法 <code class="docutils literal notranslate"><span class="pre">get_directory_name()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">get_filename()</span></code> 已被弃用，推荐在 <a class="reference internal" href="../ref/files/storage.html#django.core.files.storage.Storage.generate_filename" title="django.core.files.storage.Storage.generate_filename"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Storage.generate_filename()</span></code></a> 中执行这项工作。</li>
<li>使用 <code class="docutils literal notranslate"><span class="pre">settings.MIDDLEWARE_CLASSES</span></code> 的旧式中间件已被弃用。请 <a class="reference internal" href="../topics/http/middleware.html#upgrading-middleware"><span class="std std-ref">适应旧的自定义中间件</span></a> 并使用新的 <a class="reference internal" href="../ref/settings.html#std-setting-MIDDLEWARE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">MIDDLEWARE</span></code></a> 设置。</li>
</ul>
</div>
</div>
<div class="section" id="s-features-removed-in-1-10">
<span id="s-removed-features-1-10"></span><span id="features-removed-in-1-10"></span><span id="removed-features-1-10"></span><h2>在 1.10 中移除的功能<a class="headerlink" href="#features-removed-in-1-10" title="永久链接至标题">¶</a></h2>
<p>这些功能已经完成了弃用周期，并在 Django 1.10 中被移除。有关详细信息，包括如何移除这些功能的用法，请参阅 <a class="reference internal" href="1.8.html#deprecated-features-1-8"><span class="std std-ref">在 1.8 中被废弃的功能</span></a>。</p>
<ul class="simple">
<li>不再支持直接调用 <code class="docutils literal notranslate"><span class="pre">SQLCompiler</span></code> 作为调用其 <code class="docutils literal notranslate"><span class="pre">quote_name_unless_alias</span></code> 方法的别名。</li>
<li><code class="docutils literal notranslate"><span class="pre">cycle</span></code> 和 <code class="docutils literal notranslate"><span class="pre">firstof</span></code> 模板标签已从 <code class="docutils literal notranslate"><span class="pre">future</span></code> 模板标签库中移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.conf.urls.patterns()</span></code> 已被移除。</li>
<li>不再支持 <code class="docutils literal notranslate"><span class="pre">prefix</span></code> 参数用于 <code class="docutils literal notranslate"><span class="pre">django.conf.urls.i18n.i18n_patterns()</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">SimpleTestCase.urls</span></code> 已被移除。</li>
<li>在模板标签 <code class="docutils literal notranslate"><span class="pre">for</span></code> 中使用不正确数量的解包值将引发异常，而不是默默失败。</li>
<li>使用点分隔的 Python 路径反向 <a class="reference internal" href="../ref/urlresolvers.html#django.urls.reverse" title="django.urls.reverse"><code class="xref py py-func docutils literal notranslate"><span class="pre">reverse()</span></code></a> URL 的能力已被移除。</li>
<li>使用点分隔的 Python 路径设置 <code class="docutils literal notranslate"><span class="pre">LOGIN_URL</span></code> 和 <code class="docutils literal notranslate"><span class="pre">LOGIN_REDIRECT_URL</span></code> 的能力已被移除。</li>
<li>自定义管理命令不再支持 <code class="docutils literal notranslate"><span class="pre">optparse</span></code>。</li>
<li>类 <code class="docutils literal notranslate"><span class="pre">django.core.management.NoArgsCommand</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.core.context_processors</span></code> 模块已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.db.models.sql.aggregates</span></code> 模块已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.gis.db.models.sql.aggregates</span></code> 模块已被移除。</li>
<li>以下 <code class="docutils literal notranslate"><span class="pre">django.db.sql.query.Query</span></code> 的方法和属性已被移除：<ul>
<li>属性：<code class="docutils literal notranslate"><span class="pre">aggregates</span></code> 和 <code class="docutils literal notranslate"><span class="pre">aggregate_select</span></code> 将被移除。</li>
<li>方法：<code class="docutils literal notranslate"><span class="pre">add_aggregate</span></code>、<code class="docutils literal notranslate"><span class="pre">set_aggregate_mask</span></code> 和 <code class="docutils literal notranslate"><span class="pre">append_aggregate_mask</span></code> 将被移除。</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">django.template.resolve_variable</span></code> 已被移除。</li>
<li>以下私有 API 已从 <a class="reference internal" href="../ref/models/meta.html#django.db.models.options.Options" title="django.db.models.options.Options"><code class="xref py py-class docutils literal notranslate"><span class="pre">django.db.models.options.Options</span></code></a> （<code class="docutils literal notranslate"><span class="pre">Model._meta</span></code>）中移除：<ul>
<li><code class="docutils literal notranslate"><span class="pre">get_field_by_name()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">get_all_field_names()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">get_fields_with_model()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">get_concrete_fields_with_model()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">get_m2m_with_model()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">get_all_related_objects()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">get_all_related_objects_with_model()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">get_all_related_many_to_many_objects()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">get_all_related_m2m_objects_with_model()</span></code></li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">django.forms.RegexField</span></code> 的 <code class="docutils literal notranslate"><span class="pre">error_message</span></code> 参数已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">unordered_list</span></code> 过滤器不再支持旧式列表。</li>
<li>不再支持将字符串 <code class="docutils literal notranslate"><span class="pre">view</span></code> 参数传递给 <code class="docutils literal notranslate"><span class="pre">url()</span></code>。</li>
<li>将 <code class="docutils literal notranslate"><span class="pre">django.forms.Form._has_changed()</span></code> 重命名为 <code class="docutils literal notranslate"><span class="pre">has_changed()</span></code> 的向后兼容性修补程序已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">removetags</span></code> 模板过滤器已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.html</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">remove_tags()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">strip_entities()</span></code> 函数已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.auth.views.password_reset()</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">is_admin_site</span></code> 参数已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.db.models.field.subclassing.SubfieldBase</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.checksums</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.admin.helpers.InlineAdminForm</span></code> 上的 <code class="docutils literal notranslate"><span class="pre">original_content_type_id</span></code> 属性已被移除。</li>
<li>允许不为其 <code class="docutils literal notranslate"><span class="pre">form_class</span></code> 参数定义默认值的 <code class="docutils literal notranslate"><span class="pre">FormMixin.get_form()</span></code> 的向后兼容性修复已被移除。</li>
<li>以下设置已被移除，您必须升级到 <a class="reference internal" href="../ref/settings.html#std-setting-TEMPLATES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">TEMPLATES</span></code></a> 设置：<ul>
<li><code class="docutils literal notranslate"><span class="pre">ALLOWED_INCLUDE_ROOTS</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TEMPLATE_CONTEXT_PROCESSORS</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TEMPLATE_DEBUG</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TEMPLATE_DIRS</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TEMPLATE_LOADERS</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TEMPLATE_STRING_IF_INVALID</span></code></li>
</ul>
</li>
<li>向后兼容的别名 <code class="docutils literal notranslate"><span class="pre">django.template.loader.BaseLoader</span></code> 已被移除。</li>
<li>由 <a class="reference internal" href="../topics/templates.html#django.template.loader.get_template" title="django.template.loader.get_template"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_template()</span></code></a> 和 <a class="reference internal" href="../topics/templates.html#django.template.loader.select_template" title="django.template.loader.select_template"><code class="xref py py-func docutils literal notranslate"><span class="pre">select_template()</span></code></a> 返回的 Django 模板对象不再在其 <a class="reference internal" href="../topics/templates.html#django.template.backends.base.Template.render" title="django.template.backends.base.Template.render"><code class="xref py py-meth docutils literal notranslate"><span class="pre">render()</span></code></a> 方法中接受 <a class="reference internal" href="../ref/templates/api.html#django.template.Context" title="django.template.Context"><code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span></code></a>。</li>
<li><a class="reference internal" href="../ref/template-response.html"><span class="doc">Template response APIs</span></a> 强制使用 <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> 和依赖后端的模板对象，而不再使用 <a class="reference internal" href="../ref/templates/api.html#django.template.Context" title="django.template.Context"><code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span></code></a> 和 <a class="reference internal" href="../ref/templates/api.html#django.template.Template" title="django.template.Template"><code class="xref py py-class docutils literal notranslate"><span class="pre">Template</span></code></a>。</li>
<li>以下函数和类的 <code class="docutils literal notranslate"><span class="pre">current_app</span></code> 参数已被移除：<ul>
<li><code class="docutils literal notranslate"><span class="pre">django.shortcuts.render()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.template.Context()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.template.RequestContext()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.template.response.TemplateResponse()</span></code></li>
</ul>
</li>
<li>以下函数的 <code class="docutils literal notranslate"><span class="pre">dictionary</span></code> 和 <code class="docutils literal notranslate"><span class="pre">context_instance</span></code> 参数已被移除：<ul>
<li><code class="docutils literal notranslate"><span class="pre">django.shortcuts.render()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.shortcuts.render_to_response()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.template.loader.render_to_string()</span></code></li>
</ul>
</li>
<li>以下函数的 <code class="docutils literal notranslate"><span class="pre">dirs</span></code> 参数已被移除：<ul>
<li><code class="docutils literal notranslate"><span class="pre">django.template.loader.get_template()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.template.loader.select_template()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.shortcuts.render()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.shortcuts.render_to_response()</span></code></li>
</ul>
</li>
<li>会话验证现在已启用，无论是否在 <code class="docutils literal notranslate"><span class="pre">MIDDLEWARE_CLASSES</span></code> 中包含 <code class="docutils literal notranslate"><span class="pre">'django.contrib.auth.middleware.SessionAuthenticationMiddleware'</span></code>。<code class="docutils literal notranslate"><span class="pre">SessionAuthenticationMiddleware</span></code> 不再有任何用途，可以从 <code class="docutils literal notranslate"><span class="pre">MIDDLEWARE_CLASSES</span></code> 中删除。为了方便那些没有阅读此说明的用户，它被保留为一个存根，直到 Django 2.0。</li>
<li>私有属性 <code class="docutils literal notranslate"><span class="pre">django.db.models.Field.related</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">migrate</span></code> 管理命令的 <code class="docutils literal notranslate"><span class="pre">--list</span></code> 选项已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">ssi</span></code> 模板标签已被移除。</li>
<li>不再支持 <code class="docutils literal notranslate"><span class="pre">if</span></code> 模板标签中的 <code class="docutils literal notranslate"><span class="pre">=</span></code> 比较运算符。</li>
<li>允许在不带 <code class="docutils literal notranslate"><span class="pre">max_length</span></code> 参数的情况下定义 <code class="docutils literal notranslate"><span class="pre">Storage.get_available_name()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Storage.save()</span></code> 的向后兼容性修复已被移除。</li>
<li>在 <code class="docutils literal notranslate"><span class="pre">ModelFormMixin.success_url</span></code> 中移除了对旧式 <code class="docutils literal notranslate"><span class="pre">%(&lt;foo&gt;)s</span></code> 语法的支持。</li>
<li>移除了``GeoQuerySet`` 聚合方法 <code class="docutils literal notranslate"><span class="pre">collect()</span></code>, <code class="docutils literal notranslate"><span class="pre">extent()</span></code>, <code class="docutils literal notranslate"><span class="pre">extent3d()</span></code>, <code class="docutils literal notranslate"><span class="pre">make_line()</span></code>, 和 <code class="docutils literal notranslate"><span class="pre">unionagg()</span></code>。</li>
<li>在创建内容类型实例时不再支持指定 <code class="docutils literal notranslate"><span class="pre">ContentType.name</span></code> 的能力。</li>
<li>不再支持旧的 <code class="docutils literal notranslate"><span class="pre">allow_migrate</span></code> 签名。</li>
<li>移除了使用逗号分隔参数的 <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">cycle</span> <span class="pre">%}</span></code> 语法的支持。</li>
<li><a class="reference internal" href="../topics/signing.html#django.core.signing.Signer" title="django.core.signing.Signer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Signer</span></code></a> 在提供无效的分隔符时发出的警告现在是一个 <code class="docutils literal notranslate"><span class="pre">ValueError</span></code>。</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../contents.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">Django 1.10 版本发行说明</a><ul>
<li><a class="reference internal" href="#python-compatibility">Python 兼容性</a></li>
<li><a class="reference internal" href="#what-s-new-in-django-1-10">Django 1.10 新特性</a><ul>
<li><a class="reference internal" href="#full-text-search-for-postgresql">PostgreSQL 的全文搜索</a></li>
<li><a class="reference internal" href="#new-style-middleware">新式中间件</a></li>
<li><a class="reference internal" href="#official-support-for-unicode-usernames">官方支持 Unicode 用户名</a></li>
<li><a class="reference internal" href="#minor-features">次要特性</a><ul>
<li><a class="reference internal" href="#django-contrib-admin"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-auth"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-gis"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-postgres"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.postgres</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-sessions"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sessions</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-sites"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sites</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-staticfiles"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.staticfiles</span></code></a></li>
<li><a class="reference internal" href="#cache">缓存</a></li>
<li><a class="reference internal" href="#csrf">CSRF</a></li>
<li><a class="reference internal" href="#database-backends">数据库后端</a></li>
<li><a class="reference internal" href="#file-storage">文件存储</a></li>
<li><a class="reference internal" href="#forms">表单</a></li>
<li><a class="reference internal" href="#generic-views">通用视图</a></li>
<li><a class="reference internal" href="#internationalization">国际化</a></li>
<li><a class="reference internal" href="#management-commands">管理命令</a></li>
<li><a class="reference internal" href="#migrations">迁移</a></li>
<li><a class="reference internal" href="#models">模型</a></li>
<li><a class="reference internal" href="#requests-and-responses">请求和响应</a></li>
<li><a class="reference internal" href="#serialization">序列化</a></li>
<li><a class="reference internal" href="#templates">模板</a></li>
<li><a class="reference internal" href="#tests">测试</a></li>
<li><a class="reference internal" href="#urls">URLs</a></li>
<li><a class="reference internal" href="#validators">验证器</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-incompatible-changes-in-1-10">1.10 中的不向后兼容的变更</a><ul>
<li><a class="reference internal" href="#database-backend-api">数据库后端 API</a></li>
<li><a class="reference internal" href="#select-related-prohibits-non-relational-fields-for-nested-relations"><code class="docutils literal notranslate"><span class="pre">select_related()</span></code> 禁止嵌套关系的非关系字段。</a></li>
<li><a class="reference internal" href="#meta-get-fields-returns-consistent-reverse-fields-for-proxy-models"><code class="docutils literal notranslate"><span class="pre">_meta.get_fields()</span></code> 为代理模型返回一致的反向字段。</a></li>
<li><a class="reference internal" href="#abstractuser-username-max-length-increased-to-150"><code class="xref py py-attr docutils literal notranslate"><span class="pre">AbstractUser.username</span></code> 的 <code class="docutils literal notranslate"><span class="pre">max_length</span></code> 增加到了 150。</a></li>
<li><a class="reference internal" href="#dropped-support-for-postgresql-9-1">停止支持 PostgreSQL 9.1</a></li>
<li><a class="reference internal" href="#runserver-output-goes-through-logging"><code class="docutils literal notranslate"><span class="pre">runserver</span></code> 输出经过日志记录</a></li>
<li><a class="reference internal" href="#auth-customuser-and-auth-extensionuser-test-models-were-removed"><code class="docutils literal notranslate"><span class="pre">auth.CustomUser</span></code> 和 <code class="docutils literal notranslate"><span class="pre">auth.ExtensionUser</span></code> 测试模型已被移除。</a></li>
<li><a class="reference internal" href="#apps-registry-is-no-longer-auto-populated-when-unpickling-models-outside-of-django">在 Django 之外反序列化模型时，应用程序注册表不再自动填充。</a></li>
<li><a class="reference internal" href="#removed-null-assignment-check-for-non-null-foreign-key-fields">删除了非空外键字段的空值赋值检查。</a></li>
<li><a class="reference internal" href="#removed-weak-password-hashers-from-the-default-password-hashers-setting">从默认的 <code class="docutils literal notranslate"><span class="pre">PASSWORD_HASHERS</span></code> 设置中移除了弱密码哈希器。</a></li>
<li><a class="reference internal" href="#field-get-prep-lookup-and-field-get-db-prep-lookup-methods-are-removed"><code class="docutils literal notranslate"><span class="pre">Field.get_prep_lookup()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Field.get_db_prep_lookup()</span></code> 方法已被移除。</a></li>
<li><a class="reference internal" href="#id1"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a></li>
<li><a class="reference internal" href="#maximum-size-of-a-request-body-and-the-number-of-get-post-parameters-is-limited">请求体的最大大小以及 GET/POST 参数的数量受到限制。</a></li>
<li><a class="reference internal" href="#miscellaneous">杂项</a></li>
</ul>
</li>
<li><a class="reference internal" href="#features-deprecated-in-1-10">在 1.10 中被废弃的功能</a><ul>
<li><a class="reference internal" href="#direct-assignment-to-a-reverse-foreign-key-or-many-to-many-relation">直接分配给反向外键或多对多关系</a></li>
<li><a class="reference internal" href="#non-timezone-aware-storage-api">非时区感知的 <code class="xref py py-class docutils literal notranslate"><span class="pre">Storage</span></code> API</a></li>
<li><a class="reference internal" href="#id2"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a></li>
<li><a class="reference internal" href="#commaseparatedintegerfield-model-field"><code class="docutils literal notranslate"><span class="pre">CommaSeparatedIntegerField</span></code> 模型字段</a></li>
<li><a class="reference internal" href="#using-a-model-name-as-a-query-lookup-when-default-related-name-is-set">当设置了 <code class="docutils literal notranslate"><span class="pre">default_related_name</span></code> 时，可以使用模型名称作为查询查找。</a></li>
<li><a class="reference internal" href="#search-query-lookup"><code class="docutils literal notranslate"><span class="pre">__search</span></code> 查询查找</a></li>
<li><a class="reference internal" href="#using-user-is-authenticated-and-user-is-anonymous-as-methods">使用 <code class="docutils literal notranslate"><span class="pre">User.is_authenticated()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">User.is_anonymous()</span></code> 作为方法。</a></li>
<li><a class="reference internal" href="#custom-manager-classes-available-through-prefetch-related-must-define-a-apply-rel-filters-method">通过 <code class="docutils literal notranslate"><span class="pre">prefetch_related</span></code> 可用的自定义管理器类必须定义一个 <code class="docutils literal notranslate"><span class="pre">_apply_rel_filters()</span></code> 方法。</a></li>
<li><a class="reference internal" href="#the-escape-half-of-django-utils-safestring"><code class="docutils literal notranslate"><span class="pre">django.utils.safestring</span></code> 的 &quot;escape&quot; 部分</a></li>
<li><a class="reference internal" href="#manager-use-for-related-fields-and-inheritance-changes"><code class="docutils literal notranslate"><span class="pre">Manager.use_for_related_fields</span></code> 和继承方面的变化</a></li>
<li><a class="reference internal" href="#id3">杂项</a></li>
</ul>
</li>
<li><a class="reference internal" href="#features-removed-in-1-10">在 1.10 中移除的功能</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="1.10.1.html"
                          title="上一章">Django 1.10.1 版本发行说明</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="1.9.13.html"
                          title="下一章">Django 1.9.13 版本发行说明</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/releases/1.10.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">3月 29, 2024</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="1.10.1.html" title="Django 1.10.1 版本发行说明">previous</a>
     |
    <a href="index.html" title="发行说明" accesskey="U">up</a>
   |
    <a href="1.9.13.html" title="Django 1.9.13 版本发行说明">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>
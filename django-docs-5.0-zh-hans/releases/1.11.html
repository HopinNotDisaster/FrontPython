
<!DOCTYPE html>

<html lang="zh_Hans">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Django 1.11 版本发行说明 &#8212; Django 5.0.4.dev20240329153429 文档</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/default.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Django 1.10.8 版本发行说明" href="1.10.8.html" />
    <link rel="prev" title="Django 1.11.1 版本发行说明" href="1.11.1.html" />



 
<script src="../templatebuiltins.js"></script>
<script>
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);</script>

  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../index.html">Django 5.0.4.dev20240329153429 文档</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../index.html">Home</a>  |
        <a title="Table of contents" href="../contents.html">Table of contents</a>  |
        <a title="Global index" href="../genindex.html">Index</a>  |
        <a title="Module index" href="../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="1.11.1.html" title="Django 1.11.1 版本发行说明">previous</a>
     |
    <a href="index.html" title="发行说明" accesskey="U">up</a>
   |
    <a href="1.10.8.html" title="Django 1.10.8 版本发行说明">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="releases-1.11">
            
  <div class="section" id="s-django-1-11-release-notes">
<span id="django-1-11-release-notes"></span><h1>Django 1.11 版本发行说明<a class="headerlink" href="#django-1-11-release-notes" title="永久链接至标题">¶</a></h1>
<p><em>2017 年 4 月 4 日</em></p>
<p>欢迎来到 Django 1.11 版本！</p>
<p>这些发布说明涵盖了 <a class="reference internal" href="#whats-new-1-11"><span class="std std-ref">新功能</span></a>，以及一些 <a class="reference internal" href="#backwards-incompatible-1-11"><span class="std std-ref">不兼容变更</span></a>，当您从 Django 1.10 或更早版本升级时，您需要注意。我们已经 <a class="reference internal" href="#deprecated-features-1-11"><span class="std std-ref">开始了一些功能的弃用过程</span></a>。</p>
<p>如果你要更新现有的项目，请看 <a class="reference internal" href="../howto/upgrade-version.html"><span class="doc">如何将 Django 更新至新的版本</span></a> 指南。</p>
<p>Django 1.11 被指定为 <a class="reference internal" href="../internals/release-process.html#term-Long-term-support-release"><span class="xref std std-term">长期支持版本</span></a>。它将在发布后至少三年内接收安全更新。对于之前的 LTS 版本 Django 1.8，支持将于 2018 年 4 月结束。</p>
<div class="section" id="s-python-compatibility">
<span id="python-compatibility"></span><h2>Python 兼容性<a class="headerlink" href="#python-compatibility" title="永久链接至标题">¶</a></h2>
<p>Django 1.11 需要 Python 2.7、3.4、3.5、3.6 或 3.7（截止到 1.11.17 版本）。我们* <em>强烈建议*</em> 并且只正式支持每个系列的最新版本。</p>
<p>Django 1.11.x 系列是支持 Python 2 的最后一个版本。下一个主要版本，Django 2.0，将仅支持 Python 3.4+。</p>
</div>
<div class="section" id="s-deprecating-warnings-are-no-longer-loud-by-default">
<span id="deprecating-warnings-are-no-longer-loud-by-default"></span><h2>弃用警告默认不再大声发出<a class="headerlink" href="#deprecating-warnings-are-no-longer-loud-by-default" title="永久链接至标题">¶</a></h2>
<p>与旧版本的 Django 不同，Django 自身的弃用警告默认不再显示。这与 Python 的默认行为一致。</p>
<p>此更改允许第三方应用在不添加用于避免弃用警告的代码的情况下同时支持 Django 1.11 LTS 和 Django 1.8 LTS 。</p>
<p>在发布 Django 2.0 后，我们建议第三方应用的作者停止支持所有在 1.11 之前的 Django 版本。在那时，您应该能够使用 <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-Wd</span></code> 运行您包的测试，以确保弃用警告出现。在修复弃用警告后，您的应用应该与 Django 2.0 兼容。</p>
</div>
<div class="section" id="s-what-s-new-in-django-1-11">
<span id="s-whats-new-1-11"></span><span id="what-s-new-in-django-1-11"></span><span id="whats-new-1-11"></span><h2>Django 1.11 新特性<a class="headerlink" href="#what-s-new-in-django-1-11" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-class-based-model-indexes">
<span id="class-based-model-indexes"></span><h3>基于类的模型索引<a class="headerlink" href="#class-based-model-indexes" title="永久链接至标题">¶</a></h3>
<p>新的 <a class="reference internal" href="../ref/models/indexes.html#module-django.db.models.indexes" title="django.db.models.indexes"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.db.models.indexes</span></code></a> 模块包含了用于简化创建数据库索引的类。索引可以通过在模型中使用 <a class="reference internal" href="../ref/models/options.html#django.db.models.Options.indexes" title="django.db.models.Options.indexes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Meta.indexes</span></code></a> 选项来添加。</p>
<p><a class="reference internal" href="../ref/models/indexes.html#django.db.models.Index" title="django.db.models.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> 类创建一个 b-tree 索引，就像您在模型字段上使用 <a class="reference internal" href="../ref/models/fields.html#django.db.models.Field.db_index" title="django.db.models.Field.db_index"><code class="xref py py-attr docutils literal notranslate"><span class="pre">db_index</span></code></a> 或在模型的 <code class="docutils literal notranslate"><span class="pre">Meta</span></code> 类上使用 <a class="reference internal" href="../ref/models/options.html#django.db.models.Options.index_together" title="django.db.models.Options.index_together"><code class="xref py py-attr docutils literal notranslate"><span class="pre">index_together</span></code></a> 一样。它可以被子类化以支持不同的索引类型，比如 <a class="reference internal" href="../ref/contrib/postgres/indexes.html#django.contrib.postgres.indexes.GinIndex" title="django.contrib.postgres.indexes.GinIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">GinIndex</span></code></a>。它还允许定义索引列的顺序（ASC/DESC）。</p>
</div>
<div class="section" id="s-template-based-widget-rendering">
<span id="template-based-widget-rendering"></span><h3>基于模板的小部件渲染<a class="headerlink" href="#template-based-widget-rendering" title="永久链接至标题">¶</a></h3>
<p>为了方便定制小部件，现在表单小部件的渲染是使用模板系统而不是在 Python 中进行的。请参阅 <a class="reference internal" href="../ref/forms/renderers.html"><span class="doc">表单渲染 API</span></a>。</p>
<p>你可能需要调整你编写的任何自定义小部件，以适应一些 <a class="reference internal" href="#template-widget-incompatibilities-1-11"><span class="std std-ref">不兼容变更</span></a>。</p>
</div>
<div class="section" id="s-subquery-expressions">
<span id="subquery-expressions"></span><h3><code class="docutils literal notranslate"><span class="pre">Subquery</span></code> 表达式<a class="headerlink" href="#subquery-expressions" title="永久链接至标题">¶</a></h3>
<p>新的 <a class="reference internal" href="../ref/models/expressions.html#django.db.models.Subquery" title="django.db.models.Subquery"><code class="xref py py-class docutils literal notranslate"><span class="pre">Subquery</span></code></a> 和 <a class="reference internal" href="../ref/models/expressions.html#django.db.models.Exists" title="django.db.models.Exists"><code class="xref py py-class docutils literal notranslate"><span class="pre">Exists</span></code></a> 数据库表达式允许创建明确的子查询。子查询可以使用 <a class="reference internal" href="../ref/models/expressions.html#django.db.models.OuterRef" title="django.db.models.OuterRef"><code class="xref py py-class docutils literal notranslate"><span class="pre">OuterRef</span></code></a> 类引用来自外部查询集的字段。</p>
</div>
<div class="section" id="s-minor-features">
<span id="minor-features"></span><h3>次要特性<a class="headerlink" href="#minor-features" title="永久链接至标题">¶</a></h3>
<div class="section" id="s-django-contrib-admin">
<span id="django-contrib-admin"></span><h4><a class="reference internal" href="../ref/contrib/admin/index.html#module-django.contrib.admin" title="django.contrib.admin: Django's admin site."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a><a class="headerlink" href="#django-contrib-admin" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.date_hierarchy" title="django.contrib.admin.ModelAdmin.date_hierarchy"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ModelAdmin.date_hierarchy</span></code></a> 现在可以引用跨关联的字段。</li>
<li>新的 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.get_exclude" title="django.contrib.admin.ModelAdmin.get_exclude"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ModelAdmin.get_exclude()</span></code></a> 钩子允许根据请求或模型实例指定要排除的字段。</li>
<li><code class="docutils literal notranslate"><span class="pre">popup_response.html</span></code> 模板现在可以按照每个应用程序、每个模型或通过设置 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.popup_response_template" title="django.contrib.admin.ModelAdmin.popup_response_template"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ModelAdmin.popup_response_template</span></code></a> 属性来进行覆盖。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-auth">
<span id="django-contrib-auth"></span><h4><a class="reference internal" href="../topics/auth/index.html#module-django.contrib.auth" title="django.contrib.auth: Django's authentication framework."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a><a class="headerlink" href="#django-contrib-auth" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>PBKDF2 密码哈希器的默认迭代次数增加了 20 %。</li>
<li><a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.views.LoginView" title="django.contrib.auth.views.LoginView"><code class="xref py py-class docutils literal notranslate"><span class="pre">LoginView</span></code></a> 和 <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.views.LogoutView" title="django.contrib.auth.views.LogoutView"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogoutView</span></code></a> 基于类的视图替代了已弃用的 <code class="docutils literal notranslate"><span class="pre">login()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">logout()</span></code> 基于函数的视图。</li>
<li><a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.views.PasswordChangeView" title="django.contrib.auth.views.PasswordChangeView"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordChangeView</span></code></a>、<a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.views.PasswordChangeDoneView" title="django.contrib.auth.views.PasswordChangeDoneView"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordChangeDoneView</span></code></a>、<a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.views.PasswordResetView" title="django.contrib.auth.views.PasswordResetView"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordResetView</span></code></a>、<a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.views.PasswordResetDoneView" title="django.contrib.auth.views.PasswordResetDoneView"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordResetDoneView</span></code></a>、<a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.views.PasswordResetConfirmView" title="django.contrib.auth.views.PasswordResetConfirmView"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordResetConfirmView</span></code></a> 和 <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.views.PasswordResetCompleteView" title="django.contrib.auth.views.PasswordResetCompleteView"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordResetCompleteView</span></code></a> 基于类的视图替代了已弃用的 <code class="docutils literal notranslate"><span class="pre">password_change()</span></code>, <code class="docutils literal notranslate"><span class="pre">password_change_done()</span></code>, <code class="docutils literal notranslate"><span class="pre">password_reset()</span></code>, <code class="docutils literal notranslate"><span class="pre">password_reset_done()</span></code>, <code class="docutils literal notranslate"><span class="pre">password_reset_confirm()</span></code>, 和 <code class="docutils literal notranslate"><span class="pre">password_reset_complete()</span></code> 基于函数的视图。</li>
<li><a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.views.PasswordResetConfirmView" title="django.contrib.auth.views.PasswordResetConfirmView"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordResetConfirmView</span></code></a> 的新属性 <code class="docutils literal notranslate"><span class="pre">post_reset_login</span></code> 允许在成功重置密码后自动登录用户。如果配置了多个 <code class="docutils literal notranslate"><span class="pre">AUTHENTICATION_BACKENDS</span></code>，可以使用 <code class="docutils literal notranslate"><span class="pre">post_reset_login_backend</span></code> 属性选择要使用的后端。</li>
<li>为了避免通过 HTTP Referer 标头泄露密码重置令牌的可能性（例如，如果重置页面包含对托管在另一个域上的 CSS 或 JavaScript 的引用），<a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.views.PasswordResetConfirmView" title="django.contrib.auth.views.PasswordResetConfirmView"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordResetConfirmView</span></code></a> （但不是已弃用的 <code class="docutils literal notranslate"><span class="pre">password_reset_confirm()</span></code> 基于函数的视图）将令牌存储在会话中，并重定向到自身，以向用户呈现不带令牌的 URL 的密码更改表单。</li>
<li><a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.update_session_auth_hash" title="django.contrib.auth.update_session_auth_hash"><code class="xref py py-func docutils literal notranslate"><span class="pre">update_session_auth_hash()</span></code></a> 现在会旋转会话密钥，以允许密码更改来使被窃取的会话 Cookie 失效。</li>
<li><a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.views.LoginView" title="django.contrib.auth.views.LoginView"><code class="xref py py-class docutils literal notranslate"><span class="pre">LoginView</span></code></a> 和 <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.views.LogoutView" title="django.contrib.auth.views.LogoutView"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogoutView</span></code></a> 的新属性 <code class="docutils literal notranslate"><span class="pre">success_url_allowed_hosts</span></code> 允许指定一组安全的主机，用于在登录和注销后进行重定向。</li>
<li>已添加密码验证器的 <code class="docutils literal notranslate"><span class="pre">help_text</span></code> 到 <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.forms.UserCreationForm" title="django.contrib.auth.forms.UserCreationForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">UserCreationForm</span></code></a>。</li>
<li><code class="docutils literal notranslate"><span class="pre">HttpRequest</span></code> 现在传递给 <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.authenticate" title="django.contrib.auth.authenticate"><code class="xref py py-func docutils literal notranslate"><span class="pre">authenticate()</span></code></a>，如果身份验证后端接受 <code class="docutils literal notranslate"><span class="pre">request</span></code> 参数，则它将传递给身份验证后端。</li>
<li><a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.signals.user_login_failed" title="django.contrib.auth.signals.user_login_failed"><code class="xref py py-func docutils literal notranslate"><span class="pre">user_login_failed()</span></code></a> 信号现在接收一个 <code class="docutils literal notranslate"><span class="pre">request</span></code> 参数。</li>
<li><a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.forms.PasswordResetForm" title="django.contrib.auth.forms.PasswordResetForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordResetForm</span></code></a> 支持自定义用户模型，该模型使用名称不是 <code class="docutils literal notranslate"><span class="pre">'email'</span></code> 的电子邮件字段。将 <a class="reference internal" href="../topics/auth/customizing.html#django.contrib.auth.models.CustomUser.EMAIL_FIELD" title="django.contrib.auth.models.CustomUser.EMAIL_FIELD"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CustomUser.EMAIL_FIELD</span></code></a> 设置为字段的名称。</li>
<li><a class="reference internal" href="../topics/auth/customizing.html#django.contrib.auth.get_user_model" title="django.contrib.auth.get_user_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_user_model()</span></code></a> 现在可以在导入时调用，即使在定义模型的模块中也可以。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-contenttypes">
<span id="django-contrib-contenttypes"></span><h4><a class="reference internal" href="../ref/contrib/contenttypes.html#module-django.contrib.contenttypes" title="django.contrib.contenttypes: Provides generic interface to installed models."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.contenttypes</span></code></a><a class="headerlink" href="#django-contrib-contenttypes" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>在 <a class="reference internal" href="../ref/django-admin.html#django-admin-remove_stale_contenttypes"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">remove_stale_contenttypes</span></code></a> 命令中，当检测到陈旧的内容类型时，现在会列出一系列相关对象，如 <code class="docutils literal notranslate"><span class="pre">auth.Permission</span></code>，这些对象也将被删除。之前，只列出了内容类型（而且此提示是在 <code class="docutils literal notranslate"><span class="pre">migrate</span></code> 之后，而不是在一个单独的命令中）。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-gis">
<span id="django-contrib-gis"></span><h4><a class="reference internal" href="../ref/contrib/gis/index.html#module-django.contrib.gis" title="django.contrib.gis: Geographic Information System (GIS) extensions for Django"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a><a class="headerlink" href="#django-contrib-gis" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../ref/contrib/gis/geos.html#django.contrib.gis.geos.GEOSGeometry.from_gml" title="django.contrib.gis.geos.GEOSGeometry.from_gml"><code class="xref py py-meth docutils literal notranslate"><span class="pre">GEOSGeometry.from_gml()</span></code></a> 和 <a class="reference internal" href="../ref/contrib/gis/gdal.html#django.contrib.gis.gdal.OGRGeometry.from_gml" title="django.contrib.gis.gdal.OGRGeometry.from_gml"><code class="xref py py-meth docutils literal notranslate"><span class="pre">OGRGeometry.from_gml()</span></code></a> 方法允许从 GML 创建几何图形。</li>
<li>在 SpatiaLite 上新增了对 <a class="reference internal" href="../ref/contrib/gis/geoquerysets.html#std-fieldlookup-dwithin"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">dwithin</span></code></a> 查询的支持。</li>
<li><a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.Area" title="django.contrib.gis.db.models.functions.Area"><code class="xref py py-class docutils literal notranslate"><span class="pre">Area</span></code></a> 函数、<a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.Distance" title="django.contrib.gis.db.models.functions.Distance"><code class="xref py py-class docutils literal notranslate"><span class="pre">Distance</span></code></a> 函数以及距离查询现在在 SpatiaLite 上支持大地坐标。</li>
<li>基于 OpenLayers 的表单小部件现在使用来自 <code class="docutils literal notranslate"><span class="pre">https://cdnjs.cloudflare.com</span></code> 的 <code class="docutils literal notranslate"><span class="pre">OpenLayers.js</span></code>，这比旧的 <code class="docutils literal notranslate"><span class="pre">https://openlayers.org/</span></code> 源更适合生产使用。它们还更新为使用 OpenLayers 3。</li>
<li>PostGIS 迁移现在可以改变字段尺寸。</li>
<li>现在可以在创建 <a class="reference internal" href="../ref/contrib/gis/gdal.html#django.contrib.gis.gdal.GDALRaster" title="django.contrib.gis.gdal.GDALRaster"><code class="xref py py-class docutils literal notranslate"><span class="pre">GDALRaster</span></code></a> 对象时传递 <code class="docutils literal notranslate"><span class="pre">size</span></code>、<code class="docutils literal notranslate"><span class="pre">shape</span></code> 和 <code class="docutils literal notranslate"><span class="pre">offset</span></code> 参数。</li>
<li>新增了对 <a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.IsValid" title="django.contrib.gis.db.models.functions.IsValid"><code class="xref py py-class docutils literal notranslate"><span class="pre">IsValid</span></code></a> 函数、<a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.MakeValid" title="django.contrib.gis.db.models.functions.MakeValid"><code class="xref py py-class docutils literal notranslate"><span class="pre">MakeValid</span></code></a> 函数以及 <a class="reference internal" href="../ref/contrib/gis/geoquerysets.html#std-fieldlookup-isvalid"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">isvalid</span></code></a> 查询的 SpatiaLite 支持。</li>
<li>新增了对 Oracle 数据库的支持，包括 <a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.AsGML" title="django.contrib.gis.db.models.functions.AsGML"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsGML</span></code></a> 函数、<a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.BoundingCircle" title="django.contrib.gis.db.models.functions.BoundingCircle"><code class="xref py py-class docutils literal notranslate"><span class="pre">BoundingCircle</span></code></a> 函数、<a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.IsValid" title="django.contrib.gis.db.models.functions.IsValid"><code class="xref py py-class docutils literal notranslate"><span class="pre">IsValid</span></code></a> 函数以及 <a class="reference internal" href="../ref/contrib/gis/geoquerysets.html#std-fieldlookup-isvalid"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">isvalid</span></code></a> 查询。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-postgres">
<span id="django-contrib-postgres"></span><h4><a class="reference internal" href="../ref/contrib/postgres/index.html#module-django.contrib.postgres" title="django.contrib.postgres: PostgreSQL-specific fields and features"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.postgres</span></code></a><a class="headerlink" href="#django-contrib-postgres" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/contrib/postgres/aggregates.html#django.contrib.postgres.aggregates.StringAgg" title="django.contrib.postgres.aggregates.StringAgg"><code class="xref py py-class docutils literal notranslate"><span class="pre">StringAgg</span></code></a> 的新参数 <code class="docutils literal notranslate"><span class="pre">distinct</span></code> 决定了连接的值是否要去重。</li>
<li>新的 <a class="reference internal" href="../ref/contrib/postgres/indexes.html#django.contrib.postgres.indexes.GinIndex" title="django.contrib.postgres.indexes.GinIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">GinIndex</span></code></a> 和 <a class="reference internal" href="../ref/contrib/postgres/indexes.html#django.contrib.postgres.indexes.BrinIndex" title="django.contrib.postgres.indexes.BrinIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">BrinIndex</span></code></a> 类允许在数据库中创建 <code class="docutils literal notranslate"><span class="pre">GIN</span></code> 和 <code class="docutils literal notranslate"><span class="pre">BRIN</span></code> 索引。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.postgres.fields.JSONField</span></code> 接受一个新的参数 <code class="docutils literal notranslate"><span class="pre">encoder</span></code>，用于指定自定义类以编码不受标准编码器支持的数据类型。</li>
<li>新的 <code class="docutils literal notranslate"><span class="pre">CIText</span></code> 混合类和 <a class="reference internal" href="../ref/contrib/postgres/operations.html#django.contrib.postgres.operations.CITextExtension" title="django.contrib.postgres.operations.CITextExtension"><code class="xref py py-class docutils literal notranslate"><span class="pre">CITextExtension</span></code></a> 迁移操作允许在 PostgreSQL 中使用 <code class="docutils literal notranslate"><span class="pre">citext</span></code> 扩展来进行不区分大小写的查找。提供了三个字段：<code class="docutils literal notranslate"><span class="pre">CICharField</span></code>、<code class="docutils literal notranslate"><span class="pre">CIEmailField</span></code> 和 <code class="docutils literal notranslate"><span class="pre">CITextField</span></code>。</li>
<li>新的 <a class="reference internal" href="../ref/contrib/postgres/aggregates.html#django.contrib.postgres.aggregates.JSONBAgg" title="django.contrib.postgres.aggregates.JSONBAgg"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSONBAgg</span></code></a> 允许将值聚合为 JSON 数组。</li>
<li><a class="reference internal" href="../ref/contrib/postgres/fields.html#django.contrib.postgres.fields.HStoreField" title="django.contrib.postgres.fields.HStoreField"><code class="xref py py-class docutils literal notranslate"><span class="pre">HStoreField</span></code></a> （模型字段）和 <a class="reference internal" href="../ref/contrib/postgres/forms.html#django.contrib.postgres.forms.HStoreField" title="django.contrib.postgres.forms.HStoreField"><code class="xref py py-class docutils literal notranslate"><span class="pre">HStoreField</span></code></a> （表单字段）允许存储空值。</li>
</ul>
</div>
<div class="section" id="s-cache">
<span id="cache"></span><h4>缓存<a class="headerlink" href="#cache" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>Memcached 后端现在将 <a class="reference internal" href="../ref/settings.html#std-setting-CACHES-OPTIONS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">OPTIONS</span></code></a> 的内容作为关键字参数传递给客户端构造函数，允许更高级的客户端行为控制。请参阅 <a class="reference internal" href="../topics/cache.html#cache-arguments"><span class="std std-ref">cache arguments</span></a> 文档以获取示例。</li>
<li>Memcached 后端现在允许在 <a class="reference internal" href="../ref/settings.html#std-setting-CACHES-LOCATION"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOCATION</span></code></a> 中定义多个服务器，使用逗号分隔的字符串，以方便处理使用这种字符串的环境变量的第三方服务。</li>
</ul>
</div>
<div class="section" id="s-csrf">
<span id="csrf"></span><h4>CSRF<a class="headerlink" href="#csrf" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新增了 <a class="reference internal" href="../ref/settings.html#std-setting-CSRF_USE_SESSIONS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">CSRF_USE_SESSIONS</span></code></a> 设置，允许将 CSRF 令牌存储在用户的会话中，而不是在 cookie 中。</li>
</ul>
</div>
<div class="section" id="s-database-backends">
<span id="database-backends"></span><h4>数据库后端<a class="headerlink" href="#database-backends" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>在 PostgreSQL 9.5+ 和 Oracle 上，新增了 <code class="docutils literal notranslate"><span class="pre">skip_locked</span></code> 参数，用于执行带有 <code class="docutils literal notranslate"><span class="pre">FOR</span> <span class="pre">UPDATE</span> <span class="pre">SKIP</span> <span class="pre">LOCKED</span></code> 的查询，可通过 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.select_for_update" title="django.db.models.query.QuerySet.select_for_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.select_for_update()</span></code></a> 使用。</li>
<li>新增了 <a class="reference internal" href="../ref/settings.html#std-setting-TEST_TEMPLATE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">TEST['TEMPLATE']</span></code></a> 设置，允许 PostgreSQL 用户指定用于创建测试数据库的模板。</li>
<li><a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.iterator" title="django.db.models.query.QuerySet.iterator"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.iterator()</span></code></a> 现在在 PostgreSQL 上使用 <a class="reference external" href="https://www.psycopg.org/docs/usage.html#server-side-cursors">server-side cursors</a>。这个功能将一些用于保存查询结果的工作内存负载转移到数据库，可能会增加数据库的内存使用量。</li>
<li>新增了对在 <a class="reference internal" href="../ref/settings.html#std-setting-OPTIONS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">OPTIONS</span></code></a> 中使用 <code class="docutils literal notranslate"><span class="pre">'isolation_level'</span></code> 选项的 MySQL 支持，允许指定 <a class="reference internal" href="../ref/databases.html#mysql-isolation-level"><span class="std std-ref">事务隔离级别</span></a>。为了避免可能的数据丢失，建议从 MySQL 的默认级别 repeatable read 切换到 read committed。</li>
<li>新增了对 <code class="docutils literal notranslate"><span class="pre">cx_Oracle</span></code> 5.3 的支持。</li>
</ul>
</div>
<div class="section" id="s-email">
<span id="email"></span><h4>电子邮件<a class="headerlink" href="#email" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新增了 <a class="reference internal" href="../ref/settings.html#std-setting-EMAIL_USE_LOCALTIME"><code class="xref std std-setting docutils literal notranslate"><span class="pre">EMAIL_USE_LOCALTIME</span></code></a> 设置，允许将 SMTP 日期标头发送到本地时区，而不是 UTC。</li>
<li><code class="docutils literal notranslate"><span class="pre">EmailMessage.attach()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">attach_file()</span></code> 现在在为 <em class="mimetype">text/*</em> 附件指定无法解码为 UTF-8 的二进制内容时，会回退到 MIME 类型 <em class="mimetype">application/octet-stream</em>。</li>
</ul>
</div>
<div class="section" id="s-file-storage">
<span id="file-storage"></span><h4>文件存储<a class="headerlink" href="#file-storage" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>为了能够被 <a class="reference external" href="https://docs.python.org/3/library/io.html#io.TextIOWrapper" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">io.TextIOWrapper</span></code></a> 包装，<a class="reference internal" href="../ref/files/file.html#django.core.files.File" title="django.core.files.File"><code class="xref py py-class docutils literal notranslate"><span class="pre">File</span></code></a> 现在具有 <code class="docutils literal notranslate"><span class="pre">readable()</span></code>、<code class="docutils literal notranslate"><span class="pre">writable()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">seekable()</span></code> 方法。</li>
</ul>
</div>
<div class="section" id="s-forms">
<span id="forms"></span><h4>表单<a class="headerlink" href="#forms" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>在 <a class="reference internal" href="../ref/forms/fields.html#django.forms.CharField" title="django.forms.CharField"><code class="xref py py-class docutils literal notranslate"><span class="pre">CharField</span></code></a>、<a class="reference internal" href="../ref/forms/fields.html#django.forms.EmailField" title="django.forms.EmailField"><code class="xref py py-class docutils literal notranslate"><span class="pre">EmailField</span></code></a>、<a class="reference internal" href="../ref/forms/fields.html#django.forms.RegexField" title="django.forms.RegexField"><code class="xref py py-class docutils literal notranslate"><span class="pre">RegexField</span></code></a>、<a class="reference internal" href="../ref/forms/fields.html#django.forms.SlugField" title="django.forms.SlugField"><code class="xref py py-class docutils literal notranslate"><span class="pre">SlugField</span></code></a> 和 <a class="reference internal" href="../ref/forms/fields.html#django.forms.URLField" title="django.forms.URLField"><code class="xref py py-class docutils literal notranslate"><span class="pre">URLField</span></code></a> 上新增了 <code class="docutils literal notranslate"><span class="pre">empty_value</span></code> 属性，允许指定表示 &quot;空&quot; 的 Python 值。</li>
<li>新的 <a class="reference internal" href="../ref/forms/api.html#django.forms.Form.get_initial_for_field" title="django.forms.Form.get_initial_for_field"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Form.get_initial_for_field()</span></code></a> 方法返回表单字段的初始数据。</li>
</ul>
</div>
<div class="section" id="s-internationalization">
<span id="internationalization"></span><h4>国际化<a class="headerlink" href="#internationalization" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>数字格式化和 <a class="reference internal" href="../ref/settings.html#std-setting-NUMBER_GROUPING"><code class="xref std std-setting docutils literal notranslate"><span class="pre">NUMBER_GROUPING</span></code></a> 设置支持非均匀的数字分组。</li>
</ul>
</div>
<div class="section" id="s-management-commands">
<span id="management-commands"></span><h4>管理命令<a class="headerlink" href="#management-commands" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../ref/django-admin.html#cmdoption-loaddata-exclude"><code class="xref std std-option docutils literal notranslate"><span class="pre">loaddata</span> <span class="pre">--exclude</span></code></a> 选项允许在从 fixture 加载数据时排除模型和应用程序。</li>
<li>新的 <a class="reference internal" href="../ref/django-admin.html#cmdoption-diffsettings-default"><code class="xref std std-option docutils literal notranslate"><span class="pre">diffsettings</span> <span class="pre">--default</span></code></a> 选项允许指定与 Django 默认设置进行比较的设置模块。</li>
<li><code class="docutils literal notranslate"><span class="pre">app_label</span></code> 参数现在限制了 <a class="reference internal" href="../ref/django-admin.html#cmdoption-showmigrations-plan"><code class="xref std std-option docutils literal notranslate"><span class="pre">showmigrations</span> <span class="pre">--plan</span></code></a> 输出。</li>
</ul>
</div>
<div class="section" id="s-migrations">
<span id="migrations"></span><h4>迁移<a class="headerlink" href="#migrations" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新增了对 <code class="docutils literal notranslate"><span class="pre">uuid.UUID</span></code> 对象的序列化支持。</li>
</ul>
</div>
<div class="section" id="s-models">
<span id="models"></span><h4>模型<a class="headerlink" href="#models" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>在 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.update_or_create" title="django.db.models.query.QuerySet.update_or_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.update_or_create()</span></code></a> 和 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.get_or_create" title="django.db.models.query.QuerySet.get_or_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_or_create()</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">defaults</span></code> 参数中新增了对可调用值的支持。</li>
<li><a class="reference internal" href="../ref/models/fields.html#django.db.models.ImageField" title="django.db.models.ImageField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ImageField</span></code></a> 现在具有默认的 <a class="reference internal" href="../ref/validators.html#django.core.validators.validate_image_file_extension" title="django.core.validators.validate_image_file_extension"><code class="xref py py-data docutils literal notranslate"><span class="pre">validate_image_file_extension</span></code></a> 验证器。（此验证器在 <a class="reference internal" href="1.11.2.html"><span class="doc">Django 1.11.2</span></a> 中移至表单字段。）</li>
<li><a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Trunc" title="django.db.models.functions.Trunc"><code class="xref py py-class docutils literal notranslate"><span class="pre">Trunc</span></code></a> 函数现在支持时间截断。</li>
<li>新增了 <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.ExtractWeek" title="django.db.models.functions.ExtractWeek"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExtractWeek</span></code></a> 函数，用于从 <a class="reference internal" href="../ref/models/fields.html#django.db.models.DateField" title="django.db.models.DateField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateField</span></code></a> 和 <a class="reference internal" href="../ref/models/fields.html#django.db.models.DateTimeField" title="django.db.models.DateTimeField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateTimeField</span></code></a> 中提取周，并通过 <a class="reference internal" href="../ref/models/querysets.html#std-fieldlookup-week"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">week</span></code></a> 查询公开。</li>
<li>新增了 <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.TruncTime" title="django.db.models.functions.TruncTime"><code class="xref py py-class docutils literal notranslate"><span class="pre">TruncTime</span></code></a> 函数，用于将 <a class="reference internal" href="../ref/models/fields.html#django.db.models.DateTimeField" title="django.db.models.DateTimeField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateTimeField</span></code></a> 截断到其时间组件，并通过 <a class="reference internal" href="../ref/models/querysets.html#std-fieldlookup-time"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">time</span></code></a> 查询公开。</li>
<li>在 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.values" title="django.db.models.query.QuerySet.values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.values()</span></code></a> 和 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.values_list" title="django.db.models.query.QuerySet.values_list"><code class="xref py py-meth docutils literal notranslate"><span class="pre">values_list()</span></code></a> 中添加了对表达式的支持。</li>
<li>对于接受多个参数的查询，如 <code class="docutils literal notranslate"><span class="pre">range</span></code>，新增了对查询表达式的支持。</li>
<li>现在可以在 <a class="reference internal" href="../ref/models/fields.html#django.db.models.FileField" title="django.db.models.FileField"><code class="xref py py-class docutils literal notranslate"><span class="pre">FileField</span></code></a> 上使用 <code class="docutils literal notranslate"><span class="pre">unique=True</span></code> 选项。</li>
<li>新增了 <a class="reference internal" href="../ref/models/expressions.html#django.db.models.Expression.asc" title="django.db.models.Expression.asc"><code class="xref py py-class docutils literal notranslate"><span class="pre">Expression.asc()</span></code></a> 和 <a class="reference internal" href="../ref/models/expressions.html#django.db.models.Expression.desc" title="django.db.models.Expression.desc"><code class="xref py py-meth docutils literal notranslate"><span class="pre">desc()</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">nulls_first</span></code> 和 <code class="docutils literal notranslate"><span class="pre">nulls_last</span></code> 参数，用于控制空值的排序顺序。</li>
<li>新的 <code class="docutils literal notranslate"><span class="pre">F</span></code> 表达式中的 <code class="docutils literal notranslate"><span class="pre">bitleftshift()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">bitrightshift()</span></code> 方法允许进行位移操作。</li>
<li>新增了 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.union" title="django.db.models.query.QuerySet.union"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.union()</span></code></a>、<a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.intersection" title="django.db.models.query.QuerySet.intersection"><code class="xref py py-meth docutils literal notranslate"><span class="pre">intersection()</span></code></a> 和 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.difference" title="django.db.models.query.QuerySet.difference"><code class="xref py py-meth docutils literal notranslate"><span class="pre">difference()</span></code></a> 方法。</li>
</ul>
</div>
<div class="section" id="s-requests-and-responses">
<span id="requests-and-responses"></span><h4>请求和响应<a class="headerlink" href="#requests-and-responses" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新增了 <a class="reference internal" href="../ref/request-response.html#django.http.QueryDict.fromkeys" title="django.http.QueryDict.fromkeys"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QueryDict.fromkeys()</span></code></a> 方法。</li>
<li><a class="reference internal" href="../ref/middleware.html#django.middleware.common.CommonMiddleware" title="django.middleware.common.CommonMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">CommonMiddleware</span></code></a> 现在为非流式响应设置 <code class="docutils literal notranslate"><span class="pre">Content-Length</span></code> 响应头。</li>
<li>新增了 <a class="reference internal" href="../ref/settings.html#std-setting-SECURE_HSTS_PRELOAD"><code class="xref std std-setting docutils literal notranslate"><span class="pre">SECURE_HSTS_PRELOAD</span></code></a> 设置，允许将 <code class="docutils literal notranslate"><span class="pre">preload</span></code> 指令附加到 <code class="docutils literal notranslate"><span class="pre">Strict-Transport-Security</span></code> 头部。</li>
<li><a class="reference internal" href="../ref/middleware.html#django.middleware.http.ConditionalGetMiddleware" title="django.middleware.http.ConditionalGetMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConditionalGetMiddleware</span></code></a> 现在将 <code class="docutils literal notranslate"><span class="pre">ETag</span></code> 头部添加到响应中。</li>
</ul>
</div>
<div class="section" id="s-serialization">
<span id="serialization"></span><h4>序列化<a class="headerlink" href="#serialization" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <code class="docutils literal notranslate"><span class="pre">django.core.serializers.base.Serializer.stream_class</span></code> 属性允许子类自定义默认流。</li>
<li>可以通过向 <code class="docutils literal notranslate"><span class="pre">serializers.serialize()</span></code> 函数传递一个 <code class="docutils literal notranslate"><span class="pre">cls</span></code> 关键字参数来自定义 <a class="reference internal" href="../topics/serialization.html#serialization-formats-json"><span class="std std-ref">JSON 序列化器</span></a> 使用的编码器。</li>
<li><a class="reference internal" href="../topics/serialization.html#django.core.serializers.json.DjangoJSONEncoder" title="django.core.serializers.json.DjangoJSONEncoder"><code class="xref py py-class docutils literal notranslate"><span class="pre">DjangoJSONEncoder</span></code></a> 现在可以序列化 <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.timedelta" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">timedelta</span></code></a> 对象（被 <a class="reference internal" href="../ref/models/fields.html#django.db.models.DurationField" title="django.db.models.DurationField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DurationField</span></code></a> 使用）。</li>
</ul>
</div>
<div class="section" id="s-templates">
<span id="templates"></span><h4>模板<a class="headerlink" href="#templates" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>现在可以将 <a class="reference internal" href="../ref/utils.html#django.utils.safestring.mark_safe" title="django.utils.safestring.mark_safe"><code class="xref py py-meth docutils literal notranslate"><span class="pre">mark_safe()</span></code></a> 用作装饰器。</li>
<li><a class="reference internal" href="../topics/templates.html#django.template.backends.jinja2.Jinja2" title="django.template.backends.jinja2.Jinja2"><code class="xref py py-class docutils literal notranslate"><span class="pre">Jinja2</span></code></a> 模板后端现在支持通过在 <a class="reference internal" href="../ref/settings.html#std-setting-TEMPLATES-OPTIONS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">OPTIONS</span></code></a> 中设置 <code class="docutils literal notranslate"><span class="pre">'context_processors'</span></code> 选项来配置上下文处理器。</li>
<li><a class="reference internal" href="../ref/templates/builtins.html#std-templatetag-regroup"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">regroup</span></code></a> 标签现在返回 <code class="docutils literal notranslate"><span class="pre">namedtuple</span></code> 而不是字典，因此你可以在循环中直接解包组对象，例如 <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">for</span> <span class="pre">grouper,</span> <span class="pre">list</span> <span class="pre">in</span> <span class="pre">regrouped</span> <span class="pre">%}</span></code>。</li>
<li>新增了 <a class="reference internal" href="../ref/templates/builtins.html#std-templatetag-resetcycle"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">resetcycle</span></code></a> 模板标签，允许重置 <a class="reference internal" href="../ref/templates/builtins.html#std-templatetag-cycle"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">cycle</span></code></a> 模板标签的序列。</li>
<li>现在可以为特定的 <a class="reference internal" href="../ref/templates/api.html#django.template.loaders.filesystem.Loader" title="django.template.loaders.filesystem.Loader"><code class="xref py py-class docutils literal notranslate"><span class="pre">filesystem.Loader</span></code></a> 指定特定的目录。</li>
</ul>
</div>
<div class="section" id="s-tests">
<span id="tests"></span><h4>测试<a class="headerlink" href="#tests" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新增了 <a class="reference internal" href="../topics/testing/advanced.html#django.test.runner.DiscoverRunner.get_test_runner_kwargs" title="django.test.runner.DiscoverRunner.get_test_runner_kwargs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DiscoverRunner.get_test_runner_kwargs()</span></code></a> 方法，允许自定义传递给测试运行器的关键字参数。</li>
<li>新增了 <a class="reference internal" href="../ref/django-admin.html#cmdoption-test-debug-mode"><code class="xref std std-option docutils literal notranslate"><span class="pre">test</span> <span class="pre">--debug-mode</span></code></a> 选项，通过将 <a class="reference internal" href="../ref/settings.html#std-setting-DEBUG"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DEBUG</span></code></a> 设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 来帮助排查测试失败。</li>
<li>新的 <a class="reference internal" href="../topics/testing/advanced.html#django.test.utils.setup_databases" title="django.test.utils.setup_databases"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.test.utils.setup_databases()</span></code></a> （从 <code class="docutils literal notranslate"><span class="pre">django.test.runner</span></code> 移动过来）和 <a class="reference internal" href="../topics/testing/advanced.html#django.test.utils.teardown_databases" title="django.test.utils.teardown_databases"><code class="xref py py-func docutils literal notranslate"><span class="pre">teardown_databases()</span></code></a> 函数使构建自定义测试运行器更加容易。</li>
<li>在使用 <a class="reference internal" href="../ref/django-admin.html#cmdoption-test-parallel"><code class="xref std std-option docutils literal notranslate"><span class="pre">test</span> <span class="pre">--parallel</span></code></a> 选项时，新增了对 <a class="reference external" href="https://docs.python.org/3/library/unittest.html#unittest.TestCase.subTest" title="(在 Python v3.12)"><code class="docutils literal notranslate"><span class="pre">unittest.TestCase.subTest()</span></code></a> 的支持。</li>
<li><code class="docutils literal notranslate"><span class="pre">DiscoverRunner</span></code> 现在在测试运行开始时运行系统检查。如果要禁用此功能，请覆盖 <a class="reference internal" href="../topics/testing/advanced.html#django.test.runner.DiscoverRunner.run_checks" title="django.test.runner.DiscoverRunner.run_checks"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DiscoverRunner.run_checks()</span></code></a> 方法。</li>
</ul>
</div>
<div class="section" id="s-validators">
<span id="validators"></span><h4>验证器<a class="headerlink" href="#validators" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新增了 <a class="reference internal" href="../ref/validators.html#django.core.validators.FileExtensionValidator" title="django.core.validators.FileExtensionValidator"><code class="xref py py-class docutils literal notranslate"><span class="pre">FileExtensionValidator</span></code></a> 以验证文件扩展名，以及 <a class="reference internal" href="../ref/validators.html#django.core.validators.validate_image_file_extension" title="django.core.validators.validate_image_file_extension"><code class="xref py py-data docutils literal notranslate"><span class="pre">validate_image_file_extension</span></code></a> 以验证图像文件。</li>
</ul>
</div>
</div>
</div>
<div class="section" id="s-backwards-incompatible-changes-in-1-11">
<span id="s-backwards-incompatible-1-11"></span><span id="backwards-incompatible-changes-in-1-11"></span><span id="backwards-incompatible-1-11"></span><h2>1.11 中的向后不兼容更改<a class="headerlink" href="#backwards-incompatible-changes-in-1-11" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-id1">
<span id="id1"></span><h3><a class="reference internal" href="../ref/contrib/gis/index.html#module-django.contrib.gis" title="django.contrib.gis: Geographic Information System (GIS) extensions for Django"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a><a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>为了简化代码库并且因为现在安装起来更容易（相对于最初发布 <code class="docutils literal notranslate"><span class="pre">contrib.gis</span></code> 时的情况），现在在 GeoDjango 中需要 <a class="reference internal" href="../ref/contrib/gis/install/geolibs.html#gdalbuild"><span class="std std-ref">GDAL</span></a> 作为依赖。在旧版本中，它只对 SQLite 有要求。</li>
<li><code class="docutils literal notranslate"><span class="pre">contrib.gis.maps</span></code> 已被移除，因为它与已退役的 Google Maps API 版本进行交互，似乎没有维护。如果您正在使用它，请 <a class="reference external" href="https://code.djangoproject.com/ticket/14284">告诉我们</a>。</li>
<li><code class="docutils literal notranslate"><span class="pre">GEOSGeometry</span></code> 的等号运算符现在也会比较 SRID。</li>
<li>基于 OpenLayers 的表单小部件现在使用 OpenLayers 3，同时更新了 <code class="docutils literal notranslate"><span class="pre">gis/openlayers.html</span></code> 和 <code class="docutils literal notranslate"><span class="pre">gis/openlayers-osm.html</span></code> 模板。如果您对这些小部件进行子类化或扩展模板，请检查您的项目。此外，新的小部件与旧的小部件有一些不同。不再使用小部件中的工具栏，而是点击以绘制，点击并拖动以移动地图，以及点击并拖动一个点/顶点/角来移动它。</li>
<li>不再支持 SpatiaLite &lt; 4.0 。</li>
<li>不再支持 GDAL 1.7 和 1.8 。</li>
<li><code class="docutils literal notranslate"><span class="pre">contrib.gis.forms.widgets</span></code> 中的小部件和管理员的 <code class="docutils literal notranslate"><span class="pre">OpenLayersWidget</span></code> 现在使用 <a class="reference internal" href="../ref/forms/renderers.html"><span class="doc">表单渲染 API</span></a> 而不是 <code class="docutils literal notranslate"><span class="pre">loader.render_to_string()</span></code>。如果您使用自定义小部件模板，您需要确保您的表单渲染器可以找到它。例如，您可以使用 <a class="reference internal" href="../ref/forms/renderers.html#django.forms.renderers.TemplatesSetting" title="django.forms.renderers.TemplatesSetting"><code class="xref py py-class docutils literal notranslate"><span class="pre">TemplatesSetting</span></code></a> 渲染器。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-staticfiles">
<span id="django-contrib-staticfiles"></span><h3><a class="reference internal" href="../ref/contrib/staticfiles.html#module-django.contrib.staticfiles" title="django.contrib.staticfiles: An app for handling static files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.staticfiles</span></code></a><a class="headerlink" href="#django-contrib-staticfiles" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>当使用散列的静态文件存储时，如果存在引用循环（例如，<code class="docutils literal notranslate"><span class="pre">'foo.css'</span></code> 引用 <code class="docutils literal notranslate"><span class="pre">'bar.css'</span></code>，而 <code class="docutils literal notranslate"><span class="pre">'bar.css'</span></code> 又引用 <code class="docutils literal notranslate"><span class="pre">'foo.css'</span></code>），或者如果引用其他文件的文件链过深，无法在多次传递中解析，那么 <code class="docutils literal notranslate"><span class="pre">collectstatic</span></code> 在后处理期间可能会失败。在后一种情况下，可以通过 <a class="reference internal" href="../ref/contrib/staticfiles.html#django.contrib.staticfiles.storage.ManifestStaticFilesStorage.max_post_process_passes" title="django.contrib.staticfiles.storage.ManifestStaticFilesStorage.max_post_process_passes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManifestStaticFilesStorage.max_post_process_passes</span></code></a> 增加传递次数。</li>
<li>当使用 <code class="docutils literal notranslate"><span class="pre">ManifestStaticFilesStorage</span></code> 时，运行时未在清单中找到的静态文件现在会引发 <code class="docutils literal notranslate"><span class="pre">ValueError</span></code>，而不是返回不变的路径。您可以通过将 <a class="reference internal" href="../ref/contrib/staticfiles.html#django.contrib.staticfiles.storage.ManifestStaticFilesStorage.manifest_strict" title="django.contrib.staticfiles.storage.ManifestStaticFilesStorage.manifest_strict"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManifestStaticFilesStorage.manifest_strict</span></code></a> 设置为 <code class="docutils literal notranslate"><span class="pre">False</span></code> 来恢复到旧的行为。</li>
</ul>
</div>
<div class="section" id="s-database-backend-api">
<span id="database-backend-api"></span><h3>数据库后端 API<a class="headerlink" href="#database-backend-api" title="永久链接至标题">¶</a></h3>
<p>本节介绍了第三方数据库后端可能需要的更改。</p>
<ul class="simple">
<li>新增了 <code class="docutils literal notranslate"><span class="pre">DatabaseOperations.time_trunc_sql()</span></code> 方法，以支持 <code class="docutils literal notranslate"><span class="pre">TimeField</span></code> 截断。它接受一个 <code class="docutils literal notranslate"><span class="pre">lookup_type</span></code> 和 <code class="docutils literal notranslate"><span class="pre">field_name</span></code> 参数，并返回将给定时间字段 <code class="docutils literal notranslate"><span class="pre">field_name</span></code> 截断为只具有给定精度的时间对象的适当 SQL。<code class="docutils literal notranslate"><span class="pre">lookup_type</span></code> 参数可以是 <code class="docutils literal notranslate"><span class="pre">'hour'</span></code>、<code class="docutils literal notranslate"><span class="pre">'minute'</span></code> 或 <code class="docutils literal notranslate"><span class="pre">'second'</span></code>。</li>
<li>新增了 <code class="docutils literal notranslate"><span class="pre">DatabaseOperations.datetime_cast_time_sql()</span></code> 方法，以支持 <a class="reference internal" href="../ref/models/querysets.html#std-fieldlookup-time"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">time</span></code></a> 查询。它接受一个 <code class="docutils literal notranslate"><span class="pre">field_name</span></code> 和 <code class="docutils literal notranslate"><span class="pre">tzname</span></code> 参数，并返回将日期时间值强制转换为时间值所需的 SQL。</li>
<li>要启用 <code class="docutils literal notranslate"><span class="pre">FOR</span> <span class="pre">UPDATE</span> <span class="pre">SKIP</span> <span class="pre">LOCKED</span></code> 支持，请设置 <code class="docutils literal notranslate"><span class="pre">DatabaseFeatures.has_select_for_update_skip_locked</span> <span class="pre">=</span> <span class="pre">True</span></code>。</li>
<li>新的 <code class="docutils literal notranslate"><span class="pre">DatabaseFeatures.supports_index_column_ordering</span></code> 属性指定数据库是否允许在索引中定义列的排序。默认值为 <code class="docutils literal notranslate"><span class="pre">True</span></code>，而 <code class="docutils literal notranslate"><span class="pre">DatabaseIntrospection.get_constraints()</span></code> 方法应在每个返回的字典中包含一个 <code class="docutils literal notranslate"><span class="pre">'orders'</span></code> 键，该键包含一个列表，其中包含与索引中每列的排序对应的 <code class="docutils literal notranslate"><span class="pre">'ASC'</span></code> 和/或 <code class="docutils literal notranslate"><span class="pre">'DESC'</span></code> 值。</li>
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-inspectdb"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">inspectdb</span></code></a> 不再调用已弃用的 <code class="docutils literal notranslate"><span class="pre">DatabaseIntrospection.get_indexes()</span></code> 方法。自定义数据库后端应确保 <code class="docutils literal notranslate"><span class="pre">DatabaseIntrospection.get_constraints()</span></code> 返回所有类型的索引。</li>
<li>将 <code class="docutils literal notranslate"><span class="pre">ignores_quoted_identifier_case</span></code> 功能的名称更改为 <code class="docutils literal notranslate"><span class="pre">ignores_table_name_case</span></code>，以更准确地反映它的使用方式。</li>
<li>新增了 <code class="docutils literal notranslate"><span class="pre">name</span></code> 关键字参数到 <code class="docutils literal notranslate"><span class="pre">DatabaseWrapper.create_cursor(self,</span> <span class="pre">name=None)</span></code> 方法，以允许在支持的后端上使用服务器端游标。</li>
</ul>
</div>
<div class="section" id="s-dropped-support-for-postgresql-9-2-and-postgis-2-0">
<span id="dropped-support-for-postgresql-9-2-and-postgis-2-0"></span><h3>不再支持 PostgreSQL 9.2 和 PostGIS 2.0 。<a class="headerlink" href="#dropped-support-for-postgresql-9-2-and-postgis-2-0" title="永久链接至标题">¶</a></h3>
<p>PostgreSQL 9.2 的上游支持将于 2017 年 9 月结束。因此，Django 1.11 将 PostgreSQL 9.3 设为其官方支持的最低版本。</p>
<p>由于 PostgreSQL 9.2 是支持 PostGIS 2.0 的最后一个版本，因此也取消了对 PostGIS 2.0 的支持。</p>
<p>此外，支持的最低 psycopg2 版本从 2.4.5 提高到 2.5.4 。</p>
</div>
<div class="section" id="s-liveservertestcase-binds-to-port-zero">
<span id="s-liveservertestcase-port-zero-change"></span><span id="liveservertestcase-binds-to-port-zero"></span><span id="liveservertestcase-port-zero-change"></span><h3><code class="docutils literal notranslate"><span class="pre">LiveServerTestCase</span></code> 现在绑定到零端口<a class="headerlink" href="#liveservertestcase-binds-to-port-zero" title="永久链接至标题">¶</a></h3>
<p>与其采用端口范围并迭代查找空闲端口，<code class="docutils literal notranslate"><span class="pre">LiveServerTestCase</span></code> 现在绑定到零端口，并依赖操作系统分配空闲端口。不再使用 <code class="docutils literal notranslate"><span class="pre">DJANGO_LIVE_TEST_SERVER_ADDRESS</span></code> 环境变量，也不再使用 <code class="docutils literal notranslate"><span class="pre">manage.py</span> <span class="pre">test</span> <span class="pre">--liveserver</span></code> 选项。</p>
<p>如果需要将 <code class="docutils literal notranslate"><span class="pre">LiveServerTestCase</span></code> 绑定到特定端口，可以使用 Django 1.11.2 中新增的 <code class="docutils literal notranslate"><span class="pre">port</span></code> 属性。</p>
</div>
<div class="section" id="s-protection-against-insecure-redirects-in-django-contrib-auth-and-i18n-views">
<span id="protection-against-insecure-redirects-in-django-contrib-auth-and-i18n-views"></span><h3>在 <a class="reference internal" href="../topics/auth/index.html#module-django.contrib.auth" title="django.contrib.auth: Django's authentication framework."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a> 和 <code class="docutils literal notranslate"><span class="pre">i18n</span></code> 视图中加强了对不安全的重定向的保护。<a class="headerlink" href="#protection-against-insecure-redirects-in-django-contrib-auth-and-i18n-views" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">LoginView</span></code>、<code class="docutils literal notranslate"><span class="pre">LogoutView</span></code> （以及已弃用的函数式等效版本）和 <a class="reference internal" href="../topics/i18n/translation.html#django.views.i18n.set_language" title="django.views.i18n.set_language"><code class="xref py py-func docutils literal notranslate"><span class="pre">set_language()</span></code></a> 在应用程序运行在 HTTPS 上时，会保护用户免受被重定向到非 HTTPS 的 <code class="docutils literal notranslate"><span class="pre">next</span></code> URL 的影响。</p>
</div>
<div class="section" id="s-queryset-get-or-create-and-update-or-create-validate-arguments">
<span id="queryset-get-or-create-and-update-or-create-validate-arguments"></span><h3><code class="docutils literal notranslate"><span class="pre">QuerySet.get_or_create()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">update_or_create()</span></code> 现在会验证参数。<a class="headerlink" href="#queryset-get-or-create-and-update-or-create-validate-arguments" title="永久链接至标题">¶</a></h3>
<p>为了防止拼写错误默默通过，<a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.get_or_create" title="django.db.models.query.QuerySet.get_or_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_or_create()</span></code></a> 和 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.update_or_create" title="django.db.models.query.QuerySet.update_or_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">update_or_create()</span></code></a> 检查它们的参数是否是模型字段。这只会在一个方面引入向后不兼容，可能会暴露出项目中的错误。</p>
</div>
<div class="section" id="s-pytz-is-a-required-dependency-and-support-for-settings-time-zone-none-is-removed">
<span id="pytz-is-a-required-dependency-and-support-for-settings-time-zone-none-is-removed"></span><h3><code class="docutils literal notranslate"><span class="pre">pytz</span></code> 现在是必需的依赖项，不再支持将 <code class="docutils literal notranslate"><span class="pre">settings.TIME_ZONE</span> <span class="pre">=</span> <span class="pre">None</span></code>。<a class="headerlink" href="#pytz-is-a-required-dependency-and-support-for-settings-time-zone-none-is-removed" title="永久链接至标题">¶</a></h3>
<p>为了简化 Django 的时区处理，<code class="docutils literal notranslate"><span class="pre">pytz</span></code> 现在是必需的依赖项，它会自动与 Django 一起安装。</p>
<p>不再支持 <code class="docutils literal notranslate"><span class="pre">settings.TIME_ZONE</span> <span class="pre">=</span> <span class="pre">None</span></code>，因为这种行为通常不常用且可疑的有用性。如果希望根据系统时区自动检测时区，可以使用 <a class="reference external" href="https://pypi.org/project/tzlocal/">tzlocal</a>。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tzlocal</span> <span class="kn">import</span> <span class="n">get_localzone</span>

<span class="n">TIME_ZONE</span> <span class="o">=</span> <span class="n">get_localzone</span><span class="p">()</span><span class="o">.</span><span class="n">zone</span>
</pre></div>
</div>
<p>这与 <code class="docutils literal notranslate"><span class="pre">settings.TIME_ZONE</span> <span class="pre">=</span> <span class="pre">None</span></code> 类似，但它还设置了 <code class="docutils literal notranslate"><span class="pre">os.environ['TZ']</span></code>。如果存在情况下，您发现无法适应设置 <code class="docutils literal notranslate"><span class="pre">TIME_ZONE</span></code> 的代码，请通过 <a class="reference external" href="https://groups.google.com/g/django-developers/c/OAV3FChfuPM/discussion">告诉我们</a>。</p>
</div>
<div class="section" id="s-html-changes-in-admin-templates">
<span id="html-changes-in-admin-templates"></span><h3>管理模板中的 HTML 更改<a class="headerlink" href="#html-changes-in-admin-templates" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">&lt;p</span> <span class="pre">class=&quot;help&quot;&gt;</span></code> 被替换为 <code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code> 标签，以允许在帮助文本中包含列表。</p>
<p>只读字段现在被包装在 <code class="docutils literal notranslate"><span class="pre">&lt;div</span> <span class="pre">class=&quot;readonly&quot;&gt;...&lt;/div&gt;</span></code> 中，而不是 <code class="docutils literal notranslate"><span class="pre">&lt;p&gt;...&lt;/p&gt;</span></code>，以允许字段内容包含任何类型的 HTML。</p>
</div>
<div class="section" id="s-changes-due-to-the-introduction-of-template-based-widget-rendering">
<span id="s-template-widget-incompatibilities-1-11"></span><span id="changes-due-to-the-introduction-of-template-based-widget-rendering"></span><span id="template-widget-incompatibilities-1-11"></span><h3>由于引入基于模板的小部件渲染，发生了一些更改。<a class="headerlink" href="#changes-due-to-the-introduction-of-template-based-widget-rendering" title="永久链接至标题">¶</a></h3>
<p>移除了 <code class="docutils literal notranslate"><span class="pre">django.forms.widgets</span></code> 中一些未记录的类：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">SubWidget</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">RendererMixin</span></code>, <code class="docutils literal notranslate"><span class="pre">ChoiceFieldRenderer</span></code>, <code class="docutils literal notranslate"><span class="pre">RadioFieldRenderer</span></code>,
<code class="docutils literal notranslate"><span class="pre">CheckboxFieldRenderer</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ChoiceInput</span></code>, <code class="docutils literal notranslate"><span class="pre">RadioChoiceInput</span></code>, <code class="docutils literal notranslate"><span class="pre">CheckboxChoiceInput</span></code></li>
</ul>
<p>移除了未记录的 <code class="docutils literal notranslate"><span class="pre">Select.render_option()</span></code> 方法。</p>
<p>移除了 <code class="docutils literal notranslate"><span class="pre">Widget.format_output()</span></code> 方法。请使用自定义小部件模板替代。</p>
<p>如果 <code class="docutils literal notranslate"><span class="pre">settings.USE_L10N=True</span></code>，现在某些小部件的值，如 <code class="docutils literal notranslate"><span class="pre">&lt;select&gt;</span></code> 选项，将进行本地化。您可以通过使用 <a class="reference internal" href="../topics/i18n/formatting.html#std-templatetag-localize"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">localize</span></code></a> 模板标签关闭本地化，恢复到旧的行为，使用自定义小部件模板。</p>
</div>
<div class="section" id="s-django-template-backends-django-template-render-prohibits-non-dict-context">
<span id="django-template-backends-django-template-render-prohibits-non-dict-context"></span><h3><code class="docutils literal notranslate"><span class="pre">django.template.backends.django.Template.render()</span></code> 禁止非字典上下文。<a class="headerlink" href="#django-template-backends-django-template-render-prohibits-non-dict-context" title="永久链接至标题">¶</a></h3>
<p>为了与多个模板引擎兼容，<code class="docutils literal notranslate"><span class="pre">django.template.backends.django.Template.render()</span></code> （从高级模板加载器 API（如 <code class="docutils literal notranslate"><span class="pre">loader.get_template()</span></code>）返回）必须接收一个上下文字典，而不是 <code class="docutils literal notranslate"><span class="pre">Context</span></code> 或 <code class="docutils literal notranslate"><span class="pre">RequestContext</span></code>。如果您之前传递了这两个类中的任何一个，请改为传递一个字典 - 这样做是向后兼容旧版本的 Django。</p>
</div>
<div class="section" id="s-model-state-changes-in-migration-operations">
<span id="model-state-changes-in-migration-operations"></span><h3>迁移操作中的模型状态更改<a class="headerlink" href="#model-state-changes-in-migration-operations" title="永久链接至标题">¶</a></h3>
<p>为了提高应用迁移的速度，延迟了相关模型的渲染，直到需要它们的操作（例如 <code class="docutils literal notranslate"><span class="pre">RunPython</span></code>）。如果您有一个自定义操作，需要在 <code class="docutils literal notranslate"><span class="pre">database_forwards()</span></code> 或 <code class="docutils literal notranslate"><span class="pre">database_backwards()</span></code> 的 <code class="docutils literal notranslate"><span class="pre">from_state</span></code> 参数中使用模型类或模型实例，您必须使用 <code class="docutils literal notranslate"><span class="pre">clear_delayed_apps_cache()</span></code> 方法来渲染模型状态，如 <a class="reference internal" href="../ref/migration-operations.html#writing-your-own-migration-operation"><span class="std std-ref">编写自己的迁移操作</span></a> 中所述。</p>
</div>
<div class="section" id="s-server-side-cursors-on-postgresql">
<span id="server-side-cursors-on-postgresql"></span><h3>PostgreSQL 上的服务器端游标<a class="headerlink" href="#server-side-cursors-on-postgresql" title="永久链接至标题">¶</a></h3>
<p>将 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.iterator" title="django.db.models.query.QuerySet.iterator"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.iterator()</span></code></a> 使用服务器端游标在 PostgreSQL 上可能会阻止在事务池模式下使用 PgBouncer 运行 Django。要重新允许这样做，可以在 <a class="reference internal" href="../ref/settings.html#std-setting-DATABASES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DATABASES</span></code></a> 中使用 <a class="reference internal" href="../ref/settings.html#std-setting-DATABASE-DISABLE_SERVER_SIDE_CURSORS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DISABLE_SERVER_SIDE_CURSORS</span></code></a> 设置（在 Django 1.11.1 中添加）。</p>
<p>有关更多讨论，请参阅 <a class="reference internal" href="../ref/databases.html#transaction-pooling-server-side-cursors"><span class="std std-ref">事务池和服务器端游标</span></a>。</p>
</div>
<div class="section" id="s-miscellaneous">
<span id="miscellaneous"></span><h3>杂项<a class="headerlink" href="#miscellaneous" title="永久链接至标题">¶</a></h3>
<ul>
<li><p class="first">如果在 feed 中没有任何项目具有 <code class="docutils literal notranslate"><span class="pre">pubdate</span></code> 或 <code class="docutils literal notranslate"><span class="pre">updateddate</span></code> 属性，那么 <a class="reference internal" href="../ref/utils.html#django.utils.feedgenerator.SyndicationFeed.latest_post_date" title="django.utils.feedgenerator.SyndicationFeed.latest_post_date"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SyndicationFeed.latest_post_date()</span></code></a> 现在会返回当前的 UTC 日期/时间，而不是一个没有任何时区信息的 datetime。</p>
</li>
<li><p class="first">CSRF 失败现在会被记录到 <code class="docutils literal notranslate"><span class="pre">django.security.csrf</span></code> 日志器，而不是 <code class="docutils literal notranslate"><span class="pre">django.request</span></code>。</p>
</li>
<li><p class="first">运行测试时，不再禁用 <a class="reference internal" href="../ref/settings.html#std-setting-ALLOWED_HOSTS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">ALLOWED_HOSTS</span></code></a> 验证。如果您的应用程序包括具有自定义主机名的测试，您必须将这些主机名包含在 <a class="reference internal" href="../ref/settings.html#std-setting-ALLOWED_HOSTS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">ALLOWED_HOSTS</span></code></a> 中。请参阅 <a class="reference internal" href="../topics/testing/advanced.html#topics-testing-advanced-multiple-hosts"><span class="std std-ref">测试与多主机名</span></a>。</p>
</li>
<li><p class="first">在 <code class="docutils literal notranslate"><span class="pre">ModelAdmin.list_display</span></code> 中使用外键的 id（例如 <code class="docutils literal notranslate"><span class="pre">'field_id'</span></code>）会显示相关对象的 ID。如果要恢复到对象的字符串表示的旧行为，请移除 <code class="docutils literal notranslate"><span class="pre">_id</span></code> 后缀。</p>
</li>
<li><p class="first">在模型表单中，具有 <code class="docutils literal notranslate"><span class="pre">null=True</span></code> 的 <a class="reference internal" href="../ref/models/fields.html#django.db.models.CharField" title="django.db.models.CharField"><code class="xref py py-class docutils literal notranslate"><span class="pre">CharField</span></code></a> 现在会为空白值保存 <code class="docutils literal notranslate"><span class="pre">NULL</span></code>，而不是空字符串。</p>
</li>
<li><p class="first">在 Oracle 上，<a class="reference internal" href="../ref/models/instances.html#django.db.models.Model.validate_unique" title="django.db.models.Model.validate_unique"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.validate_unique()</span></code></a> 不再检查空字符串的唯一性，因为数据库会将该值解释为 <code class="docutils literal notranslate"><span class="pre">NULL</span></code>。</p>
</li>
<li><p class="first">如果您子类化了 <a class="reference internal" href="../topics/auth/customizing.html#django.contrib.auth.models.AbstractUser" title="django.contrib.auth.models.AbstractUser"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractUser</span></code></a> 并覆盖了 <code class="docutils literal notranslate"><span class="pre">clean()</span></code> 方法，请确保它调用了 <code class="docutils literal notranslate"><span class="pre">super()</span></code>。新的 <a class="reference internal" href="../topics/auth/customizing.html#django.contrib.auth.models.AbstractUser.clean" title="django.contrib.auth.models.AbstractUser.clean"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AbstractUser.clean()</span></code></a> 方法中会调用 <a class="reference internal" href="../topics/auth/customizing.html#django.contrib.auth.models.BaseUserManager.normalize_email" title="django.contrib.auth.models.BaseUserManager.normalize_email"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BaseUserManager.normalize_email()</span></code></a>，以便在模型表单验证等情况下应用标准化。</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">EmailField</span></code> 和 <code class="docutils literal notranslate"><span class="pre">URLField</span></code> 不再接受 <code class="docutils literal notranslate"><span class="pre">strip</span></code> 关键字参数。移除它，因为在旧版本的 Django 中它没有任何效果，这些字段总是会去除空格。</p>
</li>
<li><p class="first">表单小部件渲染的 <code class="docutils literal notranslate"><span class="pre">checked</span></code> 和 <code class="docutils literal notranslate"><span class="pre">selected</span></code> 属性现在使用 HTML5 布尔语法，而不再使用 XHTML 的 <code class="docutils literal notranslate"><span class="pre">checked='checked'</span></code> 和 <code class="docutils literal notranslate"><span class="pre">selected='selected'</span></code>。</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/models/relations.html#django.db.models.fields.related.RelatedManager.add" title="django.db.models.fields.related.RelatedManager.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RelatedManager.add()</span></code></a>、<a class="reference internal" href="../ref/models/relations.html#django.db.models.fields.related.RelatedManager.remove" title="django.db.models.fields.related.RelatedManager.remove"><code class="xref py py-meth docutils literal notranslate"><span class="pre">remove()</span></code></a>、<a class="reference internal" href="../ref/models/relations.html#django.db.models.fields.related.RelatedManager.clear" title="django.db.models.fields.related.RelatedManager.clear"><code class="xref py py-meth docutils literal notranslate"><span class="pre">clear()</span></code></a> 和 <a class="reference internal" href="../ref/models/relations.html#django.db.models.fields.related.RelatedManager.set" title="django.db.models.fields.related.RelatedManager.set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set()</span></code></a> 现在会清除 <code class="docutils literal notranslate"><span class="pre">prefetch_related()</span></code> 缓存。</p>
</li>
<li><p class="first">为防止可能丢失的保存设置，如果在调用 <a class="reference internal" href="../topics/testing/advanced.html#django.test.utils.teardown_test_environment" title="django.test.utils.teardown_test_environment"><code class="xref py py-func docutils literal notranslate"><span class="pre">teardown_test_environment()</span></code></a> 之前再次调用 <a class="reference internal" href="../topics/testing/advanced.html#django.test.utils.setup_test_environment" title="django.test.utils.setup_test_environment"><code class="xref py py-func docutils literal notranslate"><span class="pre">setup_test_environment()</span></code></a>，它现在会引发异常。</p>
</li>
<li><p class="first">未记录的 <code class="docutils literal notranslate"><span class="pre">DateTimeAwareJSONEncoder</span></code> 别名（对于在 Django 1.0 中更名的 <a class="reference internal" href="../topics/serialization.html#django.core.serializers.json.DjangoJSONEncoder" title="django.core.serializers.json.DjangoJSONEncoder"><code class="xref py py-class docutils literal notranslate"><span class="pre">DjangoJSONEncoder</span></code></a>）已被移除。</p>
</li>
<li><p class="first">如果没有指定 <a class="reference internal" href="../ref/settings.html#std-setting-TEMPLATES-OPTIONS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">OPTIONS['loaders']</span></code></a> 并且 <a class="reference internal" href="../ref/settings.html#std-setting-TEMPLATES-OPTIONS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">OPTIONS['debug']</span></code></a> 为 <code class="docutils literal notranslate"><span class="pre">False</span></code> （后者默认为 <a class="reference internal" href="../ref/settings.html#std-setting-DEBUG"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DEBUG</span></code></a> 的值），则现在会启用 <a class="reference internal" href="../ref/templates/api.html#django.template.loaders.cached.Loader" title="django.template.loaders.cached.Loader"><code class="xref py py-class docutils literal notranslate"><span class="pre">cached</span> <span class="pre">template</span> <span class="pre">loader</span></code></a>。如果您有一些不是线程安全的 <a class="reference internal" href="../howto/custom-template-tags.html#template-tag-thread-safety"><span class="std std-ref">模板标签</span></a>，这可能会导致不兼容。</p>
</li>
<li><p class="first">过去在运行 <code class="docutils literal notranslate"><span class="pre">migrate</span></code> 命令之后不再提示删除陈旧的内容类型。现在请使用新的 <a class="reference internal" href="../ref/django-admin.html#django-admin-remove_stale_contenttypes"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">remove_stale_contenttypes</span></code></a> 命令。</p>
</li>
<li><p class="first">管理员界面中的 <code class="docutils literal notranslate"><span class="pre">IntegerField</span></code> 控件现在使用 <code class="docutils literal notranslate"><span class="pre">type=&quot;number&quot;</span></code> 而不是 <code class="docutils literal notranslate"><span class="pre">type=&quot;text&quot;</span></code>。</p>
</li>
<li><p class="first">现在，条件 HTTP 标头根据 <span class="target" id="index-6"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7232.html"><strong>RFC 7232</strong></a> 的条件请求规范进行解析和比较，而不是较旧的 <span class="target" id="index-7"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2616.html"><strong>RFC 2616</strong></a> 规范。</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/utils.html#django.utils.cache.patch_response_headers" title="django.utils.cache.patch_response_headers"><code class="xref py py-func docutils literal notranslate"><span class="pre">patch_response_headers()</span></code></a> 不再添加 <code class="docutils literal notranslate"><span class="pre">Last-Modified</span></code> 标头。根据 <span class="target" id="index-8"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7234.html#section-4.2.2"><strong>RFC 7234#section-4.2.2</strong></a>，在提供明确的过期时间的其他缓存标头旁边，例如 <code class="docutils literal notranslate"><span class="pre">Expires</span></code> 或 <code class="docutils literal notranslate"><span class="pre">Cache-Control</span></code>，此标头是无用的。因此，<a class="reference internal" href="../ref/middleware.html#django.middleware.cache.UpdateCacheMiddleware" title="django.middleware.cache.UpdateCacheMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">UpdateCacheMiddleware</span></code></a> 和 <a class="reference internal" href="../ref/utils.html#django.utils.cache.add_never_cache_headers" title="django.utils.cache.add_never_cache_headers"><code class="xref py py-func docutils literal notranslate"><span class="pre">add_never_cache_headers()</span></code></a> 调用 <code class="docutils literal notranslate"><span class="pre">patch_response_headers()</span></code>，因此也受到此更改的影响。</p>
</li>
<li><p class="first">在管理模板中，<code class="docutils literal notranslate"><span class="pre">&lt;p</span> <span class="pre">class=&quot;help&quot;&gt;</span></code> 被替换为 <code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code> 标签，以允许在帮助文本中包含列表。</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/middleware.html#django.middleware.http.ConditionalGetMiddleware" title="django.middleware.http.ConditionalGetMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConditionalGetMiddleware</span></code></a> 不再设置 <code class="docutils literal notranslate"><span class="pre">Date</span></code> 头，因为 web 服务器会设置该头。它也不再设置 <code class="docutils literal notranslate"><span class="pre">Content-Length</span></code> 头，因为现在由 <a class="reference internal" href="../ref/middleware.html#django.middleware.common.CommonMiddleware" title="django.middleware.common.CommonMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">CommonMiddleware</span></code></a> 完成此操作。</p>
<p>如果您有一个中间件在 <code class="docutils literal notranslate"><span class="pre">MIDDLEWARE</span></code> 或 <code class="docutils literal notranslate"><span class="pre">MIDDLEWARE_CLASSES</span></code> 设置中出现在 <code class="docutils literal notranslate"><span class="pre">CommonMiddleware</span></code> 之前，并且修改响应的内容，那么您必须重新排列您的中间件，以确保在设置 <code class="docutils literal notranslate"><span class="pre">Content-Length</span></code> 后不会修改响应，或者让修改响应的中间件重置 <code class="docutils literal notranslate"><span class="pre">Content-Length</span></code> 头。</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/applications.html#django.apps.AppConfig.get_model" title="django.apps.AppConfig.get_model"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_model()</span></code></a> 和 <a class="reference internal" href="../ref/applications.html#django.apps.AppConfig.get_models" title="django.apps.AppConfig.get_models"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_models()</span></code></a> 现在在所有应用程序的模型加载之前调用时会引发 <a class="reference internal" href="../ref/exceptions.html#django.core.exceptions.AppRegistryNotReady" title="django.core.exceptions.AppRegistryNotReady"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AppRegistryNotReady</span></code></a> 异常。以前它们只需要目标应用程序的模型被加载，因此可能返回未完全设置其关系的模型。如果您需要 <code class="docutils literal notranslate"><span class="pre">get_model()</span></code> 的旧行为，请将 <code class="docutils literal notranslate"><span class="pre">require_ready</span></code> 参数设置为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。</p>
</li>
<li><p class="first">未使用的 <code class="docutils literal notranslate"><span class="pre">BaseCommand.can_import_settings</span></code> 属性已被删除。</p>
</li>
<li><p class="first">未记录的 <code class="docutils literal notranslate"><span class="pre">django.utils.functional.lazy_property</span></code> 已被移除。</p>
</li>
<li><p class="first">为了与非多部分请求保持一致，<code class="docutils literal notranslate"><span class="pre">MultiPartParser.parse()</span></code> 现在会使 <code class="docutils literal notranslate"><span class="pre">request.POST</span></code> 保持不可变性。如果你要修改那个 <code class="docutils literal notranslate"><span class="pre">QueryDict</span></code>，你现在必须先复制它，例如 <code class="docutils literal notranslate"><span class="pre">request.POST.copy()</span></code>。</p>
</li>
<li><p class="first">对于 <code class="docutils literal notranslate"><span class="pre">cx_Oracle</span></code> 版本小于 5.2 的支持已被移除。</p>
</li>
<li><p class="first">对于 IPython 版本小于 1.0 的支持已从 <code class="docutils literal notranslate"><span class="pre">shell</span></code> 命令中移除。</p>
</li>
<li><p class="first">私有 API <code class="docutils literal notranslate"><span class="pre">Widget.build_attrs()</span></code> 的签名已从 <code class="docutils literal notranslate"><span class="pre">extra_attrs=None,</span> <span class="pre">**kwargs</span></code> 更改为 <code class="docutils literal notranslate"><span class="pre">base_attrs,</span> <span class="pre">extra_attrs=None</span></code>。</p>
</li>
<li><p class="first">通过测试客户端上传到一个 <a class="reference internal" href="../ref/models/fields.html#django.db.models.ImageField" title="django.db.models.ImageField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ImageField</span></code></a> 的类似文件的对象（例如 <a class="reference external" href="https://docs.python.org/3/library/io.html#io.StringIO" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">StringIO</span></code></a> 和 <a class="reference external" href="https://docs.python.org/3/library/io.html#io.BytesIO" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">BytesIO</span></code></a>）现在需要一个具有通过 <a class="reference internal" href="../ref/validators.html#django.core.validators.validate_image_file_extension" title="django.core.validators.validate_image_file_extension"><code class="xref py py-data docutils literal notranslate"><span class="pre">validate_image_file_extension</span></code></a> 验证器的值的 <code class="docutils literal notranslate"><span class="pre">name</span></code> 属性。请参阅 <a class="reference internal" href="../topics/testing/tools.html#django.test.Client.post" title="django.test.Client.post"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Client.post()</span></code></a> 中的注意事项。</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/models/fields.html#django.db.models.FileField" title="django.db.models.FileField"><code class="xref py py-class docutils literal notranslate"><span class="pre">FileField</span></code></a> 现在会移动文件而不是复制它所接收的文件。使用默认的文件上传设置，文件大小超过 <a class="reference internal" href="../ref/settings.html#std-setting-FILE_UPLOAD_MAX_MEMORY_SIZE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">FILE_UPLOAD_MAX_MEMORY_SIZE</span></code></a> 的文件现在具有与临时文件相同的权限（通常是 <code class="docutils literal notranslate"><span class="pre">0o600</span></code>），而不是系统的标准掩码（通常是 <code class="docutils literal notranslate"><span class="pre">0o644</span></code>）。如果您需要不考虑文件大小都具有相同权限，请设置 <a class="reference internal" href="../ref/settings.html#std-setting-FILE_UPLOAD_PERMISSIONS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">FILE_UPLOAD_PERMISSIONS</span></code></a>。</p>
</li>
</ul>
</div>
</div>
<div class="section" id="s-features-deprecated-in-1-11">
<span id="s-deprecated-features-1-11"></span><span id="features-deprecated-in-1-11"></span><span id="deprecated-features-1-11"></span><h2>在 1.11 中被废弃的功能<a class="headerlink" href="#features-deprecated-in-1-11" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-models-permalink-decorator">
<span id="models-permalink-decorator"></span><h3><code class="docutils literal notranslate"><span class="pre">models.permalink()</span></code> 装饰器<a class="headerlink" href="#models-permalink-decorator" title="永久链接至标题">¶</a></h3>
<p>请使用 <a class="reference internal" href="../ref/urlresolvers.html#django.urls.reverse" title="django.urls.reverse"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.urls.reverse()</span></code></a>。例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="nd">@models</span><span class="o">.</span><span class="n">permalink</span>
    <span class="k">def</span> <span class="nf">url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;guitarist_detail&quot;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">])</span>
</pre></div>
</div>
<p>变成：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>


<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;guitarist_detail&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="s-id2">
<span id="id2"></span><h3>杂项<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">contrib.auth</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">login()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">logout()</span></code> 基于函数的视图已被弃用，推荐使用新的基于类的视图 <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.views.LoginView" title="django.contrib.auth.views.LoginView"><code class="xref py py-class docutils literal notranslate"><span class="pre">LoginView</span></code></a> 和 <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.views.LogoutView" title="django.contrib.auth.views.LogoutView"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogoutView</span></code></a>。</li>
<li><code class="docutils literal notranslate"><span class="pre">contrib.auth.views.logout_then_login()</span></code> 的未使用的 <code class="docutils literal notranslate"><span class="pre">extra_context</span></code> 参数已被弃用。</li>
<li><code class="docutils literal notranslate"><span class="pre">contrib.auth</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">password_change()</span></code>, <code class="docutils literal notranslate"><span class="pre">password_change_done()</span></code>, <code class="docutils literal notranslate"><span class="pre">password_reset()</span></code>, <code class="docutils literal notranslate"><span class="pre">password_reset_done()</span></code>, <code class="docutils literal notranslate"><span class="pre">password_reset_confirm()</span></code>, 和 <code class="docutils literal notranslate"><span class="pre">password_reset_complete()</span></code> 基于函数的视图已被弃用，推荐使用新的基于类的视图 <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.views.PasswordChangeView" title="django.contrib.auth.views.PasswordChangeView"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordChangeView</span></code></a>, <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.views.PasswordChangeDoneView" title="django.contrib.auth.views.PasswordChangeDoneView"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordChangeDoneView</span></code></a>, <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.views.PasswordResetView" title="django.contrib.auth.views.PasswordResetView"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordResetView</span></code></a>, <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.views.PasswordResetDoneView" title="django.contrib.auth.views.PasswordResetDoneView"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordResetDoneView</span></code></a>, <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.views.PasswordResetConfirmView" title="django.contrib.auth.views.PasswordResetConfirmView"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordResetConfirmView</span></code></a>, 和 <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.views.PasswordResetCompleteView" title="django.contrib.auth.views.PasswordResetCompleteView"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordResetCompleteView</span></code></a>。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.test.runner.setup_databases()</span></code> 已移至 <a class="reference internal" href="../topics/testing/advanced.html#django.test.utils.setup_databases" title="django.test.utils.setup_databases"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.test.utils.setup_databases()</span></code></a>。旧位置已被弃用。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.translation.string_concat()</span></code> 已被弃用，推荐使用 <a class="reference internal" href="../ref/utils.html#django.utils.text.format_lazy" title="django.utils.text.format_lazy"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.text.format_lazy()</span></code></a>。可以通过 <code class="docutils literal notranslate"><span class="pre">format_lazy('{}'</span> <span class="pre">*</span> <span class="pre">len(strings),</span> <span class="pre">*strings)</span></code> 来替代 <code class="docutils literal notranslate"><span class="pre">string_concat(*strings)</span></code>。</li>
<li>对于 <code class="docutils literal notranslate"><span class="pre">PyLibMCCache</span></code> 缓存后端，将 <code class="docutils literal notranslate"><span class="pre">pylibmc</span></code> 行为设置作为 <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> 的顶级属性传递已被弃用。请将它们设置在 <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> 内的 <code class="docutils literal notranslate"><span class="pre">behaviors</span></code> 键下。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.http.is_safe_url()</span></code> 的 <code class="docutils literal notranslate"><span class="pre">host</span></code> 参数已被弃用，推荐使用新的 <code class="docutils literal notranslate"><span class="pre">allowed_hosts</span></code> 参数。</li>
<li>在渲染 <a class="reference internal" href="../ref/templates/builtins.html#std-templatetag-include"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include</span> <span class="pre">%}</span></code></a> 模板标签时抑制异常已被弃用，因为这种行为通常会比有帮助更令人困惑。在 Django 2.1 中，将会引发异常。</li>
<li><code class="docutils literal notranslate"><span class="pre">DatabaseIntrospection.get_indexes()</span></code> 已被弃用，推荐使用 <code class="docutils literal notranslate"><span class="pre">DatabaseIntrospection.get_constraints()</span></code>。</li>
<li><a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.authenticate" title="django.contrib.auth.authenticate"><code class="xref py py-func docutils literal notranslate"><span class="pre">authenticate()</span></code></a> 现在向身份验证后端的 <code class="docutils literal notranslate"><span class="pre">authenticate()</span></code> 方法传递一个 <code class="docutils literal notranslate"><span class="pre">request</span></code> 参数。不接受 <code class="docutils literal notranslate"><span class="pre">request</span></code> 作为第一个位置参数的方法将在 Django 2.1 中被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">USE_ETAGS</span></code> 设置已被弃用，推荐使用 <a class="reference internal" href="../ref/middleware.html#django.middleware.http.ConditionalGetMiddleware" title="django.middleware.http.ConditionalGetMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConditionalGetMiddleware</span></code></a>，它现在会在响应中添加 <code class="docutils literal notranslate"><span class="pre">ETag</span></code> 头，不受设置的影响。当弃用结束时，<code class="docutils literal notranslate"><span class="pre">CommonMiddleware</span></code> 和 <code class="docutils literal notranslate"><span class="pre">django.utils.cache.patch_response_headers()</span></code> 将不再设置 ETags。</li>
<li><code class="docutils literal notranslate"><span class="pre">Model._meta.has_auto_field</span></code> 已被弃用，推荐检查 <code class="docutils literal notranslate"><span class="pre">Model._meta.auto_field</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">None</span></code>。</li>
<li>在 <code class="docutils literal notranslate"><span class="pre">url()</span></code> 中使用带有 <code class="docutils literal notranslate"><span class="pre">iLmsu#</span></code> 的正则表达式组已被弃用。唯一有用的组是 <code class="docutils literal notranslate"><span class="pre">(?i)</span></code> 用于不区分大小写的 URL，但是不区分大小写的 URL 并不是一个好的实践，因为它们会为搜索引擎创建多个条目，例如。一个替代方案可能是创建一个 <a class="reference internal" href="../ref/urls.html#django.conf.urls.handler404" title="django.conf.urls.handler404"><code class="xref py py-data docutils literal notranslate"><span class="pre">handler404</span></code></a>，它查找 URL 中的大写字符并重定向到相应的小写字符。</li>
<li><code class="docutils literal notranslate"><span class="pre">renderer</span></code> 参数已添加到 <a class="reference internal" href="../ref/forms/widgets.html#django.forms.Widget.render" title="django.forms.Widget.render"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Widget.render()</span></code></a> 方法。不接受该参数的方法将在一个弃用期内继续工作。</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../contents.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">Django 1.11 版本发行说明</a><ul>
<li><a class="reference internal" href="#python-compatibility">Python 兼容性</a></li>
<li><a class="reference internal" href="#deprecating-warnings-are-no-longer-loud-by-default">弃用警告默认不再大声发出</a></li>
<li><a class="reference internal" href="#what-s-new-in-django-1-11">Django 1.11 新特性</a><ul>
<li><a class="reference internal" href="#class-based-model-indexes">基于类的模型索引</a></li>
<li><a class="reference internal" href="#template-based-widget-rendering">基于模板的小部件渲染</a></li>
<li><a class="reference internal" href="#subquery-expressions"><code class="docutils literal notranslate"><span class="pre">Subquery</span></code> 表达式</a></li>
<li><a class="reference internal" href="#minor-features">次要特性</a><ul>
<li><a class="reference internal" href="#django-contrib-admin"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-auth"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-contenttypes"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.contenttypes</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-gis"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-postgres"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.postgres</span></code></a></li>
<li><a class="reference internal" href="#cache">缓存</a></li>
<li><a class="reference internal" href="#csrf">CSRF</a></li>
<li><a class="reference internal" href="#database-backends">数据库后端</a></li>
<li><a class="reference internal" href="#email">电子邮件</a></li>
<li><a class="reference internal" href="#file-storage">文件存储</a></li>
<li><a class="reference internal" href="#forms">表单</a></li>
<li><a class="reference internal" href="#internationalization">国际化</a></li>
<li><a class="reference internal" href="#management-commands">管理命令</a></li>
<li><a class="reference internal" href="#migrations">迁移</a></li>
<li><a class="reference internal" href="#models">模型</a></li>
<li><a class="reference internal" href="#requests-and-responses">请求和响应</a></li>
<li><a class="reference internal" href="#serialization">序列化</a></li>
<li><a class="reference internal" href="#templates">模板</a></li>
<li><a class="reference internal" href="#tests">测试</a></li>
<li><a class="reference internal" href="#validators">验证器</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-incompatible-changes-in-1-11">1.11 中的向后不兼容更改</a><ul>
<li><a class="reference internal" href="#id1"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-staticfiles"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.staticfiles</span></code></a></li>
<li><a class="reference internal" href="#database-backend-api">数据库后端 API</a></li>
<li><a class="reference internal" href="#dropped-support-for-postgresql-9-2-and-postgis-2-0">不再支持 PostgreSQL 9.2 和 PostGIS 2.0 。</a></li>
<li><a class="reference internal" href="#liveservertestcase-binds-to-port-zero"><code class="docutils literal notranslate"><span class="pre">LiveServerTestCase</span></code> 现在绑定到零端口</a></li>
<li><a class="reference internal" href="#protection-against-insecure-redirects-in-django-contrib-auth-and-i18n-views">在 <code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code> 和 <code class="docutils literal notranslate"><span class="pre">i18n</span></code> 视图中加强了对不安全的重定向的保护。</a></li>
<li><a class="reference internal" href="#queryset-get-or-create-and-update-or-create-validate-arguments"><code class="docutils literal notranslate"><span class="pre">QuerySet.get_or_create()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">update_or_create()</span></code> 现在会验证参数。</a></li>
<li><a class="reference internal" href="#pytz-is-a-required-dependency-and-support-for-settings-time-zone-none-is-removed"><code class="docutils literal notranslate"><span class="pre">pytz</span></code> 现在是必需的依赖项，不再支持将 <code class="docutils literal notranslate"><span class="pre">settings.TIME_ZONE</span> <span class="pre">=</span> <span class="pre">None</span></code>。</a></li>
<li><a class="reference internal" href="#html-changes-in-admin-templates">管理模板中的 HTML 更改</a></li>
<li><a class="reference internal" href="#changes-due-to-the-introduction-of-template-based-widget-rendering">由于引入基于模板的小部件渲染，发生了一些更改。</a></li>
<li><a class="reference internal" href="#django-template-backends-django-template-render-prohibits-non-dict-context"><code class="docutils literal notranslate"><span class="pre">django.template.backends.django.Template.render()</span></code> 禁止非字典上下文。</a></li>
<li><a class="reference internal" href="#model-state-changes-in-migration-operations">迁移操作中的模型状态更改</a></li>
<li><a class="reference internal" href="#server-side-cursors-on-postgresql">PostgreSQL 上的服务器端游标</a></li>
<li><a class="reference internal" href="#miscellaneous">杂项</a></li>
</ul>
</li>
<li><a class="reference internal" href="#features-deprecated-in-1-11">在 1.11 中被废弃的功能</a><ul>
<li><a class="reference internal" href="#models-permalink-decorator"><code class="docutils literal notranslate"><span class="pre">models.permalink()</span></code> 装饰器</a></li>
<li><a class="reference internal" href="#id2">杂项</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="1.11.1.html"
                          title="上一章">Django 1.11.1 版本发行说明</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="1.10.8.html"
                          title="下一章">Django 1.10.8 版本发行说明</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/releases/1.11.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">3月 29, 2024</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="1.11.1.html" title="Django 1.11.1 版本发行说明">previous</a>
     |
    <a href="index.html" title="发行说明" accesskey="U">up</a>
   |
    <a href="1.10.8.html" title="Django 1.10.8 版本发行说明">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>
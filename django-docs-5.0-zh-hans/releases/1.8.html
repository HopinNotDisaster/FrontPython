
<!DOCTYPE html>

<html lang="zh_Hans">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Django 1.8 版本发行说明 &#8212; Django 5.0.4.dev20240329153429 文档</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/default.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Django 1.7.11 版本发行说明" href="1.7.11.html" />
    <link rel="prev" title="Django 1.8.1 版本发行说明" href="1.8.1.html" />



 
<script src="../templatebuiltins.js"></script>
<script>
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);</script>

  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../index.html">Django 5.0.4.dev20240329153429 文档</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../index.html">Home</a>  |
        <a title="Table of contents" href="../contents.html">Table of contents</a>  |
        <a title="Global index" href="../genindex.html">Index</a>  |
        <a title="Module index" href="../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="1.8.1.html" title="Django 1.8.1 版本发行说明">previous</a>
     |
    <a href="index.html" title="发行说明" accesskey="U">up</a>
   |
    <a href="1.7.11.html" title="Django 1.7.11 版本发行说明">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="releases-1.8">
            
  <div class="section" id="s-django-1-8-release-notes">
<span id="django-1-8-release-notes"></span><h1>Django 1.8 版本发行说明<a class="headerlink" href="#django-1-8-release-notes" title="永久链接至标题">¶</a></h1>
<p><em>2015 年 4 月 1 日</em></p>
<p>欢迎使用 Django 1.8 ！</p>
<p>这些发布说明涵盖了 <a class="reference internal" href="#whats-new-1-8"><span class="std std-ref">新功能</span></a>，以及从 Django 1.7 或更早版本升级时需要注意的一些 <a class="reference internal" href="#backwards-incompatible-1-8"><span class="std std-ref">不向后兼容的变更</span></a>。我们还已经 <a class="reference internal" href="#deprecated-features-1-8"><span class="std std-ref">开始了一些功能的弃用过程</span></a>，并且一些功能已经完成了弃用过程并被 <a class="reference internal" href="#removed-features-1-8"><span class="std std-ref">移除了</span></a>。</p>
<p>如果你要更新现有的项目，请看 <a class="reference internal" href="../howto/upgrade-version.html"><span class="doc">如何将 Django 更新至新的版本</span></a> 指南。</p>
<p>Django 1.8 已被指定为 Django 的第二个 <a class="reference internal" href="../internals/release-process.html#term-Long-term-support-release"><span class="xref std std-term">长期支持版本</span></a>。它将在发布后至少三年内接收安全更新。对于之前的 LTS 版本，Django 1.4，支持将在 Django 1.8 发布日期后的 6 个月内结束。</p>
<div class="section" id="s-python-compatibility">
<span id="python-compatibility"></span><h2>Python 兼容性<a class="headerlink" href="#python-compatibility" title="永久链接至标题">¶</a></h2>
<p>Django 1.8 需要 Python 2.7、3.2、3.3、3.4 或 3.5。我们 <strong>强烈推荐</strong> 并且只官方支持每个系列的最新版本。</p>
<p>Django 1.8 是第一个支持 Python 3.5 的版本。</p>
<p>由于 Python 3.2 在 2016 年 2 月结束了上游支持，因此在 2016 年底之后我们将不再在 Python 3.2 上测试 Django 1.8.x 。</p>
</div>
<div class="section" id="s-what-s-new-in-django-1-8">
<span id="s-whats-new-1-8"></span><span id="what-s-new-in-django-1-8"></span><span id="whats-new-1-8"></span><h2>Django 1.8 的新特性<a class="headerlink" href="#what-s-new-in-django-1-8" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-model-meta-api">
<span id="model-meta-api"></span><h3><code class="docutils literal notranslate"><span class="pre">Model._meta</span></code> API<a class="headerlink" href="#model-meta-api" title="永久链接至标题">¶</a></h3>
<p>Django 现在有了一个正式的 API 用于 <a class="reference internal" href="../ref/models/meta.html"><span class="doc">Model._meta</span></a>，提供了一种官方支持的方式来 <a class="reference internal" href="../ref/models/meta.html#model-meta-field-api"><span class="std std-ref">检索字段</span></a> 并根据它们的 <a class="reference internal" href="../ref/models/fields.html#model-field-attributes"><span class="std std-ref">属性</span></a> 进行过滤。</p>
<p><code class="docutils literal notranslate"><span class="pre">Model._meta</span></code> 对象从 Django 的 0.96 版本前的 &quot;Magic Removal&quot; 时期就存在了，只是它不是一个官方的、稳定的 API。鉴于这一点，我们努力在可能的情况下保持与旧 API 端点的向后兼容性。然而，那些不属于新官方 API 的 API 端点已经被弃用，并最终将被移除。</p>
</div>
<div class="section" id="s-multiple-template-engines">
<span id="multiple-template-engines"></span><h3>多模板引擎<a class="headerlink" href="#multiple-template-engines" title="永久链接至标题">¶</a></h3>
<p>Django 1.8 定义了一个稳定的 API 用于集成模板后端。它内置支持 Django 模板语言和 <a class="reference internal" href="../topics/templates.html#django.template.backends.jinja2.Jinja2" title="django.template.backends.jinja2.Jinja2"><code class="xref py py-class docutils literal notranslate"><span class="pre">Jinja2</span></code></a>。它支持在同一个项目中使用多个引擎来渲染模板。了解更多关于新功能的信息，请参阅 <a class="reference internal" href="../topics/templates.html"><span class="doc">主题指南</span></a>，并查看早期版本文档中的升级说明。</p>
</div>
<div class="section" id="s-security-enhancements">
<span id="security-enhancements"></span><h3>安全增强<a class="headerlink" href="#security-enhancements" title="永久链接至标题">¶</a></h3>
<p><a class="reference external" href="https://pypi.org/project/django-secure/">django-secure</a> 第三方库的几个功能已经集成到 Django 中。<a class="reference internal" href="../ref/middleware.html#django.middleware.security.SecurityMiddleware" title="django.middleware.security.SecurityMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">django.middleware.security.SecurityMiddleware</span></code></a> 提供了一些安全增强功能，用于请求/响应循环。新的 <a class="reference internal" href="../ref/django-admin.html#cmdoption-check-deploy"><code class="xref std std-option docutils literal notranslate"><span class="pre">check</span> <span class="pre">--deploy</span></code></a> 选项允许你检查生产设置文件，以提高站点的安全性。</p>
</div>
<div class="section" id="s-new-postgresql-specific-functionality">
<span id="new-postgresql-specific-functionality"></span><h3>新的 PostgreSQL 特有功能<a class="headerlink" href="#new-postgresql-specific-functionality" title="永久链接至标题">¶</a></h3>
<p>Django 现在有一个模块，用于扩展 PostgreSQL 特定的功能，例如 <a class="reference internal" href="../ref/contrib/postgres/fields.html#django.contrib.postgres.fields.ArrayField" title="django.contrib.postgres.fields.ArrayField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ArrayField</span></code></a>、<a class="reference internal" href="../ref/contrib/postgres/fields.html#django.contrib.postgres.fields.HStoreField" title="django.contrib.postgres.fields.HStoreField"><code class="xref py py-class docutils literal notranslate"><span class="pre">HStoreField</span></code></a>、<a class="reference internal" href="../ref/contrib/postgres/fields.html#range-fields"><span class="std std-ref">范围字段</span></a> 和 <a class="reference internal" href="../ref/contrib/postgres/lookups.html#std-fieldlookup-unaccent"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">unaccent</span></code></a> 查找。可以在 <a class="reference internal" href="../ref/contrib/postgres/index.html"><span class="doc">文档</span></a> 中找到有关这些功能的详细信息。</p>
</div>
<div class="section" id="s-new-data-types">
<span id="new-data-types"></span><h3>新的数据类型<a class="headerlink" href="#new-data-types" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>Django 现在有一个 <a class="reference internal" href="../ref/models/fields.html#django.db.models.UUIDField" title="django.db.models.UUIDField"><code class="xref py py-class docutils literal notranslate"><span class="pre">UUIDField</span></code></a> 用于存储通用唯一标识符。它在 PostgreSQL 上以本地的 <code class="docutils literal notranslate"><span class="pre">uuid</span></code> 数据类型存储，在其他后端上以固定长度的字符字段存储。还有一个相应的 <a class="reference internal" href="../ref/forms/fields.html#django.forms.UUIDField" title="django.forms.UUIDField"><code class="xref py py-class docutils literal notranslate"><span class="pre">表单字段</span></code></a>。</li>
<li>Django 现在有一个 <a class="reference internal" href="../ref/models/fields.html#django.db.models.DurationField" title="django.db.models.DurationField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DurationField</span></code></a> 用于存储时间段，Python 中用 <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.timedelta" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">timedelta</span></code></a> 来建模。它在 PostgreSQL 上以本地的 <code class="docutils literal notranslate"><span class="pre">interval</span></code> 数据类型存储，在 Oracle 上以 <code class="docutils literal notranslate"><span class="pre">INTERVAL</span> <span class="pre">DAY(9)</span> <span class="pre">TO</span> <span class="pre">SECOND(6)</span></code> 存储，在其他后端上以微秒的 <code class="docutils literal notranslate"><span class="pre">bigint</span></code> 存储。所有后端上的日期和时间相关算术操作也得到了改进。还有一个相应的 <a class="reference internal" href="../ref/forms/fields.html#django.forms.DurationField" title="django.forms.DurationField"><code class="xref py py-class docutils literal notranslate"><span class="pre">表单字段</span></code></a>。</li>
</ul>
</div>
<div class="section" id="s-query-expressions-conditional-expressions-and-database-functions">
<span id="query-expressions-conditional-expressions-and-database-functions"></span><h3>查询表达式、条件表达式和数据库函数<a class="headerlink" href="#query-expressions-conditional-expressions-and-database-functions" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../ref/models/expressions.html"><span class="doc">查询表达式</span></a> 允许你创建、自定义和组合复杂的 SQL 表达式。这使得 annotate 能够接受除了聚合之外的表达式。聚合现在可以引用多个字段，并执行类似于 <code class="docutils literal notranslate"><span class="pre">F()</span></code> 对象的算术操作。<a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.order_by" title="django.db.models.query.QuerySet.order_by"><code class="xref py py-meth docutils literal notranslate"><span class="pre">order_by()</span></code></a> 也具备接受表达式的能力。</p>
<p><a class="reference internal" href="../ref/models/conditional-expressions.html"><span class="doc">条件表达式</span></a> 允许你在查询中使用 <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#if" title="(在 Python v3.12)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">if</span></code></a> ... <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#elif" title="(在 Python v3.12)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">elif</span></code></a> ... <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#else" title="(在 Python v3.12)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">else</span></code></a> 逻辑。</p>
<p>还包括了一组 <a class="reference internal" href="../ref/models/database-functions.html"><span class="doc">数据库函数</span></a>，其中包括 <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Coalesce" title="django.db.models.functions.Coalesce"><code class="xref py py-class docutils literal notranslate"><span class="pre">Coalesce</span></code></a>、<a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Concat" title="django.db.models.functions.Concat"><code class="xref py py-class docutils literal notranslate"><span class="pre">Concat</span></code></a> 和 <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Substr" title="django.db.models.functions.Substr"><code class="xref py py-class docutils literal notranslate"><span class="pre">Substr</span></code></a> 等功能。</p>
</div>
<div class="section" id="s-testcase-data-setup">
<span id="testcase-data-setup"></span><h3><code class="docutils literal notranslate"><span class="pre">TestCase</span></code> 数据设置<a class="headerlink" href="#testcase-data-setup" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../topics/testing/tools.html#django.test.TestCase" title="django.test.TestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestCase</span></code></a> 已进行重构，以允许在类级别使用事务和保存点进行数据初始化。不支持事务的数据库后端，比如使用 MyISAM 存储引擎的 MySQL，仍然可以运行这些测试，但不会从改进中受益。现在，测试在两个嵌套的 <a class="reference internal" href="../topics/db/transactions.html#django.db.transaction.atomic" title="django.db.transaction.atomic"><code class="xref py py-func docutils literal notranslate"><span class="pre">atomic()</span></code></a> 块中运行：一个用于整个类，一个用于每个测试。</p>
<ul class="simple">
<li>类方法 <a class="reference internal" href="../topics/testing/tools.html#django.test.TestCase.setUpTestData" title="django.test.TestCase.setUpTestData"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TestCase.setUpTestData()</span></code></a> 添加了在类级别设置测试数据的能力。使用这种技术可以加速测试，与使用 <code class="docutils literal notranslate"><span class="pre">setUp()</span></code> 相比。</li>
<li>在 <code class="docutils literal notranslate"><span class="pre">TestCase</span></code> 中的 fixture 加载现在一次性完成整个 <code class="docutils literal notranslate"><span class="pre">TestCase</span></code>。</li>
</ul>
</div>
<div class="section" id="s-minor-features">
<span id="minor-features"></span><h3>次要特性<a class="headerlink" href="#minor-features" title="永久链接至标题">¶</a></h3>
<div class="section" id="s-django-contrib-admin">
<span id="django-contrib-admin"></span><h4><a class="reference internal" href="../ref/contrib/admin/index.html#module-django.contrib.admin" title="django.contrib.admin: Django's admin site."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a><a class="headerlink" href="#django-contrib-admin" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin" title="django.contrib.admin.ModelAdmin"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelAdmin</span></code></a> 现在具有一个 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.has_module_permission" title="django.contrib.admin.ModelAdmin.has_module_permission"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_module_permission()</span></code></a> 方法，允许限制在管理索引页面上对模块的访问。</li>
<li><a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.InlineModelAdmin" title="django.contrib.admin.InlineModelAdmin"><code class="xref py py-class docutils literal notranslate"><span class="pre">InlineModelAdmin</span></code></a> 现在有一个属性 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.InlineModelAdmin.show_change_link" title="django.contrib.admin.InlineModelAdmin.show_change_link"><code class="xref py py-attr docutils literal notranslate"><span class="pre">show_change_link</span></code></a>，支持显示到内联对象的更改表单的链接。</li>
<li>在 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.list_filter" title="django.contrib.admin.ModelAdmin.list_filter"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ModelAdmin.list_filter</span></code></a> 中使用新的 <code class="docutils literal notranslate"><span class="pre">django.contrib.admin.RelatedOnlyFieldListFilter</span></code>，以将 <code class="docutils literal notranslate"><span class="pre">list_filter</span></code> 选项限制为与 <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> 相关联的外部对象。</li>
<li><a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.delete_view" title="django.contrib.admin.ModelAdmin.delete_view"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ModelAdmin.delete_view()</span></code></a> 在删除确认页面上显示要删除的对象的摘要信息。</li>
<li>嵌入在管理员中的 jQuery 库已升级到 1.11.2 版本。</li>
<li>现在可以指定 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.AdminSite.site_url" title="django.contrib.admin.AdminSite.site_url"><code class="xref py py-attr docutils literal notranslate"><span class="pre">AdminSite.site_url</span></code></a>，以便在前端网站中显示一个链接。</li>
<li>现在可以指定 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.show_full_result_count" title="django.contrib.admin.ModelAdmin.show_full_result_count"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ModelAdmin.show_full_result_count</span></code></a>，以控制是否在筛选后的管理页面上显示对象的完整计数。</li>
<li><code class="docutils literal notranslate"><span class="pre">AdminSite.password_change()</span></code> 方法现在有一个 <code class="docutils literal notranslate"><span class="pre">extra_context</span></code> 参数。</li>
<li>现在可以通过覆盖 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.AdminSite.has_permission" title="django.contrib.admin.AdminSite.has_permission"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AdminSite.has_permission()</span></code></a> 和 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.AdminSite.login_form" title="django.contrib.admin.AdminSite.login_form"><code class="xref py py-attr docutils literal notranslate"><span class="pre">AdminSite.login_form</span></code></a> 来控制谁可以登录到管理站点。<code class="docutils literal notranslate"><span class="pre">base.html</span></code> 模板有一个新的块 <code class="docutils literal notranslate"><span class="pre">usertools</span></code>，其中包含用户特定的页眉。一个新的上下文变量 <code class="docutils literal notranslate"><span class="pre">has_permission</span></code>，它的值来自于 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.AdminSite.has_permission" title="django.contrib.admin.AdminSite.has_permission"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_permission()</span></code></a>，指示用户是否可以访问站点。</li>
<li>外键下拉菜单现在通过弹出窗口提供更改或删除相关对象的按钮。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-admindocs">
<span id="django-contrib-admindocs"></span><h4><a class="reference internal" href="../ref/contrib/admin/admindocs.html#module-django.contrib.admindocs" title="django.contrib.admindocs: Django's admin documentation generator."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admindocs</span></code></a><a class="headerlink" href="#django-contrib-admindocs" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>现在在模型的文档字符串中解析 reStructuredText 。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-auth">
<span id="django-contrib-auth"></span><h4><a class="reference internal" href="../topics/auth/index.html#module-django.contrib.auth" title="django.contrib.auth: Django's authentication framework."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a><a class="headerlink" href="#django-contrib-auth" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>授权后端现在可以在 <a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.models.User.has_perm" title="django.contrib.auth.models.User.has_perm"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_perm()</span></code></a> 和 <a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.models.User.has_module_perms" title="django.contrib.auth.models.User.has_module_perms"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_module_perms()</span></code></a> 中引发 <a class="reference internal" href="../ref/exceptions.html#django.core.exceptions.PermissionDenied" title="django.core.exceptions.PermissionDenied"><code class="xref py py-class docutils literal notranslate"><span class="pre">PermissionDenied</span></code></a> 以绕过权限检查。</li>
<li><a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.forms.PasswordResetForm" title="django.contrib.auth.forms.PasswordResetForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordResetForm</span></code></a> 现在有一个可以被重写以自定义要发送的邮件的方法 <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.forms.PasswordResetForm.send_mail" title="django.contrib.auth.forms.PasswordResetForm.send_mail"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send_mail()</span></code></a>。</li>
<li><a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.models.Permission.name" title="django.contrib.auth.models.Permission.name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Permission.name</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">max_length</span></code> 从 50 增加到 255 个字符。请运行数据库迁移。</li>
<li><a class="reference internal" href="../topics/auth/customizing.html#django.contrib.auth.models.CustomUser.USERNAME_FIELD" title="django.contrib.auth.models.CustomUser.USERNAME_FIELD"><code class="xref py py-attr docutils literal notranslate"><span class="pre">USERNAME_FIELD</span></code></a> 和 <a class="reference internal" href="../topics/auth/customizing.html#django.contrib.auth.models.CustomUser.REQUIRED_FIELDS" title="django.contrib.auth.models.CustomUser.REQUIRED_FIELDS"><code class="xref py py-attr docutils literal notranslate"><span class="pre">REQUIRED_FIELDS</span></code></a> 现在支持 <a class="reference internal" href="../ref/models/fields.html#django.db.models.ForeignKey" title="django.db.models.ForeignKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKey</span></code></a>。</li>
<li>PBKDF2 密码哈希器的默认迭代次数增加了 33%。这个向后兼容的变更不会影响那些已经子类化了 <code class="docutils literal notranslate"><span class="pre">django.contrib.auth.hashers.PBKDF2PasswordHasher</span></code> 以更改默认值的用户。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-gis">
<span id="django-contrib-gis"></span><h4><a class="reference internal" href="../ref/contrib/gis/index.html#module-django.contrib.gis" title="django.contrib.gis: Geographic Information System (GIS) extensions for Django"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a><a class="headerlink" href="#django-contrib-gis" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>现在有一个新的 <a class="reference internal" href="../ref/contrib/gis/serializers.html"><span class="doc">GeoJSON 序列化程序</span></a> 可供使用。</li>
<li>现在允许将子查询作为地理查找参数，例如 <code class="docutils literal notranslate"><span class="pre">City.objects.filter(point__within=Country.objects.filter(continent='Africa').values('mpoly'))</span></code>。</li>
<li>当数据库版本为 3.0 或更高时，SpatiaLite 后端现在支持 <code class="docutils literal notranslate"><span class="pre">Collect</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Extent</span></code> 聚合函数。</li>
<li>PostGIS 2 中的 <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">EXTENSION</span> <span class="pre">postgis</span></code> 和 SpatiaLite 中的 <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">InitSpatialMetaData</span></code> 初始化命令现在会被 <a class="reference internal" href="../ref/django-admin.html#django-admin-migrate"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">migrate</span></code></a> 自动执行。</li>
<li>GDAL 接口现在支持检索 <a class="reference internal" href="../ref/contrib/gis/gdal.html#raster-data-source-objects"><span class="std std-ref">栅格（图像）数据文件</span></a> 的属性。</li>
<li>已删除了 Django 1.2 中更改的 <code class="docutils literal notranslate"><span class="pre">SpatialRefSys</span></code> 和 <code class="docutils literal notranslate"><span class="pre">GeometryColumns</span></code> 的兼容性 shims。</li>
<li>现在所有与 GDAL 相关的异常都使用 <code class="docutils literal notranslate"><span class="pre">GDALException</span></code> 引发。以前的 <code class="docutils literal notranslate"><span class="pre">OGRException</span></code> 已保留以保持向后兼容性，但不应再使用。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-sessions">
<span id="django-contrib-sessions"></span><h4><a class="reference internal" href="../topics/http/sessions.html#module-django.contrib.sessions" title="django.contrib.sessions: Provides session management for Django projects."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sessions</span></code></a><a class="headerlink" href="#django-contrib-sessions" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>在调用 <a class="reference internal" href="../topics/http/sessions.html#django.contrib.sessions.backends.base.SessionBase.flush" title="django.contrib.sessions.backends.base.SessionBase.flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flush()</span></code></a> 后，会删除会话 cookie。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-sitemaps">
<span id="django-contrib-sitemaps"></span><h4><a class="reference internal" href="../ref/contrib/sitemaps.html#module-django.contrib.sitemaps" title="django.contrib.sitemaps: A framework for generating Google sitemap XML files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sitemaps</span></code></a><a class="headerlink" href="#django-contrib-sitemaps" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../ref/contrib/sitemaps.html#django.contrib.sitemaps.Sitemap.i18n" title="django.contrib.sitemaps.Sitemap.i18n"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Sitemap.i18n</span></code></a> 属性允许你基于 <a class="reference internal" href="../ref/settings.html#std-setting-LANGUAGES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGES</span></code></a> 设置生成多语言站点地图。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-sites">
<span id="django-contrib-sites"></span><h4><a class="reference internal" href="../ref/contrib/sites.html#module-django.contrib.sites" title="django.contrib.sites: Lets you operate multiple websites from the same database and Django project"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sites</span></code></a><a class="headerlink" href="#django-contrib-sites" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>如果没有定义 <a class="reference internal" href="../ref/settings.html#std-setting-SITE_ID"><code class="xref std std-setting docutils literal notranslate"><span class="pre">SITE_ID</span></code></a> 设置，<a class="reference internal" href="../ref/contrib/sites.html#django.contrib.sites.shortcuts.get_current_site" title="django.contrib.sites.shortcuts.get_current_site"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_current_site()</span></code></a> 现在将基于 <a class="reference internal" href="../ref/request-response.html#django.http.HttpRequest.get_host" title="django.http.HttpRequest.get_host"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request.get_host()</span></code></a> 查找当前站点。</li>
<li>在运行 <code class="docutils literal notranslate"><span class="pre">migrate</span></code> 时创建的默认 <a class="reference internal" href="../ref/contrib/sites.html#django.contrib.sites.models.Site" title="django.contrib.sites.models.Site"><code class="xref py py-class docutils literal notranslate"><span class="pre">Site</span></code></a> 现在会遵循 <a class="reference internal" href="../ref/settings.html#std-setting-SITE_ID"><code class="xref std std-setting docutils literal notranslate"><span class="pre">SITE_ID</span></code></a> 设置（而不是总是使用 <code class="docutils literal notranslate"><span class="pre">pk=1</span></code>）。</li>
</ul>
</div>
<div class="section" id="s-cache">
<span id="cache"></span><h4>缓存<a class="headerlink" href="#cache" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">django.core.cache.backends.locmem.LocMemCache</span></code> 后端的 <code class="docutils literal notranslate"><span class="pre">incr()</span></code> 方法现在是线程安全的。</li>
</ul>
</div>
<div class="section" id="s-cryptography">
<span id="cryptography"></span><h4>密码学<a class="headerlink" href="#cryptography" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../topics/signing.html#django.core.signing.TimestampSigner.unsign" title="django.core.signing.TimestampSigner.unsign"><code class="xref py py-meth docutils literal notranslate"><span class="pre">django.core.signing.TimestampSigner.unsign()</span></code></a> 方法的 <code class="docutils literal notranslate"><span class="pre">max_age</span></code> 参数现在也接受 <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.timedelta" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime.timedelta</span></code></a> 对象。</li>
</ul>
</div>
<div class="section" id="s-database-backends">
<span id="database-backends"></span><h4>数据库后端<a class="headerlink" href="#database-backends" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>MySQL 后端不再从 <code class="docutils literal notranslate"><span class="pre">datetime</span></code> 值中去掉微秒，因为 MySQL 5.6.4 及更高版本根据 datetime 字段的声明支持分数秒（当 <code class="docutils literal notranslate"><span class="pre">DATETIME</span></code> 包含大于 0 的分数精度时）。使用 Django 1.8 和 MySQL 5.6.4 及更高版本创建的新 datetime 数据库列将支持微秒。有关更多详细信息，请参阅 <a class="reference internal" href="../ref/databases.html#mysql-fractional-seconds"><span class="std std-ref">MySQL 数据库注释</span></a>。</li>
<li>在使用 InnoDB 存储引擎时，MySQL 后端不再为外键创建显式索引，因为 MySQL 已经自动创建了这些索引。</li>
<li>Oracle 后端不再将 <code class="docutils literal notranslate"><span class="pre">connection_persists_old_columns</span></code> 特性定义为 <code class="docutils literal notranslate"><span class="pre">True</span></code>。相反，Oracle 现在在获取表的描述时将包括一个缓存破坏子句。</li>
</ul>
</div>
<div class="section" id="s-email">
<span id="email"></span><h4>电子邮件<a class="headerlink" href="#email" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../topics/email.html#topic-email-backends"><span class="std std-ref">电子邮件后端</span></a> 现在支持上下文管理协议，用于打开和关闭连接。</li>
<li>SMTP 电子邮件后端现在支持使用 <a class="reference internal" href="../ref/settings.html#std-setting-EMAIL_SSL_CERTFILE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">EMAIL_SSL_CERTFILE</span></code></a> 和 <a class="reference internal" href="../ref/settings.html#std-setting-EMAIL_SSL_KEYFILE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">EMAIL_SSL_KEYFILE</span></code></a> 设置进行 <code class="docutils literal notranslate"><span class="pre">keyfile</span></code> 和 <code class="docutils literal notranslate"><span class="pre">certfile</span></code> 身份验证。</li>
<li>SMTP <a class="reference internal" href="../topics/email.html#django.core.mail.backends.smtp.EmailBackend" title="django.core.mail.backends.smtp.EmailBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">EmailBackend</span></code></a> 现在支持使用 <a class="reference internal" href="../ref/settings.html#std-setting-EMAIL_TIMEOUT"><code class="xref std std-setting docutils literal notranslate"><span class="pre">EMAIL_TIMEOUT</span></code></a> 设置来设置 <code class="docutils literal notranslate"><span class="pre">timeout</span></code> 参数。</li>
<li><a class="reference internal" href="../topics/email.html#django.core.mail.EmailMessage" title="django.core.mail.EmailMessage"><code class="xref py py-class docutils literal notranslate"><span class="pre">EmailMessage</span></code></a> 和 <code class="docutils literal notranslate"><span class="pre">EmailMultiAlternatives</span></code> 现在支持 <code class="docutils literal notranslate"><span class="pre">reply_to</span></code> 参数。</li>
</ul>
</div>
<div class="section" id="s-file-storage">
<span id="file-storage"></span><h4>文件存储<a class="headerlink" href="#file-storage" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/files/storage.html#django.core.files.storage.Storage.get_available_name" title="django.core.files.storage.Storage.get_available_name"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Storage.get_available_name()</span></code></a> 和 <a class="reference internal" href="../ref/files/storage.html#django.core.files.storage.Storage.save" title="django.core.files.storage.Storage.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Storage.save()</span></code></a> 现在接受一个 <code class="docutils literal notranslate"><span class="pre">max_length</span></code> 参数，以实现存储级别的最大文件名长度约束。超过此参数的文件名将被截断。这可以防止在长文件名上追加唯一后缀时出现数据库错误，而该文件名已存在于存储中。请查看关于在自定义存储类中添加此参数的 <a class="reference internal" href="#storage-max-length-update"><span class="std std-ref">弃用说明</span></a>。</li>
</ul>
</div>
<div class="section" id="s-forms">
<span id="forms"></span><h4>表单<a class="headerlink" href="#forms" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>表单小部件现在将值为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 或 <code class="docutils literal notranslate"><span class="pre">False</span></code> 的属性呈现为 HTML5 布尔属性。</li>
<li>新的 <a class="reference internal" href="../ref/forms/api.html#django.forms.Form.has_error" title="django.forms.Form.has_error"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_error()</span></code></a> 方法允许检查是否发生了特定错误。</li>
<li>如果在表单上定义了 <a class="reference internal" href="../ref/forms/api.html#django.forms.Form.required_css_class" title="django.forms.Form.required_css_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">required_css_class</span></code></a>，则必填字段的 <code class="docutils literal notranslate"><span class="pre">&lt;label&gt;</span></code> 标签将在其属性中包含此类。</li>
<li>无序列表（<code class="docutils literal notranslate"><span class="pre">&lt;ul&gt;</span></code>）中非字段错误的呈现现在在其类列表中包括 <code class="docutils literal notranslate"><span class="pre">nonfield</span></code>，以区分它们和特定字段错误。</li>
<li><a class="reference internal" href="../ref/forms/fields.html#django.forms.Field" title="django.forms.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> 现在接受一个 <a class="reference internal" href="../ref/forms/fields.html#django.forms.Field.label_suffix" title="django.forms.Field.label_suffix"><code class="xref py py-attr docutils literal notranslate"><span class="pre">label_suffix</span></code></a> 参数，该参数将覆盖表单的 <a class="reference internal" href="../ref/forms/api.html#django.forms.Form.label_suffix" title="django.forms.Form.label_suffix"><code class="xref py py-attr docutils literal notranslate"><span class="pre">label_suffix</span></code></a>。这使得可以在每个字段的基础上自定义后缀 — 以前在模板中使用 <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">form.as_p</span> <span class="pre">}}</span></code> 等快捷方式时无法覆盖表单的 <a class="reference internal" href="../ref/forms/api.html#django.forms.Form.label_suffix" title="django.forms.Form.label_suffix"><code class="xref py py-attr docutils literal notranslate"><span class="pre">label_suffix</span></code></a>。</li>
<li><a class="reference internal" href="../ref/forms/widgets.html#django.forms.SelectDateWidget" title="django.forms.SelectDateWidget"><code class="xref py py-class docutils literal notranslate"><span class="pre">SelectDateWidget</span></code></a> 现在接受一个 <a class="reference internal" href="../ref/forms/widgets.html#django.forms.SelectDateWidget.empty_label" title="django.forms.SelectDateWidget.empty_label"><code class="xref py py-attr docutils literal notranslate"><span class="pre">empty_label</span></code></a> 参数，该参数将在 <a class="reference internal" href="../ref/forms/fields.html#django.forms.DateField" title="django.forms.DateField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateField</span></code></a> 不是必需时覆盖顶部列表选项的标签。</li>
<li>在对 <a class="reference internal" href="../ref/forms/fields.html#django.forms.ImageField" title="django.forms.ImageField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ImageField</span></code></a> 进行清理和验证后，<code class="docutils literal notranslate"><span class="pre">UploadedFile</span></code> 对象将具有额外的 <code class="docutils literal notranslate"><span class="pre">image</span></code> 属性，其中包含用于检查文件是否为有效图像的 Pillow <code class="docutils literal notranslate"><span class="pre">Image</span></code> 实例。它还会使用 Pillow 确定的图像内容类型来更新 <code class="docutils literal notranslate"><span class="pre">UploadedFile.content_type</span></code>。</li>
<li>现在在实例化 <a class="reference internal" href="../ref/forms/fields.html#django.forms.ChoiceField" title="django.forms.ChoiceField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChoiceField</span></code></a> 时可以传递一个可调用对象，该可调用对象返回一个选项的可迭代对象。</li>
</ul>
</div>
<div class="section" id="s-generic-views">
<span id="generic-views"></span><h4>通用视图<a class="headerlink" href="#generic-views" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>使用 <a class="reference internal" href="../ref/class-based-views/mixins-multiple-object.html#django.views.generic.list.MultipleObjectMixin" title="django.views.generic.list.MultipleObjectMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultipleObjectMixin</span></code></a> 的通用视图现在可以通过设置 <a class="reference internal" href="../ref/class-based-views/mixins-multiple-object.html#django.views.generic.list.MultipleObjectMixin.ordering" title="django.views.generic.list.MultipleObjectMixin.ordering"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ordering</span></code></a> 或重写 <a class="reference internal" href="../ref/class-based-views/mixins-multiple-object.html#django.views.generic.list.MultipleObjectMixin.get_ordering" title="django.views.generic.list.MultipleObjectMixin.get_ordering"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_ordering()</span></code></a> 来指定应用于 <a class="reference internal" href="../ref/class-based-views/mixins-multiple-object.html#django.views.generic.list.MultipleObjectMixin.queryset" title="django.views.generic.list.MultipleObjectMixin.queryset"><code class="xref py py-attr docutils literal notranslate"><span class="pre">queryset</span></code></a> 的排序。</li>
<li>新的 <a class="reference internal" href="../ref/class-based-views/mixins-single-object.html#django.views.generic.detail.SingleObjectMixin.query_pk_and_slug" title="django.views.generic.detail.SingleObjectMixin.query_pk_and_slug"><code class="xref py py-attr docutils literal notranslate"><span class="pre">SingleObjectMixin.query_pk_and_slug</span></code></a> 属性允许更改 <a class="reference internal" href="../ref/class-based-views/mixins-single-object.html#django.views.generic.detail.SingleObjectMixin.get_object" title="django.views.generic.detail.SingleObjectMixin.get_object"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_object()</span></code></a> 的行为，使其使用主键和 slug 来执行查找。</li>
<li><a class="reference internal" href="../ref/class-based-views/mixins-editing.html#django.views.generic.edit.FormMixin.get_form" title="django.views.generic.edit.FormMixin.get_form"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_form()</span></code></a> 方法不再需要提供 <code class="docutils literal notranslate"><span class="pre">form_class</span></code>。如果没有提供 <code class="docutils literal notranslate"><span class="pre">form_class</span></code>，则默认为 <a class="reference internal" href="../ref/class-based-views/mixins-editing.html#django.views.generic.edit.FormMixin.get_form_class" title="django.views.generic.edit.FormMixin.get_form_class"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_form_class()</span></code></a>。</li>
<li><a class="reference internal" href="../ref/class-based-views/mixins-editing.html#django.views.generic.edit.ModelFormMixin.success_url" title="django.views.generic.edit.ModelFormMixin.success_url"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ModelFormMixin.success_url</span></code></a> 中的占位符现在支持 Python 的 <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str.format" title="(在 Python v3.12)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">str.format()</span></code></a> 语法。旧的 <code class="docutils literal notranslate"><span class="pre">%(&lt;foo&gt;)s</span></code> 语法仍然受支持，但将在 Django 1.10 中删除。</li>
</ul>
</div>
<div class="section" id="s-internationalization">
<span id="internationalization"></span><h4>国际化<a class="headerlink" href="#internationalization" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/settings.html#std-setting-FORMAT_MODULE_PATH"><code class="xref std std-setting docutils literal notranslate"><span class="pre">FORMAT_MODULE_PATH</span></code></a> 现在可以是表示模块路径的字符串列表。这允许从不同的可重用应用程序导入多个格式模块。它还允许在主要的 Django 项目中覆盖这些自定义格式。</li>
</ul>
</div>
<div class="section" id="s-logging">
<span id="logging"></span><h4>日志<a class="headerlink" href="#logging" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/logging.html#django.utils.log.AdminEmailHandler" title="django.utils.log.AdminEmailHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">django.utils.log.AdminEmailHandler</span></code></a> 类现在具有 <a class="reference internal" href="../ref/logging.html#django.utils.log.AdminEmailHandler.send_mail" title="django.utils.log.AdminEmailHandler.send_mail"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send_mail()</span></code></a> 方法，使其更容易进行子类化。</li>
</ul>
</div>
<div class="section" id="s-management-commands">
<span id="management-commands"></span><h4>管理命令<a class="headerlink" href="#management-commands" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>现在，从命令行调用的管理命令完成其工作后，数据库连接将始终关闭。</li>
<li>现在还可以发现来自诸如&quot;eggs &quot;之类的备用软件包格式的命令。</li>
<li>新的 <a class="reference internal" href="../ref/django-admin.html#cmdoption-dumpdata-output"><code class="xref std std-option docutils literal notranslate"><span class="pre">dumpdata</span> <span class="pre">--output</span></code></a> 选项允许指定将序列化数据写入的文件。</li>
<li>新的 <a class="reference internal" href="../ref/django-admin.html#cmdoption-makemessages-exclude"><code class="xref std std-option docutils literal notranslate"><span class="pre">makemessages</span> <span class="pre">--exclude</span></code></a> 和 <a class="reference internal" href="../ref/django-admin.html#cmdoption-compilemessages-exclude"><code class="xref std std-option docutils literal notranslate"><span class="pre">compilemessages</span> <span class="pre">--exclude</span></code></a> 选项允许排除特定的区域设置不进行处理。</li>
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-compilemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">compilemessages</span></code></a> 现在有一个 <code class="docutils literal notranslate"><span class="pre">--use-fuzzy</span></code> 或 <code class="docutils literal notranslate"><span class="pre">-f</span></code> 选项，它将模糊的翻译包括在编译后的文件中。</li>
<li><a class="reference internal" href="../ref/django-admin.html#cmdoption-loaddata-ignorenonexistent"><code class="xref std std-option docutils literal notranslate"><span class="pre">loaddata</span> <span class="pre">--ignorenonexistent</span></code></a> 选项现在会忽略已不存在的模型的数据。</li>
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-runserver"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">runserver</span></code></a> 现在使用守护线程以加快重新加载速度。</li>
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-inspectdb"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">inspectdb</span></code></a> 现在输出 <code class="docutils literal notranslate"><span class="pre">Meta.unique_together</span></code>。它还可以对 MySQL 和 PostgreSQL 数据库进行自省以获取 <a class="reference internal" href="../ref/models/fields.html#django.db.models.AutoField" title="django.db.models.AutoField"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoField</span></code></a>。</li>
<li>使用 <a class="reference internal" href="../ref/django-admin.html#django.core.management.call_command" title="django.core.management.call_command"><code class="xref py py-func docutils literal notranslate"><span class="pre">call_command()</span></code></a> 调用带有选项的管理命令时，选项名称可以匹配命令行选项名称（去掉初始破折号）或最终选项目标变量名称，但无论哪种情况，命令接收到的结果选项现在始终是命令选项定义中指定的 <code class="docutils literal notranslate"><span class="pre">dest</span></code> 名称（只要命令使用 <a class="reference external" href="https://docs.python.org/3/library/argparse.html#module-argparse" title="(在 Python v3.12)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">argparse</span></code></a> 模块）。</li>
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-dbshell"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">dbshell</span></code></a> 命令现在支持 MySQL 的可选 SSL 证书颁发机构设置（<code class="docutils literal notranslate"><span class="pre">--ssl-ca</span></code>）。</li>
<li>新的 <a class="reference internal" href="../ref/django-admin.html#cmdoption-makemigrations-name"><code class="xref std std-option docutils literal notranslate"><span class="pre">makemigrations</span> <span class="pre">--name</span></code></a> 允许为迁移指定自定义名称，而不是生成的名称。</li>
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-loaddata"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">loaddata</span></code></a> 命令现在防止了重复的夹具加载。如果 <a class="reference internal" href="../ref/settings.html#std-setting-FIXTURE_DIRS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">FIXTURE_DIRS</span></code></a> 包含重复项或默认的夹具目录路径（<code class="docutils literal notranslate"><span class="pre">app_name/fixtures</span></code>），则会引发异常。</li>
<li>新的 <code class="docutils literal notranslate"><span class="pre">makemigrations</span> <span class="pre">--exit</span></code> 选项允许在没有创建迁移时退出并返回错误代码。</li>
<li>新的 <a class="reference internal" href="../ref/django-admin.html#django-admin-showmigrations"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">showmigrations</span></code></a> 命令允许列出项目中的所有迁移及其依赖关系。</li>
</ul>
</div>
<div class="section" id="s-middleware">
<span id="middleware"></span><h4>中间件<a class="headerlink" href="#middleware" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/middleware.html#django.middleware.common.CommonMiddleware.response_redirect_class" title="django.middleware.common.CommonMiddleware.response_redirect_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CommonMiddleware.response_redirect_class</span></code></a> 属性允许您自定义中间件发出的重定向。</li>
<li>在 <a class="reference internal" href="../ref/settings.html#std-setting-DEBUG"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DEBUG</span></code></a> 模式下，当中间件引发 <a class="reference internal" href="../ref/exceptions.html#django.core.exceptions.MiddlewareNotUsed" title="django.core.exceptions.MiddlewareNotUsed"><code class="xref py py-exc docutils literal notranslate"><span class="pre">MiddlewareNotUsed</span></code></a> 异常时，将会在 <code class="docutils literal notranslate"><span class="pre">django.request</span></code> 记录器中记录调试消息。</li>
</ul>
</div>
<div class="section" id="s-migrations">
<span id="migrations"></span><h4>迁移<a class="headerlink" href="#migrations" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.RunSQL" title="django.db.migrations.operations.RunSQL"><code class="xref py py-class docutils literal notranslate"><span class="pre">RunSQL</span></code></a> 操作现在可以处理传递给 SQL 语句的参数。</li>
<li>现在可以为没有模型的应用程序创建迁移（很可能是 <a class="reference internal" href="../topics/migrations.html#data-migrations"><span class="std std-ref">数据迁移</span></a>）。</li>
<li>迁移现在可以将模型管理器 <a class="reference internal" href="../topics/migrations.html#using-managers-in-migrations"><span class="std std-ref">序列化为模型状态</span></a> 的一部分。</li>
<li>添加了一种 <a class="reference internal" href="../topics/migrations.html#migrations-removing-model-fields"><span class="std std-ref">处理模型字段弃用的通用机制</span></a>。</li>
<li>添加了 <a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.RunPython.noop" title="django.db.migrations.operations.RunPython.noop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RunPython.noop()</span></code></a> 和 <a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.RunSQL.noop" title="django.db.migrations.operations.RunSQL.noop"><code class="xref py py-attr docutils literal notranslate"><span class="pre">RunSQL.noop</span></code></a> 类方法/属性，以便于使 <code class="docutils literal notranslate"><span class="pre">RunPython</span></code> 和 <code class="docutils literal notranslate"><span class="pre">RunSQL</span></code> 操作可逆。</li>
<li>现在，迁移操作 <a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.RunPython" title="django.db.migrations.operations.RunPython"><code class="xref py py-class docutils literal notranslate"><span class="pre">RunPython</span></code></a> 和 <a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.RunSQL" title="django.db.migrations.operations.RunSQL"><code class="xref py py-class docutils literal notranslate"><span class="pre">RunSQL</span></code></a> 会调用数据库路由器的 <a class="reference internal" href="../topics/db/multi-db.html#allow_migrate" title="allow_migrate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">allow_migrate()</span></code></a> 方法。路由器可以使用新引入的 <code class="docutils literal notranslate"><span class="pre">app_label</span></code> 和 <code class="docutils literal notranslate"><span class="pre">hints</span></code> 参数来进行路由决策。要利用此功能，您需要将路由器更新到新的 <code class="docutils literal notranslate"><span class="pre">allow_migrate</span></code> 签名，有关详细信息，请参阅 <a class="reference internal" href="#deprecated-signature-of-allow-migrate"><span class="std std-ref">弃用部分</span></a>。</li>
</ul>
</div>
<div class="section" id="s-models">
<span id="models"></span><h4>模型<a class="headerlink" href="#models" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>现在，Django 最多记录 9000 条查询在 <code class="docutils literal notranslate"><span class="pre">connections.queries</span></code> 中，以防止在调试模式下的长时间运行过程中出现过多的内存使用。</li>
<li>现在有一个模型 <code class="docutils literal notranslate"><span class="pre">Meta</span></code> 选项，可以为模型的所有关联字段定义 <a class="reference internal" href="../ref/models/options.html#django.db.models.Options.default_related_name" title="django.db.models.Options.default_related_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">默认相关名称</span></code></a>。</li>
<li>在不同版本的 Django 之间对模型和查询集进行 pickling 并不是官方支持的（它可能会工作，但没有保证）。现在，一个额外的变量被添加到模型和查询集的 pickled 状态中，用来指定当前的 Django 版本，当这些对象在与其被 pickled 的版本不同的版本中 unpickle 时，Django 会引发一个 <code class="docutils literal notranslate"><span class="pre">RuntimeWarning</span></code>。</li>
<li>添加了 <a class="reference internal" href="../ref/models/instances.html#django.db.models.Model.from_db" title="django.db.models.Model.from_db"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.from_db()</span></code></a>，Django 在使用 ORM 加载对象时会使用这个方法。该方法允许自定义模型的加载行为。</li>
<li>现在，<code class="docutils literal notranslate"><span class="pre">extra(select={...})</span></code> 允许您使用 <code class="docutils literal notranslate"><span class="pre">%%s</span></code> 来转义文本中的字面 <code class="docutils literal notranslate"><span class="pre">%s</span></code> 序列。</li>
<li>现在可以使用装饰器模式注册 <a class="reference internal" href="../howto/custom-lookups.html"><span class="doc">自定义查找器</span></a>。</li>
<li>新的 <a class="reference internal" href="../ref/models/lookups.html#django.db.models.Transform.bilateral" title="django.db.models.Transform.bilateral"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Transform.bilateral</span></code></a> 属性允许创建双向变换。这些变换在查找表达式中同时应用于 <code class="docutils literal notranslate"><span class="pre">lhs</span></code> 和 <code class="docutils literal notranslate"><span class="pre">rhs</span></code>，提供了更多复杂查找的机会。</li>
<li>现在，当使用模式查找（例如 <code class="docutils literal notranslate"><span class="pre">contains</span></code>、<code class="docutils literal notranslate"><span class="pre">startswith</span></code> 等）与 <code class="docutils literal notranslate"><span class="pre">F()</span></code> 表达式作为右侧时，SQL 的特殊字符（、%、_）会得到正确的转义。在这些情况下，转义是由数据库执行的，这可能导致涉及嵌套的 <code class="docutils literal notranslate"><span class="pre">REPLACE</span></code> 函数调用的相对复杂的查询。</li>
<li>现在，您可以使用 <a class="reference internal" href="../ref/models/instances.html#django.db.models.Model.refresh_from_db" title="django.db.models.Model.refresh_from_db"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.refresh_from_db()</span></code></a> 来刷新模型实例。</li>
<li>现在，您可以使用 <a class="reference internal" href="../ref/models/instances.html#django.db.models.Model.get_deferred_fields" title="django.db.models.Model.get_deferred_fields"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.get_deferred_fields()</span></code></a> 获取模型的延迟加载字段集合。</li>
<li>现在，当主键字段设置为 <code class="docutils literal notranslate"><span class="pre">None</span></code> 时，将使用模型字段的 <code class="docutils literal notranslate"><span class="pre">default</span></code> 值。</li>
</ul>
</div>
<div class="section" id="s-signals">
<span id="signals"></span><h4>信号<a class="headerlink" href="#signals" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>通过 <a class="reference internal" href="../topics/signals.html#django.dispatch.Signal.send_robust" title="django.dispatch.Signal.send_robust"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Signal.send_robust()</span></code></a> 返回的 <code class="docutils literal notranslate"><span class="pre">(receiver,</span> <span class="pre">exception)</span></code> 元组中的异常现在附带了其回溯信息作为 <code class="docutils literal notranslate"><span class="pre">__traceback__</span></code> 属性。</li>
<li>在 <a class="reference internal" href="../ref/signals.html#django.core.signals.request_started" title="django.core.signals.request_started"><code class="xref py py-data docutils literal notranslate"><span class="pre">request_started</span></code></a> 信号中添加了 <code class="docutils literal notranslate"><span class="pre">environ</span></code> 参数，其中包含了来自请求的 WSGI 环境结构。</li>
<li>现在可以从 <code class="docutils literal notranslate"><span class="pre">django.core.signals</span></code> 导入 <a class="reference internal" href="../ref/signals.html#django.test.signals.setting_changed" title="django.test.signals.setting_changed"><code class="xref py py-func docutils literal notranslate"><span class="pre">setting_changed()</span></code></a> 信号，以避免在非测试情况下加载 <code class="docutils literal notranslate"><span class="pre">django.test</span></code>。 Django 不再自行加载它。</li>
</ul>
</div>
<div class="section" id="s-system-check-framework">
<span id="system-check-framework"></span><h4>系统检查框架<a class="headerlink" href="#system-check-framework" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../topics/checks.html#django.core.checks.register" title="django.core.checks.register"><code class="xref py py-attr docutils literal notranslate"><span class="pre">register</span></code></a> 现在可以作为一个函数使用。</li>
</ul>
</div>
<div class="section" id="s-templates">
<span id="templates"></span><h4>模板<a class="headerlink" href="#templates" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/templates/builtins.html#std-templatefilter-urlize"><code class="xref std std-tfilter docutils literal notranslate"><span class="pre">urlize</span></code></a> 现在支持包含顶级域名后面字符的域名链接（例如 <code class="docutils literal notranslate"><span class="pre">djangoproject.com/</span></code> 和 <code class="docutils literal notranslate"><span class="pre">djangoproject.com/download/</span></code>）。</li>
<li><a class="reference internal" href="../ref/templates/builtins.html#std-templatefilter-urlize"><code class="xref std std-tfilter docutils literal notranslate"><span class="pre">urlize</span></code></a> 不将域名或其查询字符串末尾的感叹号视为 URL 的一部分（例如，<code class="docutils literal notranslate"><span class="pre">'djangoproject.com!</span></code> 中的 URL 为 <code class="docutils literal notranslate"><span class="pre">djangoproject.com</span></code>）。</li>
<li>添加了一个名为 <a class="reference internal" href="../ref/templates/api.html#django.template.loaders.locmem.Loader" title="django.template.loaders.locmem.Loader"><code class="xref py py-class docutils literal notranslate"><span class="pre">locmem.Loader</span></code></a> 的类，它可以从 Python 字典中加载 Django 模板。</li>
<li><a class="reference internal" href="../ref/templates/builtins.html#std-templatetag-now"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">now</span></code></a> 标签现在可以使用常见的语法将其输出存储在上下文变量中，例如：<code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">now</span> <span class="pre">'j</span> <span class="pre">n</span> <span class="pre">Y'</span> <span class="pre">as</span> <span class="pre">varname</span> <span class="pre">%}</span></code>。</li>
</ul>
</div>
<div class="section" id="s-requests-and-responses">
<span id="requests-and-responses"></span><h4>请求和响应<a class="headerlink" href="#requests-and-responses" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>现在，<code class="docutils literal notranslate"><span class="pre">WSGIRequest</span></code> 将尊重以 <code class="docutils literal notranslate"><span class="pre">//</span></code> 开头的路径。</li>
<li>现在， <a class="reference internal" href="../ref/request-response.html#django.http.HttpRequest.build_absolute_uri" title="django.http.HttpRequest.build_absolute_uri"><code class="xref py py-meth docutils literal notranslate"><span class="pre">HttpRequest.build_absolute_uri()</span></code></a> 方法能够正确处理以 <code class="docutils literal notranslate"><span class="pre">//</span></code> 开头的路径。</li>
<li>如果 <a class="reference internal" href="../ref/settings.html#std-setting-DEBUG"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DEBUG</span></code></a> 为 <code class="docutils literal notranslate"><span class="pre">True</span></code>，并且请求引发了 <a class="reference internal" href="../ref/exceptions.html#django.core.exceptions.SuspiciousOperation" title="django.core.exceptions.SuspiciousOperation"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SuspiciousOperation</span></code></a> 异常，将会使用详细的错误页面呈现响应。</li>
<li><a class="reference internal" href="../ref/request-response.html#django.http.QueryDict" title="django.http.QueryDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueryDict</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">query_string</span></code> 参数现在是可选的，默认值为 <code class="docutils literal notranslate"><span class="pre">None</span></code>，因此可以使用 <code class="docutils literal notranslate"><span class="pre">QueryDict()</span></code> 来实例化一个空的 <code class="docutils literal notranslate"><span class="pre">QueryDict</span></code>，而不是 <code class="docutils literal notranslate"><span class="pre">QueryDict(None)</span></code> 或 <code class="docutils literal notranslate"><span class="pre">QueryDict('')</span></code>。</li>
<li><a class="reference internal" href="../ref/request-response.html#django.http.HttpRequest" title="django.http.HttpRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpRequest</span></code></a> 对象的 <code class="docutils literal notranslate"><span class="pre">GET</span></code> 和 <code class="docutils literal notranslate"><span class="pre">POST</span></code> 属性现在是 <a class="reference internal" href="../ref/request-response.html#django.http.QueryDict" title="django.http.QueryDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueryDict</span></code></a>，而不再是字典，而 <code class="docutils literal notranslate"><span class="pre">FILES</span></code> 属性现在是一个 <code class="docutils literal notranslate"><span class="pre">MultiValueDict</span></code>。这使得该类与文档和 <code class="docutils literal notranslate"><span class="pre">WSGIRequest</span></code> 保持一致。</li>
<li>添加了 <a class="reference internal" href="../ref/request-response.html#django.http.HttpResponse.charset" title="django.http.HttpResponse.charset"><code class="xref py py-attr docutils literal notranslate"><span class="pre">HttpResponse.charset</span></code></a> 属性。</li>
<li><code class="docutils literal notranslate"><span class="pre">WSGIRequestHandler</span></code> 现在按照 RFC 将 URI 转换为 IRI，使用 <code class="docutils literal notranslate"><span class="pre">uri_to_iri()</span></code>。</li>
<li><a class="reference internal" href="../ref/request-response.html#django.http.HttpRequest.get_full_path" title="django.http.HttpRequest.get_full_path"><code class="xref py py-meth docutils literal notranslate"><span class="pre">HttpRequest.get_full_path()</span></code></a> 方法现在正确地对 Uniform Resource Identifier (URI) 的路径部分进行了字符转义，以防止不安全字符的问题。</li>
<li><a class="reference internal" href="../ref/request-response.html#django.http.HttpResponse" title="django.http.HttpResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpResponse</span></code></a> 类现在实现了一些额外的方法，如 <a class="reference internal" href="../ref/request-response.html#django.http.HttpResponse.getvalue" title="django.http.HttpResponse.getvalue"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getvalue()</span></code></a>，使得实例可以作为流对象使用。</li>
<li>新的 <a class="reference internal" href="../ref/request-response.html#django.http.HttpResponse.setdefault" title="django.http.HttpResponse.setdefault"><code class="xref py py-meth docutils literal notranslate"><span class="pre">HttpResponse.setdefault()</span></code></a> 方法允许在尚未设置时设置标头。</li>
<li>你可以使用新的 <a class="reference internal" href="../ref/request-response.html#django.http.FileResponse" title="django.http.FileResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">FileResponse</span></code></a> 来流式传输文件。</li>
<li>用于条件视图处理的 <a class="reference internal" href="../topics/http/decorators.html#django.views.decorators.http.condition" title="django.views.decorators.http.condition"><code class="xref py py-func docutils literal notranslate"><span class="pre">condition()</span></code></a> 装饰器现在支持 <code class="docutils literal notranslate"><span class="pre">If-unmodified-since</span></code> 标头。</li>
</ul>
</div>
<div class="section" id="s-tests">
<span id="tests"></span><h4>测试<a class="headerlink" href="#tests" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../topics/testing/advanced.html#django.test.RequestFactory" title="django.test.RequestFactory"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestFactory.trace()</span></code></a> 和 <a class="reference internal" href="../topics/testing/tools.html#django.test.Client.trace" title="django.test.Client.trace"><code class="xref py py-class docutils literal notranslate"><span class="pre">Client.trace()</span></code></a> 方法已经实现，允许你在测试中创建 <code class="docutils literal notranslate"><span class="pre">TRACE</span></code> 请求。</li>
<li><a class="reference internal" href="../topics/testing/tools.html#django.test.SimpleTestCase.assertTemplateUsed" title="django.test.SimpleTestCase.assertTemplateUsed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertTemplateUsed()</span></code></a> 添加了 <code class="docutils literal notranslate"><span class="pre">count</span></code> 参数。这允许你断言模板被渲染了特定次数。</li>
<li>新的 <a class="reference internal" href="../topics/testing/tools.html#django.test.SimpleTestCase.assertJSONNotEqual" title="django.test.SimpleTestCase.assertJSONNotEqual"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertJSONNotEqual()</span></code></a> 断言允许你测试两个 JSON 片段不相等。</li>
<li>为 <a class="reference internal" href="../ref/django-admin.html#django-admin-test"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">test</span></code></a> 命令添加了选项，以保留测试数据库 (<a class="reference internal" href="../ref/django-admin.html#cmdoption-test-keepdb"><code class="xref std std-option docutils literal notranslate"><span class="pre">--keepdb</span></code></a>)，以倒序运行测试用例 (<a class="reference internal" href="../ref/django-admin.html#cmdoption-test-reverse"><code class="xref std std-option docutils literal notranslate"><span class="pre">--reverse</span></code></a>)，并为失败的测试启用 SQL 日志记录 (<a class="reference internal" href="../ref/django-admin.html#cmdoption-test-debug-sql"><code class="xref std std-option docutils literal notranslate"><span class="pre">--debug-sql</span></code></a>)。</li>
<li>为测试客户端响应添加了 <a class="reference internal" href="../topics/testing/tools.html#django.test.Response.resolver_match" title="django.test.Response.resolver_match"><code class="xref py py-attr docutils literal notranslate"><span class="pre">resolver_match</span></code></a> 属性。</li>
<li>添加了一些设置，允许自定义 Oracle 测试表空间参数： <a class="reference internal" href="../ref/settings.html#std-setting-DATAFILE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DATAFILE</span></code></a>、<a class="reference internal" href="../ref/settings.html#std-setting-DATAFILE_TMP"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DATAFILE_TMP</span></code></a>、<a class="reference internal" href="../ref/settings.html#std-setting-DATAFILE_MAXSIZE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DATAFILE_MAXSIZE</span></code></a> 和 <a class="reference internal" href="../ref/settings.html#std-setting-DATAFILE_TMP_MAXSIZE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DATAFILE_TMP_MAXSIZE</span></code></a>。</li>
<li><a class="reference internal" href="../topics/testing/tools.html#django.test.override_settings" title="django.test.override_settings"><code class="xref py py-func docutils literal notranslate"><span class="pre">override_settings()</span></code></a> 装饰器现在可以影响 <a class="reference internal" href="../ref/settings.html#std-setting-DATABASE_ROUTERS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DATABASE_ROUTERS</span></code></a> 中的主路由器。</li>
<li>添加了对使用类文件对象进行文件上传的测试客户端支持。</li>
<li>在使用 Python 3.4+ 和 SQLite 3.7.13+ 进行测试时，现在使用共享缓存来测试 SQLite 内存数据库。这允许在线程之间共享数据库。</li>
</ul>
</div>
<div class="section" id="s-validators">
<span id="validators"></span><h4>验证器<a class="headerlink" href="#validators" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/validators.html#django.core.validators.URLValidator" title="django.core.validators.URLValidator"><code class="xref py py-class docutils literal notranslate"><span class="pre">URLValidator</span></code></a> 现在支持 IPv6 地址、Unicode 域名和包含身份验证数据的 URL。</li>
</ul>
</div>
</div>
</div>
<div class="section" id="s-backwards-incompatible-changes-in-1-8">
<span id="s-backwards-incompatible-1-8"></span><span id="backwards-incompatible-changes-in-1-8"></span><span id="backwards-incompatible-1-8"></span><h2>1.8 版本中的向后不兼容的更改<a class="headerlink" href="#backwards-incompatible-changes-in-1-8" title="永久链接至标题">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">除了本节中概述的更改之外，请确保查看 <a class="reference internal" href="../internals/deprecation.html#deprecation-removed-in-1-8"><span class="std std-ref">弃用计划</span></a>，以了解已移除的任何功能。如果您在给定功能的弃用时间内未更新您的代码，其移除可能会被视为不兼容的变更。</p>
</div>
<div class="section" id="s-related-object-operations-are-run-in-a-transaction">
<span id="related-object-operations-are-run-in-a-transaction"></span><h3>相关对象操作在事务中执行<a class="headerlink" href="#related-object-operations-are-run-in-a-transaction" title="永久链接至标题">¶</a></h3>
<p>某些操作涉及到相关对象，例如 <a class="reference internal" href="../ref/models/relations.html#django.db.models.fields.related.RelatedManager.add" title="django.db.models.fields.related.RelatedManager.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add()</span></code></a> 或直接赋值，在没有包装在事务中的情况下运行多个数据修改查询。为了减少数据损坏的风险，现在所有涉及多个相关对象的数据修改方法（即 <code class="docutils literal notranslate"><span class="pre">add()</span></code>, <code class="docutils literal notranslate"><span class="pre">remove()</span></code>, <code class="docutils literal notranslate"><span class="pre">clear()</span></code> 和直接赋值）都会在事务内执行其数据修改查询，前提是您的数据库支持事务。</p>
<p>这个改变带来了一个向后不兼容的副作用，从这些方法触发的信号处理程序现在在方法的事务中执行，而且信号处理程序中的任何异常都会阻止整个操作。</p>
</div>
<div class="section" id="s-assigning-unsaved-objects-to-relations-raises-an-error">
<span id="s-unsaved-model-instance-check-18"></span><span id="assigning-unsaved-objects-to-relations-raises-an-error"></span><span id="unsaved-model-instance-check-18"></span><h3>将未保存的对象分配给关系会引发错误。<a class="headerlink" href="#assigning-unsaved-objects-to-relations-raises-an-error" title="永久链接至标题">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">备注</p>
<p>为了更容易允许在内存中使用模型，这个更改在 Django 1.8.4 中已被撤销，并在 <code class="docutils literal notranslate"><span class="pre">model.save()</span></code> 期间替换为检查。例如：</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Django&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">Author</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;John&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">save() prohibited to prevent data loss due to unsaved related object &#39;author&#39;.</span>
</pre></div>
</div>
<p class="last">在 Django 1.8.5 中，取消了对反向一对一关系分配的类似检查。</p>
</div>
<p>将未保存的对象分配给 <a class="reference internal" href="../ref/models/fields.html#django.db.models.ForeignKey" title="django.db.models.ForeignKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKey</span></code></a>、<a class="reference internal" href="../ref/contrib/contenttypes.html#django.contrib.contenttypes.fields.GenericForeignKey" title="django.contrib.contenttypes.fields.GenericForeignKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">GenericForeignKey</span></code></a> 和 <a class="reference internal" href="../ref/models/fields.html#django.db.models.OneToOneField" title="django.db.models.OneToOneField"><code class="xref py py-class docutils literal notranslate"><span class="pre">OneToOneField</span></code></a> 现在会引发 <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(在 Python v3.12)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a>。</p>
<p>以前，对未保存的对象的分配会被静默忽略。例如：</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Django&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">Author</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;John&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Django&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">author</span>
<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>现在，将引发一个错误以防止数据丢失：</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">Author</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;john&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">Cannot assign &quot;&lt;Author: John&gt;&quot;: &quot;Author&quot; instance isn&#39;t saved in the database.</span>
</pre></div>
</div>
<p>如果你需要允许分配未保存的实例（旧行为）并且不担心可能的数据丢失（例如，你从不将对象保存到数据库），你可以通过使用 <code class="docutils literal notranslate"><span class="pre">ForeignKey.allow_unsaved_instance_assignment</span></code> 属性来禁用此检查（此属性在 1.8.4 中已被移除，因为不再相关）。</p>
</div>
<div class="section" id="s-management-commands-that-only-accept-positional-arguments">
<span id="management-commands-that-only-accept-positional-arguments"></span><h3>仅接受位置参数的管理命令<a class="headerlink" href="#management-commands-that-only-accept-positional-arguments" title="永久链接至标题">¶</a></h3>
<p>如果你编写了一个只接受位置参数的自定义管理命令，并且没有指定 <code class="docutils literal notranslate"><span class="pre">args</span></code> 命令变量，你可能会遇到类似 <code class="docutils literal notranslate"><span class="pre">Error:</span> <span class="pre">unrecognized</span> <span class="pre">arguments:</span> <span class="pre">...</span></code> 的错误，因为变量解析现在基于 <a class="reference external" href="https://docs.python.org/3/library/argparse.html#module-argparse" title="(在 Python v3.12)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">argparse</span></code></a>，它不会隐式接受位置参数。你可以通过简单地设置 <code class="docutils literal notranslate"><span class="pre">args</span></code> 类变量来使你的命令向后兼容。然而，如果你不需要与旧版本的 Django 保持兼容性，最好按照 <a class="reference internal" href="../howto/custom-management-commands.html"><span class="doc">编写自定义 django-admin 命令</span></a> 中描述的方法实现新的 <a class="reference internal" href="../howto/custom-management-commands.html#django.core.management.BaseCommand.add_arguments" title="django.core.management.BaseCommand.add_arguments"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_arguments()</span></code></a> 方法。</p>
</div>
<div class="section" id="s-custom-test-management-command-arguments-through-test-runner">
<span id="custom-test-management-command-arguments-through-test-runner"></span><h3>通过测试运行器对自定义测试管理命令的参数进行设置<a class="headerlink" href="#custom-test-management-command-arguments-through-test-runner" title="永久链接至标题">¶</a></h3>
<p>通过测试运行器向 <code class="docutils literal notranslate"><span class="pre">test</span></code> 管理命令添加自定义参数的方法已经发生了变化。以前，你可以在测试运行器上提供一个 <code class="docutils literal notranslate"><span class="pre">option_list</span></code> 类变量来添加更多参数（类似于 <a class="reference external" href="https://docs.python.org/3/library/optparse.html#module-optparse" title="(在 Python v3.12)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">optparse</span></code></a>）。现在，为了实现相同的行为，你必须在测试运行器上创建一个 <code class="docutils literal notranslate"><span class="pre">add_arguments(cls,</span> <span class="pre">parser)</span></code> 类方法，并调用 <code class="docutils literal notranslate"><span class="pre">parser.add_argument</span></code> 来添加任何自定义参数，因为现在的 parser 是一个 <a class="reference external" href="https://docs.python.org/3/library/argparse.html#argparse.ArgumentParser" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">argparse.ArgumentParser</span></code></a> 实例。</p>
</div>
<div class="section" id="s-model-check-ensures-auto-generated-column-names-are-within-limits-specified-by-database">
<span id="model-check-ensures-auto-generated-column-names-are-within-limits-specified-by-database"></span><h3>模型检查确保自动生成的列名在数据库指定的限制范围内<a class="headerlink" href="#model-check-ensures-auto-generated-column-names-are-within-limits-specified-by-database" title="永久链接至标题">¶</a></h3>
<p>字段名长度超过数据库支持的列名长度可能会引发问题。例如，在 MySQL 中，尝试创建该列时会引发异常；在 PostgreSQL 中，数据库会截断列名（你可能会在 PostgreSQL 日志中看到警告）。</p>
<p>引入了模型检查，以在实际创建数据库表之前更好地提醒用户注意这种情况。</p>
<p>如果你有一个现有的模型，在其中这个检查似乎是一个错误的正检，例如在 PostgreSQL 上，其中名称已经被截断，只需使用 <a class="reference internal" href="../ref/models/fields.html#django.db.models.Field.db_column" title="django.db.models.Field.db_column"><code class="xref py py-attr docutils literal notranslate"><span class="pre">db_column</span></code></a> 来指定正在使用的名称。</p>
<p>这个检查也适用于隐式生成的 <code class="docutils literal notranslate"><span class="pre">ManyToManyField.through</span></code> 模型中的列。如果在那里遇到问题，可以使用 <a class="reference internal" href="../ref/models/fields.html#django.db.models.ManyToManyField.through" title="django.db.models.ManyToManyField.through"><code class="xref py py-attr docutils literal notranslate"><span class="pre">through</span></code></a> 创建一个显式模型，然后根据需要指定其列的 <a class="reference internal" href="../ref/models/fields.html#django.db.models.Field.db_column" title="django.db.models.Field.db_column"><code class="xref py py-attr docutils literal notranslate"><span class="pre">db_column</span></code></a>。</p>
</div>
<div class="section" id="s-query-relation-lookups-now-check-object-types">
<span id="query-relation-lookups-now-check-object-types"></span><h3>现在查询关系查找会检查对象类型<a class="headerlink" href="#query-relation-lookups-now-check-object-types" title="永久链接至标题">¶</a></h3>
<p>现在，查询模型查找会检查传递的对象是否是正确的类型，如果不是，则引发 <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(在 Python v3.12)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a>。以前，Django 不关心对象是否是正确的类型；它只是使用对象的相关字段属性（例如 <code class="docutils literal notranslate"><span class="pre">id</span></code>）进行查找。现在，会引发错误以防止不正确的查找：</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Django&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">author</span><span class="o">=</span><span class="n">book</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">Cannot query &quot;&lt;Book: Django&gt;&quot;: Must be &quot;Author&quot; instance.</span>
</pre></div>
</div>
</div>
<div class="section" id="s-select-related-now-checks-given-fields">
<span id="select-related-now-checks-given-fields"></span><h3><code class="docutils literal notranslate"><span class="pre">select_related()</span></code> 现在会检查给定的字段。<a class="headerlink" href="#select-related-now-checks-given-fields" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">select_related()</span></code> 现在会验证给定的字段是否实际存在。以前，不存在的字段会被默默忽略。现在会引发错误：</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="s2">&quot;nonexistent_field&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">FieldError</span>: <span class="n">Invalid field name(s) given in select_related: &#39;nonexistent_field&#39;</span>
</pre></div>
</div>
<p>验证还确保给定字段是关系型的：</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">FieldError</span>: <span class="n">Non-relational field given in select_related: &#39;name&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="s-default-emailfield-max-length-increased-to-254">
<span id="default-emailfield-max-length-increased-to-254"></span><h3>默认的 <code class="docutils literal notranslate"><span class="pre">EmailField.max_length</span></code> 增加到了 254。<a class="headerlink" href="#default-emailfield-max-length-increased-to-254" title="永久链接至标题">¶</a></h3>
<p>旧的默认值为 75 个字符的 <code class="docutils literal notranslate"><span class="pre">max_length</span></code> 无法存储所有可能符合 RFC3696/5321 标准的电子邮件地址。为了存储所有可能的有效电子邮件地址，<code class="docutils literal notranslate"><span class="pre">max_length</span></code> 已增加到 254 个字符。您需要为受影响的模型生成并应用数据库迁移（或者如果希望保留当前字段的长度，则添加 <code class="docutils literal notranslate"><span class="pre">max_length=75</span></code>）。一个用于 <a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.models.User.email" title="django.contrib.auth.models.User.email"><code class="xref py py-attr docutils literal notranslate"><span class="pre">django.contrib.auth.models.User.email</span></code></a> 的迁移已包含在内。</p>
</div>
<div class="section" id="s-support-for-postgresql-versions-older-than-9-0">
<span id="support-for-postgresql-versions-older-than-9-0"></span><h3>对于早于 9.0 版本的 PostgreSQL 的支持<a class="headerlink" href="#support-for-postgresql-versions-older-than-9-0" title="永久链接至标题">¶</a></h3>
<p>PostgreSQL 8.4 的上游支持期限在 2014 年 7 月结束。因此，Django 1.8 将 9.0 版本设置为其正式支持的最低 PostgreSQL 版本。</p>
<p>这还包括不再支持 PostGIS 1.3 和 1.4，因为这些版本在 8.4 之后的 PostgreSQL 版本上不受支持。</p>
<p>Django 现在要求使用 Psycopg2 版本 2.4.5 或更高版本（如果要使用 <a class="reference internal" href="../ref/contrib/postgres/index.html#module-django.contrib.postgres" title="django.contrib.postgres: PostgreSQL-specific fields and features"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.postgres</span></code></a>，则需要 2.5+）。</p>
</div>
<div class="section" id="s-support-for-mysql-versions-older-than-5-5">
<span id="support-for-mysql-versions-older-than-5-5"></span><h3>对于早于 5.5 版本的 MySQL 的支持<a class="headerlink" href="#support-for-mysql-versions-older-than-5-5" title="永久链接至标题">¶</a></h3>
<p>MySQL 5.0 的上游支持期限在 2012 年 1 月到期，MySQL 5.1 的上游支持期限在 2013 年 12 月到期。因此，Django 1.8 将 5.5 版本设置为其正式支持的最低 MySQL 版本。</p>
</div>
<div class="section" id="s-support-for-oracle-versions-older-than-11-1">
<span id="support-for-oracle-versions-older-than-11-1"></span><h3>对于早于 11.1 版本的 Oracle 的支持<a class="headerlink" href="#support-for-oracle-versions-older-than-11-1" title="永久链接至标题">¶</a></h3>
<p>Oracle 9.2 的上游支持期限在 2010 年 7 月到期，Oracle 10.1 的上游支持期限在 2012 年 1 月到期，Oracle 10.2 的上游支持期限在 2013 年 7 月到期。因此，Django 1.8 将 11.1 版本设置为其正式支持的最低 Oracle 版本。</p>
</div>
<div class="section" id="s-specific-privileges-used-instead-of-roles-for-tests-on-oracle">
<span id="specific-privileges-used-instead-of-roles-for-tests-on-oracle"></span><h3>在 Oracle 上，测试中使用特定权限而不是角色。<a class="headerlink" href="#specific-privileges-used-instead-of-roles-for-tests-on-oracle" title="永久链接至标题">¶</a></h3>
<p>早期版本的 Django 在 Oracle 上为测试用户授予 CONNECT 和 RESOURCE 角色。这些角色已被弃用，因此 Django 1.8 改为使用特定的底层权限。这改变了运行测试所需的主用户的权限（除非项目配置为避免创建测试用户）。现在所需的确切权限详见 <a class="reference internal" href="../ref/databases.html#oracle-notes"><span class="std std-ref">Oracle 注释</span></a>。</p>
</div>
<div class="section" id="s-abstractuser-last-login-allows-null-values">
<span id="abstractuser-last-login-allows-null-values"></span><h3><code class="docutils literal notranslate"><span class="pre">AbstractUser.last_login</span></code> 允许空值<a class="headerlink" href="#abstractuser-last-login-allows-null-values" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.models.User.last_login" title="django.contrib.auth.models.User.last_login"><code class="xref py py-attr docutils literal notranslate"><span class="pre">AbstractUser.last_login</span></code></a> 字段现在允许空值。以前，它默认为用户创建时的时间，如果用户从未登录，这会产生误导。如果你使用的是默认用户（<a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">django.contrib.auth.models.User</span></code></a>），请运行 <code class="docutils literal notranslate"><span class="pre">contrib.auth</span></code> 中包含的数据库迁移。</p>
<p>如果你使用从 <code class="docutils literal notranslate"><span class="pre">AbstractUser</span></code> 继承的自定义用户模型，你需要运行 <a class="reference internal" href="../ref/django-admin.html#django-admin-makemigrations"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">makemigrations</span></code></a> 并为包含该模型的应用程序生成一个迁移。此外，如果希望将未登录的用户的 <code class="docutils literal notranslate"><span class="pre">last_login</span></code> 设置为 <code class="docutils literal notranslate"><span class="pre">NULL</span></code>，你可以运行以下查询：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">get_user_model</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">AbstractBaseUser</span>

<span class="n">UserModel</span> <span class="o">=</span> <span class="n">get_user_model</span><span class="p">()</span>
<span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">UserModel</span><span class="p">,</span> <span class="n">AbstractBaseUser</span><span class="p">):</span>
    <span class="n">UserModel</span><span class="o">.</span><span class="n">_default_manager</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">last_login</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">F</span><span class="p">(</span><span class="s2">&quot;date_joined&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="n">last_login</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-id1">
<span id="id1"></span><h3><a class="reference internal" href="../ref/contrib/gis/index.html#module-django.contrib.gis" title="django.contrib.gis: Geographic Information System (GIS) extensions for Django"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a><a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>不再支持 GEOS 3.1 和 GDAL 1.6 版本。</li>
<li>不再支持 SpatiaLite 版本低于 2.4 。</li>
<li>GIS-specific lookups 已经重构以使用 <a class="reference internal" href="../ref/models/lookups.html#django.db.models.Lookup" title="django.db.models.Lookup"><code class="xref py py-class docutils literal notranslate"><span class="pre">django.db.models.Lookup</span></code></a> API。</li>
<li><a class="reference internal" href="../ref/contrib/gis/geos.html#django.contrib.gis.geos.GEOSGeometry" title="django.contrib.gis.geos.GEOSGeometry"><code class="xref py py-class docutils literal notranslate"><span class="pre">GEOSGeometry</span></code></a> 对象的默认 <code class="docutils literal notranslate"><span class="pre">str</span></code> 表示已从 WKT 更改为 EWKT 格式（包括 SRID）。由于这个表示法在序列化框架中使用，这意味着 <code class="docutils literal notranslate"><span class="pre">dumpdata</span></code> 输出现在将包含几何对象的 SRID 值。</li>
</ul>
</div>
<div class="section" id="s-priority-of-context-processors-for-templateresponse-brought-in-line-with-render">
<span id="priority-of-context-processors-for-templateresponse-brought-in-line-with-render"></span><h3>对于 <code class="docutils literal notranslate"><span class="pre">TemplateResponse</span></code>，上下文处理器的优先级已与 <code class="docutils literal notranslate"><span class="pre">render</span></code> 保持一致。<a class="headerlink" href="#priority-of-context-processors-for-templateresponse-brought-in-line-with-render" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../ref/template-response.html#django.template.response.TemplateResponse" title="django.template.response.TemplateResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">TemplateResponse</span></code></a> 构造函数旨在成为 <a class="reference internal" href="../topics/http/shortcuts.html#django.shortcuts.render" title="django.shortcuts.render"><code class="xref py py-func docutils literal notranslate"><span class="pre">render()</span></code></a> 函数的一个替代。然而，它存在一个轻微的不兼容性，即对于 <code class="docutils literal notranslate"><span class="pre">TemplateResponse</span></code>，传递的上下文字典中的上下文数据可能会被上下文处理器返回的上下文数据覆盖，而对于 <code class="docutils literal notranslate"><span class="pre">render</span></code> 则相反。这是一个错误，而 <code class="docutils literal notranslate"><span class="pre">render</span></code> 的行为更为合适，因为它允许在视图中本地覆盖全局定义的上下文处理器。如果你依赖于在 <code class="docutils literal notranslate"><span class="pre">TemplateResponse</span></code> 中使用上下文处理器可以覆盖上下文数据的事实，那么你需要更改你的代码。</p>
</div>
<div class="section" id="s-overriding-setupclass-teardownclass-in-test-cases">
<span id="overriding-setupclass-teardownclass-in-test-cases"></span><h3>在测试用例中重写 <code class="docutils literal notranslate"><span class="pre">setUpClass</span></code> / <code class="docutils literal notranslate"><span class="pre">tearDownClass</span></code><a class="headerlink" href="#overriding-setupclass-teardownclass-in-test-cases" title="永久链接至标题">¶</a></h3>
<p>装饰器 <a class="reference internal" href="../topics/testing/tools.html#django.test.override_settings" title="django.test.override_settings"><code class="xref py py-func docutils literal notranslate"><span class="pre">override_settings()</span></code></a> 和 <a class="reference internal" href="../topics/testing/tools.html#django.test.modify_settings" title="django.test.modify_settings"><code class="xref py py-func docutils literal notranslate"><span class="pre">modify_settings()</span></code></a> 现在在作为类装饰器使用时以类级别的方式起作用。因此，在重写 <code class="docutils literal notranslate"><span class="pre">setUpClass()</span></code> 或 <code class="docutils literal notranslate"><span class="pre">tearDownClass()</span></code> 时，应始终调用 <code class="docutils literal notranslate"><span class="pre">super</span></code> 实现。</p>
</div>
<div class="section" id="s-removal-of-django-contrib-formtools">
<span id="removal-of-django-contrib-formtools"></span><h3>移除了 <code class="docutils literal notranslate"><span class="pre">django.contrib.formtools</span></code> 模块<a class="headerlink" href="#removal-of-django-contrib-formtools" title="永久链接至标题">¶</a></h3>
<p>formtools contrib 应用已被移动到一个单独的包中，并相应的文档页面已被更新或删除。</p>
<p>新的包可以在 <a class="reference external" href="https://github.com/jazzband/django-formtools/">GitHub</a> 和 PyPI 上获得。</p>
</div>
<div class="section" id="s-database-connection-reloading-between-tests">
<span id="database-connection-reloading-between-tests"></span><h3>测试之间重新加载数据库连接。<a class="headerlink" href="#database-connection-reloading-between-tests" title="永久链接至标题">¶</a></h3>
<p>以前，在 <code class="docutils literal notranslate"><span class="pre">TestCase</span></code> 中的每个测试之间，Django 会关闭数据库连接。现在不再是这样了，因为 Django 现在会将整个 <code class="docutils literal notranslate"><span class="pre">TestCase</span></code> 包装在一个事务中。如果你的一些测试依赖于旧的行为，你应该让它们继承自 <code class="docutils literal notranslate"><span class="pre">TransactionTestCase</span></code>。</p>
</div>
<div class="section" id="s-cleanup-of-the-django-template-namespace">
<span id="cleanup-of-the-django-template-namespace"></span><h3>对 <code class="docutils literal notranslate"><span class="pre">django.template</span></code> 命名空间进行了清理<a class="headerlink" href="#cleanup-of-the-django-template-namespace" title="永久链接至标题">¶</a></h3>
<p>如果你一直依赖于在 <code class="docutils literal notranslate"><span class="pre">django.template</span></code> 模块中公开的私有 API，你可能需要从 <code class="docutils literal notranslate"><span class="pre">django.template.base</span></code> 中导入它们。</p>
<p>另外，已删除了私有 API <code class="docutils literal notranslate"><span class="pre">django.template.base.compile_string()</span></code>, <code class="docutils literal notranslate"><span class="pre">django.template.loader.find_template()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">django.template.loader.get_template_from_string()</span></code>。</p>
</div>
<div class="section" id="s-model-attribute-on-private-model-relations">
<span id="model-attribute-on-private-model-relations"></span><h3>私有模型关系上的 <code class="docutils literal notranslate"><span class="pre">model</span></code> 属性<a class="headerlink" href="#model-attribute-on-private-model-relations" title="永久链接至标题">¶</a></h3>
<p>在早期版本的 Django 中，对于具有反向外键关系的模型（例如），<code class="docutils literal notranslate"><span class="pre">model._meta.get_all_related_objects()</span></code> 返回关系作为具有 <code class="docutils literal notranslate"><span class="pre">model</span></code> 属性设置为关系源的 <code class="docutils literal notranslate"><span class="pre">django.db.models.related.RelatedObject</span></code>。现在，这个方法返回关系作为 <code class="docutils literal notranslate"><span class="pre">django.db.models.fields.related.ManyToOneRel</span></code> （私有 API <code class="docutils literal notranslate"><span class="pre">RelatedObject</span></code> 已被删除），并且 <code class="docutils literal notranslate"><span class="pre">model</span></code> 属性设置为关系目标而不是源。源模型可以在 <code class="docutils literal notranslate"><span class="pre">related_model</span></code> 属性上访问。</p>
<p>考虑一下来自 Django 1.8 教程的这个例子：</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_all_related_objects</span><span class="p">()</span>
<span class="go">[&lt;ManyToOneRel: polls.choice&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_all_related_objects</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">model</span>
<span class="go">&lt;class &#39;polls.models.Poll&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_all_related_objects</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">related_model</span>
<span class="go">&lt;class &#39;polls.models.Choice&#39;&gt;</span>
</pre></div>
</div>
<p>将其与旧版本的行为进行比较：</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_all_related_objects</span><span class="p">()</span>
<span class="go">[&lt;RelatedObject: polls:choice related to poll&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_all_related_objects</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">model</span>
<span class="go">&lt;class &#39;polls.models.Choice&#39;&gt;</span>
</pre></div>
</div>
<p>为了访问源模型，您可以使用以下模式的代码，该代码可以在 Django 1.8 和旧版本中都有效：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">relation</span> <span class="ow">in</span> <span class="n">opts</span><span class="o">.</span><span class="n">get_all_related_objects</span><span class="p">():</span>
    <span class="n">to_model</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">relation</span><span class="p">,</span> <span class="s2">&quot;related_model&quot;</span><span class="p">,</span> <span class="n">relation</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
<p>还请注意，<code class="docutils literal notranslate"><span class="pre">get_all_related_objects()</span></code> 在 1.8 中已被弃用。</p>
</div>
<div class="section" id="s-database-backend-api">
<span id="database-backend-api"></span><h3>数据库后端 API<a class="headerlink" href="#database-backend-api" title="永久链接至标题">¶</a></h3>
<p>以下对数据库后端 API 的更改已记录，以帮助那些编写第三方后端的人更新其代码：</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">BaseDatabaseXXX</span></code> 类已经移动到 <code class="docutils literal notranslate"><span class="pre">django.db.backends.base</span></code>。请从新的位置导入它们：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db.backends.base.base</span> <span class="kn">import</span> <span class="n">BaseDatabaseWrapper</span>
<span class="kn">from</span> <span class="nn">django.db.backends.base.client</span> <span class="kn">import</span> <span class="n">BaseDatabaseClient</span>
<span class="kn">from</span> <span class="nn">django.db.backends.base.creation</span> <span class="kn">import</span> <span class="n">BaseDatabaseCreation</span>
<span class="kn">from</span> <span class="nn">django.db.backends.base.features</span> <span class="kn">import</span> <span class="n">BaseDatabaseFeatures</span>
<span class="kn">from</span> <span class="nn">django.db.backends.base.introspection</span> <span class="kn">import</span> <span class="n">BaseDatabaseIntrospection</span>
<span class="kn">from</span> <span class="nn">django.db.backends.base.introspection</span> <span class="kn">import</span> <span class="n">FieldInfo</span><span class="p">,</span> <span class="n">TableInfo</span>
<span class="kn">from</span> <span class="nn">django.db.backends.base.operations</span> <span class="kn">import</span> <span class="n">BaseDatabaseOperations</span>
<span class="kn">from</span> <span class="nn">django.db.backends.base.schema</span> <span class="kn">import</span> <span class="n">BaseDatabaseSchemaEditor</span>
<span class="kn">from</span> <span class="nn">django.db.backends.base.validation</span> <span class="kn">import</span> <span class="n">BaseDatabaseValidation</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">DatabaseCreation</span></code> 类中的 <code class="docutils literal notranslate"><span class="pre">data_types</span></code>、<code class="docutils literal notranslate"><span class="pre">data_types_suffix</span></code> 和 <code class="docutils literal notranslate"><span class="pre">data_type_check_constraints</span></code> 属性已经移到了 <code class="docutils literal notranslate"><span class="pre">DatabaseWrapper</span></code> 中。</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">SQLCompiler.as_sql()</span></code> 方法现在接受一个 <code class="docutils literal notranslate"><span class="pre">subquery</span></code> 参数 (<a class="reference external" href="https://code.djangoproject.com/ticket/24164">#24164</a>)。</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">BaseDatabaseOperations.date_interval_sql()</span></code> 方法现在只接受一个 <code class="docutils literal notranslate"><span class="pre">timedelta</span></code> 参数。</p>
</li>
</ul>
</div>
<div class="section" id="s-id2">
<span id="id2"></span><h3><a class="reference internal" href="../ref/contrib/admin/index.html#module-django.contrib.admin" title="django.contrib.admin: Django's admin site."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a><a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">AdminSite</span></code> 不再接受一个 <code class="docutils literal notranslate"><span class="pre">app_name</span></code> 参数，并且它的 <code class="docutils literal notranslate"><span class="pre">app_name</span></code> 属性已被删除。应用程序名称始终为 <code class="docutils literal notranslate"><span class="pre">admin</span></code> （与实例名称不同，你仍然可以使用 <code class="docutils literal notranslate"><span class="pre">AdminSite(name=&quot;...&quot;)</span></code> 进行自定义）。</li>
<li><code class="docutils literal notranslate"><span class="pre">ModelAdmin.get_object()</span></code> 方法（私有 API）现在接受一个名为 <code class="docutils literal notranslate"><span class="pre">from_field</span></code> 的第三个参数，以指定应该与提供的 <code class="docutils literal notranslate"><span class="pre">object_id</span></code> 匹配的字段。</li>
<li><a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.response_delete" title="django.contrib.admin.ModelAdmin.response_delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ModelAdmin.response_delete()</span></code></a> 方法现在接受一个名为 <code class="docutils literal notranslate"><span class="pre">obj_id</span></code> 的第二个参数，它是在删除之前用于检索对象的序列化标识符。</li>
</ul>
</div>
<div class="section" id="s-default-autoescaping-of-functions-in-django-template-defaultfilters">
<span id="default-autoescaping-of-functions-in-django-template-defaultfilters"></span><h3>默认情况下，<code class="docutils literal notranslate"><span class="pre">django.template.defaultfilters</span></code> 中的函数现在会自动进行自动转义。<a class="headerlink" href="#default-autoescaping-of-functions-in-django-template-defaultfilters" title="永久链接至标题">¶</a></h3>
<p>为了在 Python 代码中调用输出 HTML 的内置模板过滤器时使其 &quot;默认安全&quot;，已更改了 <code class="docutils literal notranslate"><span class="pre">django.template.defaultfilters</span></code> 中以下函数，以自动转义其输入值：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">join</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">linebreaksbr</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">linebreaks_filter</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">linenumbers</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">unordered_list</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">urlize</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">urlizetrunc</span></code></li>
</ul>
<p>如果您传递了可信内容，可以通过指定 <code class="docutils literal notranslate"><span class="pre">autoescape=False</span></code> 来恢复到旧的行为。在模板中使用相应的过滤器时，此更改不会产生任何效果。</p>
</div>
<div class="section" id="s-miscellaneous">
<span id="miscellaneous"></span><h3>杂项<a class="headerlink" href="#miscellaneous" title="永久链接至标题">¶</a></h3>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">connections.queries</span></code> 现在是一个只读属性。</p>
</li>
<li><p class="first">现在只有当数据库连接是同一个对象时才被视为相等。它们不再是可哈希的。</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/middleware.html#django.middleware.gzip.GZipMiddleware" title="django.middleware.gzip.GZipMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">GZipMiddleware</span></code></a> 用于在请求来自 Internet Explorer 时禁用某些内容类型的压缩，以解决 IE6 及更早版本中的一个错误。这种行为可能会影响 IE7 及更高版本的性能。已被移除。</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">URLField.to_python</span></code> 不再在没有路径的 URL 中添加尾随斜杠。</p>
</li>
<li><p class="first">模板过滤器 <a class="reference internal" href="../ref/templates/builtins.html#std-templatefilter-length"><code class="xref std std-tfilter docutils literal notranslate"><span class="pre">length</span></code></a> 现在对未定义的变量返回 <code class="docutils literal notranslate"><span class="pre">0</span></code>，而不是空字符串。</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">ForeignKey.default_error_message['invalid']</span></code> 已从 <code class="docutils literal notranslate"><span class="pre">'%(model)s</span> <span class="pre">instance</span> <span class="pre">with</span> <span class="pre">pk</span> <span class="pre">%(pk)r</span> <span class="pre">does</span> <span class="pre">not</span> <span class="pre">exist.'</span></code> 更改为 <code class="docutils literal notranslate"><span class="pre">'%(model)s</span> <span class="pre">instance</span> <span class="pre">with</span> <span class="pre">%(field)s</span> <span class="pre">%(value)r</span> <span class="pre">does</span> <span class="pre">not</span> <span class="pre">exist.'</span></code> 如果您在自己的代码中使用此消息，请更新插入的参数列表。在内部，Django 将继续提供 <code class="docutils literal notranslate"><span class="pre">params</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">pk</span></code> 参数以保持向后兼容性。</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">UserCreationForm.error_messages['duplicate_username']</span></code> 不再使用。如果您希望自定义该错误消息，请在表单上使用 <code class="docutils literal notranslate"><span class="pre">Meta.error_messages['username']</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">'unique'</span></code> 键 <a class="reference internal" href="../topics/forms/modelforms.html#modelforms-overriding-default-fields"><span class="std std-ref">覆盖它</span></a>，或者如果您有一个自定义的 <code class="docutils literal notranslate"><span class="pre">'username'</span></code> 字段，可以在其 <a class="reference internal" href="../ref/forms/fields.html#django.forms.Field.error_messages" title="django.forms.Field.error_messages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">error_messages</span></code></a> 参数中使用 <code class="docutils literal notranslate"><span class="pre">'unique'</span></code> 键。</p>
</li>
<li><p class="first">在 <a class="reference internal" href="../ref/contrib/admin/index.html#module-django.contrib.admin" title="django.contrib.admin: Django's admin site."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">base.html</span></code> 模板中，块 <code class="docutils literal notranslate"><span class="pre">usertools</span></code> 现在需要设置 <code class="docutils literal notranslate"><span class="pre">has_permission</span></code> 上下文变量。如果您有任何使用此模板的自定义管理视图，请更新它们以传递 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.AdminSite.has_permission" title="django.contrib.admin.AdminSite.has_permission"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AdminSite.has_permission()</span></code></a> 作为这个新变量的值，或者简单地在上下文中包括 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.AdminSite.each_context" title="django.contrib.admin.AdminSite.each_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AdminSite.each_context(request)</span></code></a>。</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/forms/widgets.html#django.forms.ClearableFileInput" title="django.forms.ClearableFileInput"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClearableFileInput</span></code></a> 小部件进行了内部更改，以允许更多自定义。未记录的 <code class="docutils literal notranslate"><span class="pre">url_markup_template</span></code> 属性已被删除，而改用 <code class="docutils literal notranslate"><span class="pre">template_with_initial</span></code>。</p>
</li>
<li><p class="first">为了与其他主要供应商保持一致，<code class="docutils literal notranslate"><span class="pre">en_GB</span></code> 区域现在将星期一作为一周的第一天。</p>
</li>
<li><p class="first">在 <code class="docutils literal notranslate"><span class="pre">TIME_FORMAT</span></code>、<code class="docutils literal notranslate"><span class="pre">DATETIME_FORMAT</span></code> 或 <code class="docutils literal notranslate"><span class="pre">SHORT_DATETIME_FORMAT</span></code> 中，已从任何具有秒钟的区域中删除了秒钟。</p>
</li>
<li><p class="first">Oracle 测试表空间的默认最大大小从 300M（或在 1.7.2 之前的 200M）增加到 500M 。</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">reverse()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">reverse_lazy()</span></code> 现在返回 Unicode 字符串而不是字节字符串。</p>
</li>
<li><p class="first">所有缓存后端都已删除 <code class="docutils literal notranslate"><span class="pre">CacheClass</span></code> 部分。这些别名是为了向后兼容 Django 1.3 提供的。如果您仍在使用它们，请更新您的项目以使用在 <a class="reference internal" href="../ref/settings.html#std-setting-CACHES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">CACHES</span></code></a> 设置的 <a class="reference internal" href="../ref/settings.html#std-setting-CACHES-BACKEND"><code class="xref std std-setting docutils literal notranslate"><span class="pre">BACKEND</span></code></a> 键中找到的真实类名。</p>
</li>
<li><p class="first">默认情况下，<a class="reference internal" href="../ref/django-admin.html#django.core.management.call_command" title="django.core.management.call_command"><code class="xref py py-func docutils literal notranslate"><span class="pre">call_command()</span></code></a> 现在总是跳过检查框架（除非您传递 <code class="docutils literal notranslate"><span class="pre">skip_checks=False</span></code>）。</p>
</li>
<li><p class="first">在迭代行时，<a class="reference internal" href="../ref/files/file.html#django.core.files.File" title="django.core.files.File"><code class="xref py py-class docutils literal notranslate"><span class="pre">File</span></code></a> 现在使用 <span class="target" id="index-2"></span><a class="pep reference external" href="https://peps.python.org/pep-0278/"><strong>universal newlines</strong></a>。以下内容被识别为结束行：Unix 换行约定 <code class="docutils literal notranslate"><span class="pre">'\n'</span></code>，Windows 换行约定 <code class="docutils literal notranslate"><span class="pre">'\r\n'</span></code> 和旧的 Macintosh 换行约定 <code class="docutils literal notranslate"><span class="pre">'\r'</span></code>。</p>
</li>
<li><p class="first">如果 <code class="docutils literal notranslate"><span class="pre">set()</span></code> 失败，Memcached 缓存后端 <code class="docutils literal notranslate"><span class="pre">MemcachedCache</span></code> 和 <code class="docutils literal notranslate"><span class="pre">PyLibMCCache</span></code> 将删除一个键。这是为了确保 <code class="docutils literal notranslate"><span class="pre">cache_db</span></code> 会话存储始终获取最新的会话数据。</p>
</li>
<li><p class="first">在 <code class="docutils literal notranslate"><span class="pre">django.test.utils</span></code> 中删除了私有 API <code class="docutils literal notranslate"><span class="pre">override_template_loaders</span></code> 和 <code class="docutils literal notranslate"><span class="pre">override_with_test_loader</span></code>。请改用 <code class="docutils literal notranslate"><span class="pre">override_settings</span></code> 来覆盖 <code class="docutils literal notranslate"><span class="pre">TEMPLATES</span></code>。</p>
</li>
<li><p class="first">当 <a class="reference internal" href="../ref/settings.html#std-setting-DEBUG"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DEBUG</span></code></a> 设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 时，MySQL 数据库后端不再将警告转换为异常。</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/request-response.html#django.http.HttpRequest" title="django.http.HttpRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpRequest</span></code></a> 现在具有简化的 <code class="docutils literal notranslate"><span class="pre">repr</span></code> （例如 <code class="docutils literal notranslate"><span class="pre">&lt;WSGIRequest:</span> <span class="pre">GET</span> <span class="pre">'/somepath/'&gt;</span></code>）。这不会改变 <a class="reference internal" href="../howto/error-reporting.html#django.views.debug.SafeExceptionReporterFilter" title="django.views.debug.SafeExceptionReporterFilter"><code class="xref py py-class docutils literal notranslate"><span class="pre">SafeExceptionReporterFilter</span></code></a> 类的行为。</p>
</li>
<li><p class="first">使用 <a class="reference internal" href="../ref/class-based-views/mixins-editing.html#django.views.generic.edit.ModelFormMixin" title="django.views.generic.edit.ModelFormMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelFormMixin</span></code></a> 的类视图在同时指定 <code class="docutils literal notranslate"><span class="pre">fields</span></code> 和 <code class="docutils literal notranslate"><span class="pre">form_class</span></code> 属性时将引发 <a class="reference internal" href="../ref/exceptions.html#django.core.exceptions.ImproperlyConfigured" title="django.core.exceptions.ImproperlyConfigured"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ImproperlyConfigured</span></code></a> 异常。以前，<code class="docutils literal notranslate"><span class="pre">fields</span></code> 会被静默忽略。</p>
</li>
<li><p class="first">在跟随重定向时，测试客户端现在会引发 <a class="reference internal" href="../ref/exceptions.html#django.test.client.RedirectCycleError" title="django.test.client.RedirectCycleError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RedirectCycleError</span></code></a>，如果检测到循环或达到了最大重定向限制（而不是静默传递）。</p>
</li>
<li><p class="first">作为字段的 <code class="docutils literal notranslate"><span class="pre">default</span></code> 参数设置的可翻译字符串稍后会转换为具体的字符串，因此在某些情况下，<code class="docutils literal notranslate"><span class="pre">Field.get_default()</span></code> 的返回类型会有所不同。对于可调用返回的默认值没有变化。</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">GenericIPAddressField.empty_strings_allowed</span></code> 现在是 <code class="docutils literal notranslate"><span class="pre">False</span></code>。将空字符串解释为 null 值的数据库后端（Django 包括的后端中只有 Oracle）将不再将 null 值转换回空字符串。这与其他后端保持一致。</p>
</li>
<li><p class="first">当 <code class="docutils literal notranslate"><span class="pre">BaseCommand.leave_locale_alone</span></code> 属性为 <code class="docutils literal notranslate"><span class="pre">False</span></code> 时，现在会停用翻译，而不是强制使用 &quot;en-us&quot; 区域设置。如果您的模型包含非英语字符串，并且您依赖于在管理命令中激活英语翻译，那么这将不再发生。可能会在迁移到 1.8 后生成新的数据库迁移（一次）。</p>
</li>
<li><p class="first">当翻译被临时停用时，<a class="reference internal" href="../ref/utils.html#django.utils.translation.get_language" title="django.utils.translation.get_language"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.translation.get_language()</span></code></a> 现在返回 <code class="docutils literal notranslate"><span class="pre">None</span></code> 而不是 <a class="reference internal" href="../ref/settings.html#std-setting-LANGUAGE_CODE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code></a>。</p>
</li>
<li><p class="first">当不存在特定文字的翻译时，现在会从 <a class="reference internal" href="../ref/settings.html#std-setting-LANGUAGE_CODE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code></a> 语言中获取回退翻译（而不是从未翻译的 <code class="docutils literal notranslate"><span class="pre">msgid</span></code> 消息中获取）。</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/contrib/contenttypes.html#django.contrib.contenttypes.models.ContentType" title="django.contrib.contenttypes.models.ContentType"><code class="xref py py-class docutils literal notranslate"><span class="pre">django.contrib.contenttypes.models.ContentType</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">name</span></code> 字段已经在迁移中删除，并被一个属性替代。这意味着不再可以使用这个字段来查询或过滤 <code class="docutils literal notranslate"><span class="pre">ContentType</span></code> 了。</p>
<p>如果你升级到 Django 1.8 并跳过了 Django 1.7，请注意。如果你运行 <code class="docutils literal notranslate"><span class="pre">manage.py</span> <span class="pre">migrate</span> <span class="pre">--fake</span></code>，这个迁移将被跳过，并且你会看到一个 <code class="docutils literal notranslate"><span class="pre">RuntimeError:</span> <span class="pre">Error</span> <span class="pre">creating</span> <span class="pre">new</span> <span class="pre">content</span> <span class="pre">types.</span></code> 异常，因为 <code class="docutils literal notranslate"><span class="pre">name</span></code> 列不会从数据库中删除。使用 <code class="docutils literal notranslate"><span class="pre">manage.py</span> <span class="pre">migrate</span> <span class="pre">--fake-initial</span></code> 仅虚拟执行初始迁移。</p>
</li>
<li><p class="first">新的 <a class="reference internal" href="../ref/django-admin.html#cmdoption-migrate-fake-initial"><code class="xref std std-option docutils literal notranslate"><span class="pre">migrate</span> <span class="pre">--fake-initial</span></code></a> 选项允许虚拟执行初始迁移。在 1.7 版中，如果初始迁移中创建的所有表格已经存在，初始迁移将始终自动虚拟执行。</p>
</li>
<li><p class="first">一个没有迁移的应用程序，其内含一个对有迁移的应用程序的 <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code>，在迁移数据库或运行测试时可能会导致外键约束错误。在 Django 1.7 中，这可能会导致默默失败并导致约束丢失。要解决这个错误，请为没有迁移的应用程序添加迁移。</p>
</li>
</ul>
</div>
</div>
<div class="section" id="s-features-deprecated-in-1-8">
<span id="s-deprecated-features-1-8"></span><span id="features-deprecated-in-1-8"></span><span id="deprecated-features-1-8"></span><h2>在 1.8 中被废弃的功能<a class="headerlink" href="#features-deprecated-in-1-8" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-selected-methods-in-django-db-models-options-options">
<span id="selected-methods-in-django-db-models-options-options"></span><h3><code class="docutils literal notranslate"><span class="pre">django.db.models.options.Options</span></code> 中的选定方法<a class="headerlink" href="#selected-methods-in-django-db-models-options-options" title="永久链接至标题">¶</a></h3>
<p>作为正式化 <code class="docutils literal notranslate"><span class="pre">Model._meta</span></code> API（来自 <a class="reference internal" href="../ref/models/meta.html#django.db.models.options.Options" title="django.db.models.options.Options"><code class="xref py py-class docutils literal notranslate"><span class="pre">django.db.models.options.Options</span></code></a> 类）的一部分，一些方法已被弃用，并将在 Django 1.10 中移除：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">get_all_field_names()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">get_all_related_objects()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">get_all_related_objects_with_model()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">get_all_related_many_to_many_objects()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">get_all_related_m2m_objects_with_model()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">get_concrete_fields_with_model()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">get_field_by_name()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">get_fields_with_model()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">get_m2m_with_model()</span></code></li>
</ul>
</div>
<div class="section" id="s-loading-cycle-and-firstof-template-tags-from-future-library">
<span id="loading-cycle-and-firstof-template-tags-from-future-library"></span><h3>加载 <code class="docutils literal notranslate"><span class="pre">cycle</span></code> 和 <code class="docutils literal notranslate"><span class="pre">firstof</span></code> 模板标签来自 <code class="docutils literal notranslate"><span class="pre">future</span></code> 库<a class="headerlink" href="#loading-cycle-and-firstof-template-tags-from-future-library" title="永久链接至标题">¶</a></h3>
<p>Django 1.6 引入了 <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">load</span> <span class="pre">cycle</span> <span class="pre">from</span> <span class="pre">future</span> <span class="pre">%}</span></code> 和 <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">load</span> <span class="pre">firstof</span> <span class="pre">from</span> <span class="pre">future</span> <span class="pre">%}</span></code> 语法，用于前向兼容 <a class="reference internal" href="../ref/templates/builtins.html#std-templatetag-cycle"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">cycle</span></code></a> 和 <a class="reference internal" href="../ref/templates/builtins.html#std-templatetag-firstof"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">firstof</span></code></a> 模板标签。此语法现已被弃用，并将在 Django 1.10 中移除。您可以简单地删除 <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">load</span> <span class="pre">...</span> <span class="pre">from</span> <span class="pre">future</span> <span class="pre">%}</span></code> 标签。</p>
</div>
<div class="section" id="s-django-conf-urls-patterns">
<span id="django-conf-urls-patterns"></span><h3><code class="docutils literal notranslate"><span class="pre">django.conf.urls.patterns()</span></code><a class="headerlink" href="#django-conf-urls-patterns" title="永久链接至标题">¶</a></h3>
<p>在早期的 Django 中，鼓励在 <code class="docutils literal notranslate"><span class="pre">urlpatterns</span></code> 中将视图引用为字符串：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span>
    <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s2">&quot;^$&quot;</span><span class="p">,</span> <span class="s2">&quot;myapp.views.myview&quot;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Django 会在内部神奇地导入 <code class="docutils literal notranslate"><span class="pre">myapp.views.myview</span></code> 并将字符串转换为真实的函数引用。为了减少在引用同一模块中的多个视图时的重复性，<code class="docutils literal notranslate"><span class="pre">patterns()</span></code> 函数接受一个必需的初始 <code class="docutils literal notranslate"><span class="pre">prefix</span></code> 参数，该参数会添加到该组 <code class="docutils literal notranslate"><span class="pre">urlpatterns</span></code> 中所有作为字符串的视图前面：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span>
    <span class="s2">&quot;myapp.views&quot;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s2">&quot;^$&quot;</span><span class="p">,</span> <span class="s2">&quot;myview&quot;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s2">&quot;^other/$&quot;</span><span class="p">,</span> <span class="s2">&quot;otherview&quot;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>在现代时代，我们已经更新了教程，建议导入您的视图模块并直接引用您的视图函数（或类）。这样做有很多优点，所有优点都源自于我们使用普通的 Python 代替“Django 字符串魔法”：当您拼写错误视图名称时的错误更不隐晦，集成开发环境可以帮助自动完成视图名称等等。</p>
<p>因此，现在更有可能以以下方式编写（也更好地编写）上述使用 <code class="docutils literal notranslate"><span class="pre">prefix</span></code> 参数的代码：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">myapp</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span>
    <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s2">&quot;^$&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">myview</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s2">&quot;^other/$&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">otherview</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>因此，<code class="docutils literal notranslate"><span class="pre">patterns()</span></code> 函数的作用很小，并且在教新用户时会造成困扰（回答新手的问题 &quot;为什么我需要将空字符串作为 <code class="docutils literal notranslate"><span class="pre">patterns()</span></code> 的第一个参数？&quot;）。出于这些原因，我们正在弃用它。更新您的代码非常简单，只需确保 <code class="docutils literal notranslate"><span class="pre">urlpatterns</span></code> 是 <code class="docutils literal notranslate"><span class="pre">django.conf.urls.url()</span></code> 实例的列表。例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">myapp</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s2">&quot;^$&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">myview</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s2">&quot;^other/$&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">otherview</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="s-passing-a-string-as-view-to-django-conf-urls-url">
<span id="passing-a-string-as-view-to-django-conf-urls-url"></span><h3>将字符串作为 <code class="docutils literal notranslate"><span class="pre">view</span></code> 传递给 <code class="docutils literal notranslate"><span class="pre">django.conf.urls.url()</span></code><a class="headerlink" href="#passing-a-string-as-view-to-django-conf-urls-url" title="永久链接至标题">¶</a></h3>
<p>与前面的项目相关，将视图作为字符串引用在 <code class="docutils literal notranslate"><span class="pre">url()</span></code> 函数中已被弃用。请按照前面的部分所描述的方式传递可调用的视图函数。</p>
</div>
<div class="section" id="s-template-related-settings">
<span id="template-related-settings"></span><h3>模板相关的设置<a class="headerlink" href="#template-related-settings" title="永久链接至标题">¶</a></h3>
<p>由于多个模板引擎的重构，一些设置已被弃用，建议使用 <a class="reference internal" href="../ref/settings.html#std-setting-TEMPLATES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">TEMPLATES</span></code></a> 代替：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">ALLOWED_INCLUDE_ROOTS</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TEMPLATE_CONTEXT_PROCESSORS</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TEMPLATE_DEBUG</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TEMPLATE_DIRS</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TEMPLATE_LOADERS</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TEMPLATE_STRING_IF_INVALID</span></code></li>
</ul>
</div>
<div class="section" id="s-django-core-context-processors">
<span id="django-core-context-processors"></span><h3><code class="docutils literal notranslate"><span class="pre">django.core.context_processors</span></code><a class="headerlink" href="#django-core-context-processors" title="永久链接至标题">¶</a></h3>
<p>内置模板上下文处理器已经移动到 <code class="docutils literal notranslate"><span class="pre">django.template.context_processors</span></code>。</p>
</div>
<div class="section" id="s-django-test-simpletestcase-urls">
<span id="django-test-simpletestcase-urls"></span><h3><code class="docutils literal notranslate"><span class="pre">django.test.SimpleTestCase.urls</span></code><a class="headerlink" href="#django-test-simpletestcase-urls" title="永久链接至标题">¶</a></h3>
<p>用于在测试中指定 URLconf 配置的属性 <code class="docutils literal notranslate"><span class="pre">SimpleTestCase.urls</span></code> 已被弃用，并将在 Django 1.10 中移除。请改用 <a class="reference internal" href="../topics/testing/tools.html#django.test.override_settings" title="django.test.override_settings"><code class="xref py py-func docutils literal notranslate"><span class="pre">&#64;override_settings(ROOT_URLCONF=...)</span></code></a>。</p>
</div>
<div class="section" id="s-prefix-argument-to-i18n-patterns">
<span id="prefix-argument-to-i18n-patterns"></span><h3><code class="docutils literal notranslate"><span class="pre">prefix</span></code> 参数用于 <a class="reference internal" href="../topics/i18n/translation.html#django.conf.urls.i18n.i18n_patterns" title="django.conf.urls.i18n.i18n_patterns"><code class="xref py py-func docutils literal notranslate"><span class="pre">i18n_patterns()</span></code></a> 函数。<a class="headerlink" href="#prefix-argument-to-i18n-patterns" title="永久链接至标题">¶</a></h3>
<p>与前面的项目相关，已弃用了 <a class="reference internal" href="../topics/i18n/translation.html#django.conf.urls.i18n.i18n_patterns" title="django.conf.urls.i18n.i18n_patterns"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.conf.urls.i18n.i18n_patterns()</span></code></a> 函数的 <code class="docutils literal notranslate"><span class="pre">prefix</span></code> 参数。只需传递一个 <code class="docutils literal notranslate"><span class="pre">django.conf.urls.url()</span></code> 实例的列表即可。</p>
</div>
<div class="section" id="s-using-an-incorrect-count-of-unpacked-values-in-the-for-template-tag">
<span id="using-an-incorrect-count-of-unpacked-values-in-the-for-template-tag"></span><h3>在 <a class="reference internal" href="../ref/templates/builtins.html#std-templatetag-for"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">for</span></code></a> 模板标签中使用错误的解包值数量<a class="headerlink" href="#using-an-incorrect-count-of-unpacked-values-in-the-for-template-tag" title="永久链接至标题">¶</a></h3>
<p>在 Django 1.10 中，在 <a class="reference internal" href="../ref/templates/builtins.html#std-templatetag-for"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">for</span></code></a> 标签中使用错误的解包值数量将引发异常，而不是静默失败。</p>
</div>
<div class="section" id="s-passing-a-dotted-path-to-reverse-and-url">
<span id="passing-a-dotted-path-to-reverse-and-url"></span><h3>传递点路径给 <code class="docutils literal notranslate"><span class="pre">reverse()</span></code> 和 <a class="reference internal" href="../ref/templates/builtins.html#std-templatetag-url"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">url</span></code></a><a class="headerlink" href="#passing-a-dotted-path-to-reverse-and-url" title="永久链接至标题">¶</a></h3>
<p>通过 Python 路径反向解析 URL 是一项昂贵的操作，因为它导致被反向解析的路径被导入。这种行为还导致了一个 <a class="reference external" href="https://www.djangoproject.com/weblog/2014/apr/21/security/#s-issue-unexpected-code-execution-using-reverse">security issue</a>。请改用 <a class="reference internal" href="../topics/http/urls.html#naming-url-patterns"><span class="std std-ref">命名的 URL 模式</span></a> 来进行反向解析。</p>
<p>如果您正在使用 <a class="reference internal" href="../ref/contrib/sitemaps.html#module-django.contrib.sitemaps" title="django.contrib.sitemaps: A framework for generating Google sitemap XML files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sitemaps</span></code></a>，请在引用 <a class="reference internal" href="../ref/contrib/sitemaps.html#django.contrib.sitemaps.views.sitemap" title="django.contrib.sitemaps.views.sitemap"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.contrib.sitemaps.views.sitemap()</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">url</span></code> 中添加 <code class="docutils literal notranslate"><span class="pre">name</span></code> 参数：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.sitemaps.views</span> <span class="kn">import</span> <span class="n">sitemap</span>

<span class="n">url</span><span class="p">(</span>
    <span class="sa">r</span><span class="s2">&quot;^sitemap\.xml$&quot;</span><span class="p">,</span>
    <span class="n">sitemap</span><span class="p">,</span>
    <span class="p">{</span><span class="s2">&quot;sitemaps&quot;</span><span class="p">:</span> <span class="n">sitemaps</span><span class="p">},</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;django.contrib.sitemaps.views.sitemap&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>为了确保在 Django 1.10 中移除通过 Python 路径进行反向解析时的兼容性。</p>
<p>同样对于 GIS 网站地图，添加 <code class="docutils literal notranslate"><span class="pre">name='django.contrib.gis.sitemaps.views.kml'</span></code> 或 <code class="docutils literal notranslate"><span class="pre">name='django.contrib.gis.sitemaps.views.kmz'</span></code>。</p>
<p>如果您正在为 <a class="reference internal" href="../ref/settings.html#std-setting-LOGIN_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOGIN_URL</span></code></a> 或 <a class="reference internal" href="../ref/settings.html#std-setting-LOGIN_REDIRECT_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOGIN_REDIRECT_URL</span></code></a> 设置使用 Python 路径，请改为使用 <code class="docutils literal notranslate"><span class="pre">url()</span></code> 的名称。</p>
</div>
<div class="section" id="s-aggregate-methods-and-modules">
<span id="aggregate-methods-and-modules"></span><h3>聚合方法和模块<a class="headerlink" href="#aggregate-methods-and-modules" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">django.db.models.sql.aggregates</span></code> 和 <code class="docutils literal notranslate"><span class="pre">django.contrib.gis.db.models.sql.aggregates</span></code> 模块（都是私有 API）已被弃用，因为 <code class="docutils literal notranslate"><span class="pre">django.db.models.aggregates</span></code> 和 <code class="docutils literal notranslate"><span class="pre">django.contrib.gis.db.models.aggregates</span></code> 现在也负责 SQL 生成。旧模块将在 Django 1.10 中移除。</p>
<p>如果您正在使用旧模块，请参阅 <a class="reference internal" href="../ref/models/expressions.html"><span class="doc">查询表达式</span></a>，以了解如何使用新的稳定 API 重写自定义聚合函数。</p>
<p>以下方法和属性已经被弃用，并且在 Django 1.10 中将移除与向后兼容的包装：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Query.aggregates</span></code>，已被替换为 <code class="docutils literal notranslate"><span class="pre">annotations</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">Query.aggregate_select</span></code>，已被替换为 <code class="docutils literal notranslate"><span class="pre">annotation_select</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">Query.add_aggregate()</span></code>，已被替换为 <code class="docutils literal notranslate"><span class="pre">add_annotation()</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">Query.set_aggregate_mask()</span></code>，已被替换为 <code class="docutils literal notranslate"><span class="pre">set_annotation_mask()</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">Query.append_aggregate_mask()</span></code>，已被替换为 <code class="docutils literal notranslate"><span class="pre">append_annotation_mask()</span></code>。</li>
</ul>
</div>
<div class="section" id="s-extending-management-command-arguments-through-command-option-list">
<span id="extending-management-command-arguments-through-command-option-list"></span><h3>通过 <code class="docutils literal notranslate"><span class="pre">Command.option_list</span></code> 扩展管理命令参数<a class="headerlink" href="#extending-management-command-arguments-through-command-option-list" title="永久链接至标题">¶</a></h3>
<p>管理命令现在使用 <a class="reference external" href="https://docs.python.org/3/library/argparse.html#module-argparse" title="(在 Python v3.12)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">argparse</span></code></a> 而不是 <a class="reference external" href="https://docs.python.org/3/library/optparse.html#module-optparse" title="(在 Python v3.12)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">optparse</span></code></a> 来解析传递给命令的命令行参数。这也意味着添加自定义参数到命令的方式已经改变：不再扩展 <code class="docutils literal notranslate"><span class="pre">option_list</span></code> 类列表，而是现在应该覆盖 <a class="reference internal" href="../howto/custom-management-commands.html#django.core.management.BaseCommand.add_arguments" title="django.core.management.BaseCommand.add_arguments"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_arguments()</span></code></a> 方法，并通过 <code class="docutils literal notranslate"><span class="pre">argparse.add_argument()</span></code> 添加参数。有关更多详细信息，请参阅 <a class="reference internal" href="../howto/custom-management-commands.html#custom-commands-options"><span class="std std-ref">此示例</span></a>。</p>
</div>
<div class="section" id="s-django-core-management-noargscommand">
<span id="django-core-management-noargscommand"></span><h3><code class="docutils literal notranslate"><span class="pre">django.core.management.NoArgsCommand</span></code><a class="headerlink" href="#django-core-management-noargscommand" title="永久链接至标题">¶</a></h3>
<p>类 <code class="docutils literal notranslate"><span class="pre">NoArgsCommand</span></code> 现已被弃用，将在 Django 1.10 中移除。请改用 <a class="reference internal" href="../howto/custom-management-commands.html#django.core.management.BaseCommand" title="django.core.management.BaseCommand"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseCommand</span></code></a>，默认情况下不接受参数。</p>
</div>
<div class="section" id="s-listing-all-migrations-in-a-project">
<span id="listing-all-migrations-in-a-project"></span><h3>列出项目中的所有迁移<a class="headerlink" href="#listing-all-migrations-in-a-project" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../ref/django-admin.html#django-admin-migrate"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">migrate</span></code></a> 管理命令的 <code class="docutils literal notranslate"><span class="pre">--list</span></code> 选项已被弃用，将在 Django 1.10 中移除。请改用 <a class="reference internal" href="../ref/django-admin.html#django-admin-showmigrations"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">showmigrations</span></code></a>。</p>
</div>
<div class="section" id="s-cache-choices-option-of-modelchoicefield-and-modelmultiplechoicefield">
<span id="cache-choices-option-of-modelchoicefield-and-modelmultiplechoicefield"></span><h3><code class="docutils literal notranslate"><span class="pre">ModelChoiceField</span></code> 和 <code class="docutils literal notranslate"><span class="pre">ModelMultipleChoiceField</span></code> 的 <code class="docutils literal notranslate"><span class="pre">cache_choices</span></code> 选项<a class="headerlink" href="#cache-choices-option-of-modelchoicefield-and-modelmultiplechoicefield" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../ref/forms/fields.html#django.forms.ModelChoiceField" title="django.forms.ModelChoiceField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelChoiceField</span></code></a> 和 <a class="reference internal" href="../ref/forms/fields.html#django.forms.ModelMultipleChoiceField" title="django.forms.ModelMultipleChoiceField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelMultipleChoiceField</span></code></a> 接受了一个未记录和未经测试的选项 <code class="docutils literal notranslate"><span class="pre">cache_choices</span></code>。该选项在同一 <code class="docutils literal notranslate"><span class="pre">Form</span></code> 对象的多次渲染之间缓存了查询集。该选项将加速弃用，并将在 Django 1.9 中移除。</p>
</div>
<div class="section" id="s-django-template-resolve-variable">
<span id="django-template-resolve-variable"></span><h3><code class="docutils literal notranslate"><span class="pre">django.template.resolve_variable()</span></code><a class="headerlink" href="#django-template-resolve-variable" title="永久链接至标题">¶</a></h3>
<p>这个函数已经在一段时间内非正式地标记为 &quot;弃用&quot;。请使用 <code class="docutils literal notranslate"><span class="pre">django.template.Variable(path).resolve(context)</span></code> 替代 <code class="docutils literal notranslate"><span class="pre">resolve_variable(path,</span> <span class="pre">context)</span></code>。</p>
</div>
<div class="section" id="s-django-contrib-webdesign">
<span id="django-contrib-webdesign"></span><h3><code class="docutils literal notranslate"><span class="pre">django.contrib.webdesign</span></code><a class="headerlink" href="#django-contrib-webdesign" title="永久链接至标题">¶</a></h3>
<p>它提供了 <a class="reference internal" href="../ref/templates/builtins.html#std-templatetag-lorem"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">lorem</span></code></a> 模板标签，现在已包含在内置标签中。只需从 <a class="reference internal" href="../ref/settings.html#std-setting-INSTALLED_APPS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code></a> 中移除 <code class="docutils literal notranslate"><span class="pre">'django.contrib.webdesign'</span></code>，并从您的模板中移除 <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">load</span> <span class="pre">webdesign</span> <span class="pre">%}</span></code>。</p>
</div>
<div class="section" id="s-error-message-argument-to-django-forms-regexfield">
<span id="error-message-argument-to-django-forms-regexfield"></span><h3><code class="docutils literal notranslate"><span class="pre">django.forms.RegexField</span></code> 的 <code class="docutils literal notranslate"><span class="pre">error_message</span></code> 参数已被弃用<a class="headerlink" href="#error-message-argument-to-django-forms-regexfield" title="永久链接至标题">¶</a></h3>
<p>它提供了对 1.0 版本之前的代码的向后兼容性，但其功能是多余的。请改用 <code class="docutils literal notranslate"><span class="pre">Field.error_messages['invalid']</span></code>。</p>
</div>
<div class="section" id="s-old-unordered-list-syntax">
<span id="old-unordered-list-syntax"></span><h3>旧的 <a class="reference internal" href="../ref/templates/builtins.html#std-templatefilter-unordered_list"><code class="xref std std-tfilter docutils literal notranslate"><span class="pre">unordered_list</span></code></a> 语法<a class="headerlink" href="#old-unordered-list-syntax" title="永久链接至标题">¶</a></h3>
<p>已弃用了 <a class="reference internal" href="../ref/templates/builtins.html#std-templatefilter-unordered_list"><code class="xref std std-tfilter docutils literal notranslate"><span class="pre">unordered_list</span></code></a> 模板过滤器的旧输入格式，这是一个较旧（1.0 版本之前）的、更受限制和冗长的格式：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s2">&quot;States&quot;</span><span class="p">,</span> <span class="p">[[</span><span class="s2">&quot;Kansas&quot;</span><span class="p">,</span> <span class="p">[[</span><span class="s2">&quot;Lawrence&quot;</span><span class="p">,</span> <span class="p">[]],</span> <span class="p">[</span><span class="s2">&quot;Topeka&quot;</span><span class="p">,</span> <span class="p">[]]]],</span> <span class="p">[</span><span class="s2">&quot;Illinois&quot;</span><span class="p">,</span> <span class="p">[]]]]</span>
</pre></div>
</div>
<p>使用新的语法，这将变为：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s2">&quot;States&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Kansas&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Lawrence&quot;</span><span class="p">,</span> <span class="s2">&quot;Topeka&quot;</span><span class="p">],</span> <span class="s2">&quot;Illinois&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="section" id="s-django-forms-field-has-changed">
<span id="django-forms-field-has-changed"></span><h3><code class="docutils literal notranslate"><span class="pre">django.forms.Field._has_changed()</span></code><a class="headerlink" href="#django-forms-field-has-changed" title="永久链接至标题">¶</a></h3>
<p>将这个方法的名称更改为 <a class="reference internal" href="../ref/forms/fields.html#django.forms.Field.has_changed" title="django.forms.Field.has_changed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_changed()</span></code></a>，删除前导的下划线。旧的名称将在 Django 1.10 之前仍然有效。</p>
</div>
<div class="section" id="s-django-utils-html-remove-tags-and-removetags-template-filter">
<span id="django-utils-html-remove-tags-and-removetags-template-filter"></span><h3><code class="docutils literal notranslate"><span class="pre">django.utils.html.remove_tags()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">removetags</span></code> 模板过滤器<a class="headerlink" href="#django-utils-html-remove-tags-and-removetags-template-filter" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">django.utils.html.remove_tags()</span></code> 以及模板过滤器 <code class="docutils literal notranslate"><span class="pre">removetags</span></code> 已被弃用，因为它们无法保证安全的输出。它们的存在可能会导致在安全敏感的上下文中使用它们，而实际上它们并不安全。</p>
<p>未使用且未记录的 <code class="docutils literal notranslate"><span class="pre">django.utils.html.strip_entities()</span></code> 函数也已被弃用。</p>
</div>
<div class="section" id="s-is-admin-site-argument-to-django-contrib-auth-views-password-reset">
<span id="is-admin-site-argument-to-django-contrib-auth-views-password-reset"></span><h3><code class="docutils literal notranslate"><span class="pre">django.contrib.auth.views.password_reset()</span></code> 的 <code class="docutils literal notranslate"><span class="pre">is_admin_site</span></code> 参数<a class="headerlink" href="#is-admin-site-argument-to-django-contrib-auth-views-password-reset" title="永久链接至标题">¶</a></h3>
<p>这是一个遗留选项，应该不再需要。</p>
</div>
<div class="section" id="s-subfieldbase">
<span id="subfieldbase"></span><h3><code class="docutils literal notranslate"><span class="pre">SubfieldBase</span></code><a class="headerlink" href="#subfieldbase" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">django.db.models.fields.subclassing.SubfieldBase</span></code> 已被弃用，并将在 Django 1.10 中删除。从历史上看，它用于处理需要在从数据库加载时进行类型转换的字段，但在 <code class="docutils literal notranslate"><span class="pre">.values()</span></code> 调用或聚合中不使用。它已被 <a class="reference internal" href="../ref/models/fields.html#django.db.models.Field.from_db_value" title="django.db.models.Field.from_db_value"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_db_value()</span></code></a> 替代。</p>
<p>新的方法在赋值时不会调用 <a class="reference internal" href="../ref/models/fields.html#django.db.models.Field.to_python" title="django.db.models.Field.to_python"><code class="xref py py-meth docutils literal notranslate"><span class="pre">to_python()</span></code></a> 方法，就像 <code class="docutils literal notranslate"><span class="pre">SubfieldBase</span></code> 的情况一样。如果你需要这个行为，请在你的项目中重新实现 <code class="docutils literal notranslate"><span class="pre">Creator</span></code> 类，可以从 Django 的源代码中获取 <a class="reference external" href="https://github.com/django/django/blob/stable/1.8.x/django/db/models/fields/subclassing.py#L31-L44">链接</a>。</p>
</div>
<div class="section" id="s-django-utils-checksums">
<span id="django-utils-checksums"></span><h3><code class="docutils literal notranslate"><span class="pre">django.utils.checksums</span></code><a class="headerlink" href="#django-utils-checksums" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">django.utils.checksums</span></code> 模块已被弃用，并将在 Django 1.10 中删除。它提供的功能（使用 Luhn 算法验证校验和）未经文档化，并且在 Django 中未被使用。该模块已被移动到 <a class="reference external" href="https://pypi.org/project/django-localflavor/">django-localflavor</a> 包中（版本 1.1+）。</p>
</div>
<div class="section" id="s-inlineadminform-original-content-type-id">
<span id="inlineadminform-original-content-type-id"></span><h3><code class="docutils literal notranslate"><span class="pre">InlineAdminForm.original_content_type_id</span></code><a class="headerlink" href="#inlineadminform-original-content-type-id" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">InlineAdminForm</span></code> 上的 <code class="docutils literal notranslate"><span class="pre">original_content_type_id</span></code> 属性已被弃用，并将在 Django 1.10 中删除。从历史上看，它用于构建“查看网站上的内容” URL。现在可以使用表单的 <code class="docutils literal notranslate"><span class="pre">absolute_url</span></code> 属性访问此 URL。</p>
</div>
<div class="section" id="s-django-views-generic-edit-formmixin-get-form-s-form-class-argument">
<span id="django-views-generic-edit-formmixin-get-form-s-form-class-argument"></span><h3><code class="docutils literal notranslate"><span class="pre">django.views.generic.edit.FormMixin.get_form()</span></code> 方法的 <code class="docutils literal notranslate"><span class="pre">form_class</span></code> 参数<a class="headerlink" href="#django-views-generic-edit-formmixin-get-form-s-form-class-argument" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">FormMixin</span></code> 的子类在重写 <code class="docutils literal notranslate"><span class="pre">get_form()</span></code> 方法时，应确保为 <code class="docutils literal notranslate"><span class="pre">form_class</span></code> 参数提供默认值，因为它现在是可选的。</p>
</div>
<div class="section" id="s-rendering-templates-loaded-by-get-template-with-a-context">
<span id="rendering-templates-loaded-by-get-template-with-a-context"></span><h3>使用 <a class="reference internal" href="../topics/templates.html#django.template.loader.get_template" title="django.template.loader.get_template"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_template()</span></code></a> 加载的模板进行渲染，需要使用 <a class="reference internal" href="../ref/templates/api.html#django.template.Context" title="django.template.Context"><code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span></code></a>。<a class="headerlink" href="#rendering-templates-loaded-by-get-template-with-a-context" title="永久链接至标题">¶</a></h3>
<p>在 Django 1.8 中，<a class="reference internal" href="../topics/templates.html#django.template.loader.get_template" title="django.template.loader.get_template"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_template()</span></code></a> 的返回类型已更改：不再返回 <a class="reference internal" href="../ref/templates/api.html#django.template.Template" title="django.template.Template"><code class="xref py py-class docutils literal notranslate"><span class="pre">django.template.Template</span></code></a>，而是返回一个 <code class="docutils literal notranslate"><span class="pre">Template</span></code> 实例，其确切类型取决于加载它的后端。</p>
<p>这两个类都提供了一个 <code class="docutils literal notranslate"><span class="pre">render()</span></code> 方法，然而，前者接受一个 <a class="reference internal" href="../ref/templates/api.html#django.template.Context" title="django.template.Context"><code class="xref py py-class docutils literal notranslate"><span class="pre">django.template.Context</span></code></a> 作为参数，而后者期望一个 <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>。这个更改是通过 Django 模板的弃用路径来强制执行的。</p>
<p>所有这些也适用于 <a class="reference internal" href="../topics/templates.html#django.template.loader.select_template" title="django.template.loader.select_template"><code class="xref py py-func docutils literal notranslate"><span class="pre">select_template()</span></code></a>。</p>
</div>
<div class="section" id="s-template-and-context-classes-in-template-responses">
<span id="template-and-context-classes-in-template-responses"></span><h3>在模板响应中使用 <a class="reference internal" href="../ref/templates/api.html#django.template.Template" title="django.template.Template"><code class="xref py py-class docutils literal notranslate"><span class="pre">Template</span></code></a> 和 <a class="reference internal" href="../ref/templates/api.html#django.template.Context" title="django.template.Context"><code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span></code></a> 类。<a class="headerlink" href="#template-and-context-classes-in-template-responses" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../ref/template-response.html#django.template.response.SimpleTemplateResponse" title="django.template.response.SimpleTemplateResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleTemplateResponse</span></code></a> 和 <a class="reference internal" href="../ref/template-response.html#django.template.response.TemplateResponse" title="django.template.response.TemplateResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">TemplateResponse</span></code></a> 的一些方法以前接受 <a class="reference internal" href="../ref/templates/api.html#django.template.Context" title="django.template.Context"><code class="xref py py-class docutils literal notranslate"><span class="pre">django.template.Context</span></code></a> 和 <a class="reference internal" href="../ref/templates/api.html#django.template.Template" title="django.template.Template"><code class="xref py py-class docutils literal notranslate"><span class="pre">django.template.Template</span></code></a> 对象作为参数。现在它们应该分别接收 <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> 和依赖于后端的模板对象。</p>
<p>如果您已经对模板响应类进行了子类化，这也适用于返回类型。</p>
<p>请查看 <a class="reference internal" href="../ref/template-response.html"><span class="doc">模板响应 API 文档</span></a> 获取详细信息。</p>
</div>
<div class="section" id="s-current-app-argument-of-template-related-apis">
<span id="current-app-argument-of-template-related-apis"></span><h3>与模板相关的 API 中的 <code class="docutils literal notranslate"><span class="pre">current_app</span></code> 参数<a class="headerlink" href="#current-app-argument-of-template-related-apis" title="永久链接至标题">¶</a></h3>
<p>以下函数和类将不再接受 <code class="docutils literal notranslate"><span class="pre">current_app</span></code> 参数来设置 Django 1.10 中的 URL 命名空间：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">django.shortcuts.render()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.template.Context()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.template.RequestContext()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.template.response.TemplateResponse()</span></code></li>
</ul>
<p>请设置 <code class="docutils literal notranslate"><span class="pre">request.current_app</span></code>，其中 <code class="docutils literal notranslate"><span class="pre">request</span></code> 是这些函数或类的第一个参数。如果你使用一个普通的 <code class="docutils literal notranslate"><span class="pre">Context</span></code>，请改用 <code class="docutils literal notranslate"><span class="pre">RequestContext</span></code>。</p>
</div>
<div class="section" id="s-dictionary-and-context-instance-arguments-of-rendering-functions">
<span id="dictionary-and-context-instance-arguments-of-rendering-functions"></span><h3>渲染函数的 <code class="docutils literal notranslate"><span class="pre">dictionary</span></code> 和 <code class="docutils literal notranslate"><span class="pre">context_instance</span></code> 参数<a class="headerlink" href="#dictionary-and-context-instance-arguments-of-rendering-functions" title="永久链接至标题">¶</a></h3>
<p>在 Django 1.10 中，以下函数将不再接受 <code class="docutils literal notranslate"><span class="pre">dictionary</span></code> 和 <code class="docutils literal notranslate"><span class="pre">context_instance</span></code> 参数：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">django.shortcuts.render()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.shortcuts.render_to_response()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.template.loader.render_to_string()</span></code></li>
</ul>
<p>请改用 <code class="docutils literal notranslate"><span class="pre">context</span></code> 参数。当 <code class="docutils literal notranslate"><span class="pre">dictionary</span></code> 作为位置参数传递时，这是最常见的用法，无需进行更改。</p>
<p>如果在 <code class="docutils literal notranslate"><span class="pre">context_instance</span></code> 中传递了 <a class="reference internal" href="../ref/templates/api.html#django.template.Context" title="django.template.Context"><code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span></code></a>，请在 <code class="docutils literal notranslate"><span class="pre">context</span></code> 参数中传递一个 <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>。如果传递了 <a class="reference internal" href="../ref/templates/api.html#django.template.RequestContext" title="django.template.RequestContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestContext</span></code></a>，请在 <code class="docutils literal notranslate"><span class="pre">request</span></code> 参数中单独传递请求。</p>
</div>
<div class="section" id="s-dirs-argument-of-template-finding-functions">
<span id="dirs-argument-of-template-finding-functions"></span><h3>模板查找函数的 <code class="docutils literal notranslate"><span class="pre">dirs</span></code> 参数<a class="headerlink" href="#dirs-argument-of-template-finding-functions" title="永久链接至标题">¶</a></h3>
<p>在 Django 1.10 中，以下函数将不再接受 <code class="docutils literal notranslate"><span class="pre">dirs</span></code> 参数来覆盖 <code class="docutils literal notranslate"><span class="pre">TEMPLATE_DIRS</span></code>：</p>
<ul class="simple">
<li><a class="reference internal" href="../topics/templates.html#django.template.loader.get_template" title="django.template.loader.get_template"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.template.loader.get_template()</span></code></a></li>
<li><a class="reference internal" href="../topics/templates.html#django.template.loader.select_template" title="django.template.loader.select_template"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.template.loader.select_template()</span></code></a></li>
<li><a class="reference internal" href="../topics/http/shortcuts.html#django.shortcuts.render" title="django.shortcuts.render"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.shortcuts.render()</span></code></a></li>
<li><code class="docutils literal notranslate"><span class="pre">django.shortcuts.render_to_response()</span></code></li>
</ul>
<p>该参数在不同的模板加载器之间不一致，并且在包含的模板中无法正常工作。</p>
</div>
<div class="section" id="s-django-template-loader-baseloader">
<span id="django-template-loader-baseloader"></span><h3><code class="docutils literal notranslate"><span class="pre">django.template.loader.BaseLoader</span></code><a class="headerlink" href="#django-template-loader-baseloader" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">django.template.loader.BaseLoader</span></code> 已更名为 <code class="docutils literal notranslate"><span class="pre">django.template.loaders.base.Loader</span></code>。如果您编写了一个自定义的模板加载器，继承自 <code class="docutils literal notranslate"><span class="pre">BaseLoader</span></code>，那么您必须改为继承 <code class="docutils literal notranslate"><span class="pre">Loader</span></code>。</p>
</div>
<div class="section" id="s-django-test-utils-testtemplateloader">
<span id="django-test-utils-testtemplateloader"></span><h3><code class="docutils literal notranslate"><span class="pre">django.test.utils.TestTemplateLoader</span></code><a class="headerlink" href="#django-test-utils-testtemplateloader" title="永久链接至标题">¶</a></h3>
<p>私有 API <code class="docutils literal notranslate"><span class="pre">django.test.utils.TestTemplateLoader</span></code> 已弃用，推荐使用 <code class="docutils literal notranslate"><span class="pre">django.template.loaders.locmem.Loader</span></code>，将在 Django 1.9 中移除。</p>
</div>
<div class="section" id="s-support-for-the-max-length-argument-on-custom-storage-classes">
<span id="s-storage-max-length-update"></span><span id="support-for-the-max-length-argument-on-custom-storage-classes"></span><span id="storage-max-length-update"></span><h3>自定义 <code class="docutils literal notranslate"><span class="pre">Storage</span></code> 类上 <code class="docutils literal notranslate"><span class="pre">max_length</span></code> 参数的支持<a class="headerlink" href="#support-for-the-max-length-argument-on-custom-storage-classes" title="永久链接至标题">¶</a></h3>
<p>如果自定义的 <code class="docutils literal notranslate"><span class="pre">Storage</span></code> 子类重写了 <a class="reference internal" href="../ref/files/storage.html#django.core.files.storage.Storage.get_available_name" title="django.core.files.storage.Storage.get_available_name"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_available_name()</span></code></a> 和/或 <a class="reference internal" href="../ref/files/storage.html#django.core.files.storage.Storage.save" title="django.core.files.storage.Storage.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code></a> 方法，应该将 <code class="docutils literal notranslate"><span class="pre">max_length=None</span></code> 添加为参数。不接受这个参数的存储支持将在 Django 1.10 中移除。</p>
</div>
<div class="section" id="s-qn-replaced-by-compiler">
<span id="qn-replaced-by-compiler"></span><h3><code class="docutils literal notranslate"><span class="pre">qn</span></code> 被替换为 <code class="docutils literal notranslate"><span class="pre">compiler</span></code><a class="headerlink" href="#qn-replaced-by-compiler" title="永久链接至标题">¶</a></h3>
<p>在以前的 Django 版本中，各种内部的 ORM 方法（主要是 <code class="docutils literal notranslate"><span class="pre">as_sql</span></code> 方法）接受一个名为 <code class="docutils literal notranslate"><span class="pre">qn</span></code> （代表 &quot;quote name&quot;）的参数，它是一个引用了一个函数来为发送到数据库的标识符加引号的参数。在 Django 1.8 中，这个参数已被重命名为 <code class="docutils literal notranslate"><span class="pre">compiler</span></code>，并且现在是一个完整的 <code class="docutils literal notranslate"><span class="pre">SQLCompiler</span></code> 实例。为了向后兼容，调用一个 <code class="docutils literal notranslate"><span class="pre">SQLCompiler</span></code> 实例执行与之前 <code class="docutils literal notranslate"><span class="pre">qn</span></code> 函数相同的名称引用操作。然而，这个向后兼容性的支持被立即弃用：您应该将您的 <code class="docutils literal notranslate"><span class="pre">qn</span></code> 参数重命名为 <code class="docutils literal notranslate"><span class="pre">compiler</span></code>，并在以前调用 <code class="docutils literal notranslate"><span class="pre">qn(...)</span></code> 的地方改为调用 <code class="docutils literal notranslate"><span class="pre">compiler.quote_name_unless_alias(...)</span></code>。</p>
</div>
<div class="section" id="s-default-value-of-redirectview-permanent">
<span id="default-value-of-redirectview-permanent"></span><h3><code class="docutils literal notranslate"><span class="pre">RedirectView.permanent</span></code> 的默认值<a class="headerlink" href="#default-value-of-redirectview-permanent" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../ref/class-based-views/base.html#django.views.generic.base.RedirectView.permanent" title="django.views.generic.base.RedirectView.permanent"><code class="xref py py-attr docutils literal notranslate"><span class="pre">RedirectView.permanent</span></code></a> 属性的默认值将在 Django 1.9 中从 <code class="docutils literal notranslate"><span class="pre">True</span></code> 更改为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。</p>
</div>
<div class="section" id="s-using-authenticationmiddleware-without-sessionauthenticationmiddleware">
<span id="using-authenticationmiddleware-without-sessionauthenticationmiddleware"></span><h3>在没有使用 <code class="docutils literal notranslate"><span class="pre">SessionAuthenticationMiddleware</span></code> 的情况下使用 <code class="docutils literal notranslate"><span class="pre">AuthenticationMiddleware</span></code>。<a class="headerlink" href="#using-authenticationmiddleware-without-sessionauthenticationmiddleware" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">django.contrib.auth.middleware.SessionAuthenticationMiddleware</span></code> 是在 Django 1.7 中添加的。在 Django 1.7.2 中，它的功能被移动到了 <code class="docutils literal notranslate"><span class="pre">auth.get_user()</span></code> 中，并且为了向后兼容，只有在 <code class="docutils literal notranslate"><span class="pre">MIDDLEWARE_CLASSES</span></code> 中出现 <code class="docutils literal notranslate"><span class="pre">'django.contrib.auth.middleware.SessionAuthenticationMiddleware'</span></code> 才会启用它。</p>
<p>在 Django 1.10 中，无论是否启用 <code class="docutils literal notranslate"><span class="pre">SessionAuthenticationMiddleware</span></code>，会启用会话验证（此时 <code class="docutils literal notranslate"><span class="pre">SessionAuthenticationMiddleware</span></code> 将不再具有重要意义）。您可以在那之前的某个时候将其添加到您的 <code class="docutils literal notranslate"><span class="pre">MIDDLEWARE_CLASSES</span></code> 中以选择启用它。请首先阅读 <a class="reference internal" href="../topics/auth/default.html#session-invalidation-on-password-change"><span class="std std-ref">升级注意事项</span></a>。</p>
</div>
<div class="section" id="s-django-contrib-sitemaps-flatpagesitemap">
<span id="django-contrib-sitemaps-flatpagesitemap"></span><h3><code class="docutils literal notranslate"><span class="pre">django.contrib.sitemaps.FlatPageSitemap</span></code><a class="headerlink" href="#django-contrib-sitemaps-flatpagesitemap" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">django.contrib.sitemaps.FlatPageSitemap</span></code> 已经移动到 <code class="docutils literal notranslate"><span class="pre">django.contrib.flatpages.sitemaps.FlatPageSitemap</span></code>。旧的导入位置已被弃用，并将在 Django 1.9 中移除。</p>
</div>
<div class="section" id="s-model-field-related">
<span id="model-field-related"></span><h3>模型 <code class="docutils literal notranslate"><span class="pre">Field.related</span></code><a class="headerlink" href="#model-field-related" title="永久链接至标题">¶</a></h3>
<p>私有属性 <code class="docutils literal notranslate"><span class="pre">django.db.models.Field.related</span></code> 已被弃用，建议使用 <code class="docutils literal notranslate"><span class="pre">Field.rel</span></code>。后者是 <code class="docutils literal notranslate"><span class="pre">django.db.models.fields.related.ForeignObjectRel</span></code> 的一个实例，它替代了 <code class="docutils literal notranslate"><span class="pre">django.db.models.related.RelatedObject</span></code>。<code class="docutils literal notranslate"><span class="pre">django.db.models.related</span></code> 模块已被移除，<code class="docutils literal notranslate"><span class="pre">Field.related</span></code> 属性将在 Django 1.10 中移除。</p>
</div>
<div class="section" id="s-ssi-template-tag">
<span id="ssi-template-tag"></span><h3><code class="docutils literal notranslate"><span class="pre">ssi</span></code> 模板标签<a class="headerlink" href="#ssi-template-tag" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ssi</span></code> 模板标签允许通过绝对路径将文件包含到模板中。在大多数部署情况下，这具有有限的用途，通常更有意义的是使用 <a class="reference internal" href="../ref/templates/builtins.html#std-templatetag-include"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">include</span></code></a> 标签。此标签现在已被弃用，并将在 Django 1.10 中移除。</p>
</div>
<div class="section" id="s-as-comparison-operator-in-if-template-tag">
<span id="as-comparison-operator-in-if-template-tag"></span><h3><code class="docutils literal notranslate"><span class="pre">if</span></code> 模板标签中的比较运算符 <code class="docutils literal notranslate"><span class="pre">=</span></code> 已被弃用<a class="headerlink" href="#as-comparison-operator-in-if-template-tag" title="永久链接至标题">¶</a></h3>
<p>在 <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">if</span> <span class="pre">%}</span></code> 模板标签中使用单个等号进行相等性测试是未记录和未经测试的。现在已弃用，建议使用 <code class="docutils literal notranslate"><span class="pre">==</span></code>。</p>
</div>
<div class="section" id="s-foo-s-syntax-in-modelformmixin-success-url">
<span id="foo-s-syntax-in-modelformmixin-success-url"></span><h3>在 <code class="docutils literal notranslate"><span class="pre">ModelFormMixin.success_url</span></code> 中使用的 <code class="docutils literal notranslate"><span class="pre">%(&lt;foo&gt;)s</span></code> 语法已被弃用<a class="headerlink" href="#foo-s-syntax-in-modelformmixin-success-url" title="永久链接至标题">¶</a></h3>
<p>在 <a class="reference internal" href="../ref/class-based-views/mixins-editing.html#django.views.generic.edit.ModelFormMixin.success_url" title="django.views.generic.edit.ModelFormMixin.success_url"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ModelFormMixin.success_url</span></code></a> 中的遗留 <code class="docutils literal notranslate"><span class="pre">%(&lt;foo&gt;)s</span></code> 语法已被弃用，并将在 Django 1.10 中移除。</p>
</div>
<div class="section" id="s-geoqueryset-aggregate-methods">
<span id="geoqueryset-aggregate-methods"></span><h3><code class="docutils literal notranslate"><span class="pre">GeoQuerySet</span></code> 聚合方法<a class="headerlink" href="#geoqueryset-aggregate-methods" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">collect()</span></code>, <code class="docutils literal notranslate"><span class="pre">extent()</span></code>, <code class="docutils literal notranslate"><span class="pre">extent3d()</span></code>, <code class="docutils literal notranslate"><span class="pre">make_line()</span></code>, 和 <code class="docutils literal notranslate"><span class="pre">unionagg()</span></code> 聚合方法已被弃用，应该用它们的基于函数的聚合等效方法（<code class="docutils literal notranslate"><span class="pre">Collect</span></code>、<code class="docutils literal notranslate"><span class="pre">Extent</span></code>、<code class="docutils literal notranslate"><span class="pre">Extent3D</span></code>、<code class="docutils literal notranslate"><span class="pre">MakeLine</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Union</span></code>）来替代。</p>
</div>
<div class="section" id="s-signature-of-the-allow-migrate-router-method">
<span id="s-deprecated-signature-of-allow-migrate"></span><span id="signature-of-the-allow-migrate-router-method"></span><span id="deprecated-signature-of-allow-migrate"></span><h3><code class="docutils literal notranslate"><span class="pre">allow_migrate</span></code> 路由方法的签名<a class="headerlink" href="#signature-of-the-allow-migrate-router-method" title="永久链接至标题">¶</a></h3>
<p>数据库路由器的 <a class="reference internal" href="../topics/db/multi-db.html#allow_migrate" title="allow_migrate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">allow_migrate()</span></code></a> 方法的签名已从 <code class="docutils literal notranslate"><span class="pre">allow_migrate(db,</span> <span class="pre">model)</span></code> 更改为 <code class="docutils literal notranslate"><span class="pre">allow_migrate(db,</span> <span class="pre">app_label,</span> <span class="pre">model_name=None,</span> <span class="pre">**hints)</span></code>。</p>
<p>当设置了 <code class="docutils literal notranslate"><span class="pre">model_name</span></code> 时，之前通过 <code class="docutils literal notranslate"><span class="pre">model</span></code> 位置参数传递的值现在可以在 <code class="docutils literal notranslate"><span class="pre">hints</span></code> 字典中的键 <code class="docutils literal notranslate"><span class="pre">'model'</span></code> 下找到。</p>
<p>在切换到新签名后，路由器还将被 <a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.RunPython" title="django.db.migrations.operations.RunPython"><code class="xref py py-class docutils literal notranslate"><span class="pre">RunPython</span></code></a> 和 <a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.RunSQL" title="django.db.migrations.operations.RunSQL"><code class="xref py py-class docutils literal notranslate"><span class="pre">RunSQL</span></code></a> 操作调用。</p>
</div>
</div>
<div class="section" id="s-features-removed-in-1-8">
<span id="s-removed-features-1-8"></span><span id="features-removed-in-1-8"></span><span id="removed-features-1-8"></span><h2>在 1.8 版本中移除的功能<a class="headerlink" href="#features-removed-in-1-8" title="永久链接至标题">¶</a></h2>
<p>这些特性已经到达了它们的弃用周期的尽头，并在 Django 1.8 中被移除。有关详细信息，包括如何删除对这些特性的使用，请参阅 <a class="reference internal" href="1.6.html#deprecated-features-1-6"><span class="std std-ref">在 1.6 中被废弃的功能</span></a>。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.comments</span></code> 已被移除。</li>
<li>以下事务管理 API 已被移除：<ul>
<li><code class="docutils literal notranslate"><span class="pre">TransactionMiddleware</span></code></li>
<li>在 <code class="docutils literal notranslate"><span class="pre">django.db.transaction</span></code> 中定义的装饰器和上下文管理器 <code class="docutils literal notranslate"><span class="pre">autocommit</span></code>, <code class="docutils literal notranslate"><span class="pre">commit_on_success</span></code>, 和 <code class="docutils literal notranslate"><span class="pre">commit_manually</span></code> 已被移除。</li>
<li>在 <code class="docutils literal notranslate"><span class="pre">django.db.transaction</span></code> 中定义的函数 <code class="docutils literal notranslate"><span class="pre">commit_unless_managed</span></code> 和 <code class="docutils literal notranslate"><span class="pre">rollback_unless_managed</span></code> 也已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">TRANSACTIONS_MANAGED</span></code> 设置</li>
</ul>
</li>
<li><a class="reference internal" href="../ref/templates/builtins.html#std-templatetag-cycle"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">cycle</span></code></a> 和 <a class="reference internal" href="../ref/templates/builtins.html#std-templatetag-firstof"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">firstof</span></code></a> 模板标签会自动转义其参数。</li>
<li><code class="docutils literal notranslate"><span class="pre">SEND_BROKEN_LINK_EMAILS</span></code> 设置已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.middleware.doc.XViewMiddleware</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">Model._meta.module_name</span></code> 别名已被移除。</li>
<li>已经移除了为了重命名 <code class="docutils literal notranslate"><span class="pre">get_query_set</span></code> 和类似的查询集方法而引入的向后兼容的包装。这会影响以下类：<code class="docutils literal notranslate"><span class="pre">BaseModelAdmin</span></code>、<code class="docutils literal notranslate"><span class="pre">ChangeList</span></code>、<code class="docutils literal notranslate"><span class="pre">BaseCommentNode</span></code>、<code class="docutils literal notranslate"><span class="pre">GenericForeignKey</span></code>、<code class="docutils literal notranslate"><span class="pre">Manager</span></code>、<code class="docutils literal notranslate"><span class="pre">SingleRelatedObjectDescriptor</span></code> 和 <code class="docutils literal notranslate"><span class="pre">ReverseSingleRelatedObjectDescriptor</span></code>。</li>
<li>已经移除了为了重命名属性 <code class="docutils literal notranslate"><span class="pre">ChangeList.root_query_set</span></code> 和 <code class="docutils literal notranslate"><span class="pre">ChangeList.query_set</span></code> 而引入的向后兼容的包装。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.views.defaults.shortcut</span></code> 和 <code class="docutils literal notranslate"><span class="pre">django.conf.urls.shortcut</span></code> 已被移除。</li>
<li>不再支持 Python Imaging Library (PIL) 模块。</li>
<li>以下私有 API 已被移除：<ul>
<li><code class="docutils literal notranslate"><span class="pre">django.db.backend</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.db.close_connection()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.db.backends.creation.BaseDatabaseCreation.set_autocommit()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.db.transaction.is_managed()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.db.transaction.managed()</span></code></li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">django.forms.widgets.RadioInput</span></code> 已被移除。</li>
<li>模块 <code class="docutils literal notranslate"><span class="pre">django.test.simple</span></code> 和类 <code class="docutils literal notranslate"><span class="pre">django.test.simple.DjangoTestSuiteRunner</span></code> 已被移除。</li>
<li>模块 <code class="docutils literal notranslate"><span class="pre">django.test._doctest</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">CACHE_MIDDLEWARE_ANONYMOUS_ONLY</span></code> 设置已被移除。这个改变影响了 <code class="docutils literal notranslate"><span class="pre">django.middleware.cache.CacheMiddleware</span></code> 和 <code class="docutils literal notranslate"><span class="pre">django.middleware.cache.UpdateCacheMiddleware</span></code>，尽管在后者类中没有弃用警告。</li>
<li>Django 不再在模型或表单层面使用硬编码的字符串 <em>Hold down &quot;Control&quot;, or &quot;Command&quot; on a Mac, to select more than one.</em> 来覆盖或附加到用户提供的 <code class="docutils literal notranslate"><span class="pre">ManyToMany</span></code> 模型字段的 <code class="docutils literal notranslate"><span class="pre">help_text</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">Model._meta.get_(add|change|delete)_permission</span></code> 方法已被移除。</li>
<li>不再读取会话键 <code class="docutils literal notranslate"><span class="pre">django_language</span></code> 以保持向后兼容性。</li>
<li>地理位置 Sitemaps 已被移除（<code class="docutils literal notranslate"><span class="pre">django.contrib.gis.sitemaps.views.index</span></code> 和 <code class="docutils literal notranslate"><span class="pre">django.contrib.gis.sitemaps.views.sitemap</span></code>）。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.html.fix_ampersands</span></code>、<code class="docutils literal notranslate"><span class="pre">fix_ampersands</span></code> 模板过滤器以及 <code class="docutils literal notranslate"><span class="pre">django.utils.html.clean_html</span></code> 都已被移除。</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../contents.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">Django 1.8 版本发行说明</a><ul>
<li><a class="reference internal" href="#python-compatibility">Python 兼容性</a></li>
<li><a class="reference internal" href="#what-s-new-in-django-1-8">Django 1.8 的新特性</a><ul>
<li><a class="reference internal" href="#model-meta-api"><code class="docutils literal notranslate"><span class="pre">Model._meta</span></code> API</a></li>
<li><a class="reference internal" href="#multiple-template-engines">多模板引擎</a></li>
<li><a class="reference internal" href="#security-enhancements">安全增强</a></li>
<li><a class="reference internal" href="#new-postgresql-specific-functionality">新的 PostgreSQL 特有功能</a></li>
<li><a class="reference internal" href="#new-data-types">新的数据类型</a></li>
<li><a class="reference internal" href="#query-expressions-conditional-expressions-and-database-functions">查询表达式、条件表达式和数据库函数</a></li>
<li><a class="reference internal" href="#testcase-data-setup"><code class="docutils literal notranslate"><span class="pre">TestCase</span></code> 数据设置</a></li>
<li><a class="reference internal" href="#minor-features">次要特性</a><ul>
<li><a class="reference internal" href="#django-contrib-admin"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-admindocs"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admindocs</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-auth"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-gis"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-sessions"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sessions</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-sitemaps"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sitemaps</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-sites"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sites</span></code></a></li>
<li><a class="reference internal" href="#cache">缓存</a></li>
<li><a class="reference internal" href="#cryptography">密码学</a></li>
<li><a class="reference internal" href="#database-backends">数据库后端</a></li>
<li><a class="reference internal" href="#email">电子邮件</a></li>
<li><a class="reference internal" href="#file-storage">文件存储</a></li>
<li><a class="reference internal" href="#forms">表单</a></li>
<li><a class="reference internal" href="#generic-views">通用视图</a></li>
<li><a class="reference internal" href="#internationalization">国际化</a></li>
<li><a class="reference internal" href="#logging">日志</a></li>
<li><a class="reference internal" href="#management-commands">管理命令</a></li>
<li><a class="reference internal" href="#middleware">中间件</a></li>
<li><a class="reference internal" href="#migrations">迁移</a></li>
<li><a class="reference internal" href="#models">模型</a></li>
<li><a class="reference internal" href="#signals">信号</a></li>
<li><a class="reference internal" href="#system-check-framework">系统检查框架</a></li>
<li><a class="reference internal" href="#templates">模板</a></li>
<li><a class="reference internal" href="#requests-and-responses">请求和响应</a></li>
<li><a class="reference internal" href="#tests">测试</a></li>
<li><a class="reference internal" href="#validators">验证器</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-incompatible-changes-in-1-8">1.8 版本中的向后不兼容的更改</a><ul>
<li><a class="reference internal" href="#related-object-operations-are-run-in-a-transaction">相关对象操作在事务中执行</a></li>
<li><a class="reference internal" href="#assigning-unsaved-objects-to-relations-raises-an-error">将未保存的对象分配给关系会引发错误。</a></li>
<li><a class="reference internal" href="#management-commands-that-only-accept-positional-arguments">仅接受位置参数的管理命令</a></li>
<li><a class="reference internal" href="#custom-test-management-command-arguments-through-test-runner">通过测试运行器对自定义测试管理命令的参数进行设置</a></li>
<li><a class="reference internal" href="#model-check-ensures-auto-generated-column-names-are-within-limits-specified-by-database">模型检查确保自动生成的列名在数据库指定的限制范围内</a></li>
<li><a class="reference internal" href="#query-relation-lookups-now-check-object-types">现在查询关系查找会检查对象类型</a></li>
<li><a class="reference internal" href="#select-related-now-checks-given-fields"><code class="docutils literal notranslate"><span class="pre">select_related()</span></code> 现在会检查给定的字段。</a></li>
<li><a class="reference internal" href="#default-emailfield-max-length-increased-to-254">默认的 <code class="docutils literal notranslate"><span class="pre">EmailField.max_length</span></code> 增加到了 254。</a></li>
<li><a class="reference internal" href="#support-for-postgresql-versions-older-than-9-0">对于早于 9.0 版本的 PostgreSQL 的支持</a></li>
<li><a class="reference internal" href="#support-for-mysql-versions-older-than-5-5">对于早于 5.5 版本的 MySQL 的支持</a></li>
<li><a class="reference internal" href="#support-for-oracle-versions-older-than-11-1">对于早于 11.1 版本的 Oracle 的支持</a></li>
<li><a class="reference internal" href="#specific-privileges-used-instead-of-roles-for-tests-on-oracle">在 Oracle 上，测试中使用特定权限而不是角色。</a></li>
<li><a class="reference internal" href="#abstractuser-last-login-allows-null-values"><code class="docutils literal notranslate"><span class="pre">AbstractUser.last_login</span></code> 允许空值</a></li>
<li><a class="reference internal" href="#id1"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a></li>
<li><a class="reference internal" href="#priority-of-context-processors-for-templateresponse-brought-in-line-with-render">对于 <code class="docutils literal notranslate"><span class="pre">TemplateResponse</span></code>，上下文处理器的优先级已与 <code class="docutils literal notranslate"><span class="pre">render</span></code> 保持一致。</a></li>
<li><a class="reference internal" href="#overriding-setupclass-teardownclass-in-test-cases">在测试用例中重写 <code class="docutils literal notranslate"><span class="pre">setUpClass</span></code> / <code class="docutils literal notranslate"><span class="pre">tearDownClass</span></code></a></li>
<li><a class="reference internal" href="#removal-of-django-contrib-formtools">移除了 <code class="docutils literal notranslate"><span class="pre">django.contrib.formtools</span></code> 模块</a></li>
<li><a class="reference internal" href="#database-connection-reloading-between-tests">测试之间重新加载数据库连接。</a></li>
<li><a class="reference internal" href="#cleanup-of-the-django-template-namespace">对 <code class="docutils literal notranslate"><span class="pre">django.template</span></code> 命名空间进行了清理</a></li>
<li><a class="reference internal" href="#model-attribute-on-private-model-relations">私有模型关系上的 <code class="docutils literal notranslate"><span class="pre">model</span></code> 属性</a></li>
<li><a class="reference internal" href="#database-backend-api">数据库后端 API</a></li>
<li><a class="reference internal" href="#id2"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a></li>
<li><a class="reference internal" href="#default-autoescaping-of-functions-in-django-template-defaultfilters">默认情况下，<code class="docutils literal notranslate"><span class="pre">django.template.defaultfilters</span></code> 中的函数现在会自动进行自动转义。</a></li>
<li><a class="reference internal" href="#miscellaneous">杂项</a></li>
</ul>
</li>
<li><a class="reference internal" href="#features-deprecated-in-1-8">在 1.8 中被废弃的功能</a><ul>
<li><a class="reference internal" href="#selected-methods-in-django-db-models-options-options"><code class="docutils literal notranslate"><span class="pre">django.db.models.options.Options</span></code> 中的选定方法</a></li>
<li><a class="reference internal" href="#loading-cycle-and-firstof-template-tags-from-future-library">加载 <code class="docutils literal notranslate"><span class="pre">cycle</span></code> 和 <code class="docutils literal notranslate"><span class="pre">firstof</span></code> 模板标签来自 <code class="docutils literal notranslate"><span class="pre">future</span></code> 库</a></li>
<li><a class="reference internal" href="#django-conf-urls-patterns"><code class="docutils literal notranslate"><span class="pre">django.conf.urls.patterns()</span></code></a></li>
<li><a class="reference internal" href="#passing-a-string-as-view-to-django-conf-urls-url">将字符串作为 <code class="docutils literal notranslate"><span class="pre">view</span></code> 传递给 <code class="docutils literal notranslate"><span class="pre">django.conf.urls.url()</span></code></a></li>
<li><a class="reference internal" href="#template-related-settings">模板相关的设置</a></li>
<li><a class="reference internal" href="#django-core-context-processors"><code class="docutils literal notranslate"><span class="pre">django.core.context_processors</span></code></a></li>
<li><a class="reference internal" href="#django-test-simpletestcase-urls"><code class="docutils literal notranslate"><span class="pre">django.test.SimpleTestCase.urls</span></code></a></li>
<li><a class="reference internal" href="#prefix-argument-to-i18n-patterns"><code class="docutils literal notranslate"><span class="pre">prefix</span></code> 参数用于 <code class="xref py py-func docutils literal notranslate"><span class="pre">i18n_patterns()</span></code> 函数。</a></li>
<li><a class="reference internal" href="#using-an-incorrect-count-of-unpacked-values-in-the-for-template-tag">在 <code class="xref std std-ttag docutils literal notranslate"><span class="pre">for</span></code> 模板标签中使用错误的解包值数量</a></li>
<li><a class="reference internal" href="#passing-a-dotted-path-to-reverse-and-url">传递点路径给 <code class="docutils literal notranslate"><span class="pre">reverse()</span></code> 和 <code class="xref std std-ttag docutils literal notranslate"><span class="pre">url</span></code></a></li>
<li><a class="reference internal" href="#aggregate-methods-and-modules">聚合方法和模块</a></li>
<li><a class="reference internal" href="#extending-management-command-arguments-through-command-option-list">通过 <code class="docutils literal notranslate"><span class="pre">Command.option_list</span></code> 扩展管理命令参数</a></li>
<li><a class="reference internal" href="#django-core-management-noargscommand"><code class="docutils literal notranslate"><span class="pre">django.core.management.NoArgsCommand</span></code></a></li>
<li><a class="reference internal" href="#listing-all-migrations-in-a-project">列出项目中的所有迁移</a></li>
<li><a class="reference internal" href="#cache-choices-option-of-modelchoicefield-and-modelmultiplechoicefield"><code class="docutils literal notranslate"><span class="pre">ModelChoiceField</span></code> 和 <code class="docutils literal notranslate"><span class="pre">ModelMultipleChoiceField</span></code> 的 <code class="docutils literal notranslate"><span class="pre">cache_choices</span></code> 选项</a></li>
<li><a class="reference internal" href="#django-template-resolve-variable"><code class="docutils literal notranslate"><span class="pre">django.template.resolve_variable()</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-webdesign"><code class="docutils literal notranslate"><span class="pre">django.contrib.webdesign</span></code></a></li>
<li><a class="reference internal" href="#error-message-argument-to-django-forms-regexfield"><code class="docutils literal notranslate"><span class="pre">django.forms.RegexField</span></code> 的 <code class="docutils literal notranslate"><span class="pre">error_message</span></code> 参数已被弃用</a></li>
<li><a class="reference internal" href="#old-unordered-list-syntax">旧的 <code class="xref std std-tfilter docutils literal notranslate"><span class="pre">unordered_list</span></code> 语法</a></li>
<li><a class="reference internal" href="#django-forms-field-has-changed"><code class="docutils literal notranslate"><span class="pre">django.forms.Field._has_changed()</span></code></a></li>
<li><a class="reference internal" href="#django-utils-html-remove-tags-and-removetags-template-filter"><code class="docutils literal notranslate"><span class="pre">django.utils.html.remove_tags()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">removetags</span></code> 模板过滤器</a></li>
<li><a class="reference internal" href="#is-admin-site-argument-to-django-contrib-auth-views-password-reset"><code class="docutils literal notranslate"><span class="pre">django.contrib.auth.views.password_reset()</span></code> 的 <code class="docutils literal notranslate"><span class="pre">is_admin_site</span></code> 参数</a></li>
<li><a class="reference internal" href="#subfieldbase"><code class="docutils literal notranslate"><span class="pre">SubfieldBase</span></code></a></li>
<li><a class="reference internal" href="#django-utils-checksums"><code class="docutils literal notranslate"><span class="pre">django.utils.checksums</span></code></a></li>
<li><a class="reference internal" href="#inlineadminform-original-content-type-id"><code class="docutils literal notranslate"><span class="pre">InlineAdminForm.original_content_type_id</span></code></a></li>
<li><a class="reference internal" href="#django-views-generic-edit-formmixin-get-form-s-form-class-argument"><code class="docutils literal notranslate"><span class="pre">django.views.generic.edit.FormMixin.get_form()</span></code> 方法的 <code class="docutils literal notranslate"><span class="pre">form_class</span></code> 参数</a></li>
<li><a class="reference internal" href="#rendering-templates-loaded-by-get-template-with-a-context">使用 <code class="xref py py-func docutils literal notranslate"><span class="pre">get_template()</span></code> 加载的模板进行渲染，需要使用 <code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span></code>。</a></li>
<li><a class="reference internal" href="#template-and-context-classes-in-template-responses">在模板响应中使用 <code class="xref py py-class docutils literal notranslate"><span class="pre">Template</span></code> 和 <code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span></code> 类。</a></li>
<li><a class="reference internal" href="#current-app-argument-of-template-related-apis">与模板相关的 API 中的 <code class="docutils literal notranslate"><span class="pre">current_app</span></code> 参数</a></li>
<li><a class="reference internal" href="#dictionary-and-context-instance-arguments-of-rendering-functions">渲染函数的 <code class="docutils literal notranslate"><span class="pre">dictionary</span></code> 和 <code class="docutils literal notranslate"><span class="pre">context_instance</span></code> 参数</a></li>
<li><a class="reference internal" href="#dirs-argument-of-template-finding-functions">模板查找函数的 <code class="docutils literal notranslate"><span class="pre">dirs</span></code> 参数</a></li>
<li><a class="reference internal" href="#django-template-loader-baseloader"><code class="docutils literal notranslate"><span class="pre">django.template.loader.BaseLoader</span></code></a></li>
<li><a class="reference internal" href="#django-test-utils-testtemplateloader"><code class="docutils literal notranslate"><span class="pre">django.test.utils.TestTemplateLoader</span></code></a></li>
<li><a class="reference internal" href="#support-for-the-max-length-argument-on-custom-storage-classes">自定义 <code class="docutils literal notranslate"><span class="pre">Storage</span></code> 类上 <code class="docutils literal notranslate"><span class="pre">max_length</span></code> 参数的支持</a></li>
<li><a class="reference internal" href="#qn-replaced-by-compiler"><code class="docutils literal notranslate"><span class="pre">qn</span></code> 被替换为 <code class="docutils literal notranslate"><span class="pre">compiler</span></code></a></li>
<li><a class="reference internal" href="#default-value-of-redirectview-permanent"><code class="docutils literal notranslate"><span class="pre">RedirectView.permanent</span></code> 的默认值</a></li>
<li><a class="reference internal" href="#using-authenticationmiddleware-without-sessionauthenticationmiddleware">在没有使用 <code class="docutils literal notranslate"><span class="pre">SessionAuthenticationMiddleware</span></code> 的情况下使用 <code class="docutils literal notranslate"><span class="pre">AuthenticationMiddleware</span></code>。</a></li>
<li><a class="reference internal" href="#django-contrib-sitemaps-flatpagesitemap"><code class="docutils literal notranslate"><span class="pre">django.contrib.sitemaps.FlatPageSitemap</span></code></a></li>
<li><a class="reference internal" href="#model-field-related">模型 <code class="docutils literal notranslate"><span class="pre">Field.related</span></code></a></li>
<li><a class="reference internal" href="#ssi-template-tag"><code class="docutils literal notranslate"><span class="pre">ssi</span></code> 模板标签</a></li>
<li><a class="reference internal" href="#as-comparison-operator-in-if-template-tag"><code class="docutils literal notranslate"><span class="pre">if</span></code> 模板标签中的比较运算符 <code class="docutils literal notranslate"><span class="pre">=</span></code> 已被弃用</a></li>
<li><a class="reference internal" href="#foo-s-syntax-in-modelformmixin-success-url">在 <code class="docutils literal notranslate"><span class="pre">ModelFormMixin.success_url</span></code> 中使用的 <code class="docutils literal notranslate"><span class="pre">%(&lt;foo&gt;)s</span></code> 语法已被弃用</a></li>
<li><a class="reference internal" href="#geoqueryset-aggregate-methods"><code class="docutils literal notranslate"><span class="pre">GeoQuerySet</span></code> 聚合方法</a></li>
<li><a class="reference internal" href="#signature-of-the-allow-migrate-router-method"><code class="docutils literal notranslate"><span class="pre">allow_migrate</span></code> 路由方法的签名</a></li>
</ul>
</li>
<li><a class="reference internal" href="#features-removed-in-1-8">在 1.8 版本中移除的功能</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="1.8.1.html"
                          title="上一章">Django 1.8.1 版本发行说明</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="1.7.11.html"
                          title="下一章">Django 1.7.11 版本发行说明</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/releases/1.8.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">3月 29, 2024</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="1.8.1.html" title="Django 1.8.1 版本发行说明">previous</a>
     |
    <a href="index.html" title="发行说明" accesskey="U">up</a>
   |
    <a href="1.7.11.html" title="Django 1.7.11 版本发行说明">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>

<!DOCTYPE html>

<html lang="zh_Hans">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Django 1.9 版本发行说明 &#8212; Django 5.0.4.dev20240329153429 文档</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/default.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Django 1.8.19 版本发行说明" href="1.8.19.html" />
    <link rel="prev" title="Django 1.9.1 版本发行说明" href="1.9.1.html" />



 
<script src="../templatebuiltins.js"></script>
<script>
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);</script>

  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../index.html">Django 5.0.4.dev20240329153429 文档</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../index.html">Home</a>  |
        <a title="Table of contents" href="../contents.html">Table of contents</a>  |
        <a title="Global index" href="../genindex.html">Index</a>  |
        <a title="Module index" href="../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="1.9.1.html" title="Django 1.9.1 版本发行说明">previous</a>
     |
    <a href="index.html" title="发行说明" accesskey="U">up</a>
   |
    <a href="1.8.19.html" title="Django 1.8.19 版本发行说明">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="releases-1.9">
            
  <div class="section" id="s-django-1-9-release-notes">
<span id="django-1-9-release-notes"></span><h1>Django 1.9 版本发行说明<a class="headerlink" href="#django-1-9-release-notes" title="永久链接至标题">¶</a></h1>
<p><em>2015 年 12 月 1 日</em></p>
<p>欢迎使用 Django 1.9 ！</p>
<p>这些发布说明包括 <a class="reference internal" href="#whats-new-1-9"><span class="std std-ref">新特性</span></a>，以及从 Django 1.8 或更早版本升级时需要注意的一些 <a class="reference internal" href="#backwards-incompatible-1-9"><span class="std std-ref">不兼容变更</span></a>。我们已经 <a class="reference internal" href="#removed-features-1-9"><span class="std std-ref">删除了一些已经完成了其废弃周期的功能</span></a>，并且已经 <a class="reference internal" href="#deprecated-features-1-9"><span class="std std-ref">开始废弃某些功能</span></a>。</p>
<p>如果你要更新现有的项目，请看 <a class="reference internal" href="../howto/upgrade-version.html"><span class="doc">如何将 Django 更新至新的版本</span></a> 指南。</p>
<div class="section" id="s-python-compatibility">
<span id="python-compatibility"></span><h2>Python 兼容性<a class="headerlink" href="#python-compatibility" title="永久链接至标题">¶</a></h2>
<p>Django 1.9 需要 Python 2.7、3.4 或 3.5。我们 <strong>强烈建议</strong> 并且只官方支持每个系列的最新版本。</p>
<p>Django 1.8 系列是最后一个支持 Python 3.2 和 3.3 的版本。</p>
</div>
<div class="section" id="s-what-s-new-in-django-1-9">
<span id="s-whats-new-1-9"></span><span id="what-s-new-in-django-1-9"></span><span id="whats-new-1-9"></span><h2>Django 1.9 的新特性<a class="headerlink" href="#what-s-new-in-django-1-9" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-performing-actions-after-a-transaction-commit">
<span id="performing-actions-after-a-transaction-commit"></span><h3>事务提交后执行操作<a class="headerlink" href="#performing-actions-after-a-transaction-commit" title="永久链接至标题">¶</a></h3>
<p>新的 <a class="reference internal" href="../topics/db/transactions.html#django.db.transaction.on_commit" title="django.db.transaction.on_commit"><code class="xref py py-func docutils literal notranslate"><span class="pre">on_commit()</span></code></a> 钩子允许在数据库事务成功提交后执行操作。这对于执行诸如发送通知电子邮件、创建排队任务或使缓存无效等任务非常有用。</p>
<p>这个功能已经被集成到 Django 中，之前是作为 <a class="reference external" href="https://pypi.org/project/django-transaction-hooks/">django-transaction-hooks</a> 包的一部分。</p>
</div>
<div class="section" id="s-password-validation">
<span id="password-validation"></span><h3>密码验证<a class="headerlink" href="#password-validation" title="永久链接至标题">¶</a></h3>
<p>Django 现在提供密码验证功能，以帮助防止用户使用弱密码。该验证已集成在包含的密码更改和重置表单中，并且可以简单地集成到任何其他代码中。验证由一个或多个验证器执行，可以在新的 <a class="reference internal" href="../ref/settings.html#std-setting-AUTH_PASSWORD_VALIDATORS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">AUTH_PASSWORD_VALIDATORS</span></code></a> 设置中配置。</p>
<p>Django 中包含了四个验证器，可以强制实施最小长度、将密码与用户的属性进行比较（如姓名）、确保密码不全为数字，或者检查是否在包含的常见密码列表中。您可以组合多个验证器，并且某些验证器具有自定义配置选项。例如，您可以选择提供自定义的常见密码列表。每个验证器都提供帮助文本，向用户解释其要求。</p>
<p>默认情况下，不执行任何验证，所有密码都会被接受，因此如果您不设置 <a class="reference internal" href="../ref/settings.html#std-setting-AUTH_PASSWORD_VALIDATORS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">AUTH_PASSWORD_VALIDATORS</span></code></a>，您将不会看到任何更改。在使用默认 <a class="reference internal" href="../ref/django-admin.html#django-admin-startproject"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">startproject</span></code></a> 模板创建的新项目中，已启用一组简单的验证器。要在您的项目中为包含的认证表单启用基本验证，您可以设置如下配置，例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AUTH_PASSWORD_VALIDATORS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;NAME&quot;</span><span class="p">:</span> <span class="s2">&quot;django.contrib.auth.password_validation.UserAttributeSimilarityValidator&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;NAME&quot;</span><span class="p">:</span> <span class="s2">&quot;django.contrib.auth.password_validation.MinimumLengthValidator&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;NAME&quot;</span><span class="p">:</span> <span class="s2">&quot;django.contrib.auth.password_validation.CommonPasswordValidator&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;NAME&quot;</span><span class="p">:</span> <span class="s2">&quot;django.contrib.auth.password_validation.NumericPasswordValidator&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>
</pre></div>
</div>
<p>有关更多详细信息，请参阅 <a class="reference internal" href="../topics/auth/passwords.html#password-validation"><span class="std std-ref">密码验证</span></a>。</p>
</div>
<div class="section" id="s-permission-mixins-for-class-based-views">
<span id="permission-mixins-for-class-based-views"></span><h3>用于基于类的视图的权限混合类<a class="headerlink" href="#permission-mixins-for-class-based-views" title="永久链接至标题">¶</a></h3>
<p>Django 现在包含了一些 mixin 类，如 <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.mixins.AccessMixin" title="django.contrib.auth.mixins.AccessMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">AccessMixin</span></code></a>、<a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.mixins.LoginRequiredMixin" title="django.contrib.auth.mixins.LoginRequiredMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">LoginRequiredMixin</span></code></a>、<a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.mixins.PermissionRequiredMixin" title="django.contrib.auth.mixins.PermissionRequiredMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">PermissionRequiredMixin</span></code></a> 和 <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.mixins.UserPassesTestMixin" title="django.contrib.auth.mixins.UserPassesTestMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">UserPassesTestMixin</span></code></a>，用于为基于类的视图提供与 <code class="docutils literal notranslate"><span class="pre">django.contrib.auth.decorators</span></code> 相同的功能。这些 mixin 类来自或受到了 <a class="reference external" href="https://django-braces.readthedocs.io/en/latest/index.html">django-braces</a> 项目的启发。</p>
<p>尽管如此，在 Django 和 <code class="docutils literal notranslate"><span class="pre">django-braces</span></code>' 的实现之间存在一些差异：</p>
<ul class="simple">
<li><a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.mixins.AccessMixin.raise_exception" title="django.contrib.auth.mixins.AccessMixin.raise_exception"><code class="xref py py-attr docutils literal notranslate"><span class="pre">raise_exception</span></code></a> 属性只能为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 或 <code class="docutils literal notranslate"><span class="pre">False</span></code>。不支持自定义异常或可调用对象。</li>
<li><a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.mixins.AccessMixin.handle_no_permission" title="django.contrib.auth.mixins.AccessMixin.handle_no_permission"><code class="xref py py-meth docutils literal notranslate"><span class="pre">handle_no_permission()</span></code></a> 方法不接受 <code class="docutils literal notranslate"><span class="pre">request</span></code> 参数。当前请求可在 <code class="docutils literal notranslate"><span class="pre">self.request</span></code> 中获取。</li>
<li><a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.mixins.UserPassesTestMixin" title="django.contrib.auth.mixins.UserPassesTestMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">UserPassesTestMixin</span></code></a> 的自定义 <code class="docutils literal notranslate"><span class="pre">test_func()</span></code> 不接受 <code class="docutils literal notranslate"><span class="pre">user</span></code> 参数。当前用户可在 <code class="docutils literal notranslate"><span class="pre">self.request.user</span></code> 中获取。</li>
<li><a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.mixins.PermissionRequiredMixin" title="django.contrib.auth.mixins.PermissionRequiredMixin"><code class="xref py py-attr docutils literal notranslate"><span class="pre">permission_required</span></code></a> 属性支持一个字符串（定义一个权限）或一个字符串的列表/元组（定义多个权限），这些权限需要满足才能授予访问权限。</li>
<li>新的 <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.mixins.AccessMixin.permission_denied_message" title="django.contrib.auth.mixins.AccessMixin.permission_denied_message"><code class="xref py py-attr docutils literal notranslate"><span class="pre">permission_denied_message</span></code></a> 属性允许传递消息给 <code class="docutils literal notranslate"><span class="pre">PermissionDenied</span></code> 异常。</li>
</ul>
</div>
<div class="section" id="s-new-styling-for-contrib-admin">
<span id="new-styling-for-contrib-admin"></span><h3><code class="docutils literal notranslate"><span class="pre">contrib.admin</span></code> 中的新样式<a class="headerlink" href="#new-styling-for-contrib-admin" title="永久链接至标题">¶</a></h3>
<p>管理员界面采用了现代的扁平设计，使用新的 SVG 图标，在高分辨率屏幕上效果非常好。它仍然在 <a class="reference external" href="https://github.com/yui/yui3/wiki/Graded-Browser-Support">YUI's A-grade</a> 浏览器中提供了完全功能的体验。较旧的浏览器可能会有不同程度的优雅降级。</p>
</div>
<div class="section" id="s-running-tests-in-parallel">
<span id="running-tests-in-parallel"></span><h3>并行运行测试<a class="headerlink" href="#running-tests-in-parallel" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../ref/django-admin.html#django-admin-test"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">test</span></code></a> 命令现在支持 <a class="reference internal" href="../ref/django-admin.html#cmdoption-test-parallel"><code class="xref std std-option docutils literal notranslate"><span class="pre">--parallel</span></code></a> 选项，可以并行运行项目的测试，使用多个进程。</p>
<p>每个进程都会得到它们自己的数据库。你必须确保不同的测试用例不会访问相同的资源。例如，接触文件系统的测试用例应该创建一个临时目录供自己使用。</p>
<p>对于 Django 自身的测试套件，默认情况下启用了此选项。</p>
<ul class="simple">
<li>只要操作系统支持（除了 Windows），此选项就会默认启用。</li>
<li>只要数据库后端支持（除了 Oracle），此选项就会默认启用。</li>
</ul>
</div>
<div class="section" id="s-minor-features">
<span id="minor-features"></span><h3>次要特性<a class="headerlink" href="#minor-features" title="永久链接至标题">¶</a></h3>
<div class="section" id="s-django-contrib-admin">
<span id="django-contrib-admin"></span><h4><a class="reference internal" href="../ref/contrib/admin/index.html#module-django.contrib.admin" title="django.contrib.admin: Django's admin site."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a><a class="headerlink" href="#django-contrib-admin" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>管理员视图现在具有 <code class="docutils literal notranslate"><span class="pre">model_admin</span></code> 或 <code class="docutils literal notranslate"><span class="pre">admin_site</span></code> 属性。</li>
<li>管理员更改视图的 URL 已更改（默认情况下是 <code class="docutils literal notranslate"><span class="pre">/admin/&lt;app&gt;/&lt;model&gt;/&lt;pk&gt;/</span></code>，现在是 <code class="docutils literal notranslate"><span class="pre">/admin/&lt;app&gt;/&lt;model&gt;/&lt;pk&gt;/change/</span></code>）。这不会影响您的应用程序，除非您已经硬编码了管理员的 URL。在这种情况下，建议使用 <a class="reference internal" href="../ref/contrib/admin/index.html#admin-reverse-urls"><span class="std std-ref">反向管理员 URL</span></a> 来替代这些链接。请注意，旧的 URL 仍然会重定向到新的 URL 以保持向后兼容，但它可能在将来的版本中被删除。</li>
<li>添加了 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.get_list_select_related" title="django.contrib.admin.ModelAdmin.get_list_select_related"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ModelAdmin.get_list_select_related()</span></code></a> 方法，允许根据请求更改管理员的变更列表查询中使用的 <code class="docutils literal notranslate"><span class="pre">select_related()</span></code> 值。</li>
<li>已将 <code class="docutils literal notranslate"><span class="pre">available_apps</span></code> 上下文变量添加到 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.AdminSite.each_context" title="django.contrib.admin.AdminSite.each_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AdminSite.each_context()</span></code></a> 方法中，该变量列出了当前用户可用的应用程序。</li>
<li>添加了 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.AdminSite.empty_value_display" title="django.contrib.admin.AdminSite.empty_value_display"><code class="xref py py-attr docutils literal notranslate"><span class="pre">AdminSite.empty_value_display</span></code></a> 和 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.empty_value_display" title="django.contrib.admin.ModelAdmin.empty_value_display"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ModelAdmin.empty_value_display</span></code></a>，用于覆盖管理员更改列表中空值的显示。您还可以为每个字段自定义该值。</li>
<li>在更改表单页面上添加了 jQuery 事件，用于 <a class="reference internal" href="../ref/contrib/admin/javascript.html#admin-javascript-inline-form-events"><span class="std std-ref">在添加或删除内联表单时</span></a>。</li>
<li>时间选择器小部件包括一个“下午 6 点”的选项，以保持每 6 小时预定义选项的一致性。</li>
<li>现在，JavaScript 的 slug 生成支持罗马尼亚字符。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-admindocs">
<span id="django-contrib-admindocs"></span><h4><a class="reference internal" href="../ref/contrib/admin/admindocs.html#module-django.contrib.admindocs" title="django.contrib.admindocs: Django's admin documentation generator."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admindocs</span></code></a><a class="headerlink" href="#django-contrib-admindocs" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">admindocs</span></code> 的模型部分现在还描述了接受参数的方法，而不是忽略它们。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-auth">
<span id="django-contrib-auth"></span><h4><a class="reference internal" href="../topics/auth/index.html#module-django.contrib.auth" title="django.contrib.auth: Django's authentication framework."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a><a class="headerlink" href="#django-contrib-auth" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>PBKDF2 密码哈希器的默认迭代次数增加了 20%。这个向后兼容的更改不会影响那些已经子类化了 <code class="docutils literal notranslate"><span class="pre">django.contrib.auth.hashers.PBKDF2PasswordHasher</span></code> 来更改默认值的用户。</li>
<li>如果更改了 <code class="docutils literal notranslate"><span class="pre">BCryptSHA256PasswordHasher</span></code> 的 <code class="docutils literal notranslate"><span class="pre">rounds</span></code> 属性，它将更新密码。</li>
<li><code class="docutils literal notranslate"><span class="pre">AbstractBaseUser</span></code> 和 <code class="docutils literal notranslate"><span class="pre">BaseUserManager</span></code> 被移动到了新的 <code class="docutils literal notranslate"><span class="pre">django.contrib.auth.base_user</span></code> 模块，因此可以在不包括 <code class="docutils literal notranslate"><span class="pre">django.contrib.auth</span></code> 在 <a class="reference internal" href="../ref/settings.html#std-setting-INSTALLED_APPS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code></a> 中的情况下导入它们（在较旧的版本中，这样做会引发废弃警告，在 Django 1.9 中不再支持）。</li>
<li><a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.decorators.permission_required" title="django.contrib.auth.decorators.permission_required"><code class="xref py py-func docutils literal notranslate"><span class="pre">permission_required()</span></code></a> 的权限参数接受所有类型的可迭代对象，而不仅仅是列表和元组。</li>
<li>新的 <a class="reference internal" href="../ref/middleware.html#django.contrib.auth.middleware.PersistentRemoteUserMiddleware" title="django.contrib.auth.middleware.PersistentRemoteUserMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">PersistentRemoteUserMiddleware</span></code></a> 使得在仅在登录页面上填充标头的设置中使用 <code class="docutils literal notranslate"><span class="pre">REMOTE_USER</span></code> 成为可能，而不是在会话的每个请求中都填充。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.auth.views.password_reset()</span></code> 视图接受一个 <code class="docutils literal notranslate"><span class="pre">extra_email_context</span></code> 参数。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-contenttypes">
<span id="django-contrib-contenttypes"></span><h4><a class="reference internal" href="../ref/contrib/contenttypes.html#module-django.contrib.contenttypes" title="django.contrib.contenttypes: Provides generic interface to installed models."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.contenttypes</span></code></a><a class="headerlink" href="#django-contrib-contenttypes" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>现在可以在 <code class="docutils literal notranslate"><span class="pre">GenericForeignKey</span></code> 中使用 <a class="reference internal" href="../ref/models/options.html#django.db.models.Options.order_with_respect_to" title="django.db.models.Options.order_with_respect_to"><code class="xref py py-attr docutils literal notranslate"><span class="pre">order_with_respect_to</span></code></a>。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-gis">
<span id="django-contrib-gis"></span><h4><a class="reference internal" href="../ref/contrib/gis/index.html#module-django.contrib.gis" title="django.contrib.gis: Geographic Information System (GIS) extensions for Django"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a><a class="headerlink" href="#django-contrib-gis" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>所有 <code class="docutils literal notranslate"><span class="pre">GeoQuerySet</span></code> 方法都已被废弃，并被 <a class="reference internal" href="../ref/contrib/gis/functions.html"><span class="doc">等效的数据库函数</span></a> 替代。一旦在您的代码中替换了这些旧方法，您甚至可以从启用 GIS 的类中删除特殊的 <code class="docutils literal notranslate"><span class="pre">GeoManager</span></code>。</li>
<li>GDAL 接口现在支持从原始数据实例化基于文件和内存的 <a class="reference internal" href="../ref/contrib/gis/gdal.html#raster-data-source-objects"><span class="std std-ref">GDALRaster 对象</span></a>。已添加了用于栅格属性（如投影或像素值）的设置器。</li>
<li>对于 PostGIS 用户，新的 <a class="reference internal" href="../ref/contrib/gis/model-api.html#django.contrib.gis.db.models.RasterField" title="django.contrib.gis.db.models.RasterField"><code class="xref py py-class docutils literal notranslate"><span class="pre">RasterField</span></code></a> 允许 <a class="reference internal" href="../ref/contrib/gis/db-api.html#creating-and-saving-raster-models"><span class="std std-ref">存储 GDALRaster 对象</span></a>。它支持在保存模型时自动创建空间索引和重投影。但它目前还不支持空间查询。</li>
<li>新的 <a class="reference internal" href="../ref/contrib/gis/gdal.html#django.contrib.gis.gdal.GDALRaster.warp" title="django.contrib.gis.gdal.GDALRaster.warp"><code class="xref py py-meth docutils literal notranslate"><span class="pre">GDALRaster.warp()</span></code></a> 方法允许通过指定目标栅格属性（如原点、宽度、高度或像素大小等）来进行栅格重投影。</li>
<li>新的 <a class="reference internal" href="../ref/contrib/gis/gdal.html#django.contrib.gis.gdal.GDALRaster.transform" title="django.contrib.gis.gdal.GDALRaster.transform"><code class="xref py py-meth docutils literal notranslate"><span class="pre">GDALRaster.transform()</span></code></a> 方法允许通过指定目标 <code class="docutils literal notranslate"><span class="pre">srid</span></code> 来将栅格转换为不同的空间参考系统。</li>
<li>新的 <a class="reference internal" href="../ref/contrib/gis/geoip2.html#django.contrib.gis.geoip2.GeoIP2" title="django.contrib.gis.geoip2.GeoIP2"><code class="xref py py-class docutils literal notranslate"><span class="pre">GeoIP2</span></code></a> 类允许使用 MaxMind 的 GeoLite2 数据库，其中包括对 IPv6 地址的支持。</li>
<li>包含在小部件中的默认 OpenLayers 库版本已从 2.13 更新为 2.13.1 。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-postgres">
<span id="django-contrib-postgres"></span><h4><a class="reference internal" href="../ref/contrib/postgres/index.html#module-django.contrib.postgres" title="django.contrib.postgres: PostgreSQL-specific fields and features"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.postgres</span></code></a><a class="headerlink" href="#django-contrib-postgres" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>为一些内置字段添加了对 <a class="reference internal" href="../ref/contrib/postgres/fields.html#std-fieldlookup-rangefield.contained_by"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">rangefield.contained_by</span></code></a> 查找的支持，这些字段对应于范围字段。</li>
<li>添加了 <code class="docutils literal notranslate"><span class="pre">django.contrib.postgres.fields.JSONField</span></code>。</li>
<li>添加了 <a class="reference internal" href="../ref/contrib/postgres/aggregates.html"><span class="doc">PostgreSQL 特有聚合函数</span></a>。</li>
<li>添加了 <a class="reference internal" href="../ref/contrib/postgres/functions.html#django.contrib.postgres.functions.TransactionNow" title="django.contrib.postgres.functions.TransactionNow"><code class="xref py py-class docutils literal notranslate"><span class="pre">TransactionNow</span></code></a> 数据库函数。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-sessions">
<span id="django-contrib-sessions"></span><h4><a class="reference internal" href="../topics/http/sessions.html#module-django.contrib.sessions" title="django.contrib.sessions: Provides session management for Django projects."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sessions</span></code></a><a class="headerlink" href="#django-contrib-sessions" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>会话模型和用于 <code class="docutils literal notranslate"><span class="pre">db</span></code> 和 <code class="docutils literal notranslate"><span class="pre">cached_db</span></code> 后端的 <code class="docutils literal notranslate"><span class="pre">SessionStore</span></code> 类已进行了重构，以允许自定义数据库会话后端基于它们构建。有关更多详细信息，请参阅 <a class="reference internal" href="../topics/http/sessions.html#extending-database-backed-session-engines"><span class="std std-ref">扩展数据库后端的会话引擎</span></a>。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-sites">
<span id="django-contrib-sites"></span><h4><a class="reference internal" href="../ref/contrib/sites.html#module-django.contrib.sites" title="django.contrib.sites: Lets you operate multiple websites from the same database and Django project"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sites</span></code></a><a class="headerlink" href="#django-contrib-sites" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/contrib/sites.html#django.contrib.sites.shortcuts.get_current_site" title="django.contrib.sites.shortcuts.get_current_site"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_current_site()</span></code></a> 现在处理了 <code class="docutils literal notranslate"><span class="pre">request.get_host()</span></code> 返回 <code class="docutils literal notranslate"><span class="pre">domain:port</span></code> 的情况，例如 <code class="docutils literal notranslate"><span class="pre">example.com:80</span></code>。如果查找失败，因为主机在数据库中找不到记录并且主机有一个端口，端口会被剥离，然后使用仅包含域名的部分重试查找。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-syndication">
<span id="django-contrib-syndication"></span><h4><a class="reference internal" href="../ref/contrib/syndication.html#module-django.contrib.syndication" title="django.contrib.syndication: A framework for generating syndication feeds, in RSS and Atom, quite easily."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.syndication</span></code></a><a class="headerlink" href="#django-contrib-syndication" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>添加了对每个订阅项多个附件的支持。如果在 RSS 订阅中定义了多个附件，则会引发异常，因为 RSS 订阅不支持每个订阅项多个附件，而 Atom 订阅支持。</li>
</ul>
</div>
<div class="section" id="s-cache">
<span id="cache"></span><h4>缓存<a class="headerlink" href="#cache" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">django.core.cache.backends.base.BaseCache</span></code> 现在具有一个 <code class="docutils literal notranslate"><span class="pre">get_or_set()</span></code> 方法。</li>
<li><a class="reference internal" href="../topics/http/decorators.html#django.views.decorators.cache.never_cache" title="django.views.decorators.cache.never_cache"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.views.decorators.cache.never_cache()</span></code></a> 现在发送更具说服力的头部信息（在 <code class="docutils literal notranslate"><span class="pre">Cache-Control</span></code> 中添加了 <code class="docutils literal notranslate"><span class="pre">no-cache,</span> <span class="pre">no-store,</span> <span class="pre">must-revalidate</span></code>），以更好地防止缓存。这也在 Django 1.8.8 中添加了。</li>
</ul>
</div>
<div class="section" id="s-csrf">
<span id="csrf"></span><h4>CSRF<a class="headerlink" href="#csrf" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>用于 CSRF 认证的请求头名称可以通过 <a class="reference internal" href="../ref/settings.html#std-setting-CSRF_HEADER_NAME"><code class="xref std std-setting docutils literal notranslate"><span class="pre">CSRF_HEADER_NAME</span></code></a> 进行自定义。</li>
<li>如果设置了 <a class="reference internal" href="../ref/settings.html#std-setting-CSRF_COOKIE_DOMAIN"><code class="xref std std-setting docutils literal notranslate"><span class="pre">CSRF_COOKIE_DOMAIN</span></code></a> 设置，CSRF 的 referer 头现在将与其进行验证。有关详细信息，请参阅 <a class="reference internal" href="../ref/csrf.html#how-csrf-works"><span class="std std-ref">工作方式</span></a>。</li>
<li>新的 <a class="reference internal" href="../ref/settings.html#std-setting-CSRF_TRUSTED_ORIGINS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">CSRF_TRUSTED_ORIGINS</span></code></a> 设置提供了一种允许跨源不安全请求（例如 <code class="docutils literal notranslate"><span class="pre">POST</span></code>）通过 HTTPS 的方式。</li>
</ul>
</div>
<div class="section" id="s-database-backends">
<span id="database-backends"></span><h4>数据库后端<a class="headerlink" href="#database-backends" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>PostgreSQL 后端（<code class="docutils literal notranslate"><span class="pre">django.db.backends.postgresql_psycopg2</span></code>）也可以使用 <code class="docutils literal notranslate"><span class="pre">django.db.backends.postgresql</span></code>。旧名称将继续保持以确保向后兼容。</li>
</ul>
</div>
<div class="section" id="s-file-storage">
<span id="file-storage"></span><h4>文件存储<a class="headerlink" href="#file-storage" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>当 <a class="reference internal" href="../ref/models/fields.html#django.db.models.FileField.upload_to" title="django.db.models.FileField.upload_to"><code class="xref py py-attr docutils literal notranslate"><span class="pre">upload_to</span></code></a> 是可调用对象时，现在会调用 <a class="reference internal" href="../ref/files/storage.html#django.core.files.storage.Storage.get_valid_name" title="django.core.files.storage.Storage.get_valid_name"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Storage.get_valid_name()</span></code></a>。</li>
<li>在使用 Python 3 时，<a class="reference internal" href="../ref/files/file.html#django.core.files.File" title="django.core.files.File"><code class="xref py py-class docutils literal notranslate"><span class="pre">File</span></code></a> 现在具有 <code class="docutils literal notranslate"><span class="pre">seekable()</span></code> 方法。</li>
</ul>
</div>
<div class="section" id="s-forms">
<span id="forms"></span><h4>表单<a class="headerlink" href="#forms" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../topics/forms/modelforms.html#django.forms.ModelForm" title="django.forms.ModelForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelForm</span></code></a> 接受新的 <code class="docutils literal notranslate"><span class="pre">Meta</span></code> 选项 <code class="docutils literal notranslate"><span class="pre">field_classes</span></code> 以自定义字段的类型。有关详细信息，请参阅 <a class="reference internal" href="../topics/forms/modelforms.html#modelforms-overriding-default-fields"><span class="std std-ref">覆盖默认字段</span></a>。</li>
<li>现在可以使用 <a class="reference internal" href="../ref/forms/api.html#django.forms.Form.field_order" title="django.forms.Form.field_order"><code class="xref py py-attr docutils literal notranslate"><span class="pre">field_order</span></code></a> 属性、<code class="docutils literal notranslate"><span class="pre">field_order</span></code> 构造函数参数或 <a class="reference internal" href="../ref/forms/api.html#django.forms.Form.order_fields" title="django.forms.Form.order_fields"><code class="xref py py-meth docutils literal notranslate"><span class="pre">order_fields()</span></code></a> 方法指定表单字段呈现的顺序。</li>
<li>现在可以在表单类内部指定表单前缀，而不仅仅是在实例化表单时。有关详细信息，请参阅 <a class="reference internal" href="../ref/forms/api.html#form-prefix"><span class="std std-ref">表单前缀</span></a>。</li>
<li>现在可以 <a class="reference internal" href="../topics/forms/formsets.html#custom-formset-form-kwargs"><span class="std std-ref">指定要传递给表单集合中表单构造函数的关键字参数</span></a>。</li>
<li><a class="reference internal" href="../ref/forms/fields.html#django.forms.SlugField" title="django.forms.SlugField"><code class="xref py py-class docutils literal notranslate"><span class="pre">SlugField</span></code></a> 现在接受一个 <a class="reference internal" href="../ref/forms/fields.html#django.forms.SlugField.allow_unicode" title="django.forms.SlugField.allow_unicode"><code class="xref py py-attr docutils literal notranslate"><span class="pre">allow_unicode</span></code></a> 参数，以允许在 slug 中使用 Unicode 字符。</li>
<li><a class="reference internal" href="../ref/forms/fields.html#django.forms.CharField" title="django.forms.CharField"><code class="xref py py-class docutils literal notranslate"><span class="pre">CharField</span></code></a> 现在接受一个 <a class="reference internal" href="../ref/forms/fields.html#django.forms.CharField.strip" title="django.forms.CharField.strip"><code class="xref py py-attr docutils literal notranslate"><span class="pre">strip</span></code></a> 参数，以去除输入数据的前导和尾随空格。由于默认为 <code class="docutils literal notranslate"><span class="pre">True</span></code>，这与之前的版本不同。</li>
<li>现在，表单字段支持 <a class="reference internal" href="../ref/forms/fields.html#django.forms.Field.disabled" title="django.forms.Field.disabled"><code class="xref py py-attr docutils literal notranslate"><span class="pre">disabled</span></code></a> 参数，允许浏览器将字段小部件显示为禁用状态。</li>
<li>现在可以通过重写字段的 <a class="reference internal" href="../ref/forms/api.html#django.forms.Field.get_bound_field" title="django.forms.Field.get_bound_field"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_bound_field()</span></code></a> 方法来自定义绑定字段。</li>
</ul>
</div>
<div class="section" id="s-generic-views">
<span id="generic-views"></span><h4>通用视图<a class="headerlink" href="#generic-views" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>使用 <code class="docutils literal notranslate"><span class="pre">as_view()</span></code> 生成的基于类的视图现在具有 <code class="docutils literal notranslate"><span class="pre">view_class</span></code> 和 <code class="docutils literal notranslate"><span class="pre">view_initkwargs</span></code> 属性。</li>
<li>现在可以使用 <a class="reference internal" href="../ref/utils.html#django.utils.decorators.method_decorator" title="django.utils.decorators.method_decorator"><code class="xref py py-func docutils literal notranslate"><span class="pre">method_decorator()</span></code></a> 与装饰器的列表或元组一起使用。它还可以用于 <a class="reference internal" href="../topics/class-based-views/intro.html#id1"><span class="std std-ref">装饰类而不是方法</span></a>。</li>
</ul>
</div>
<div class="section" id="s-internationalization">
<span id="internationalization"></span><h4>国际化<a class="headerlink" href="#internationalization" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>当可用时，<a class="reference internal" href="../topics/i18n/translation.html#django.views.i18n.set_language" title="django.views.i18n.set_language"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.views.i18n.set_language()</span></code></a> 视图现在正确重定向到 <a class="reference internal" href="../topics/i18n/translation.html#url-internationalization"><span class="std std-ref">已翻译的 URL</span></a>。</li>
<li>如果在同一页上多次使用不同配置调用 <code class="docutils literal notranslate"><span class="pre">django.views.i18n.javascript_catalog()</span></code> 视图，它现在会正常工作。</li>
<li><a class="reference internal" href="../ref/utils.html#django.utils.timezone.make_aware" title="django.utils.timezone.make_aware"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.timezone.make_aware()</span></code></a> 函数新增了一个 <code class="docutils literal notranslate"><span class="pre">is_dst</span></code> 参数，以帮助解决夏令时转换期间的模糊时间。</li>
<li>现在可以使用 gettext 支持的语言区域变体。这通常用于可以使用不同字符集书写的语言，例如拉丁文和西里尔文（例如 <code class="docutils literal notranslate"><span class="pre">be&#64;latin</span></code>）。</li>
<li>新增了 <code class="docutils literal notranslate"><span class="pre">django.views.i18n.json_catalog()</span></code> 视图，以帮助构建基于 Django 翻译的自定义客户端端国际化库。它返回一个包含翻译目录、格式设置和复数规则的 JSON 对象。</li>
<li>新增了 <a class="reference internal" href="../topics/i18n/translation.html#std-templatetag-get_language_info"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">get_language_info</span></code></a> 模板标签返回的对象的 <code class="docutils literal notranslate"><span class="pre">name_translated</span></code> 属性。还新增了相应的模板过滤器：<a class="reference internal" href="../topics/i18n/translation.html#std-templatefilter-language_name_translated"><code class="xref std std-tfilter docutils literal notranslate"><span class="pre">language_name_translated</span></code></a>。</li>
<li>现在你可以从项目的根目录运行 <a class="reference internal" href="../ref/django-admin.html#django-admin-compilemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">compilemessages</span></code></a>，它将找到所有由 <a class="reference internal" href="../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">makemessages</span></code></a> 创建的应用程序消息文件。</li>
<li>现在 <a class="reference internal" href="../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">makemessages</span></code></a> 每个区域目录调用一次 <code class="docutils literal notranslate"><span class="pre">xgettext</span></code> 而不是每个可翻译文件调用一次。这加快了本地化构建的速度。</li>
<li><a class="reference internal" href="../topics/i18n/translation.html#std-templatetag-blocktrans"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">blocktrans</span></code></a> 支持使用 <code class="docutils literal notranslate"><span class="pre">asvar</span></code> 将其输出分配给变量。</li>
<li>新增了两种新语言：哥伦比亚西班牙语和苏格兰盖尔语。</li>
</ul>
</div>
<div class="section" id="s-management-commands">
<span id="management-commands"></span><h4>管理命令<a class="headerlink" href="#management-commands" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../ref/django-admin.html#django-admin-sendtestemail"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">sendtestemail</span></code></a> 命令允许您发送测试邮件，以轻松确认通过 Django 发送邮件是否正常工作。</li>
<li>为了增加 <a class="reference internal" href="../ref/django-admin.html#django-admin-sqlmigrate"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">sqlmigrate</span></code></a> 生成的 SQL 代码的可读性，为每个迁移操作生成的 SQL 代码前面都有操作的描述。</li>
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-dumpdata"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">dumpdata</span></code></a> 命令的输出现在具有确定性的顺序。此外，当指定了 <code class="docutils literal notranslate"><span class="pre">--output</span></code> 选项时，它还在终端中显示一个进度条。</li>
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-createcachetable"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">createcachetable</span></code></a> 命令现在有一个 <code class="docutils literal notranslate"><span class="pre">--dry-run</span></code> 标志，可以打印出 SQL 而不执行它。</li>
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-startapp"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">startapp</span></code></a> 命令会创建一个 <code class="docutils literal notranslate"><span class="pre">apps.py</span></code> 文件。由于它不使用 <code class="docutils literal notranslate"><span class="pre">default_app_config</span></code> （一个不推荐使用的 API），你必须在 <a class="reference internal" href="../ref/settings.html#std-setting-INSTALLED_APPS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code></a> 中指定 app 配置的路径，例如 <code class="docutils literal notranslate"><span class="pre">'polls.apps.PollsConfig'</span></code>，以便使用它（而不仅仅是 <code class="docutils literal notranslate"><span class="pre">'polls'</span></code>）。</li>
<li>在使用 PostgreSQL 后端时，<a class="reference internal" href="../ref/django-admin.html#django-admin-dbshell"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">dbshell</span></code></a> 命令可以使用设置文件中的密码来连接数据库（而不需要手动输入密码）。</li>
<li><code class="docutils literal notranslate"><span class="pre">django</span></code> 包可以作为脚本运行，即 <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">django</span></code>，它的行为与 <code class="docutils literal notranslate"><span class="pre">django-admin</span></code> 相同。</li>
<li>具有 <code class="docutils literal notranslate"><span class="pre">--noinput</span></code> 选项的管理命令现在还支持 <code class="docutils literal notranslate"><span class="pre">--no-input</span></code> 作为该选项的别名。</li>
</ul>
</div>
<div class="section" id="s-migrations">
<span id="migrations"></span><h4>迁移<a class="headerlink" href="#migrations" title="永久链接至标题">¶</a></h4>
<ul>
<li><p class="first">初始迁移现在带有一个 <a class="reference internal" href="../topics/migrations.html#django.db.migrations.Migration.initial" title="django.db.migrations.Migration.initial"><code class="xref py py-attr docutils literal notranslate"><span class="pre">initial</span> <span class="pre">=</span> <span class="pre">True</span></code></a> 类属性，这允许 <a class="reference internal" href="../ref/django-admin.html#cmdoption-migrate-fake-initial"><code class="xref std std-option docutils literal notranslate"><span class="pre">migrate</span> <span class="pre">--fake-initial</span></code></a> 更容易检测到初始迁移。</p>
</li>
<li><p class="first">增加了对 <code class="docutils literal notranslate"><span class="pre">functools.partial</span></code> 和 <code class="docutils literal notranslate"><span class="pre">LazyObject</span></code> 实例的序列化支持。</p>
</li>
<li><p class="first">当在 <a class="reference internal" href="../ref/settings.html#std-setting-MIGRATION_MODULES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">MIGRATION_MODULES</span></code></a> 中提供 <code class="docutils literal notranslate"><span class="pre">None</span></code> 作为值时，Django 将考虑该应用程序为没有迁移的应用程序。</p>
</li>
<li><p class="first">在应用迁移时，当以 verbosity 2 或更高级别运行 migrate 命令时，&quot; Rendering model states &quot; 步骤现在仅计算已应用的迁移的模型状态。正在应用的迁移的模型状态将按需生成，大大减少了所需的内存。</p>
<p>然而，这个改进在取消应用迁移时不适用，因此仍然需要预先计算和存储中间迁移状态。</p>
<p>这个改进还要求 Django 不再支持混合迁移计划。混合计划包含一系列迁移，其中一些正在应用，而其他一些正在取消应用。这从未得到官方支持，并且从未有过公共 API 来支持这种行为。</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/django-admin.html#django-admin-squashmigrations"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">squashmigrations</span></code></a> 命令现在支持指定要压缩的迁移的起始迁移。</p>
</li>
</ul>
</div>
<div class="section" id="s-models">
<span id="models"></span><h4>模型<a class="headerlink" href="#models" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.bulk_create" title="django.db.models.query.QuerySet.bulk_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.bulk_create()</span></code></a> 现在可以在代理模型上使用。</li>
<li>数据库配置增加了一个 <a class="reference internal" href="../ref/settings.html#std-setting-DATABASE-TIME_ZONE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">TIME_ZONE</span></code></a> 选项，用于与在 <a class="reference internal" href="../ref/settings.html#std-setting-USE_TZ"><code class="xref std std-setting docutils literal notranslate"><span class="pre">USE_TZ</span></code></a> 为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 时不支持时区的数据库交互，这些数据库将日期时间存储在本地时间中。</li>
<li>新增了 <a class="reference internal" href="../ref/models/relations.html#django.db.models.fields.related.RelatedManager.set" title="django.db.models.fields.related.RelatedManager.set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RelatedManager.set()</span></code></a> 方法，用于与由 <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code>、<code class="docutils literal notranslate"><span class="pre">GenericForeignKey</span></code> 和 <code class="docutils literal notranslate"><span class="pre">ManyToManyField</span></code> 创建的相关管理器交互。</li>
<li><a class="reference internal" href="../ref/models/relations.html#django.db.models.fields.related.RelatedManager.add" title="django.db.models.fields.related.RelatedManager.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add()</span></code></a> 方法在反向外键上现在有一个 <code class="docutils literal notranslate"><span class="pre">bulk</span></code> 参数，允许执行一个查询，而不管要添加的对象数量如何，而不是每个对象执行一个查询。</li>
<li>在 <a class="reference internal" href="../ref/models/instances.html#django.db.models.Model.delete" title="django.db.models.Model.delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.delete()</span></code></a> 方法中添加了 <code class="docutils literal notranslate"><span class="pre">keep_parents</span></code> 参数，允许仅删除使用多表继承的模型中子模型的数据。</li>
<li><a class="reference internal" href="../ref/models/instances.html#django.db.models.Model.delete" title="django.db.models.Model.delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.delete()</span></code></a> 和 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.delete" title="django.db.models.query.QuerySet.delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.delete()</span></code></a> 返回被删除的对象数量。</li>
<li>添加了一个系统检查，防止在同一模型上同时定义 <code class="docutils literal notranslate"><span class="pre">Meta.ordering</span></code> 和 <code class="docutils literal notranslate"><span class="pre">order_with_respect_to</span></code>。</li>
<li><a class="reference internal" href="../ref/models/querysets.html#std-fieldlookup-year"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">日期和时间</span></code></a> 查询可以与其他查询（如 <a class="reference internal" href="../ref/models/querysets.html#std-fieldlookup-exact"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">exact</span></code></a>, <a class="reference internal" href="../ref/models/querysets.html#std-fieldlookup-gt"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">gt</span></code></a>, <a class="reference internal" href="../ref/models/querysets.html#std-fieldlookup-lt"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">lt</span></code></a> 等）链接使用。例如：<code class="docutils literal notranslate"><span class="pre">Entry.objects.filter(pub_date__month__gt=6)</span></code>。</li>
<li>时间查询（小时，分钟，秒）现在对所有数据库后端都受到 <a class="reference internal" href="../ref/models/fields.html#django.db.models.TimeField" title="django.db.models.TimeField"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeField</span></code></a> 的支持。在 Django 1.7 中添加了对除 SQLite 外的后端的支持，但未记录在文档中。</li>
<li>你可以通过指定 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.Avg" title="django.db.models.Avg"><code class="xref py py-class docutils literal notranslate"><span class="pre">Avg</span></code></a> 聚合的 <code class="docutils literal notranslate"><span class="pre">output_field</span></code> 参数来对非数字列（如 <code class="docutils literal notranslate"><span class="pre">DurationField</span></code>）进行聚合。</li>
<li>在 <a class="reference internal" href="../ref/models/fields.html#django.db.models.DateTimeField" title="django.db.models.DateTimeField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateTimeField</span></code></a> 中添加了 <a class="reference internal" href="../ref/models/querysets.html#std-fieldlookup-date"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">date</span></code></a> 查询，允许仅查询字段的日期部分。</li>
<li>添加了 <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Greatest" title="django.db.models.functions.Greatest"><code class="xref py py-class docutils literal notranslate"><span class="pre">Greatest</span></code></a> 和 <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Least" title="django.db.models.functions.Least"><code class="xref py py-class docutils literal notranslate"><span class="pre">Least</span></code></a> 数据库函数。</li>
<li>添加了 <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Now" title="django.db.models.functions.Now"><code class="xref py py-class docutils literal notranslate"><span class="pre">Now</span></code></a> 数据库函数，该函数返回当前的日期和时间。</li>
<li><a class="reference internal" href="../ref/models/lookups.html#django.db.models.Transform" title="django.db.models.Transform"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transform</span></code></a> 现在是 <a class="reference internal" href="../ref/models/expressions.html#func-expressions"><span class="std std-ref">Func()</span></a> 的子类，这使得 <code class="docutils literal notranslate"><span class="pre">Transform</span></code> 可以像常规的 <code class="docutils literal notranslate"><span class="pre">Func</span></code> 一样用在表达式的右侧。这允许注册一些数据库函数，如 <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Length" title="django.db.models.functions.Length"><code class="xref py py-class docutils literal notranslate"><span class="pre">Length</span></code></a>、<a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Lower" title="django.db.models.functions.Lower"><code class="xref py py-class docutils literal notranslate"><span class="pre">Lower</span></code></a> 和 <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Upper" title="django.db.models.functions.Upper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Upper</span></code></a> 作为转换函数。</li>
<li><a class="reference internal" href="../ref/models/fields.html#django.db.models.SlugField" title="django.db.models.SlugField"><code class="xref py py-class docutils literal notranslate"><span class="pre">SlugField</span></code></a> 现在接受一个 <a class="reference internal" href="../ref/models/fields.html#django.db.models.SlugField.allow_unicode" title="django.db.models.SlugField.allow_unicode"><code class="xref py py-attr docutils literal notranslate"><span class="pre">allow_unicode</span></code></a> 参数，允许在 slug 中使用 Unicode 字符。</li>
<li>在 <code class="docutils literal notranslate"><span class="pre">QuerySet.distinct()</span></code> 中增加了对注解引用的支持。</li>
<li><code class="docutils literal notranslate"><span class="pre">connection.queries</span></code> 在 SQLite 上显示带有替代参数的查询。</li>
<li><a class="reference internal" href="../ref/models/expressions.html"><span class="doc">查询表达式</span></a> 现在可以在使用 <code class="docutils literal notranslate"><span class="pre">save()</span></code>, <code class="docutils literal notranslate"><span class="pre">create()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">bulk_create()</span></code> 创建新模型实例时使用。</li>
</ul>
</div>
<div class="section" id="s-requests-and-responses">
<span id="requests-and-responses"></span><h4>请求和响应<a class="headerlink" href="#requests-and-responses" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>除非显式设置 <a class="reference internal" href="../ref/request-response.html#django.http.HttpResponse.reason_phrase" title="django.http.HttpResponse.reason_phrase"><code class="xref py py-attr docutils literal notranslate"><span class="pre">HttpResponse.reason_phrase</span></code></a>，否则它现在由 <a class="reference internal" href="../ref/request-response.html#django.http.HttpResponse.status_code" title="django.http.HttpResponse.status_code"><code class="xref py py-attr docutils literal notranslate"><span class="pre">HttpResponse.status_code</span></code></a> 的当前值确定。在构造函数之外修改 <code class="docutils literal notranslate"><span class="pre">status_code</span></code> 的值也会修改 <code class="docutils literal notranslate"><span class="pre">reason_phrase</span></code> 的值。</li>
<li>调试视图现在在 Python 3 上显示链式异常的详细信息。</li>
<li>默认的 40x 错误视图现在接受第二个位置参数，即触发视图的异常。</li>
<li>视图错误处理程序现在支持 <a class="reference internal" href="../ref/template-response.html#django.template.response.TemplateResponse" title="django.template.response.TemplateResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">TemplateResponse</span></code></a>，这在使用基于类的视图时常常使用。</li>
<li>由 <code class="docutils literal notranslate"><span class="pre">render()</span></code> 方法引发的异常现在会传递给每个中间件的 <code class="docutils literal notranslate"><span class="pre">process_exception()</span></code> 方法。</li>
<li>请求中间件现在可以将 <a class="reference internal" href="../ref/request-response.html#django.http.HttpRequest.urlconf" title="django.http.HttpRequest.urlconf"><code class="xref py py-attr docutils literal notranslate"><span class="pre">HttpRequest.urlconf</span></code></a> 设置为 <code class="docutils literal notranslate"><span class="pre">None</span></code>，以撤销之前中间件所做的任何更改并返回使用 <a class="reference internal" href="../ref/settings.html#std-setting-ROOT_URLCONF"><code class="xref std std-setting docutils literal notranslate"><span class="pre">ROOT_URLCONF</span></code></a>。</li>
<li>在 <a class="reference internal" href="../ref/middleware.html#django.middleware.common.CommonMiddleware" title="django.middleware.common.CommonMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">CommonMiddleware</span></code></a> 中的 <a class="reference internal" href="../ref/settings.html#std-setting-DISALLOWED_USER_AGENTS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DISALLOWED_USER_AGENTS</span></code></a> 检查现在引发 <a class="reference internal" href="../ref/exceptions.html#django.core.exceptions.PermissionDenied" title="django.core.exceptions.PermissionDenied"><code class="xref py py-class docutils literal notranslate"><span class="pre">PermissionDenied</span></code></a> 异常，而不是返回 <a class="reference internal" href="../ref/request-response.html#django.http.HttpResponseForbidden" title="django.http.HttpResponseForbidden"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpResponseForbidden</span></code></a>，以便调用 <a class="reference internal" href="../ref/urls.html#django.conf.urls.handler403" title="django.conf.urls.handler403"><code class="xref py py-data docutils literal notranslate"><span class="pre">handler403</span></code></a>。</li>
<li>添加了 <a class="reference internal" href="../ref/request-response.html#django.http.HttpRequest.get_port" title="django.http.HttpRequest.get_port"><code class="xref py py-meth docutils literal notranslate"><span class="pre">HttpRequest.get_port()</span></code></a> 方法，用于获取请求的起始端口。</li>
<li>在 <a class="reference internal" href="../ref/request-response.html#django.http.JsonResponse" title="django.http.JsonResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">JsonResponse</span></code></a> 中添加了 <code class="docutils literal notranslate"><span class="pre">json_dumps_params</span></code> 参数，允许将关键字参数传递给用于生成响应的 <code class="docutils literal notranslate"><span class="pre">json.dumps()</span></code> 调用。</li>
<li><a class="reference internal" href="../ref/middleware.html#django.middleware.common.BrokenLinkEmailsMiddleware" title="django.middleware.common.BrokenLinkEmailsMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">BrokenLinkEmailsMiddleware</span></code></a> 现在在引用者等于请求的 URL 时忽略 404 错误。为了规避已经实施的空引用检查，一些网络爬虫将引用者设置为请求的 URL。</li>
</ul>
</div>
<div class="section" id="s-templates">
<span id="templates"></span><h4>模板<a class="headerlink" href="#templates" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>使用 <a class="reference internal" href="../howto/custom-template-tags.html#django.template.Library.simple_tag" title="django.template.Library.simple_tag"><code class="xref py py-meth docutils literal notranslate"><span class="pre">simple_tag()</span></code></a> 辅助程序创建的模板标签现在可以使用 <code class="docutils literal notranslate"><span class="pre">as</span></code> 参数将结果存储在模板变量中。</li>
<li>添加了 <a class="reference internal" href="../ref/templates/api.html#django.template.Context.setdefault" title="django.template.Context.setdefault"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Context.setdefault()</span></code></a> 方法。</li>
<li>添加了 <a class="reference internal" href="../ref/logging.html#django-template-logger"><span class="std std-ref">django.template</span></a> 记录器，并包括以下消息：<ul>
<li>对于缺少上下文变量的情况，添加了一个 <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> 级别的消息。</li>
<li>在关闭调试模式时，对于在渲染 <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include</span> <span class="pre">%}</span></code> 期间引发的未捕获异常，添加了一个 <code class="docutils literal notranslate"><span class="pre">WARNING</span></code> 级别的消息（这对于 <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include</span> <span class="pre">%}</span></code> 会将异常消除并返回空字符串的情况很有帮助）。</li>
</ul>
</li>
<li><a class="reference internal" href="../ref/templates/builtins.html#std-templatetag-firstof"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">firstof</span></code></a> 模板标签支持使用 'as' 将输出存储在一个变量中。</li>
<li><a class="reference internal" href="../ref/templates/api.html#django.template.Context.update" title="django.template.Context.update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Context.update()</span></code></a> can now be used as
a context manager.</li>
<li>Django 模板加载器现在可以递归地扩展模板。</li>
<li>调试页面模板的事后分析现在包括安装的每个引擎的输出。</li>
<li>为自定义模板引擎添加了 <a class="reference internal" href="../howto/custom-template-backend.html#template-debug-integration"><span class="std std-ref">调试页面集成</span></a>。</li>
<li><a class="reference internal" href="../topics/templates.html#django.template.backends.django.DjangoTemplates" title="django.template.backends.django.DjangoTemplates"><code class="xref py py-class docutils literal notranslate"><span class="pre">DjangoTemplates</span></code></a> 后端通过模板 <a class="reference internal" href="../ref/settings.html#std-setting-TEMPLATES-OPTIONS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">OPTIONS</span></code></a> 获得了明确注册库和内置函数的能力。</li>
<li><code class="docutils literal notranslate"><span class="pre">timesince</span></code> 和 <code class="docutils literal notranslate"><span class="pre">timeuntil</span></code> 过滤器在处理大时间跨度时进行了改进，以应对闰年。</li>
<li><code class="docutils literal notranslate"><span class="pre">include</span></code> 标签现在在模板渲染期间缓存解析的模板对象，加快了在诸如 for 循环等地方的重复使用。</li>
</ul>
</div>
<div class="section" id="s-tests">
<span id="tests"></span><h4>测试<a class="headerlink" href="#tests" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>在测试客户端响应中添加了 <a class="reference internal" href="../topics/testing/tools.html#django.test.Response.json" title="django.test.Response.json"><code class="xref py py-meth docutils literal notranslate"><span class="pre">json()</span></code></a> 方法，以便访问响应体作为 JSON。</li>
<li>在测试客户端中添加了 <a class="reference internal" href="../topics/testing/tools.html#django.test.Client.force_login" title="django.test.Client.force_login"><code class="xref py py-meth docutils literal notranslate"><span class="pre">force_login()</span></code></a> 方法。使用该方法模拟用户登录站点的效果，同时跳过 <a class="reference internal" href="../topics/testing/tools.html#django.test.Client.login" title="django.test.Client.login"><code class="xref py py-meth docutils literal notranslate"><span class="pre">login()</span></code></a> 的身份验证和验证步骤。</li>
</ul>
</div>
<div class="section" id="s-urls">
<span id="urls"></span><h4>URLs<a class="headerlink" href="#urls" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>URL 模式中现在允许使用正则表达式的环视断言。</li>
<li>应用程序命名空间现在可以通过在包含的模块或对象上设置 <code class="docutils literal notranslate"><span class="pre">app_name</span></code> 属性来设置。也可以通过将一个 2 元组（&lt;模式列表&gt;，&lt;应用程序命名空间&gt;）作为 <code class="docutils literal notranslate"><span class="pre">include()</span></code> 的第一个参数来设置。</li>
<li>已添加了用于检测常见 URL 模式错误的系统检查。</li>
</ul>
</div>
<div class="section" id="s-validators">
<span id="validators"></span><h4>验证器<a class="headerlink" href="#validators" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>添加了 <a class="reference internal" href="../ref/validators.html#django.core.validators.int_list_validator" title="django.core.validators.int_list_validator"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.core.validators.int_list_validator()</span></code></a>，用于生成验证包含整数并用自定义字符分隔的字符串的验证器。</li>
<li><a class="reference internal" href="../ref/validators.html#django.core.validators.EmailValidator" title="django.core.validators.EmailValidator"><code class="xref py py-class docutils literal notranslate"><span class="pre">EmailValidator</span></code></a> 现在根据 <span class="target" id="index-6"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1034.html"><strong>RFC 1034</strong></a>，限制了域名标签的长度为 63 个字符。</li>
<li>添加了 <a class="reference internal" href="../ref/validators.html#django.core.validators.validate_unicode_slug" title="django.core.validators.validate_unicode_slug"><code class="xref py py-func docutils literal notranslate"><span class="pre">validate_unicode_slug()</span></code></a>，用于验证可能包含 Unicode 字符的 slugs。</li>
</ul>
</div>
</div>
</div>
<div class="section" id="s-backwards-incompatible-changes-in-1-9">
<span id="s-backwards-incompatible-1-9"></span><span id="backwards-incompatible-changes-in-1-9"></span><span id="backwards-incompatible-1-9"></span><h2>1.9 版本中的不向后兼容变更<a class="headerlink" href="#backwards-incompatible-changes-in-1-9" title="永久链接至标题">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">除了本节中概述的更改之外，请确保查看 <a class="reference internal" href="#removed-features-1-9"><span class="std std-ref">在 1.9 版本中移除的功能。</span></a>，了解已经完成弃用周期并因此被移除的功能。如果您没有在给定功能的弃用时间内更新您的代码，其移除可能会被视为不兼容的更改。</p>
</div>
<div class="section" id="s-database-backend-api">
<span id="database-backend-api"></span><h3>数据库后端 API<a class="headerlink" href="#database-backend-api" title="永久链接至标题">¶</a></h3>
<ul>
<li><p class="first">一些新的测试依赖于后端能够自省列的默认值（将结果返回为 <code class="docutils literal notranslate"><span class="pre">Field.default</span></code>）。如果您的后端没有实现这个功能，您可以将数据库特性 <code class="docutils literal notranslate"><span class="pre">can_introspect_default</span></code> 设置为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。您可能希望参考 Django 包含的后端的实现来进行审查（<a class="reference external" href="https://code.djangoproject.com/ticket/24245">#24245</a>）。</p>
</li>
<li><p class="first">不鼓励在 DB-API 模块级别注册全局适配器或转换器来处理作为查询参数传递或作为查询结果返回的不支持时区的 <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a> 值的时区信息。这可能会与其他库发生冲突。</p>
<p>向从数据库获取的 <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a> 值添加时区的推荐方法是在 <code class="docutils literal notranslate"><span class="pre">DatabaseOperations.get_db_converters()</span></code> 中为 <code class="docutils literal notranslate"><span class="pre">DateTimeField</span></code> 注册一个转换器。</p>
<p>已移除了 <code class="docutils literal notranslate"><span class="pre">needs_datetime_string_cast</span></code> 数据库特性。设置了这个特性的数据库后端必须按照上述说明注册一个转换器。</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">DatabaseOperations.value_to_db_&lt;type&gt;()</span></code> 方法被重命名为 <code class="docutils literal notranslate"><span class="pre">adapt_&lt;type&gt;field_value()</span></code>，以与 <code class="docutils literal notranslate"><span class="pre">convert_&lt;type&gt;field_value()</span></code> 方法保持一致。</p>
</li>
<li><p class="first">要使用新的 <code class="docutils literal notranslate"><span class="pre">date</span></code> 查询，第三方数据库后端可能需要实现 <code class="docutils literal notranslate"><span class="pre">DatabaseOperations.datetime_cast_date_sql()</span></code> 方法。</p>
</li>
<li><p class="first">添加了 <code class="docutils literal notranslate"><span class="pre">DatabaseOperations.time_extract_sql()</span></code> 方法。它调用现有的 <code class="docutils literal notranslate"><span class="pre">date_extract_sql()</span></code> 方法。SQLite 后端会重写此方法，以向 <a class="reference internal" href="../ref/models/fields.html#django.db.models.TimeField" title="django.db.models.TimeField"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeField</span></code></a> 添加时间查询（小时、分钟、秒），第三方数据库后端可能需要实现此方法。</p>
</li>
<li><p class="first">已删除 <code class="docutils literal notranslate"><span class="pre">DatabaseOperations.datetime_cast_sql()</span></code> 方法（请不要与上面提到的 <code class="docutils literal notranslate"><span class="pre">DatabaseOperations.datetime_cast_date_sql()</span></code> 混淆）。这个方法在很多年前用于在 Oracle 上格式化日期，但很多年来没有被任何核心后端重写，也没有在 Django 代码或测试中被调用过。</p>
</li>
<li><p class="first">为了支持测试并行化，您必须实现 <code class="docutils literal notranslate"><span class="pre">DatabaseCreation._clone_test_db()</span></code> 方法并设置 <code class="docutils literal notranslate"><span class="pre">DatabaseFeatures.can_clone_databases</span> <span class="pre">=</span> <span class="pre">True</span></code>。您可能需要调整 <code class="docutils literal notranslate"><span class="pre">DatabaseCreation.get_test_db_clone_settings()</span></code>。</p>
</li>
</ul>
</div>
<div class="section" id="s-default-settings-that-were-tuples-are-now-lists">
<span id="default-settings-that-were-tuples-are-now-lists"></span><h3>原来的默认设置是元组，现在改为列表<a class="headerlink" href="#default-settings-that-were-tuples-are-now-lists" title="永久链接至标题">¶</a></h3>
<p>在 <code class="docutils literal notranslate"><span class="pre">django.conf.global_settings</span></code> 中的默认设置原来是列表和元组的组合。以前是元组的所有设置现在都改为了列表。</p>
</div>
<div class="section" id="s-is-usable-attribute-on-template-loaders-is-removed">
<span id="is-usable-attribute-on-template-loaders-is-removed"></span><h3>模板加载器上的 <code class="docutils literal notranslate"><span class="pre">is_usable</span></code> 属性已被移除。<a class="headerlink" href="#is-usable-attribute-on-template-loaders-is-removed" title="永久链接至标题">¶</a></h3>
<p>以前，Django 模板加载器需要定义一个 <code class="docutils literal notranslate"><span class="pre">is_usable</span></code> 属性。如果在模板设置中配置了一个加载器并且该属性为 <code class="docutils literal notranslate"><span class="pre">False</span></code>，则加载器将被静默忽略。在实际应用中，这只有 egg 加载器用于检测是否安装了 <code class="docutils literal notranslate"><span class="pre">setuptools</span></code>。现在已删除 <code class="docutils literal notranslate"><span class="pre">is_usable</span></code> 属性，而 egg 加载器在运行时如果没有安装 <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> 则会失败。</p>
</div>
<div class="section" id="s-related-set-direct-assignment">
<span id="related-set-direct-assignment"></span><h3>相关集合直接赋值<a class="headerlink" href="#related-set-direct-assignment" title="永久链接至标题">¶</a></h3>
<p>在 ORM 中直接分配相关对象以前会执行 <code class="docutils literal notranslate"><span class="pre">clear()</span></code>，然后调用 <code class="docutils literal notranslate"><span class="pre">add()</span></code>。这导致了不必要的大量数据更改，并且阻止使用 <a class="reference internal" href="../ref/signals.html#django.db.models.signals.m2m_changed" title="django.db.models.signals.m2m_changed"><code class="xref py py-data docutils literal notranslate"><span class="pre">m2m_changed</span></code></a> 信号来跟踪多对多关系中的个别更改。</p>
<p>直接赋值现在依赖于相关管理器上的新 <a class="reference internal" href="../ref/models/relations.html#django.db.models.fields.related.RelatedManager.set" title="django.db.models.fields.related.RelatedManager.set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set()</span></code></a> 方法，默认情况下只处理现有相关集合与新分配的相关集合之间的更改。可以通过将直接赋值替换为带有关键字参数 <code class="docutils literal notranslate"><span class="pre">clear=True</span></code> 的 <code class="docutils literal notranslate"><span class="pre">set()</span></code> 调用来恢复先前的行为。</p>
<p><code class="docutils literal notranslate"><span class="pre">ModelForm</span></code>，因此 <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code>，在内部对于多对多关系依赖于直接赋值，并因此现在使用新行为。</p>
</div>
<div class="section" id="s-filesystem-based-template-loaders-catch-more-specific-exceptions">
<span id="filesystem-based-template-loaders-catch-more-specific-exceptions"></span><h3>基于文件系统的模板加载器捕获更具体的异常<a class="headerlink" href="#filesystem-based-template-loaders-catch-more-specific-exceptions" title="永久链接至标题">¶</a></h3>
<p>使用 <a class="reference internal" href="../ref/templates/api.html#django.template.loaders.filesystem.Loader" title="django.template.loaders.filesystem.Loader"><code class="xref py py-class docutils literal notranslate"><span class="pre">filesystem.Loader</span></code></a> 或 <a class="reference internal" href="../ref/templates/api.html#django.template.loaders.app_directories.Loader" title="django.template.loaders.app_directories.Loader"><code class="xref py py-class docutils literal notranslate"><span class="pre">app_directories.Loader</span></code></a> 模板加载器时，较早版本的 Django 如果模板源存在但不可读，会引发 <a class="reference internal" href="../topics/templates.html#django.template.TemplateDoesNotExist" title="django.template.TemplateDoesNotExist"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TemplateDoesNotExist</span></code></a> 错误。这可能发生在许多情况下，例如如果 Django 没有权限打开文件，或者模板源是一个目录。现在，只有当模板源不存在时，Django 才会抑制异常。所有其他情况都会引发原始的 <code class="docutils literal notranslate"><span class="pre">IOError</span></code>。</p>
</div>
<div class="section" id="s-http-redirects-no-longer-forced-to-absolute-uris">
<span id="http-redirects-no-longer-forced-to-absolute-uris"></span><h3>HTTP 重定向不再强制要求使用绝对 URI<a class="headerlink" href="#http-redirects-no-longer-forced-to-absolute-uris" title="永久链接至标题">¶</a></h3>
<p>相对重定向不再被转换为绝对 URI。<span class="target" id="index-7"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2616.html"><strong>RFC 2616</strong></a> 要求重定向响应中的 <code class="docutils literal notranslate"><span class="pre">Location</span></code> 标头必须是绝对 URI，但它已被 <span class="target" id="index-8"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7231.html"><strong>RFC 7231</strong></a> 取代，允许在 <code class="docutils literal notranslate"><span class="pre">Location</span></code> 中使用相对 URI，承认用户代理的实际实践，几乎所有用户代理都支持相对 URI。</p>
<p>因此，传递给 <code class="docutils literal notranslate"><span class="pre">assertRedirects</span></code> 的预期 URL 通常不再应包括 URL 的方案和域部分。例如，<code class="docutils literal notranslate"><span class="pre">self.assertRedirects(response,</span> <span class="pre">'http://testserver/some-url/')</span></code> 应该替换为 <code class="docutils literal notranslate"><span class="pre">self.assertRedirects(response,</span> <span class="pre">'/some-url/')</span></code> （除非重定向明确包含绝对 URL）。</p>
<p>在极少数情况下，如果您需要旧的行为（使用一个古老版本的 Apache 和 <code class="docutils literal notranslate"><span class="pre">mod_scgi</span></code> 发现将相对重定向解释为 &quot;内部重定向&quot; 的情况），您可以通过编写自定义中间件来恢复它：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LocationHeaderFix</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">process_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;Location&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
            <span class="n">response</span><span class="p">[</span><span class="s2">&quot;Location&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">build_absolute_uri</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;Location&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">response</span>
</pre></div>
</div>
</div>
<div class="section" id="s-dropped-support-for-postgresql-9-0">
<span id="dropped-support-for-postgresql-9-0"></span><h3>不再支持 PostgreSQL 9.0 版本<a class="headerlink" href="#dropped-support-for-postgresql-9-0" title="永久链接至标题">¶</a></h3>
<p>PostgreSQL 9.0 的上游支持于 2015 年 9 月结束。因此，Django 1.9 将 9.1 版本设定为其正式支持的最低 PostgreSQL 版本。</p>
</div>
<div class="section" id="s-dropped-support-for-oracle-11-1">
<span id="dropped-support-for-oracle-11-1"></span><h3>不再支持 Oracle 11.1 版本<a class="headerlink" href="#dropped-support-for-oracle-11-1" title="永久链接至标题">¶</a></h3>
<p>Oracle 11.1 的上游支持于 2015 年 8 月结束。因此，Django 1.9 将 11.2 版本设定为其正式支持的最低 Oracle 版本。</p>
</div>
<div class="section" id="s-bulk-behavior-of-add-method-of-related-managers">
<span id="bulk-behavior-of-add-method-of-related-managers"></span><h3>关于相关管理器的 <code class="docutils literal notranslate"><span class="pre">add()</span></code> 方法的批量行为<a class="headerlink" href="#bulk-behavior-of-add-method-of-related-managers" title="永久链接至标题">¶</a></h3>
<p>为了提高性能，由 <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code> 和 <code class="docutils literal notranslate"><span class="pre">GenericForeignKey</span></code> 创建的相关管理器的 <code class="docutils literal notranslate"><span class="pre">add()</span></code> 方法从一系列 <code class="docutils literal notranslate"><span class="pre">Model.save()</span></code> 调用改为单个 <code class="docutils literal notranslate"><span class="pre">QuerySet.update()</span></code> 调用。这个变化意味着不再发送 <code class="docutils literal notranslate"><span class="pre">pre_save</span></code> 和 <code class="docutils literal notranslate"><span class="pre">post_save</span></code> 信号。您可以使用 <code class="docutils literal notranslate"><span class="pre">bulk=False</span></code> 关键字参数来恢复到以前的行为。</p>
</div>
<div class="section" id="s-template-loaderorigin-and-stringorigin-are-removed">
<span id="template-loaderorigin-and-stringorigin-are-removed"></span><h3>模板中移除了 <code class="docutils literal notranslate"><span class="pre">LoaderOrigin</span></code> 和 <code class="docutils literal notranslate"><span class="pre">StringOrigin</span></code><a class="headerlink" href="#template-loaderorigin-and-stringorigin-are-removed" title="永久链接至标题">¶</a></h3>
<p>在之前的 Django 版本中，当一个模板引擎以 <code class="docutils literal notranslate"><span class="pre">True</span></code> 的调试设置初始化时，一个 <code class="docutils literal notranslate"><span class="pre">django.template.loader.LoaderOrigin</span></code> 或 <code class="docutils literal notranslate"><span class="pre">django.template.base.StringOrigin</span></code> 的实例被设置为模板对象的 origin 属性。这些类已经合并为 <a class="reference internal" href="../ref/templates/api.html#django.template.base.Origin" title="django.template.base.Origin"><code class="xref py py-class docutils literal notranslate"><span class="pre">Origin</span></code></a>，并且无论引擎的调试设置如何，都会始终设置。为了最小程度的向后兼容性，旧的类名将保留为新的 <code class="docutils literal notranslate"><span class="pre">Origin</span></code> 类的别名，直到 Django 2.0。</p>
</div>
<div class="section" id="s-changes-to-the-default-logging-configuration">
<span id="s-default-logging-changes-19"></span><span id="changes-to-the-default-logging-configuration"></span><span id="default-logging-changes-19"></span><h3>默认日志配置的更改<a class="headerlink" href="#changes-to-the-default-logging-configuration" title="永久链接至标题">¶</a></h3>
<p>为了更容易编写自定义的日志配置，Django 的默认日志配置不再定义 <code class="docutils literal notranslate"><span class="pre">django.request</span></code> 和 <code class="docutils literal notranslate"><span class="pre">django.security</span></code> 记录器。取而代之的是，它定义了一个名为 <code class="docutils literal notranslate"><span class="pre">django</span></code> 的记录器，过滤级别为 <code class="docutils literal notranslate"><span class="pre">INFO</span></code>，具有两个处理程序：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">console</span></code>：过滤级别为 <code class="docutils literal notranslate"><span class="pre">INFO</span></code>，仅在 <code class="docutils literal notranslate"><span class="pre">DEBUG=True</span></code> 时激活。</li>
<li><code class="docutils literal notranslate"><span class="pre">mail_admins</span></code>：过滤级别为 <code class="docutils literal notranslate"><span class="pre">ERROR</span></code>，仅在 <code class="docutils literal notranslate"><span class="pre">DEBUG=False</span></code> 时激活。</li>
</ul>
<p>如果您没有覆盖 Django 的默认日志配置，您的行为应该只会发生较少的变化，但您可能会在 <code class="docutils literal notranslate"><span class="pre">runserver</span></code> 控制台上看到一些新的日志记录，例如。</p>
<p>如果您正在覆盖 Django 的默认日志配置，您应该检查您的配置与新默认值如何合并。</p>
</div>
<div class="section" id="s-httprequest-details-in-error-reporting">
<span id="httprequest-details-in-error-reporting"></span><h3>在错误报告中的 <code class="docutils literal notranslate"><span class="pre">HttpRequest</span></code> 详细信息<a class="headerlink" href="#httprequest-details-in-error-reporting" title="永久链接至标题">¶</a></h3>
<p>每次在调试页面的 HTML 版本和错误邮件中作为堆栈帧变量出现时都显示完整的 <a class="reference internal" href="../ref/request-response.html#django.http.HttpRequest" title="django.http.HttpRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpRequest</span></code></a> 详细信息是多余的。因此，HTTP 请求现在将显示与其他变量相同的标准表示形式（<code class="docutils literal notranslate"><span class="pre">repr(request)</span></code>）。因此，删除了 <code class="docutils literal notranslate"><span class="pre">ExceptionReporterFilter.get_request_repr()</span></code> 方法和未记录的 <code class="docutils literal notranslate"><span class="pre">django.http.build_request_repr()</span></code> 函数。</p>
<p>电子邮件的文本版本内容已修改，以提供与 AJAX 请求的情况相同结构的回溯。回溯详细信息由 <code class="docutils literal notranslate"><span class="pre">ExceptionReporter.get_traceback_text()</span></code> 方法呈现。</p>
</div>
<div class="section" id="s-removal-of-time-zone-aware-global-adapters-and-converters-for-datetimes">
<span id="removal-of-time-zone-aware-global-adapters-and-converters-for-datetimes"></span><h3>移除了日期时间的时区感知全局适配器和转换器<a class="headerlink" href="#removal-of-time-zone-aware-global-adapters-and-converters-for-datetimes" title="永久链接至标题">¶</a></h3>
<p>Django 不再注册全局适配器和转换器来管理发送到数据库的查询参数中的 <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a> 值的时区信息，以及从查询结果中读取的时区信息。这个变化影响满足以下所有条件的项目：</p>
<ul class="simple">
<li><a class="reference internal" href="../ref/settings.html#std-setting-USE_TZ"><code class="xref std std-setting docutils literal notranslate"><span class="pre">USE_TZ</span></code></a> 设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code>。</li>
<li>数据库是 SQLite、MySQL、Oracle 或不支持时区的第三方数据库。如有疑问，您可以检查 <code class="docutils literal notranslate"><span class="pre">connection.features.supports_timezones</span></code> 的值。</li>
<li>代码在 ORM 之外查询数据库，通常使用 <code class="docutils literal notranslate"><span class="pre">cursor.execute(sql,</span> <span class="pre">params)</span></code>。</li>
</ul>
<p>如果您将感知的 <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a> 参数传递给这些查询，您应该将它们转换为 UTC 中的非感知日期时间：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>

<span class="n">param</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">make_naive</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
</pre></div>
</div>
<p>如果您未这样做，转换将按照早期版本（带有弃用警告）中的方式执行，直到 Django 1.11 为止。 Django 2.0 不会执行任何转换，这可能导致数据损坏。</p>
<p>如果您从结果中读取 <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a> 值，它们将是非感知的，而不是感知的。您可以按以下方式进行补偿：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>

<span class="n">value</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">make_aware</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
</pre></div>
</div>
<p>如果您通过 ORM 查询数据库，即使使用 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.raw" title="django.db.models.query.QuerySet.raw"><code class="xref py py-meth docutils literal notranslate"><span class="pre">raw()</span></code></a> 查询，也不需要进行上述操作。ORM 会处理时区信息的管理。</p>
</div>
<div class="section" id="s-template-tag-modules-are-imported-when-templates-are-configured">
<span id="template-tag-modules-are-imported-when-templates-are-configured"></span><h3>在配置模板时导入模板标签模块<a class="headerlink" href="#template-tag-modules-are-imported-when-templates-are-configured" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../topics/templates.html#django.template.backends.django.DjangoTemplates" title="django.template.backends.django.DjangoTemplates"><code class="xref py py-class docutils literal notranslate"><span class="pre">DjangoTemplates</span></code></a> 后端现在在实例化时执行已安装的模板标签模块的发现。此更新使得在定义 <a class="reference internal" href="../topics/templates.html#django.template.backends.django.DjangoTemplates" title="django.template.backends.django.DjangoTemplates"><code class="xref py py-class docutils literal notranslate"><span class="pre">DjangoTemplates</span></code></a> 后端时，可以通过 <a class="reference internal" href="../ref/settings.html#std-setting-TEMPLATES-OPTIONS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">OPTIONS</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">'libraries'</span></code> 键明确提供库。模板标签模块中的导入或语法错误现在会在实例化时提前失败，而不是在首次编译带有 <a class="reference internal" href="../ref/templates/builtins.html#std-templatetag-load"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">{%</span> <span class="pre">load</span> <span class="pre">%}</span></code></a> 标签的模板时失败。</p>
</div>
<div class="section" id="s-django-template-base-add-to-builtins-is-removed">
<span id="django-template-base-add-to-builtins-is-removed"></span><h3>已删除 <code class="docutils literal notranslate"><span class="pre">django.template.base.add_to_builtins()</span></code>。<a class="headerlink" href="#django-template-base-add-to-builtins-is-removed" title="永久链接至标题">¶</a></h3>
<p>虽然它是一个私有 API，但项目通常使用 <code class="docutils literal notranslate"><span class="pre">add_to_builtins()</span></code> 来使模板标签和过滤器在不使用 <a class="reference internal" href="../ref/templates/builtins.html#std-templatetag-load"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">{%</span> <span class="pre">load</span> <span class="pre">%}</span></code></a> 标签的情况下可用。这个 API 已经正式化。现在项目应该在定义 <a class="reference internal" href="../topics/templates.html#django.template.backends.django.DjangoTemplates" title="django.template.backends.django.DjangoTemplates"><code class="xref py py-class docutils literal notranslate"><span class="pre">DjangoTemplates</span></code></a> 后端时，通过 <a class="reference internal" href="../ref/settings.html#std-setting-TEMPLATES-OPTIONS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">OPTIONS</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">'builtins'</span></code> 键来定义内置库。</p>
</div>
<div class="section" id="s-simple-tag-now-wraps-tag-output-in-conditional-escape">
<span id="s-simple-tag-conditional-escape-fix"></span><span id="simple-tag-now-wraps-tag-output-in-conditional-escape"></span><span id="simple-tag-conditional-escape-fix"></span><h3><code class="docutils literal notranslate"><span class="pre">simple_tag</span></code> 现在在标签输出中包装了 <code class="docutils literal notranslate"><span class="pre">conditional_escape</span></code><a class="headerlink" href="#simple-tag-now-wraps-tag-output-in-conditional-escape" title="永久链接至标题">¶</a></h3>
<p>通常，模板标签不会自动转义其内容，这种行为是被 <a class="reference internal" href="../howto/custom-template-tags.html#tags-auto-escaping"><span class="std std-ref">文档记录的</span></a>。对于像 <a class="reference internal" href="../howto/custom-template-tags.html#django.template.Library.inclusion_tag" title="django.template.Library.inclusion_tag"><code class="xref py py-class docutils literal notranslate"><span class="pre">inclusion_tag</span></code></a> 这样的标签，这不是问题，因为被包含的模板会执行自动转义。对于 <code class="docutils literal notranslate"><span class="pre">assignment_tag()</span></code>，当它在模板中作为变量使用时，输出会被转义。</p>
<p>然而，对于 <a class="reference internal" href="../howto/custom-template-tags.html#django.template.Library.simple_tag" title="django.template.Library.simple_tag"><code class="xref py py-class docutils literal notranslate"><span class="pre">simple_tag</span></code></a> 的预期用例，很容易出现不正确的 HTML 和可能的 XSS 攻击。例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@register</span><span class="o">.</span><span class="n">simple_tag</span><span class="p">(</span><span class="n">takes_context</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">greeting</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;Hello </span><span class="si">{0}</span><span class="s2">!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;request&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">first_name</span><span class="p">)</span>
</pre></div>
</div>
<p>在较早版本的 Django 中，这将是一个 XSS 问题，因为``user.first_name`` 没有经过转义。</p>
<p>在 Django 1.9 中，这个问题得到了修复：如果模板上下文设置了 <code class="docutils literal notranslate"><span class="pre">autoescape=True</span></code> （默认值），那么 <code class="docutils literal notranslate"><span class="pre">simple_tag</span></code> 将使用 <a class="reference internal" href="../ref/utils.html#django.utils.html.conditional_escape" title="django.utils.html.conditional_escape"><code class="xref py py-func docutils literal notranslate"><span class="pre">conditional_escape()</span></code></a> 包装标签函数的输出。</p>
<p>要修复您的 <code class="docutils literal notranslate"><span class="pre">simple_tag</span></code>，最好遵循以下实践：</p>
<ul class="simple">
<li>生成 HTML 的任何代码都应该使用模板系统或 <a class="reference internal" href="../ref/utils.html#django.utils.html.format_html" title="django.utils.html.format_html"><code class="xref py py-func docutils literal notranslate"><span class="pre">format_html()</span></code></a>。</li>
<li>如果 <code class="docutils literal notranslate"><span class="pre">simple_tag</span></code> 的输出需要转义，请使用 <a class="reference internal" href="../ref/utils.html#django.utils.html.escape" title="django.utils.html.escape"><code class="xref py py-func docutils literal notranslate"><span class="pre">escape()</span></code></a> 或 <a class="reference internal" href="../ref/utils.html#django.utils.html.conditional_escape" title="django.utils.html.conditional_escape"><code class="xref py py-func docutils literal notranslate"><span class="pre">conditional_escape()</span></code></a>。</li>
<li>如果您绝对确定您正在输出来自可信源的 HTML（例如，由管理员输入的 HTML 存储在 CMS 字段中），您可以使用 <a class="reference internal" href="../ref/utils.html#django.utils.safestring.mark_safe" title="django.utils.safestring.mark_safe"><code class="xref py py-func docutils literal notranslate"><span class="pre">mark_safe()</span></code></a> 来标记它。</li>
</ul>
<p>遵循这些规则的标签无论在 Django 1.9+ 还是之前的版本上运行，都将是正确和安全的。</p>
</div>
<div class="section" id="s-paginator-page-range">
<span id="paginator-page-range"></span><h3><code class="docutils literal notranslate"><span class="pre">Paginator.page_range</span></code><a class="headerlink" href="#paginator-page-range" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../ref/paginator.html#django.core.paginator.Paginator.page_range" title="django.core.paginator.Paginator.page_range"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Paginator.page_range</span></code></a> 现在是一个迭代器而不是一个列表。</p>
<p>在 Django 1.8 之前的版本中，<code class="docutils literal notranslate"><span class="pre">Paginator.page_range</span></code> 在 Python 2 中返回一个 <code class="docutils literal notranslate"><span class="pre">list</span></code>，在 Python 3 中返回一个 <code class="docutils literal notranslate"><span class="pre">range</span></code>。Django 1.8 一致返回一个列表，但迭代器更有效率。</p>
<p>依赖于 <code class="docutils literal notranslate"><span class="pre">list</span></code> 特定功能（如索引）的现有代码可以通过使用 <code class="docutils literal notranslate"><span class="pre">list()</span></code> 将迭代器转换为 <code class="docutils literal notranslate"><span class="pre">list</span></code> 来迁移。</p>
</div>
<div class="section" id="s-implicit-queryset-in-lookup-removed">
<span id="implicit-queryset-in-lookup-removed"></span><h3>隐式的 <code class="docutils literal notranslate"><span class="pre">QuerySet</span></code> <code class="docutils literal notranslate"><span class="pre">__in</span></code> 查询已移除<a class="headerlink" href="#implicit-queryset-in-lookup-removed" title="永久链接至标题">¶</a></h3>
<p>在早期版本中，类似以下的查询：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Model</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">related_id</span><span class="o">=</span><span class="n">RelatedModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
</pre></div>
</div>
<p>会隐式转换为：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Model</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">related_id__in</span><span class="o">=</span><span class="n">RelatedModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
</pre></div>
</div>
<p>这将导致 SQL 查询类似于 <code class="docutils literal notranslate"><span class="pre">&quot;related_id</span> <span class="pre">IN</span> <span class="pre">(SELECT</span> <span class="pre">id</span> <span class="pre">FROM</span> <span class="pre">...)&quot;</span></code>。</p>
<p>这种隐式的 <code class="docutils literal notranslate"><span class="pre">__in</span></code> 不再发生，因此 &quot;IN&quot; SQL 现在变成了 &quot;=&quot;, 如果子查询返回多个结果，至少某些数据库会抛出错误。</p>
</div>
<div class="section" id="s-contrib-admin-browser-support">
<span id="s-admin-browser-support-19"></span><span id="contrib-admin-browser-support"></span><span id="admin-browser-support-19"></span><h3><code class="docutils literal notranslate"><span class="pre">contrib.admin</span></code> 浏览器支持<a class="headerlink" href="#contrib-admin-browser-support" title="永久链接至标题">¶</a></h3>
<p>管理员不再支持 Internet Explorer 8 及以下版本，因为这些浏览器已经到达生命周期终点。</p>
<p>已删除支持 Internet Explorer 6 和 7 的 CSS 和图像。 PNG 和 GIF 图标已被替换为 SVG 图标，这些图标不受 Internet Explorer 8 及更早版本的支持。</p>
<p>嵌入在管理员中的 jQuery 库已从 1.11.2 版本升级到 2.1.4 版本。 jQuery 2.x 具有与 jQuery 1.x 相同的 API，但不支持 Internet Explorer 6 、 7 或 8，从而实现更好的性能和更小的文件大小。如果您需要支持 IE8 并且必须使用最新版本的 Django，您可以通过创建具有以下结构的 Django 应用程序来覆盖管理员的 jQuery 副本：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>app/static/admin/js/vendor/
    jquery.js
    jquery.min.js
</pre></div>
</div>
</div>
<div class="section" id="s-syntaxerror-when-installing-django-setuptools-5-5-x">
<span id="s-syntax-error-old-setuptools-django-19"></span><span id="syntaxerror-when-installing-django-setuptools-5-5-x"></span><span id="syntax-error-old-setuptools-django-19"></span><h3>在 <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> 5.5.x 安装 Django 时出现 <code class="docutils literal notranslate"><span class="pre">SyntaxError</span></code> 错误<a class="headerlink" href="#syntaxerror-when-installing-django-setuptools-5-5-x" title="永久链接至标题">¶</a></h3>
<p>当使用 <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> 5.5.x 安装 Django 1.9 或 1.9.1 时，你会看到：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>Compiling<span class="w"> </span>django/conf/app_template/apps.py<span class="w"> </span>...
<span class="w">  </span>File<span class="w"> </span><span class="s2">&quot;django/conf/app_template/apps.py&quot;</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">4</span>
<span class="w">    </span>class<span class="w"> </span><span class="o">{{</span><span class="w"> </span>camel_case_app_name<span class="w"> </span><span class="o">}}</span>Config<span class="o">(</span>AppConfig<span class="o">)</span>:
<span class="w">          </span>^
SyntaxError:<span class="w"> </span>invalid<span class="w"> </span>syntax

Compiling<span class="w"> </span>django/conf/app_template/models.py<span class="w"> </span>...
<span class="w">  </span>File<span class="w"> </span><span class="s2">&quot;django/conf/app_template/models.py&quot;</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="o">{{</span><span class="w"> </span>unicode_literals<span class="w"> </span><span class="o">}}</span>from<span class="w"> </span>django.db<span class="w"> </span>import<span class="w"> </span>models
<span class="w">                             </span>^
SyntaxError:<span class="w"> </span>invalid<span class="w"> </span>syntax
</pre></div>
</div>
<p>你可以安全地忽略这些错误（Django 仍然会正常安装），但你可以通过升级 <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> 到一个更近期的版本来避免它们。如果你使用 pip，你可以使用 <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-U</span> <span class="pre">pip</span></code> 来升级 pip，这也会升级 <code class="docutils literal notranslate"><span class="pre">setuptools</span></code>。这个问题在后续版本的 Django 中已经得到解决，如 <a class="reference internal" href="1.9.2.html"><span class="doc">Django 1.9.2 版本发行说明</span></a> 中所描述的那样。</p>
</div>
<div class="section" id="s-miscellaneous">
<span id="miscellaneous"></span><h3>杂项<a class="headerlink" href="#miscellaneous" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">contrib.admin</span></code> 中的 jQuery 静态文件已经移动到一个名为 <code class="docutils literal notranslate"><span class="pre">vendor/jquery</span></code> 的子目录中。</li>
<li>在管理 changelist 的 <code class="docutils literal notranslate"><span class="pre">list_display</span></code> 单元格中，空列的显示文本已经从 <code class="docutils literal notranslate"><span class="pre">(None)</span></code> （或其翻译等效）更改为 <code class="docutils literal notranslate"><span class="pre">-</span></code> （破折号）。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.http.responses.REASON_PHRASES</span></code> 和 <code class="docutils literal notranslate"><span class="pre">django.core.handlers.wsgi.STATUS_CODE_TEXT</span></code> 已被移除。请改为使用 Python 标准库：对于 Python 3，使用 <a class="reference external" href="https://docs.python.org/3/library/http.client.html#http.client.responses" title="(在 Python v3.12)"><code class="xref py py-data docutils literal notranslate"><span class="pre">http.client.responses</span></code></a>，对于 Python 2，使用 <a class="reference external" href="https://docs.python.org/2/library/httplib.html#httplib.responses">httplib.responses</a>。</li>
<li><code class="docutils literal notranslate"><span class="pre">ValuesQuerySet</span></code> 和 <code class="docutils literal notranslate"><span class="pre">ValuesListQuerySet</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">admin/base.html</span></code> 模板不再设置 <code class="docutils literal notranslate"><span class="pre">window.__admin_media_prefix__</span></code> 或 <code class="docutils literal notranslate"><span class="pre">window.__admin_utc_offset__</span></code>。在 JavaScript 中使用该值构建绝对 URL 的图像引用已经移动到 CSS 中，以便更容易进行自定义。UTC 偏移量存储在 <code class="docutils literal notranslate"><span class="pre">&lt;body&gt;</span></code> 标签的数据属性中。</li>
<li><code class="docutils literal notranslate"><span class="pre">CommaSeparatedIntegerField</span></code> 的验证已经更加精细化，不再允许像 <code class="docutils literal notranslate"><span class="pre">','</span></code>、<code class="docutils literal notranslate"><span class="pre">',1'</span></code> 和 <code class="docutils literal notranslate"><span class="pre">'1,,2'</span></code> 这样的值。</li>
<li>表单的初始化已经从 <a class="reference internal" href="../ref/class-based-views/mixins-editing.html#django.views.generic.edit.ProcessFormView.get" title="django.views.generic.edit.ProcessFormView.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ProcessFormView.get()</span></code></a> 方法移动到新的 <a class="reference internal" href="../ref/class-based-views/mixins-editing.html#django.views.generic.edit.FormMixin.get_context_data" title="django.views.generic.edit.FormMixin.get_context_data"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FormMixin.get_context_data()</span></code></a> 方法。如果你曾经重写了 <code class="docutils literal notranslate"><span class="pre">get_context_data()</span></code> 方法而没有调用 <code class="docutils literal notranslate"><span class="pre">super()</span></code>，这可能会造成不兼容。</li>
<li>不再支持 PostGIS 1.5 版本。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.sites.models.Site.domain</span></code> 字段已更改为 <a class="reference internal" href="../ref/models/fields.html#django.db.models.Field.unique" title="django.db.models.Field.unique"><code class="xref py py-attr docutils literal notranslate"><span class="pre">unique</span></code></a>。</li>
<li>为了强制执行测试隔离，现在默认情况下在 <a class="reference internal" href="../topics/testing/tools.html#django.test.SimpleTestCase" title="django.test.SimpleTestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleTestCase</span></code></a> 测试中不允许数据库查询。你可以通过在测试类上设置 <code class="docutils literal notranslate"><span class="pre">allow_database_queries</span></code> 类属性为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 来禁用这个行为。</li>
<li><code class="docutils literal notranslate"><span class="pre">ResolverMatch.app_name</span></code> 已更改，现在在嵌套命名空间的情况下包含完整的命名空间路径。为了与 <code class="docutils literal notranslate"><span class="pre">ResolverMatch.namespace</span></code> 保持一致，现在空值是一个空字符串而不是 <code class="docutils literal notranslate"><span class="pre">None</span></code>。</li>
<li>为了增强安全性，会话密钥必须至少为 8 个字符。</li>
<li>已移除私有函数 <code class="docutils literal notranslate"><span class="pre">django.utils.functional.total_ordering()</span></code>。它包含了对于早于 Python 2.7.3 版本中 <code class="docutils literal notranslate"><span class="pre">functools.total_ordering()</span></code> bug 的一个解决方法。</li>
<li>XML 序列化（通过 <a class="reference internal" href="../ref/django-admin.html#django-admin-dumpdata"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">dumpdata</span></code></a> 或 syndication 框架）曾经会输出它接收到的任何字符。现在，如果要序列化的内容包含 XML 1.0 标准不允许的控制字符，序列化将会失败并引发 <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(在 Python v3.12)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a>。</li>
<li>现在，默认情况下，<a class="reference internal" href="../ref/forms/fields.html#django.forms.CharField" title="django.forms.CharField"><code class="xref py py-class docutils literal notranslate"><span class="pre">CharField</span></code></a> 会自动去除输入的前导和尾随空白。你可以通过将新的 <a class="reference internal" href="../ref/forms/fields.html#django.forms.CharField.strip" title="django.forms.CharField.strip"><code class="xref py py-attr docutils literal notranslate"><span class="pre">strip</span></code></a> 参数设置为 <code class="docutils literal notranslate"><span class="pre">False</span></code> 来禁用这个功能。</li>
<li>在翻译并使用两个或更多连续百分号的模板文本，例如 <code class="docutils literal notranslate"><span class="pre">&quot;%%&quot;</span></code>，在运行 <code class="docutils literal notranslate"><span class="pre">makemessages</span></code> 后可能会有一个新的 <code class="docutils literal notranslate"><span class="pre">msgid</span></code> （很可能翻译会被标记为模糊）。新的 <code class="docutils literal notranslate"><span class="pre">msgid</span></code> 将被标记为 <code class="docutils literal notranslate"><span class="pre">&quot;#,</span> <span class="pre">python-format&quot;</span></code>。</li>
<li>如果既没有设置 <a class="reference internal" href="../ref/request-response.html#django.http.HttpRequest.current_app" title="django.http.HttpRequest.current_app"><code class="xref py py-attr docutils literal notranslate"><span class="pre">request.current_app</span></code></a>，也没有设置 <a class="reference internal" href="../ref/templates/api.html#django.template.Context" title="django.template.Context"><code class="xref py py-class docutils literal notranslate"><span class="pre">Context.current_app</span></code></a>，那么 <a class="reference internal" href="../ref/templates/builtins.html#std-templatetag-url"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">url</span></code></a> 模板标签现在将使用当前请求的命名空间。如果不想使用命名空间提示，请将 <code class="docutils literal notranslate"><span class="pre">request.current_app</span></code> 设置为 <code class="docutils literal notranslate"><span class="pre">None</span></code>。</li>
<li><a class="reference internal" href="../ref/settings.html#std-setting-SILENCED_SYSTEM_CHECKS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">SILENCED_SYSTEM_CHECKS</span></code></a> 设置现在会禁止所有级别的消息。以前，<code class="docutils literal notranslate"><span class="pre">ERROR</span></code> 级别或更高级别的消息会打印到控制台。</li>
<li><code class="docutils literal notranslate"><span class="pre">FlatPage.enable_comments</span></code> 字段已从 <code class="docutils literal notranslate"><span class="pre">FlatPageAdmin</span></code> 中移除，因为它未被应用程序使用。如果你的项目或第三方应用程序使用它，请 <a class="reference internal" href="../ref/contrib/flatpages.html#flatpages-admin"><span class="std std-ref">创建一个自定义的 ModelAdmin</span></a> 来将其添加回去。</li>
<li><a class="reference internal" href="../topics/testing/advanced.html#django.test.runner.DiscoverRunner.setup_databases" title="django.test.runner.DiscoverRunner.setup_databases"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setup_databases()</span></code></a> 的返回值和 <a class="reference internal" href="../topics/testing/advanced.html#django.test.runner.DiscoverRunner.teardown_databases" title="django.test.runner.DiscoverRunner.teardown_databases"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_databases()</span></code></a> 的第一个参数已经改变。它们以前是 <code class="docutils literal notranslate"><span class="pre">(old_names,</span> <span class="pre">mirrors)</span></code> 元组，现在它们只是第一个项目，即 <code class="docutils literal notranslate"><span class="pre">old_names</span></code>。</li>
<li>默认情况下，<a class="reference internal" href="../topics/testing/tools.html#django.test.LiveServerTestCase" title="django.test.LiveServerTestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">LiveServerTestCase</span></code></a> 尝试在 8081-8179 范围内查找可用端口，而不仅仅是尝试端口 8081。</li>
<li>现在，对于 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin" title="django.contrib.admin.ModelAdmin"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelAdmin</span></code></a> 的系统检查会检查实例而不是类。</li>
<li>出于性能原因，已经移除了应用混合迁移计划的私有 API 。混合计划包括一系列迁移，其中一些正在应用，而其他一些正在取消应用。</li>
<li>位于 <code class="docutils literal notranslate"><span class="pre">django.db.models.fields.related</span></code> （私有 API）中的相关模型对象描述符类已经从 <code class="docutils literal notranslate"><span class="pre">related</span></code> 模块移动到 <code class="docutils literal notranslate"><span class="pre">related_descriptors</span></code>，并且被重命名如下：<ul>
<li><code class="docutils literal notranslate"><span class="pre">ReverseSingleRelatedObjectDescriptor</span></code> 是 <code class="docutils literal notranslate"><span class="pre">ForwardManyToOneDescriptor</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SingleRelatedObjectDescriptor</span></code> 是 <code class="docutils literal notranslate"><span class="pre">ReverseOneToOneDescriptor</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ForeignRelatedObjectsDescriptor</span></code> 是 <code class="docutils literal notranslate"><span class="pre">ReverseManyToOneDescriptor</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ManyRelatedObjectsDescriptor</span></code> 是 <code class="docutils literal notranslate"><span class="pre">ManyToManyDescriptor</span></code></li>
</ul>
</li>
<li>如果你实现了自定义的 <a class="reference internal" href="../ref/urls.html#django.conf.urls.handler404" title="django.conf.urls.handler404"><code class="xref py py-data docutils literal notranslate"><span class="pre">handler404</span></code></a> 视图，它必须返回一个带有 HTTP 404 状态代码的响应。使用 <a class="reference internal" href="../ref/request-response.html#django.http.HttpResponseNotFound" title="django.http.HttpResponseNotFound"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpResponseNotFound</span></code></a> 或将 <code class="docutils literal notranslate"><span class="pre">status=404</span></code> 传递给 <a class="reference internal" href="../ref/request-response.html#django.http.HttpResponse" title="django.http.HttpResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpResponse</span></code></a>。否则，在 <code class="docutils literal notranslate"><span class="pre">DEBUG=False</span></code> 的情况下，<a class="reference internal" href="../ref/settings.html#std-setting-APPEND_SLASH"><code class="xref std std-setting docutils literal notranslate"><span class="pre">APPEND_SLASH</span></code></a> 不会正确工作。</li>
</ul>
</div>
</div>
<div class="section" id="s-features-deprecated-in-1-9">
<span id="s-deprecated-features-1-9"></span><span id="features-deprecated-in-1-9"></span><span id="deprecated-features-1-9"></span><h2>在 1.9 中被废弃的功能<a class="headerlink" href="#features-deprecated-in-1-9" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-assignment-tag">
<span id="assignment-tag"></span><h3><code class="docutils literal notranslate"><span class="pre">assignment_tag()</span></code><a class="headerlink" href="#assignment-tag" title="永久链接至标题">¶</a></h3>
<p>Django 1.4 版本添加了 <code class="docutils literal notranslate"><span class="pre">assignment_tag</span></code> 辅助函数，以简化在模板变量中存储结果的模板标签的创建。<a class="reference internal" href="../howto/custom-template-tags.html#django.template.Library.simple_tag" title="django.template.Library.simple_tag"><code class="xref py py-meth docutils literal notranslate"><span class="pre">simple_tag()</span></code></a> 辅助函数也具备了相同的功能，因此使得 <code class="docutils literal notranslate"><span class="pre">assignment_tag</span></code> 已经过时。使用 <code class="docutils literal notranslate"><span class="pre">assignment_tag</span></code> 的标签应该更新为使用 <code class="docutils literal notranslate"><span class="pre">simple_tag</span></code>。</p>
</div>
<div class="section" id="s-cycle-syntax-with-comma-separated-arguments">
<span id="cycle-syntax-with-comma-separated-arguments"></span><h3><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">cycle</span> <span class="pre">%}</span></code> 语法可以接受逗号分隔的参数<a class="headerlink" href="#cycle-syntax-with-comma-separated-arguments" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../ref/templates/builtins.html#std-templatetag-cycle"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">cycle</span></code></a> 标签支持来自先前 Django 版本的旧语法：</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">cycle</span> <span class="nv">row1</span><span class="o">,</span><span class="nv">row2</span><span class="o">,</span><span class="nv">row3</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>使用旧语法会导致解析错误，因此在加速弃用后，将在 Django 1.10 中删除对旧语法的支持。</p>
</div>
<div class="section" id="s-foreignkey-and-onetoonefield-on-delete-argument">
<span id="foreignkey-and-onetoonefield-on-delete-argument"></span><h3><code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code> 和 <code class="docutils literal notranslate"><span class="pre">OneToOneField</span></code> 的 <code class="docutils literal notranslate"><span class="pre">on_delete</span></code> 参数<a class="headerlink" href="#foreignkey-and-onetoonefield-on-delete-argument" title="永久链接至标题">¶</a></h3>
<p>为了增加对级联模型删除的认知，在 Django 2.0 中将要求在 <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code> 和 <code class="docutils literal notranslate"><span class="pre">OneToOneField</span></code> 中使用 <code class="docutils literal notranslate"><span class="pre">on_delete</span></code> 参数。</p>
<p>更新模型和现有的迁移以显式设置参数。由于默认值是 <code class="docutils literal notranslate"><span class="pre">models.CASCADE</span></code>，因此请在所有不使用不同选项的 <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code> 和 <code class="docutils literal notranslate"><span class="pre">OneToOneField</span></code> 上添加 <code class="docutils literal notranslate"><span class="pre">on_delete=models.CASCADE</span></code>。如果不关心与较早版本的 Django 的兼容性，也可以将其作为第二个位置参数传递。</p>
</div>
<div class="section" id="s-field-rel-changes">
<span id="field-rel-changes"></span><h3><code class="docutils literal notranslate"><span class="pre">Field.rel</span></code> 变更<a class="headerlink" href="#field-rel-changes" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Field.rel</span></code> 及其方法和属性已更改以匹配相关字段的 API。<code class="docutils literal notranslate"><span class="pre">Field.rel</span></code> 属性被重命名为 <code class="docutils literal notranslate"><span class="pre">remote_field</span></code>，许多其方法和属性要么更改，要么重命名。</p>
<p>这些更改的目的是为关系字段提供一个有文档记录的 API 。</p>
</div>
<div class="section" id="s-geomanager-and-geoqueryset-custom-methods">
<span id="geomanager-and-geoqueryset-custom-methods"></span><h3><code class="docutils literal notranslate"><span class="pre">GeoManager</span></code> 和 <code class="docutils literal notranslate"><span class="pre">GeoQuerySet</span></code> 的自定义方法<a class="headerlink" href="#geomanager-and-geoqueryset-custom-methods" title="永久链接至标题">¶</a></h3>
<p>所有自定义的 <code class="docutils literal notranslate"><span class="pre">GeoQuerySet</span></code> 方法（如 <code class="docutils literal notranslate"><span class="pre">area()</span></code>、<code class="docutils literal notranslate"><span class="pre">distance()</span></code>、<code class="docutils literal notranslate"><span class="pre">gml()</span></code> 等）都已被等效的地理表达式注释所取代（请参见新特性）。因此，现在已经不再需要为支持 GIS 的模型设置自定义的 <code class="docutils literal notranslate"><span class="pre">GeoManager</span></code>。一旦你的代码不再调用任何已弃用的方法，你可以简单地从模型中删除 <code class="docutils literal notranslate"><span class="pre">objects</span> <span class="pre">=</span> <span class="pre">GeoManager()</span></code> 行。</p>
</div>
<div class="section" id="s-template-loader-apis-have-changed">
<span id="template-loader-apis-have-changed"></span><h3>模板加载器的 API 已经改变。<a class="headerlink" href="#template-loader-apis-have-changed" title="永久链接至标题">¶</a></h3>
<p>Django 模板加载器已更新，允许递归模板扩展。这个变化需要一个新的模板加载器 API。旧的 <code class="docutils literal notranslate"><span class="pre">load_template()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">load_template_sources()</span></code> 方法现在已被弃用。关于新 API 的详细信息可以在 <a class="reference internal" href="../ref/templates/api.html#custom-template-loaders"><span class="std std-ref">模板加载器文档中</span></a> 找到。</p>
</div>
<div class="section" id="s-passing-a-3-tuple-or-an-app-name-to-include">
<span id="passing-a-3-tuple-or-an-app-name-to-include"></span><h3>将一个 3 元组或一个 <code class="docutils literal notranslate"><span class="pre">app_name</span></code> 传递给 <code class="docutils literal notranslate"><span class="pre">include()</span></code><a class="headerlink" href="#passing-a-3-tuple-or-an-app-name-to-include" title="永久链接至标题">¶</a></h3>
<p>传递元组作为参数到 <code class="docutils literal notranslate"><span class="pre">include()</span></code> 的实例命名空间部分已被替换为通过 <code class="docutils literal notranslate"><span class="pre">include()</span></code> 传递 <code class="docutils literal notranslate"><span class="pre">namespace</span></code> 参数。例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">polls_patterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^polls/&quot;</span><span class="p">,</span> <span class="n">include</span><span class="p">((</span><span class="n">polls_patterns</span><span class="p">,</span> <span class="s2">&quot;polls&quot;</span><span class="p">,</span> <span class="s2">&quot;author-polls&quot;</span><span class="p">))),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>变成：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">polls_patterns</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">[</span>
        <span class="n">url</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="s2">&quot;polls&quot;</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># &#39;polls&#39; is the app_name</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^polls/&quot;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">polls_patterns</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s2">&quot;author-polls&quot;</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">include()</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">app_name</span></code> 参数已被替换为传递一个 2 元组（如上所示），或者传递一个具有 <code class="docutils literal notranslate"><span class="pre">app_name</span></code> 属性的对象或模块（如下所示）。如果以这种新方式设置了 <code class="docutils literal notranslate"><span class="pre">app_name</span></code>，那么 <code class="docutils literal notranslate"><span class="pre">namespace</span></code> 参数将不再需要。它将默认为 <code class="docutils literal notranslate"><span class="pre">app_name</span></code> 的值。例如，教程中的 URL 模式已更改为：</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">mysite/urls.py</span></code></span><a class="headerlink" href="#id2" title="永久链接至代码">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span><span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^polls/&quot;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s2">&quot;polls.urls&quot;</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s2">&quot;polls&quot;</span><span class="p">)),</span> <span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>到：</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">mysite/urls.py</span></code></span><a class="headerlink" href="#id3" title="永久链接至代码">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^polls/&quot;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s2">&quot;polls.urls&quot;</span><span class="p">)),</span>  <span class="c1"># &#39;namespace=&quot;polls&quot;&#39; removed</span>
    <span class="o">...</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">polls/urls.py</span></code></span><a class="headerlink" href="#id4" title="永久链接至代码">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">app_name</span> <span class="o">=</span> <span class="s2">&quot;polls&quot;</span>  <span class="c1"># added</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>这个变化还意味着旧的包含 <code class="docutils literal notranslate"><span class="pre">AdminSite</span></code> 实例的方式已经被弃用。相反，直接将 <code class="docutils literal notranslate"><span class="pre">admin.site.urls</span></code> 传递给 <code class="docutils literal notranslate"><span class="pre">django.conf.urls.url()</span></code>：</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">urls.py</span></code></span><a class="headerlink" href="#id5" title="永久链接至代码">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^admin/&quot;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="s-url-application-namespace-required-if-setting-an-instance-namespace">
<span id="url-application-namespace-required-if-setting-an-instance-namespace"></span><h3>如果设置实例命名空间，需要提供 URL 应用程序命名空间。<a class="headerlink" href="#url-application-namespace-required-if-setting-an-instance-namespace" title="永久链接至标题">¶</a></h3>
<p>在过去，没有应用程序命名空间的实例命名空间会起到与应用程序命名空间相同的作用，但如果存在相同名称的应用程序命名空间，无法对模式进行反向操作。指定实例命名空间的包含（includes）要求被包含的 URLconf 设置应用程序命名空间。</p>
</div>
<div class="section" id="s-current-app-parameter-to-contrib-auth-views">
<span id="current-app-parameter-to-contrib-auth-views"></span><h3><code class="docutils literal notranslate"><span class="pre">contrib.auth</span></code> 视图的 <code class="docutils literal notranslate"><span class="pre">current_app</span></code> 参数<a class="headerlink" href="#current-app-parameter-to-contrib-auth-views" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">django.contrib.auth.views</span></code> 中的所有视图都具有以下结构：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>def view(request, ..., current_app=None, ...):

    ...

    if current_app is not None:
        request.current_app = current_app

    return TemplateResponse(request, template_name, context)
</pre></div>
</div>
<p>从 Django 1.8 开始，<code class="docutils literal notranslate"><span class="pre">current_app</span></code> 已设置在 <code class="docutils literal notranslate"><span class="pre">request</span></code> 对象上。为了保持一致性，这些视图将要求调用者在 <code class="docutils literal notranslate"><span class="pre">request</span></code> 上设置 <code class="docutils literal notranslate"><span class="pre">current_app</span></code>，而不是将其作为单独的参数传递。</p>
</div>
<div class="section" id="s-django-contrib-gis-geoip">
<span id="django-contrib-gis-geoip"></span><h3><code class="docutils literal notranslate"><span class="pre">django.contrib.gis.geoip</span></code><a class="headerlink" href="#django-contrib-gis-geoip" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../ref/contrib/gis/geoip2.html#module-django.contrib.gis.geoip2" title="django.contrib.gis.geoip2: Python interface for MaxMind's GeoIP2 databases."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis.geoip2</span></code></a> 模块取代了 <code class="docutils literal notranslate"><span class="pre">django.contrib.gis.geoip</span></code>。新模块提供了类似的 API，但不提供旧的 GeoIP-Python API 兼容方法。</p>
</div>
<div class="section" id="s-id1">
<span id="id1"></span><h3>杂项<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">django.dispatch.signals.Signal.disconnect()</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">weak</span></code> 参数已被弃用，因为它没有效果。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.db.backends.base.BaseDatabaseOperations</span></code> 的 <code class="docutils literal notranslate"><span class="pre">check_aggregate_support()</span></code> 方法已被弃用，并将在 Django 2.0 中移除。应该改用更通用的 <code class="docutils literal notranslate"><span class="pre">check_expression_support()</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.forms.extras</span></code> 已被弃用。你可以在 <code class="docutils literal notranslate"><span class="pre">django.forms.widgets</span></code> （或简单地在 <code class="docutils literal notranslate"><span class="pre">django.forms</span></code> 中）找到 <a class="reference internal" href="../ref/forms/widgets.html#django.forms.SelectDateWidget" title="django.forms.SelectDateWidget"><code class="xref py py-class docutils literal notranslate"><span class="pre">SelectDateWidget</span></code></a>。</li>
<li>私有 API <code class="docutils literal notranslate"><span class="pre">django.db.models.fields.add_lazy_relation()</span></code> 已被弃用。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.auth.tests.utils.skipIfCustomUser()</span></code> 装饰器已被弃用。随着 Django 1.6 中的测试发现变化，不再将 <code class="docutils literal notranslate"><span class="pre">django.contrib</span></code> 应用程序的测试作为用户项目的一部分运行。因此，在 <code class="docutils literal notranslate"><span class="pre">django.contrib.auth</span></code> 中不再需要使用 <code class="docutils literal notranslate"><span class="pre">&#64;skipIfCustomUser</span></code> 装饰器来装饰测试。</li>
<li>如果你自定义了一些 <a class="reference internal" href="../ref/views.html#error-views"><span class="std std-ref">错误处理程序</span></a>，那些只有一个请求参数的视图签名已经被弃用。这些视图现在还应该接受一个名为 <code class="docutils literal notranslate"><span class="pre">exception</span></code> 的第二个位置参数。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.feedgenerator.Atom1Feed.mime_type</span></code> 和 <code class="docutils literal notranslate"><span class="pre">django.utils.feedgenerator.RssFeed.mime_type</span></code> 属性已被弃用，建议使用 <code class="docutils literal notranslate"><span class="pre">content_type</span></code> 代替。</li>
<li><a class="reference internal" href="../topics/signing.html#django.core.signing.Signer" title="django.core.signing.Signer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Signer</span></code></a> 现在如果使用无效的分隔符会发出警告。这在 Django 1.10 中将变成异常。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.db.models.Field._get_val_from_obj()</span></code> 已被弃用，应使用 <code class="docutils literal notranslate"><span class="pre">Field.value_from_object()</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.template.loaders.eggs.Loader</span></code> 已被弃用，因为不建议将应用程序作为 eggs 分发。</li>
<li><code class="docutils literal notranslate"><span class="pre">SimpleTestCase.assertRaisesMessage()</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">callable_obj</span></code> 关键字参数已被弃用。请将可调用对象作为位置参数传递。</li>
<li>在 <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> 方法中的 <code class="docutils literal notranslate"><span class="pre">allow_tags</span></code> 属性已被弃用。在构建方法的返回值时，改用 <a class="reference internal" href="../ref/utils.html#django.utils.html.format_html" title="django.utils.html.format_html"><code class="xref py py-func docutils literal notranslate"><span class="pre">format_html()</span></code></a>、<a class="reference internal" href="../ref/utils.html#django.utils.html.format_html_join" title="django.utils.html.format_html_join"><code class="xref py py-func docutils literal notranslate"><span class="pre">format_html_join()</span></code></a> 或 <a class="reference internal" href="../ref/utils.html#django.utils.safestring.mark_safe" title="django.utils.safestring.mark_safe"><code class="xref py py-func docutils literal notranslate"><span class="pre">mark_safe()</span></code></a>。</li>
<li><code class="docutils literal notranslate"><span class="pre">SyndicationFeed.add_item()</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">enclosure</span></code> 关键字参数已被弃用。改用新的 <code class="docutils literal notranslate"><span class="pre">enclosures</span></code> 参数，它接受一个 <code class="docutils literal notranslate"><span class="pre">Enclosure</span></code> 对象的列表，而不是单个对象。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.template.loader.LoaderOrigin</span></code> 和 <code class="docutils literal notranslate"><span class="pre">django.template.base.StringOrigin</span></code> 对于 <code class="docutils literal notranslate"><span class="pre">django.template.base.Origin</span></code> 的别名已被弃用。</li>
</ul>
</div>
</div>
<div class="section" id="s-features-removed-in-1-9">
<span id="s-removed-features-1-9"></span><span id="features-removed-in-1-9"></span><span id="removed-features-1-9"></span><h2>在 1.9 版本中移除的功能。<a class="headerlink" href="#features-removed-in-1-9" title="永久链接至标题">¶</a></h2>
<p>这些特性已经达到了它们的弃用周期的尽头，将在 Django 1.9 中被移除。详情请参见 <a class="reference internal" href="1.7.html#deprecated-features-1-7"><span class="std std-ref">在 1.7 中被废弃的功能</span></a>，包括如何删除对这些特性的使用。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">django.utils.dictconfig</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.importlib</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.tzinfo</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.unittest</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">syncdb</span></code> 命令已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.db.models.signals.pre_syncdb</span></code> 和 <code class="docutils literal notranslate"><span class="pre">django.db.models.signals.post_syncdb</span></code> 已被移除。</li>
<li>数据库路由器上的 <code class="docutils literal notranslate"><span class="pre">allow_syncdb</span></code> 支持已被移除。</li>
<li>自动同步没有迁移的应用已被移除。对于所有应用程序，迁移是强制性的，除非你传递 <a class="reference internal" href="../ref/django-admin.html#cmdoption-migrate-run-syncdb"><code class="xref std std-option docutils literal notranslate"><span class="pre">migrate</span> <span class="pre">--run-syncdb</span></code></a> 选项。</li>
<li>对于没有迁移的应用程序，已移除了 SQL 管理命令：<code class="docutils literal notranslate"><span class="pre">sql</span></code>、<code class="docutils literal notranslate"><span class="pre">sqlall</span></code>、<code class="docutils literal notranslate"><span class="pre">sqlclear</span></code>、<code class="docutils literal notranslate"><span class="pre">sqldropindexes</span></code> 和 <code class="docutils literal notranslate"><span class="pre">sqlindexes</span></code>。</li>
<li>已移除自动加载 <code class="docutils literal notranslate"><span class="pre">initial_data</span></code> fixtures 和初始 SQL 数据的支持。</li>
<li>所有模型都需要在一个已安装的应用程序内定义，或者声明一个明确的 <a class="reference internal" href="../ref/models/options.html#django.db.models.Options.app_label" title="django.db.models.Options.app_label"><code class="xref py py-attr docutils literal notranslate"><span class="pre">app_label</span></code></a>。此外，在应用程序加载之前不能导入它们。特别是，在应用程序的根包内不能导入模型。</li>
<li>模型和表单的 <code class="docutils literal notranslate"><span class="pre">IPAddressField</span></code> 已被移除。为了与历史迁移兼容，仍然保留了一个存根字段。</li>
<li>不再支持 <code class="docutils literal notranslate"><span class="pre">AppCommand.handle_app()</span></code>。</li>
<li>无法再从 <code class="docutils literal notranslate"><span class="pre">django.contrib.sites.models</span></code> 导入 <code class="docutils literal notranslate"><span class="pre">RequestSite</span></code> 和 <code class="docutils literal notranslate"><span class="pre">get_current_site()</span></code>。</li>
<li>通过 <code class="docutils literal notranslate"><span class="pre">runfcgi</span></code> 管理命令的 FastCGI 支持已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.datastructures.SortedDict</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">ModelAdmin.declared_fieldsets</span></code> 已被移除。</li>
<li>提供向后兼容性的 <code class="docutils literal notranslate"><span class="pre">util</span></code> 模块已被移除：<ul>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.admin.util</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.gis.db.backends.util</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.db.backends.util</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.forms.util</span></code></li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">ModelAdmin.get_formsets</span></code> 已被移除。</li>
<li>用于将 <code class="docutils literal notranslate"><span class="pre">BaseMemcachedCache._get_memcache_timeout()</span></code> 方法重命名为 <code class="docutils literal notranslate"><span class="pre">get_backend_timeout()</span></code> 的向后兼容 shims 已被移除。</li>
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-dumpdata"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">dumpdata</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">--natural</span></code> 和 <code class="docutils literal notranslate"><span class="pre">-n</span></code> 选项已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">serializers.serialize()</span></code> 的 <code class="docutils literal notranslate"><span class="pre">use_natural_keys</span></code> 参数已被移除。</li>
<li>私有 API <code class="docutils literal notranslate"><span class="pre">django.forms.forms.get_declared_fields()</span></code> 已被移除。</li>
<li>使用 <code class="docutils literal notranslate"><span class="pre">SplitDateTimeWidget</span></code> 与 <code class="docutils literal notranslate"><span class="pre">DateTimeField</span></code> 的能力已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">WSGIRequest.REQUEST</span></code> 属性已被移除。</li>
<li>类 <code class="docutils literal notranslate"><span class="pre">django.utils.datastructures.MergeDict</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">zh-cn</span></code> 和 <code class="docutils literal notranslate"><span class="pre">zh-tw</span></code> 语言代码已被移除。</li>
<li>内部的 <code class="docutils literal notranslate"><span class="pre">django.utils.functional.memoize()</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.core.cache.get_cache</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.db.models.loading</span></code> 已被移除。</li>
<li>不再支持将可调用参数传递给查询集。</li>
<li><code class="docutils literal notranslate"><span class="pre">BaseCommand.requires_model_validation</span></code> 被移除，取而代之的是 <code class="docutils literal notranslate"><span class="pre">requires_system_checks</span></code>。管理器验证器被管理器检查取代。</li>
<li><code class="docutils literal notranslate"><span class="pre">ModelAdmin.validator_class</span></code> 和 <code class="docutils literal notranslate"><span class="pre">default_validator_class</span></code> 属性已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">ModelAdmin.validate()</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.db.backends.DatabaseValidation.validate_field</span></code> 被移除，取而代之的是 <code class="docutils literal notranslate"><span class="pre">check_field</span></code> 方法。</li>
<li><code class="docutils literal notranslate"><span class="pre">validate</span></code> 管理命令已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.module_loading.import_by_path</span></code> 被移除，取而代之的是 <code class="docutils literal notranslate"><span class="pre">django.utils.module_loading.import_string</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">ssi</span></code> 和 <code class="docutils literal notranslate"><span class="pre">url</span></code> 模板标签已从 <code class="docutils literal notranslate"><span class="pre">future</span></code> 模板标签库中移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.text.javascript_quote()</span></code> 已被移除。</li>
<li>不再支持将数据库测试设置作为独立的条目出现在数据库设置中，并以 <code class="docutils literal notranslate"><span class="pre">TEST_</span></code> 为前缀。</li>
<li><code class="docutils literal notranslate"><span class="pre">cache_choices</span></code> 选项已被移除，不再适用于 <a class="reference internal" href="../ref/forms/fields.html#django.forms.ModelChoiceField" title="django.forms.ModelChoiceField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelChoiceField</span></code></a> 和 <a class="reference internal" href="../ref/forms/fields.html#django.forms.ModelMultipleChoiceField" title="django.forms.ModelMultipleChoiceField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelMultipleChoiceField</span></code></a>。</li>
<li><code class="docutils literal notranslate"><span class="pre">RedirectView.permanent</span></code> 属性的默认值已从 <code class="docutils literal notranslate"><span class="pre">True</span></code> 更改为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.sitemaps.FlatPageSitemap</span></code> 已被移除，取而代之的是 <code class="docutils literal notranslate"><span class="pre">django.contrib.flatpages.sitemaps.FlatPageSitemap</span></code>。</li>
<li>私有 API <code class="docutils literal notranslate"><span class="pre">django.test.utils.TestTemplateLoader</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.contenttypes.generic</span></code> 模块已被移除。</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../contents.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">Django 1.9 版本发行说明</a><ul>
<li><a class="reference internal" href="#python-compatibility">Python 兼容性</a></li>
<li><a class="reference internal" href="#what-s-new-in-django-1-9">Django 1.9 的新特性</a><ul>
<li><a class="reference internal" href="#performing-actions-after-a-transaction-commit">事务提交后执行操作</a></li>
<li><a class="reference internal" href="#password-validation">密码验证</a></li>
<li><a class="reference internal" href="#permission-mixins-for-class-based-views">用于基于类的视图的权限混合类</a></li>
<li><a class="reference internal" href="#new-styling-for-contrib-admin"><code class="docutils literal notranslate"><span class="pre">contrib.admin</span></code> 中的新样式</a></li>
<li><a class="reference internal" href="#running-tests-in-parallel">并行运行测试</a></li>
<li><a class="reference internal" href="#minor-features">次要特性</a><ul>
<li><a class="reference internal" href="#django-contrib-admin"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-admindocs"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admindocs</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-auth"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-contenttypes"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.contenttypes</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-gis"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-postgres"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.postgres</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-sessions"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sessions</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-sites"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sites</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-syndication"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.syndication</span></code></a></li>
<li><a class="reference internal" href="#cache">缓存</a></li>
<li><a class="reference internal" href="#csrf">CSRF</a></li>
<li><a class="reference internal" href="#database-backends">数据库后端</a></li>
<li><a class="reference internal" href="#file-storage">文件存储</a></li>
<li><a class="reference internal" href="#forms">表单</a></li>
<li><a class="reference internal" href="#generic-views">通用视图</a></li>
<li><a class="reference internal" href="#internationalization">国际化</a></li>
<li><a class="reference internal" href="#management-commands">管理命令</a></li>
<li><a class="reference internal" href="#migrations">迁移</a></li>
<li><a class="reference internal" href="#models">模型</a></li>
<li><a class="reference internal" href="#requests-and-responses">请求和响应</a></li>
<li><a class="reference internal" href="#templates">模板</a></li>
<li><a class="reference internal" href="#tests">测试</a></li>
<li><a class="reference internal" href="#urls">URLs</a></li>
<li><a class="reference internal" href="#validators">验证器</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-incompatible-changes-in-1-9">1.9 版本中的不向后兼容变更</a><ul>
<li><a class="reference internal" href="#database-backend-api">数据库后端 API</a></li>
<li><a class="reference internal" href="#default-settings-that-were-tuples-are-now-lists">原来的默认设置是元组，现在改为列表</a></li>
<li><a class="reference internal" href="#is-usable-attribute-on-template-loaders-is-removed">模板加载器上的 <code class="docutils literal notranslate"><span class="pre">is_usable</span></code> 属性已被移除。</a></li>
<li><a class="reference internal" href="#related-set-direct-assignment">相关集合直接赋值</a></li>
<li><a class="reference internal" href="#filesystem-based-template-loaders-catch-more-specific-exceptions">基于文件系统的模板加载器捕获更具体的异常</a></li>
<li><a class="reference internal" href="#http-redirects-no-longer-forced-to-absolute-uris">HTTP 重定向不再强制要求使用绝对 URI</a></li>
<li><a class="reference internal" href="#dropped-support-for-postgresql-9-0">不再支持 PostgreSQL 9.0 版本</a></li>
<li><a class="reference internal" href="#dropped-support-for-oracle-11-1">不再支持 Oracle 11.1 版本</a></li>
<li><a class="reference internal" href="#bulk-behavior-of-add-method-of-related-managers">关于相关管理器的 <code class="docutils literal notranslate"><span class="pre">add()</span></code> 方法的批量行为</a></li>
<li><a class="reference internal" href="#template-loaderorigin-and-stringorigin-are-removed">模板中移除了 <code class="docutils literal notranslate"><span class="pre">LoaderOrigin</span></code> 和 <code class="docutils literal notranslate"><span class="pre">StringOrigin</span></code></a></li>
<li><a class="reference internal" href="#changes-to-the-default-logging-configuration">默认日志配置的更改</a></li>
<li><a class="reference internal" href="#httprequest-details-in-error-reporting">在错误报告中的 <code class="docutils literal notranslate"><span class="pre">HttpRequest</span></code> 详细信息</a></li>
<li><a class="reference internal" href="#removal-of-time-zone-aware-global-adapters-and-converters-for-datetimes">移除了日期时间的时区感知全局适配器和转换器</a></li>
<li><a class="reference internal" href="#template-tag-modules-are-imported-when-templates-are-configured">在配置模板时导入模板标签模块</a></li>
<li><a class="reference internal" href="#django-template-base-add-to-builtins-is-removed">已删除 <code class="docutils literal notranslate"><span class="pre">django.template.base.add_to_builtins()</span></code>。</a></li>
<li><a class="reference internal" href="#simple-tag-now-wraps-tag-output-in-conditional-escape"><code class="docutils literal notranslate"><span class="pre">simple_tag</span></code> 现在在标签输出中包装了 <code class="docutils literal notranslate"><span class="pre">conditional_escape</span></code></a></li>
<li><a class="reference internal" href="#paginator-page-range"><code class="docutils literal notranslate"><span class="pre">Paginator.page_range</span></code></a></li>
<li><a class="reference internal" href="#implicit-queryset-in-lookup-removed">隐式的 <code class="docutils literal notranslate"><span class="pre">QuerySet</span></code> <code class="docutils literal notranslate"><span class="pre">__in</span></code> 查询已移除</a></li>
<li><a class="reference internal" href="#contrib-admin-browser-support"><code class="docutils literal notranslate"><span class="pre">contrib.admin</span></code> 浏览器支持</a></li>
<li><a class="reference internal" href="#syntaxerror-when-installing-django-setuptools-5-5-x">在 <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> 5.5.x 安装 Django 时出现 <code class="docutils literal notranslate"><span class="pre">SyntaxError</span></code> 错误</a></li>
<li><a class="reference internal" href="#miscellaneous">杂项</a></li>
</ul>
</li>
<li><a class="reference internal" href="#features-deprecated-in-1-9">在 1.9 中被废弃的功能</a><ul>
<li><a class="reference internal" href="#assignment-tag"><code class="docutils literal notranslate"><span class="pre">assignment_tag()</span></code></a></li>
<li><a class="reference internal" href="#cycle-syntax-with-comma-separated-arguments"><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">cycle</span> <span class="pre">%}</span></code> 语法可以接受逗号分隔的参数</a></li>
<li><a class="reference internal" href="#foreignkey-and-onetoonefield-on-delete-argument"><code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code> 和 <code class="docutils literal notranslate"><span class="pre">OneToOneField</span></code> 的 <code class="docutils literal notranslate"><span class="pre">on_delete</span></code> 参数</a></li>
<li><a class="reference internal" href="#field-rel-changes"><code class="docutils literal notranslate"><span class="pre">Field.rel</span></code> 变更</a></li>
<li><a class="reference internal" href="#geomanager-and-geoqueryset-custom-methods"><code class="docutils literal notranslate"><span class="pre">GeoManager</span></code> 和 <code class="docutils literal notranslate"><span class="pre">GeoQuerySet</span></code> 的自定义方法</a></li>
<li><a class="reference internal" href="#template-loader-apis-have-changed">模板加载器的 API 已经改变。</a></li>
<li><a class="reference internal" href="#passing-a-3-tuple-or-an-app-name-to-include">将一个 3 元组或一个 <code class="docutils literal notranslate"><span class="pre">app_name</span></code> 传递给 <code class="docutils literal notranslate"><span class="pre">include()</span></code></a></li>
<li><a class="reference internal" href="#url-application-namespace-required-if-setting-an-instance-namespace">如果设置实例命名空间，需要提供 URL 应用程序命名空间。</a></li>
<li><a class="reference internal" href="#current-app-parameter-to-contrib-auth-views"><code class="docutils literal notranslate"><span class="pre">contrib.auth</span></code> 视图的 <code class="docutils literal notranslate"><span class="pre">current_app</span></code> 参数</a></li>
<li><a class="reference internal" href="#django-contrib-gis-geoip"><code class="docutils literal notranslate"><span class="pre">django.contrib.gis.geoip</span></code></a></li>
<li><a class="reference internal" href="#id1">杂项</a></li>
</ul>
</li>
<li><a class="reference internal" href="#features-removed-in-1-9">在 1.9 版本中移除的功能。</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="1.9.1.html"
                          title="上一章">Django 1.9.1 版本发行说明</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="1.8.19.html"
                          title="下一章">Django 1.8.19 版本发行说明</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/releases/1.9.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">3月 29, 2024</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="1.9.1.html" title="Django 1.9.1 版本发行说明">previous</a>
     |
    <a href="index.html" title="发行说明" accesskey="U">up</a>
   |
    <a href="1.8.19.html" title="Django 1.8.19 版本发行说明">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>
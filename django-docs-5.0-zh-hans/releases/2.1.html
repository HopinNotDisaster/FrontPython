
<!DOCTYPE html>

<html lang="zh_Hans">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Django 2.1 版本发行说明 &#8212; Django 5.0.4.dev20240329153429 文档</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/default.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Django 2.0.13 版本发行说明" href="2.0.13.html" />
    <link rel="prev" title="Django 2.1.1 版本发行说明" href="2.1.1.html" />



 
<script src="../templatebuiltins.js"></script>
<script>
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);</script>

  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../index.html">Django 5.0.4.dev20240329153429 文档</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../index.html">Home</a>  |
        <a title="Table of contents" href="../contents.html">Table of contents</a>  |
        <a title="Global index" href="../genindex.html">Index</a>  |
        <a title="Module index" href="../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="2.1.1.html" title="Django 2.1.1 版本发行说明">previous</a>
     |
    <a href="index.html" title="发行说明" accesskey="U">up</a>
   |
    <a href="2.0.13.html" title="Django 2.0.13 版本发行说明">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="releases-2.1">
            
  <div class="section" id="s-django-2-1-release-notes">
<span id="django-2-1-release-notes"></span><h1>Django 2.1 版本发行说明<a class="headerlink" href="#django-2-1-release-notes" title="永久链接至标题">¶</a></h1>
<p><em>2018 年 8 月 1 日</em></p>
<p>欢迎使用 Django 2.1 ！</p>
<p>这些发布说明涵盖了 <a class="reference internal" href="#whats-new-2-1"><span class="std std-ref">新功能</span></a>，以及从 Django 2.0 或更早版本升级时需要注意的 <a class="reference internal" href="#backwards-incompatible-2-1"><span class="std std-ref">不兼容变更</span></a>。我们已经 <a class="reference internal" href="#removed-features-2-1"><span class="std std-ref">删除了一些功能</span></a>，这些功能已经到达了他们的弃用周期的末端，并且我们已经 <a class="reference internal" href="#deprecated-features-2-1"><span class="std std-ref">开始了一些功能的弃用过程</span></a>。</p>
<p>如果你要更新现有的项目，请看 <a class="reference internal" href="../howto/upgrade-version.html"><span class="doc">如何将 Django 更新至新的版本</span></a> 指南。</p>
<div class="section" id="s-python-compatibility">
<span id="python-compatibility"></span><h2>Python 兼容性<a class="headerlink" href="#python-compatibility" title="永久链接至标题">¶</a></h2>
<p>Django 2.1 支持 Python 3.5、3.6 和 3.7。Django 2.0 是最后一个支持 Python 3.4 的版本。我们 <strong>强烈推荐</strong> 并且只官方支持每个系列的最新发布版本。</p>
</div>
<div class="section" id="s-what-s-new-in-django-2-1">
<span id="s-whats-new-2-1"></span><span id="what-s-new-in-django-2-1"></span><span id="whats-new-2-1"></span><h2>Django 2.1 的新特性是什么？<a class="headerlink" href="#what-s-new-in-django-2-1" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-model-view-permission">
<span id="model-view-permission"></span><h3>模型的“查看”权限<a class="headerlink" href="#model-view-permission" title="永久链接至标题">¶</a></h3>
<p>模型的 <code class="docutils literal notranslate"><span class="pre">Meta.default_permissions</span></code> 属性中添加了 &quot;view&quot; 权限。这些新权限将在运行 <a class="reference internal" href="../ref/django-admin.html#django-admin-migrate"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">migrate</span></code></a> 时自动创建。</p>
<p>这允许将用户赋予对管理员中的模型的只读访问权限。新增了 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.has_view_permission" title="django.contrib.admin.ModelAdmin.has_view_permission"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ModelAdmin.has_view_permission()</span></code></a>。该实现是向后兼容的，不需要分配 &quot;view&quot; 权限以允许拥有 &quot;change&quot; 权限的用户编辑对象。</p>
<p>有一些 <a class="reference internal" href="#view-permission-backwards-incompatible"><span class="std std-ref">不兼容考虑</span></a>。</p>
</div>
<div class="section" id="s-minor-features">
<span id="minor-features"></span><h3>次要特性<a class="headerlink" href="#minor-features" title="永久链接至标题">¶</a></h3>
<div class="section" id="s-django-contrib-admin">
<span id="django-contrib-admin"></span><h4><a class="reference internal" href="../ref/contrib/admin/index.html#module-django.contrib.admin" title="django.contrib.admin: Django's admin site."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a><a class="headerlink" href="#django-contrib-admin" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>现在，<a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.search_fields" title="django.contrib.admin.ModelAdmin.search_fields"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ModelAdmin.search_fields</span></code></a> 接受任何查找，如 <code class="docutils literal notranslate"><span class="pre">field__exact</span></code>。</li>
<li>jQuery 的版本已从 2.2.3 升级到 3.3.1 。</li>
<li>新的 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.delete_queryset" title="django.contrib.admin.ModelAdmin.delete_queryset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ModelAdmin.delete_queryset()</span></code></a> 方法允许自定义 &quot;删除选定对象&quot; 操作的删除过程。</li>
<li>现在你可以 <a class="reference internal" href="../ref/contrib/admin/index.html#overriding-default-admin-site"><span class="std std-ref">覆盖默认的管理站点</span></a>。</li>
<li>新的 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.sortable_by" title="django.contrib.admin.ModelAdmin.sortable_by"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ModelAdmin.sortable_by</span></code></a> 属性和 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.get_sortable_by" title="django.contrib.admin.ModelAdmin.get_sortable_by"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ModelAdmin.get_sortable_by()</span></code></a> 方法允许限制可以在更改列表页面中排序的列。</li>
<li>在 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.list_display" title="django.contrib.admin.ModelAdmin.list_display"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ModelAdmin.list_display</span></code></a> 中的元素的 <code class="docutils literal notranslate"><span class="pre">admin_order_field</span></code> 属性现在可以是一个查询表达式。</li>
<li>新的 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.get_deleted_objects" title="django.contrib.admin.ModelAdmin.get_deleted_objects"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ModelAdmin.get_deleted_objects()</span></code></a> 方法允许自定义删除视图和 &quot;删除选定&quot; 操作的删除过程。</li>
<li><code class="docutils literal notranslate"><span class="pre">actions.html</span></code>、<code class="docutils literal notranslate"><span class="pre">change_list_results.html</span></code>、<code class="docutils literal notranslate"><span class="pre">date_hierarchy.html</span></code>、<code class="docutils literal notranslate"><span class="pre">pagination.html</span></code>、<code class="docutils literal notranslate"><span class="pre">prepopulated_fields_js.html</span></code>、<code class="docutils literal notranslate"><span class="pre">search_form.html</span></code> 和 <code class="docutils literal notranslate"><span class="pre">submit_line.html</span></code> 模板现在可以在每个应用程序或每个模型的基础上 <a class="reference internal" href="../ref/contrib/admin/index.html#admin-templates-overridden-per-app-or-model"><span class="std std-ref">被覆盖</span></a> （除了全局覆盖）。</li>
<li>管理员更改列表和更改表单对象工具现在可以在每个应用程序、每个模型或全局 <a class="reference internal" href="../ref/contrib/admin/index.html#admin-templates-overridden-per-app-or-model"><span class="std std-ref">被覆盖</span></a>，使用 <code class="docutils literal notranslate"><span class="pre">change_list_object_tools.html</span></code> 和 <code class="docutils literal notranslate"><span class="pre">change_form_object_tools.html</span></code> 模板。</li>
<li><a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.InlineModelAdmin.has_add_permission" title="django.contrib.admin.InlineModelAdmin.has_add_permission"><code class="xref py py-meth docutils literal notranslate"><span class="pre">InlineModelAdmin.has_add_permission()</span></code></a> 现在将父对象作为第二个位置参数传递，<code class="docutils literal notranslate"><span class="pre">obj</span></code>。</li>
<li>管理员操作现在可以 <a class="reference internal" href="../ref/contrib/admin/actions.html#admin-action-permissions"><span class="std std-ref">指定权限</span></a> 以限制它们对某些用户的可用性。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-auth">
<span id="django-contrib-auth"></span><h4><a class="reference internal" href="../topics/auth/index.html#module-django.contrib.auth" title="django.contrib.auth: Django's authentication framework."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a><a class="headerlink" href="#django-contrib-auth" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-createsuperuser"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">createsuperuser</span></code></a> 现在会提示是否允许绕过 <a class="reference internal" href="../ref/settings.html#std-setting-AUTH_PASSWORD_VALIDATORS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">AUTH_PASSWORD_VALIDATORS</span></code></a> 检查。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-gis">
<span id="django-contrib-gis"></span><h4><a class="reference internal" href="../ref/contrib/gis/index.html#module-django.contrib.gis" title="django.contrib.gis: Geographic Information System (GIS) extensions for Django"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a><a class="headerlink" href="#django-contrib-gis" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../ref/contrib/gis/geos.html#django.contrib.gis.geos.GEOSGeometry.buffer_with_style" title="django.contrib.gis.geos.GEOSGeometry.buffer_with_style"><code class="xref py py-meth docutils literal notranslate"><span class="pre">GEOSGeometry.buffer_with_style()</span></code></a> 方法是 <a class="reference internal" href="../ref/contrib/gis/geos.html#django.contrib.gis.geos.GEOSGeometry.buffer" title="django.contrib.gis.geos.GEOSGeometry.buffer"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buffer()</span></code></a> 的一个版本，允许自定义缓冲区的样式。</li>
<li><a class="reference internal" href="../ref/contrib/gis/forms-api.html#django.contrib.gis.forms.widgets.OpenLayersWidget" title="django.contrib.gis.forms.widgets.OpenLayersWidget"><code class="xref py py-class docutils literal notranslate"><span class="pre">OpenLayersWidget</span></code></a> 现在基于 OpenLayers 4.6.5（之前是 3.20.1）。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-sessions">
<span id="django-contrib-sessions"></span><h4><a class="reference internal" href="../topics/http/sessions.html#module-django.contrib.sessions" title="django.contrib.sessions: Provides session management for Django projects."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sessions</span></code></a><a class="headerlink" href="#django-contrib-sessions" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>添加了 <a class="reference internal" href="../ref/settings.html#std-setting-SESSION_COOKIE_SAMESITE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">SESSION_COOKIE_SAMESITE</span></code></a> 设置，用于在会话 cookie 上设置 <code class="docutils literal notranslate"><span class="pre">SameSite</span></code> cookie 标志。</li>
</ul>
</div>
<div class="section" id="s-cache">
<span id="cache"></span><h4>缓存<a class="headerlink" href="#cache" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../topics/cache.html#local-memory-caching"><span class="std std-ref">本地内存缓存后端</span></a> 现在使用最近最少使用（LRU）的淘汰策略，而不是伪随机策略。</li>
<li><a class="reference internal" href="../topics/cache.html#low-level-cache-api"><span class="std std-ref">低级缓存 API</span></a> 的新方法 <a class="reference internal" href="../topics/cache.html#django.core.cache.cache.touch" title="django.core.cache.cache.touch"><code class="xref py py-meth docutils literal notranslate"><span class="pre">touch()</span></code></a> 可以更新缓存键的超时时间。</li>
</ul>
</div>
<div class="section" id="s-csrf">
<span id="csrf"></span><h4>CSRF<a class="headerlink" href="#csrf" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>添加了 <a class="reference internal" href="../ref/settings.html#std-setting-CSRF_COOKIE_SAMESITE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">CSRF_COOKIE_SAMESITE</span></code></a> 设置，用于在 CSRF cookie 上设置 <code class="docutils literal notranslate"><span class="pre">SameSite</span></code> cookie 标志。</li>
</ul>
</div>
<div class="section" id="s-forms">
<span id="forms"></span><h4>表单<a class="headerlink" href="#forms" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">ImageField</span></code> 的小部件现在以带有 HTML 属性 <code class="docutils literal notranslate"><span class="pre">accept=&quot;image/*&quot;</span></code> 渲染。</li>
</ul>
</div>
<div class="section" id="s-internationalization">
<span id="internationalization"></span><h4>国际化<a class="headerlink" href="#internationalization" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>添加了 <a class="reference internal" href="../ref/utils.html#django.utils.translation.get_supported_language_variant" title="django.utils.translation.get_supported_language_variant"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_supported_language_variant()</span></code></a> 函数。</li>
<li>领土语言变体的未翻译字符串现在使用通用语言的翻译。例如，未翻译的 <code class="docutils literal notranslate"><span class="pre">pt_BR</span></code> 字符串使用 <code class="docutils literal notranslate"><span class="pre">pt</span></code> 的翻译。</li>
</ul>
</div>
<div class="section" id="s-management-commands">
<span id="management-commands"></span><h4>管理命令<a class="headerlink" href="#management-commands" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../ref/django-admin.html#cmdoption-inspectdb-include-views"><code class="xref std std-option docutils literal notranslate"><span class="pre">inspectdb</span> <span class="pre">--include-views</span></code></a> 选项允许为数据库视图创建模型。</li>
<li><a class="reference internal" href="../howto/custom-management-commands.html#django.core.management.BaseCommand" title="django.core.management.BaseCommand"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseCommand</span></code></a> 类现在使用自定义的帮助格式化程序，以使标准选项如 <code class="docutils literal notranslate"><span class="pre">--verbosity</span></code> 或 <code class="docutils literal notranslate"><span class="pre">--settings</span></code> 出现在帮助输出的最后，从而为子类命令的选项提供更突出的位置。</li>
</ul>
</div>
<div class="section" id="s-migrations">
<span id="migrations"></span><h4>迁移<a class="headerlink" href="#migrations" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>添加了对 <code class="docutils literal notranslate"><span class="pre">functools.partialmethod</span></code> 对象的序列化支持。</li>
<li>为了支持冻结的环境，迁移可以从 <code class="docutils literal notranslate"><span class="pre">.pyc</span></code> 文件中加载。</li>
</ul>
</div>
<div class="section" id="s-models">
<span id="models"></span><h4>模型<a class="headerlink" href="#models" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>模型现在可以使用来自 <span class="target" id="index-6"></span><a class="pep reference external" href="https://peps.python.org/pep-0487/"><strong>PEP 487</strong></a> 的 <code class="docutils literal notranslate"><span class="pre">__init_subclass__()</span></code> 方法。</li>
<li>如果希望将它包含在模型表单中，可以将 <code class="docutils literal notranslate"><span class="pre">BinaryField</span></code> 设置为 <code class="docutils literal notranslate"><span class="pre">editable=True</span></code>。</li>
<li>新增了一些新的文本数据库函数：<a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Chr" title="django.db.models.functions.Chr"><code class="xref py py-class docutils literal notranslate"><span class="pre">Chr</span></code></a>、<a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Left" title="django.db.models.functions.Left"><code class="xref py py-class docutils literal notranslate"><span class="pre">Left</span></code></a>、<a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.LPad" title="django.db.models.functions.LPad"><code class="xref py py-class docutils literal notranslate"><span class="pre">LPad</span></code></a>、<a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.LTrim" title="django.db.models.functions.LTrim"><code class="xref py py-class docutils literal notranslate"><span class="pre">LTrim</span></code></a>、<a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Ord" title="django.db.models.functions.Ord"><code class="xref py py-class docutils literal notranslate"><span class="pre">Ord</span></code></a>、<a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Repeat" title="django.db.models.functions.Repeat"><code class="xref py py-class docutils literal notranslate"><span class="pre">Repeat</span></code></a>、<a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Replace" title="django.db.models.functions.Replace"><code class="xref py py-class docutils literal notranslate"><span class="pre">Replace</span></code></a>、<a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Right" title="django.db.models.functions.Right"><code class="xref py py-class docutils literal notranslate"><span class="pre">Right</span></code></a>、<a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.RPad" title="django.db.models.functions.RPad"><code class="xref py py-class docutils literal notranslate"><span class="pre">RPad</span></code></a>、<a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.RTrim" title="django.db.models.functions.RTrim"><code class="xref py py-class docutils literal notranslate"><span class="pre">RTrim</span></code></a> 和 <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Trim" title="django.db.models.functions.Trim"><code class="xref py py-class docutils literal notranslate"><span class="pre">Trim</span></code></a>。</li>
<li>新的 <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.TruncWeek" title="django.db.models.functions.TruncWeek"><code class="xref py py-class docutils literal notranslate"><span class="pre">TruncWeek</span></code></a> 函数将 <a class="reference internal" href="../ref/models/fields.html#django.db.models.DateField" title="django.db.models.DateField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateField</span></code></a> 和 <a class="reference internal" href="../ref/models/fields.html#django.db.models.DateTimeField" title="django.db.models.DateTimeField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateTimeField</span></code></a> 截断到一周的星期一。</li>
<li>现在可以使用减号对查询表达式进行否定。</li>
<li><a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.order_by" title="django.db.models.query.QuerySet.order_by"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.order_by()</span></code></a> 和 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.distinct" title="django.db.models.query.QuerySet.distinct"><code class="xref py py-meth docutils literal notranslate"><span class="pre">distinct(*fields)</span></code></a> 现在支持使用字段变换。</li>
<li><a class="reference internal" href="../ref/models/fields.html#django.db.models.BooleanField" title="django.db.models.BooleanField"><code class="xref py py-class docutils literal notranslate"><span class="pre">BooleanField</span></code></a> 现在可以设置为 <code class="docutils literal notranslate"><span class="pre">null=True</span></code>。这是鼓励的，而不是使用 <code class="docutils literal notranslate"><span class="pre">NullBooleanField</span></code>，后者可能会在将来被弃用。</li>
<li>新的 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.explain" title="django.db.models.query.QuerySet.explain"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.explain()</span></code></a> 方法显示查询集查询的数据库执行计划。</li>
<li><a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.raw" title="django.db.models.query.QuerySet.raw"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.raw()</span></code></a> 现在支持 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.prefetch_related" title="django.db.models.query.QuerySet.prefetch_related"><code class="xref py py-meth docutils literal notranslate"><span class="pre">prefetch_related()</span></code></a>。</li>
</ul>
</div>
<div class="section" id="s-requests-and-responses">
<span id="requests-and-responses"></span><h4>请求和响应<a class="headerlink" href="#requests-and-responses" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>添加了 <a class="reference internal" href="../ref/request-response.html#django.http.HttpRequest.get_full_path_info" title="django.http.HttpRequest.get_full_path_info"><code class="xref py py-meth docutils literal notranslate"><span class="pre">HttpRequest.get_full_path_info()</span></code></a>。</li>
<li>添加了 <code class="docutils literal notranslate"><span class="pre">samesite</span></code> 参数到 <a class="reference internal" href="../ref/request-response.html#django.http.HttpResponse.set_cookie" title="django.http.HttpResponse.set_cookie"><code class="xref py py-meth docutils literal notranslate"><span class="pre">HttpResponse.set_cookie()</span></code></a> 以允许设置 <code class="docutils literal notranslate"><span class="pre">SameSite</span></code> cookie 标志。</li>
<li><a class="reference internal" href="../ref/request-response.html#django.http.FileResponse" title="django.http.FileResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">FileResponse</span></code></a> 的新 <code class="docutils literal notranslate"><span class="pre">as_attachment</span></code> 参数设置了 <code class="docutils literal notranslate"><span class="pre">Content-Disposition</span></code> 头，使浏览器询问用户是否要下载文件。<code class="docutils literal notranslate"><span class="pre">FileResponse</span></code> 还会在适当的情况下尝试设置 <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Content-Length</span></code> 头。</li>
</ul>
</div>
<div class="section" id="s-templates">
<span id="templates"></span><h4>模板<a class="headerlink" href="#templates" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../ref/templates/builtins.html#std-templatefilter-json_script"><code class="xref std std-tfilter docutils literal notranslate"><span class="pre">json_script</span></code></a> 过滤器安全地将 Python 对象输出为 JSON，包装在 <code class="docutils literal notranslate"><span class="pre">&lt;script&gt;</span></code> 标签中，可供 JavaScript 使用。</li>
</ul>
</div>
<div class="section" id="s-tests">
<span id="tests"></span><h4>测试<a class="headerlink" href="#tests" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>添加了对 307 和 308 重定向的测试支持，测试 <a class="reference internal" href="../topics/testing/tools.html#django.test.Client" title="django.test.Client"><code class="xref py py-class docutils literal notranslate"><span class="pre">Client</span></code></a>。</li>
<li>测试 <a class="reference internal" href="../topics/testing/tools.html#django.test.Client" title="django.test.Client"><code class="xref py py-class docutils literal notranslate"><span class="pre">Client</span></code></a> 现在如果 <code class="docutils literal notranslate"><span class="pre">content_type='application/json'</span></code>，会将请求数据字典序列化为 JSON。你可以通过测试客户端的 <code class="docutils literal notranslate"><span class="pre">json_encoder</span></code> 参数自定义 JSON 编码器。</li>
<li>新的 <a class="reference internal" href="../topics/testing/tools.html#django.test.SimpleTestCase.assertWarnsMessage" title="django.test.SimpleTestCase.assertWarnsMessage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SimpleTestCase.assertWarnsMessage()</span></code></a> 方法是 <a class="reference external" href="https://docs.python.org/3/library/unittest.html#unittest.TestCase.assertWarnsRegex" title="(在 Python v3.12)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertWarnsRegex()</span></code></a> 的简化版本。</li>
</ul>
</div>
</div>
</div>
<div class="section" id="s-backwards-incompatible-changes-in-2-1">
<span id="s-backwards-incompatible-2-1"></span><span id="backwards-incompatible-changes-in-2-1"></span><span id="backwards-incompatible-2-1"></span><h2>2.1 版本中的不向后兼容变更<a class="headerlink" href="#backwards-incompatible-changes-in-2-1" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-database-backend-api">
<span id="database-backend-api"></span><h3>数据库后端 API<a class="headerlink" href="#database-backend-api" title="永久链接至标题">¶</a></h3>
<p>本节介绍了第三方数据库后端可能需要的更改。</p>
<ul class="simple">
<li>为了遵循 <span class="target" id="index-7"></span><a class="pep reference external" href="https://peps.python.org/pep-0249/"><strong>PEP 249</strong></a>，在数据库不支持某项功能时，异常已从 <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#NotImplementedError" title="(在 Python v3.12)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">NotImplementedError</span></code></a> 更改为 <a class="reference internal" href="../ref/exceptions.html#django.db.NotSupportedError" title="django.db.NotSupportedError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">django.db.NotSupportedError</span></code></a>。</li>
<li>将数据库特性标志 <code class="docutils literal notranslate"><span class="pre">allow_sliced_subqueries</span></code> 重命名为 <code class="docutils literal notranslate"><span class="pre">allow_sliced_subqueries_with_in</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">DatabaseOperations.distinct_sql()</span></code> 现在需要额外的 <code class="docutils literal notranslate"><span class="pre">params</span></code> 参数，并返回一个包含 SQL 和参数的元组，而不是一个 SQL 字符串。</li>
<li><code class="docutils literal notranslate"><span class="pre">DatabaseFeatures.introspected_boolean_field_type</span></code> 从方法更改为属性。</li>
</ul>
</div>
<div class="section" id="s-id1">
<span id="id1"></span><h3><a class="reference internal" href="../ref/contrib/gis/index.html#module-django.contrib.gis" title="django.contrib.gis: Geographic Information System (GIS) extensions for Django"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a><a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>移除对 SpatiaLite 4.0 的支持。</li>
</ul>
</div>
<div class="section" id="s-dropped-support-for-mysql-5-5">
<span id="dropped-support-for-mysql-5-5"></span><h3>不再支持 MySQL 5.5 版本<a class="headerlink" href="#dropped-support-for-mysql-5-5" title="永久链接至标题">¶</a></h3>
<p>MySQL 5.5 的上游支持结束于 2018 年 12 月。 Django 2.1 支持 MySQL 5.6 及更高版本。</p>
</div>
<div class="section" id="s-dropped-support-for-postgresql-9-3">
<span id="dropped-support-for-postgresql-9-3"></span><h3>不再支持 PostgreSQL 9.3 版本<a class="headerlink" href="#dropped-support-for-postgresql-9-3" title="永久链接至标题">¶</a></h3>
<p>PostgreSQL 9.3 的上游支持结束于 2018 年 9 月。 Django 2.1 支持 PostgreSQL 9.4 及更高版本。</p>
</div>
<div class="section" id="s-removed-bcryptpasswordhasher-from-the-default-password-hashers-setting">
<span id="removed-bcryptpasswordhasher-from-the-default-password-hashers-setting"></span><h3>从默认的 <code class="docutils literal notranslate"><span class="pre">PASSWORD_HASHERS</span></code> 设置中移除了 <code class="docutils literal notranslate"><span class="pre">BCryptPasswordHasher</span></code>。<a class="headerlink" href="#removed-bcryptpasswordhasher-from-the-default-password-hashers-setting" title="永久链接至标题">¶</a></h3>
<p>如果你在 Django 1.4 或 1.5 中使用了 bcrypt（在 Django 1.6 中添加了 <code class="docutils literal notranslate"><span class="pre">BCryptSHA256PasswordHasher</span></code>），你可能有一些使用了 <code class="docutils literal notranslate"><span class="pre">BCryptPasswordHasher</span></code> 哈希算法的密码。</p>
<p>您可以像这样检查是否符合条件：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">get_user_model</span>

<span class="n">User</span> <span class="o">=</span> <span class="n">get_user_model</span><span class="p">()</span>
<span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">password__startswith</span><span class="o">=</span><span class="s2">&quot;bcrypt$$&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>如果你想继续允许使用这些密码，你将需要定义 <a class="reference internal" href="../ref/settings.html#std-setting-PASSWORD_HASHERS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">PASSWORD_HASHERS</span></code></a> 设置（如果尚未定义），并包含 <code class="docutils literal notranslate"><span class="pre">'django.contrib.auth.hashers.BCryptPasswordHasher'</span></code>。</p>
</div>
<div class="section" id="s-moved-wrap-label-widget-template-context-variable">
<span id="moved-wrap-label-widget-template-context-variable"></span><h3>移动了 <code class="docutils literal notranslate"><span class="pre">wrap_label</span></code> 小部件模板上下文变量<a class="headerlink" href="#moved-wrap-label-widget-template-context-variable" title="永久链接至标题">¶</a></h3>
<p>为了解决在使用 <code class="docutils literal notranslate"><span class="pre">MultiWidget</span></code> 时使用 <code class="docutils literal notranslate"><span class="pre">RadioSelect</span></code> 和 <code class="docutils literal notranslate"><span class="pre">CheckboxSelectMultiple</span></code> 时缺少 <code class="docutils literal notranslate"><span class="pre">&lt;label&gt;</span></code> 的问题，现在 <code class="docutils literal notranslate"><span class="pre">wrap_label</span></code> 上下文变量已经作为每个选项的属性出现。例如，在自定义的 <code class="docutils literal notranslate"><span class="pre">input_option.html</span></code> 模板中，将 <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">if</span> <span class="pre">wrap_label</span> <span class="pre">%}</span></code> 更改为 <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">if</span> <span class="pre">widget.wrap_label</span> <span class="pre">%}</span></code>。</p>
</div>
<div class="section" id="s-samesite-cookies">
<span id="samesite-cookies"></span><h3><code class="docutils literal notranslate"><span class="pre">SameSite</span></code> cookies<a class="headerlink" href="#samesite-cookies" title="永久链接至标题">¶</a></h3>
<p>用于 <code class="docutils literal notranslate"><span class="pre">django.contrib.sessions</span></code>、<code class="docutils literal notranslate"><span class="pre">django.contrib.messages</span></code> 和 Django 的 CSRF 保护的 cookie 现在默认将 <code class="docutils literal notranslate"><span class="pre">SameSite</span></code> 标志设置为 <code class="docutils literal notranslate"><span class="pre">Lax</span></code>。遵循此标志的浏览器不会在跨源请求上发送这些 cookie。如果依赖旧行为，请将 <a class="reference internal" href="../ref/settings.html#std-setting-SESSION_COOKIE_SAMESITE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">SESSION_COOKIE_SAMESITE</span></code></a> 和/或 <a class="reference internal" href="../ref/settings.html#std-setting-CSRF_COOKIE_SAMESITE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">CSRF_COOKIE_SAMESITE</span></code></a> 设置为 <code class="docutils literal notranslate"><span class="pre">None</span></code>。</p>
</div>
<div class="section" id="s-considerations-for-the-new-model-view-permission">
<span id="s-view-permission-backwards-incompatible"></span><span id="considerations-for-the-new-model-view-permission"></span><span id="view-permission-backwards-incompatible"></span><h3>新模型“查看”权限的注意事项<a class="headerlink" href="#considerations-for-the-new-model-view-permission" title="永久链接至标题">¶</a></h3>
<div class="section" id="s-custom-admin-forms-need-to-take-the-view-only-case-into-account">
<span id="custom-admin-forms-need-to-take-the-view-only-case-into-account"></span><h4>自定义管理表单需要考虑只读视图的情况。<a class="headerlink" href="#custom-admin-forms-need-to-take-the-view-only-case-into-account" title="永久链接至标题">¶</a></h4>
<p>新的 &quot;view&quot; 权限引入后，已存在的自定义管理员表单可能会在用户没有 &quot;change&quot; 权限时引发错误，因为表单可能会访问不存在的字段。通过覆盖 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.get_form" title="django.contrib.admin.ModelAdmin.get_form"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ModelAdmin.get_form()</span></code></a> 方法，可以解决此问题，检查用户是否具有 &quot;change&quot; 权限，如果没有，则返回默认表单：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_form</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_change_permission</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_form</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">CustomForm</span>
</pre></div>
</div>
</div>
<div class="section" id="s-new-default-view-permission-could-allow-unwanted-access-to-admin-views">
<span id="new-default-view-permission-could-allow-unwanted-access-to-admin-views"></span><h4>新的默认视图权限可能会导致对管理员视图的非预期访问。<a class="headerlink" href="#new-default-view-permission-could-allow-unwanted-access-to-admin-views" title="永久链接至标题">¶</a></h4>
<p>如果你有一个自定义权限，其代码名称的形式为 <code class="docutils literal notranslate"><span class="pre">view_&lt;modelname&gt;</span></code>，新的管理员中的视图权限处理将允许访问这些模型的 changelist 和详情页。如果这不是你想要的行为，你必须更改你的自定义权限代码名称。</p>
</div>
</div>
<div class="section" id="s-miscellaneous">
<span id="miscellaneous"></span><h3>杂项<a class="headerlink" href="#miscellaneous" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">mysqlclient</span></code> 的最低支持版本已从 1.3.3 增加到 1.3.7。</li>
<li>不再支持 SQLite 版本低于 3.7.15 。</li>
<li><code class="docutils literal notranslate"><span class="pre">Set-Cookie</span></code> 的 <code class="docutils literal notranslate"><span class="pre">Expires</span></code> 指令的日期格式已更改，以遵循 <span class="target" id="index-8"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7231.html#section-7.1.1.1"><strong>RFC 7231#section-7.1.1.1</strong></a>，而不是 Netscape 的 cookie 标准。在日期中出现的连字符（如 <code class="docutils literal notranslate"><span class="pre">Tue,</span> <span class="pre">25-Dec-2018</span> <span class="pre">22:26:13</span> <span class="pre">GMT</span></code>）已被移除。这个改变应该只是视觉上的变化，除非是一些不支持新格式的过时浏览器。</li>
<li><code class="docutils literal notranslate"><span class="pre">allowed_hosts</span></code> 现在是私有 API <code class="docutils literal notranslate"><span class="pre">django.utils.http.is_safe_url()</span></code> 的必需参数。</li>
<li><a class="reference internal" href="../ref/forms/widgets.html#django.forms.SelectMultiple" title="django.forms.SelectMultiple"><code class="xref py py-class docutils literal notranslate"><span class="pre">SelectMultiple</span></code></a> 小部件渲染的 <code class="docutils literal notranslate"><span class="pre">multiple</span></code> 属性现在使用 HTML5 的布尔语法，而不是 XHTML 的 <code class="docutils literal notranslate"><span class="pre">multiple=&quot;multiple&quot;</span></code>。</li>
<li>由表单小部件渲染的 HTML 不再在空元素上包含闭合斜杠，例如 <code class="docutils literal notranslate"><span class="pre">&lt;br&gt;</span></code>。这在 XHTML 中不兼容，尽管一些小部件已经使用了 HTML5 的一些特性，如布尔属性。</li>
<li><a class="reference internal" href="../ref/forms/widgets.html#django.forms.SelectDateWidget" title="django.forms.SelectDateWidget"><code class="xref py py-class docutils literal notranslate"><span class="pre">SelectDateWidget</span></code></a> 的空选项的值已从 0 更改为空字符串，这主要可能需要在比较 HTML 的测试中进行一些调整。</li>
<li><a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.models.User.has_usable_password" title="django.contrib.auth.models.User.has_usable_password"><code class="xref py py-meth docutils literal notranslate"><span class="pre">User.has_usable_password()</span></code></a> 和 <a class="reference internal" href="../topics/auth/passwords.html#django.contrib.auth.hashers.is_password_usable" title="django.contrib.auth.hashers.is_password_usable"><code class="xref py py-func docutils literal notranslate"><span class="pre">is_password_usable()</span></code></a> 函数不再在密码为 <code class="docutils literal notranslate"><span class="pre">None</span></code>、空字符串或使用不在 <a class="reference internal" href="../ref/settings.html#std-setting-PASSWORD_HASHERS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">PASSWORD_HASHERS</span></code></a> 设置中的哈希器时返回 <code class="docutils literal notranslate"><span class="pre">False</span></code>。这种未记录的行为是 Django 1.6 中的一个回归，阻止了使用这些密码的用户请求密码重置。审查你的代码以确认你的这些 API 的使用不依赖于旧的行为。</li>
<li>由于迁移现在从 <code class="docutils literal notranslate"><span class="pre">.pyc</span></code> 文件加载，如果你在混合 Python 2 和 Python 3 环境中工作，你可能需要删除它们。</li>
<li>在 <code class="docutils literal notranslate"><span class="pre">django.contrib.postgres.fields.JSONField</span></code> 上使用 <code class="docutils literal notranslate"><span class="pre">None</span></code> 作为查找值现在匹配具有指定键和空值的对象，而不是不具有该键的对象。</li>
<li>管理员的 CSS 类 <code class="docutils literal notranslate"><span class="pre">field-box</span></code> 已重命名为 <code class="docutils literal notranslate"><span class="pre">fieldBox</span></code>，以防止与模型字段命名为 &quot;box&quot; 的类发生冲突。</li>
<li>由于现在可以按应用程序或模型覆盖管理员的 <code class="docutils literal notranslate"><span class="pre">actions.html</span></code>、<code class="docutils literal notranslate"><span class="pre">change_list_results.html</span></code>、<code class="docutils literal notranslate"><span class="pre">date_hierarchy.html</span></code>、<code class="docutils literal notranslate"><span class="pre">pagination.html</span></code>、<code class="docutils literal notranslate"><span class="pre">prepopulated_fields_js.html</span></code>、<code class="docutils literal notranslate"><span class="pre">search_form.html</span></code> 和 <code class="docutils literal notranslate"><span class="pre">submit_line.html</span></code> 模板，因此您可能需要重命名已为不同目的编写的具有这些名称的现有模板。</li>
<li><code class="docutils literal notranslate"><span class="pre">QuerySet.raw()</span></code> 现在像常规的查询集一样缓存其结果。如果不想缓存，请使用 <code class="docutils literal notranslate"><span class="pre">iterator()</span></code>。</li>
<li>数据库路由器的 <a class="reference internal" href="../topics/db/multi-db.html#allow_relation" title="allow_relation"><code class="xref py py-meth docutils literal notranslate"><span class="pre">allow_relation()</span></code></a> 方法在更多情况下被调用。不正确编写的路由器可能需要相应地进行更新。</li>
<li>在运行管理命令之前不再停用翻译。如果你的自定义命令需要停用翻译（例如，将未翻译的内容插入数据库），可以使用新的 <a class="reference internal" href="../howto/custom-management-commands.html#management-commands-and-locales"><span class="std std-ref">&#64;no_translations 装饰器</span></a>。</li>
<li>管理命令不再允许 <code class="docutils literal notranslate"><span class="pre">--settings</span></code> 和 <code class="docutils literal notranslate"><span class="pre">--pythonpath</span></code> 参数的缩写形式。</li>
<li>私有常量 <code class="docutils literal notranslate"><span class="pre">django.db.models.sql.constants.QUERY_TERMS</span></code> 已被移除。 <a class="reference internal" href="../ref/models/lookups.html#lookup-registration-api"><span class="std std-ref">查找注册 API</span></a> 的 <a class="reference internal" href="../ref/models/lookups.html#django.db.models.lookups.RegisterLookupMixin.get_lookup" title="django.db.models.lookups.RegisterLookupMixin.get_lookup"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_lookup()</span></code></a> 和 <a class="reference internal" href="../ref/models/lookups.html#django.db.models.lookups.RegisterLookupMixin.get_lookups" title="django.db.models.lookups.RegisterLookupMixin.get_lookups"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_lookups()</span></code></a> 方法可能是合适的替代方案。与 <code class="docutils literal notranslate"><span class="pre">QUERY_TERMS</span></code> 常量相比，它们允许您的代码还考虑了已注册的任何自定义查找。</li>
<li>与 <code class="docutils literal notranslate"><span class="pre">py-bcrypt</span></code> 的兼容性已被移除，因为它已不再维护。请改用 <a class="reference external" href="https://pypi.org/project/bcrypt/">bcrypt</a>。</li>
</ul>
</div>
</div>
<div class="section" id="s-features-deprecated-in-2-1">
<span id="s-deprecated-features-2-1"></span><span id="features-deprecated-in-2-1"></span><span id="deprecated-features-2-1"></span><h2>在 2.1 中被废弃的功能<a class="headerlink" href="#features-deprecated-in-2-1" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-id2">
<span id="id2"></span><h3>杂项<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">ForceRHR</span></code> GIS 函数已被弃用，建议使用新的 <a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.ForcePolygonCW" title="django.contrib.gis.db.models.functions.ForcePolygonCW"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForcePolygonCW</span></code></a> 函数。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.http.cookie_date()</span></code> 已被弃用，建议使用 <a class="reference internal" href="../ref/utils.html#django.utils.http.http_date" title="django.utils.http.http_date"><code class="xref py py-func docutils literal notranslate"><span class="pre">http_date()</span></code></a>，它遵循最新 RFC 的格式。</li>
<li><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">load</span> <span class="pre">staticfiles</span> <span class="pre">%}</span></code> 和 <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">load</span> <span class="pre">admin_static</span> <span class="pre">%}</span></code> 已被弃用，建议使用 <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">load</span> <span class="pre">static</span> <span class="pre">%}</span></code>，它具有相同的功能。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.staticfiles.templatetags.static()</span></code> 已被弃用，建议使用 <code class="docutils literal notranslate"><span class="pre">django.templatetags.static.static()</span></code>。</li>
<li>不接受 <code class="docutils literal notranslate"><span class="pre">obj</span></code> 作为第二个位置参数的 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.InlineModelAdmin.has_add_permission" title="django.contrib.admin.InlineModelAdmin.has_add_permission"><code class="xref py py-meth docutils literal notranslate"><span class="pre">InlineModelAdmin.has_add_permission()</span></code></a> 方法的支持将在 Django 3.0 中被移除。</li>
</ul>
</div>
</div>
<div class="section" id="s-features-removed-in-2-1">
<span id="s-removed-features-2-1"></span><span id="features-removed-in-2-1"></span><span id="removed-features-2-1"></span><h2>在 2.1 版本中删除的功能<a class="headerlink" href="#features-removed-in-2-1" title="永久链接至标题">¶</a></h2>
<p>这些功能已经完成了其弃用周期，并在 Django 2.1 中被移除。有关详细信息，包括如何删除这些功能的用法，请参阅 <a class="reference internal" href="1.11.html#deprecated-features-1-11"><span class="std std-ref">在 1.11 中被废弃的功能</span></a>。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">contrib.auth.views.login()</span></code>, <code class="docutils literal notranslate"><span class="pre">logout()</span></code>, <code class="docutils literal notranslate"><span class="pre">password_change()</span></code>, <code class="docutils literal notranslate"><span class="pre">password_change_done()</span></code>, <code class="docutils literal notranslate"><span class="pre">password_reset()</span></code>, <code class="docutils literal notranslate"><span class="pre">password_reset_done()</span></code>, <code class="docutils literal notranslate"><span class="pre">password_reset_confirm()</span></code>, 和 <code class="docutils literal notranslate"><span class="pre">password_reset_complete()</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">contrib.auth.views.logout_then_login()</span></code> 的 <code class="docutils literal notranslate"><span class="pre">extra_context</span></code> 参数已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.test.runner.setup_databases()</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.translation.string_concat()</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.core.cache.backends.memcached.PyLibMCCache</span></code> 不再支持将 <code class="docutils literal notranslate"><span class="pre">pylibmc</span></code> 行为设置作为 <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> 的顶级属性传递。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.http.is_safe_url()</span></code> 的 <code class="docutils literal notranslate"><span class="pre">host</span></code> 参数已被移除。</li>
<li>不再屏蔽在渲染 <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include</span> <span class="pre">%}</span></code> 模板标签时引发的异常。</li>
<li><code class="docutils literal notranslate"><span class="pre">DatabaseIntrospection.get_indexes()</span></code> 已被移除。</li>
<li>认证后端的 <code class="docutils literal notranslate"><span class="pre">authenticate()</span></code> 方法要求将 <code class="docutils literal notranslate"><span class="pre">request</span></code> 作为第一个位置参数。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.db.models.permalink()</span></code> 装饰器已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">USE_ETAGS</span></code> 设置已被移除。<code class="docutils literal notranslate"><span class="pre">CommonMiddleware</span></code> 和 <code class="docutils literal notranslate"><span class="pre">django.utils.cache.patch_response_headers()</span></code> 不再设置 ETags。</li>
<li><code class="docutils literal notranslate"><span class="pre">Model._meta.has_auto_field</span></code> 属性已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">url()</span></code> 对正则表达式组中的内联标志（<code class="docutils literal notranslate"><span class="pre">(?i)</span></code>、<code class="docutils literal notranslate"><span class="pre">(?L)</span></code>、<code class="docutils literal notranslate"><span class="pre">(?m)</span></code>、<code class="docutils literal notranslate"><span class="pre">(?s)</span></code> 和 <code class="docutils literal notranslate"><span class="pre">(?u)</span></code>）的支持已被移除。</li>
<li>不再支持没有 <code class="docutils literal notranslate"><span class="pre">renderer</span></code> 参数的 <code class="docutils literal notranslate"><span class="pre">Widget.render()</span></code> 方法。</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../contents.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">Django 2.1 版本发行说明</a><ul>
<li><a class="reference internal" href="#python-compatibility">Python 兼容性</a></li>
<li><a class="reference internal" href="#what-s-new-in-django-2-1">Django 2.1 的新特性是什么？</a><ul>
<li><a class="reference internal" href="#model-view-permission">模型的“查看”权限</a></li>
<li><a class="reference internal" href="#minor-features">次要特性</a><ul>
<li><a class="reference internal" href="#django-contrib-admin"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-auth"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-gis"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-sessions"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sessions</span></code></a></li>
<li><a class="reference internal" href="#cache">缓存</a></li>
<li><a class="reference internal" href="#csrf">CSRF</a></li>
<li><a class="reference internal" href="#forms">表单</a></li>
<li><a class="reference internal" href="#internationalization">国际化</a></li>
<li><a class="reference internal" href="#management-commands">管理命令</a></li>
<li><a class="reference internal" href="#migrations">迁移</a></li>
<li><a class="reference internal" href="#models">模型</a></li>
<li><a class="reference internal" href="#requests-and-responses">请求和响应</a></li>
<li><a class="reference internal" href="#templates">模板</a></li>
<li><a class="reference internal" href="#tests">测试</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-incompatible-changes-in-2-1">2.1 版本中的不向后兼容变更</a><ul>
<li><a class="reference internal" href="#database-backend-api">数据库后端 API</a></li>
<li><a class="reference internal" href="#id1"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a></li>
<li><a class="reference internal" href="#dropped-support-for-mysql-5-5">不再支持 MySQL 5.5 版本</a></li>
<li><a class="reference internal" href="#dropped-support-for-postgresql-9-3">不再支持 PostgreSQL 9.3 版本</a></li>
<li><a class="reference internal" href="#removed-bcryptpasswordhasher-from-the-default-password-hashers-setting">从默认的 <code class="docutils literal notranslate"><span class="pre">PASSWORD_HASHERS</span></code> 设置中移除了 <code class="docutils literal notranslate"><span class="pre">BCryptPasswordHasher</span></code>。</a></li>
<li><a class="reference internal" href="#moved-wrap-label-widget-template-context-variable">移动了 <code class="docutils literal notranslate"><span class="pre">wrap_label</span></code> 小部件模板上下文变量</a></li>
<li><a class="reference internal" href="#samesite-cookies"><code class="docutils literal notranslate"><span class="pre">SameSite</span></code> cookies</a></li>
<li><a class="reference internal" href="#considerations-for-the-new-model-view-permission">新模型“查看”权限的注意事项</a><ul>
<li><a class="reference internal" href="#custom-admin-forms-need-to-take-the-view-only-case-into-account">自定义管理表单需要考虑只读视图的情况。</a></li>
<li><a class="reference internal" href="#new-default-view-permission-could-allow-unwanted-access-to-admin-views">新的默认视图权限可能会导致对管理员视图的非预期访问。</a></li>
</ul>
</li>
<li><a class="reference internal" href="#miscellaneous">杂项</a></li>
</ul>
</li>
<li><a class="reference internal" href="#features-deprecated-in-2-1">在 2.1 中被废弃的功能</a><ul>
<li><a class="reference internal" href="#id2">杂项</a></li>
</ul>
</li>
<li><a class="reference internal" href="#features-removed-in-2-1">在 2.1 版本中删除的功能</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="2.1.1.html"
                          title="上一章">Django 2.1.1 版本发行说明</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="2.0.13.html"
                          title="下一章">Django 2.0.13 版本发行说明</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/releases/2.1.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">3月 29, 2024</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="2.1.1.html" title="Django 2.1.1 版本发行说明">previous</a>
     |
    <a href="index.html" title="发行说明" accesskey="U">up</a>
   |
    <a href="2.0.13.html" title="Django 2.0.13 版本发行说明">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>
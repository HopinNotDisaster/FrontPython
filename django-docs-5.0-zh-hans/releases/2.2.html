
<!DOCTYPE html>

<html lang="zh_Hans">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Django 2.2 版本发行说明 &#8212; Django 5.0.4.dev20240329153429 文档</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/default.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Django 2.1.15 版本发行说明" href="2.1.15.html" />
    <link rel="prev" title="Django 2.2.1 版本发行说明" href="2.2.1.html" />



 
<script src="../templatebuiltins.js"></script>
<script>
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);</script>

  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../index.html">Django 5.0.4.dev20240329153429 文档</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../index.html">Home</a>  |
        <a title="Table of contents" href="../contents.html">Table of contents</a>  |
        <a title="Global index" href="../genindex.html">Index</a>  |
        <a title="Module index" href="../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="2.2.1.html" title="Django 2.2.1 版本发行说明">previous</a>
     |
    <a href="index.html" title="发行说明" accesskey="U">up</a>
   |
    <a href="2.1.15.html" title="Django 2.1.15 版本发行说明">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="releases-2.2">
            
  <div class="section" id="s-django-2-2-release-notes">
<span id="django-2-2-release-notes"></span><h1>Django 2.2 版本发行说明<a class="headerlink" href="#django-2-2-release-notes" title="永久链接至标题">¶</a></h1>
<p><em>2019 年 4 月 1 日</em></p>
<p>欢迎使用 Django 2.2 ！</p>
<p>这些发布说明涵盖了 <a class="reference internal" href="#whats-new-2-2"><span class="std std-ref">新功能</span></a>，以及在从 Django 2.1 或更早版本升级时需要注意的一些 <a class="reference internal" href="#backwards-incompatible-2-2"><span class="std std-ref">向后不兼容的更改</span></a>。我们已经 <a class="reference internal" href="#deprecated-features-2-2"><span class="std std-ref">开始了一些功能的弃用过程</span></a>。</p>
<p>如果你要更新现有的项目，请看 <a class="reference internal" href="../howto/upgrade-version.html"><span class="doc">如何将 Django 更新至新的版本</span></a> 指南。</p>
<p>Django 2.2 被指定为 <a class="reference internal" href="../internals/release-process.html#term-Long-term-support-release"><span class="xref std std-term">长期支持版本</span></a>。它将在发布后至少三年内接收安全更新。对于之前的 LTS 版本 Django 1.11，支持将在 2020 年 4 月结束。</p>
<div class="section" id="s-python-compatibility">
<span id="python-compatibility"></span><h2>Python 兼容性<a class="headerlink" href="#python-compatibility" title="永久链接至标题">¶</a></h2>
<p>Django 2.2 支持 Python 3.5、3.6、3.7、3.8（从 2.2.8 版开始），以及 3.9（从 2.2.17 版开始）。我们 <strong>强烈建议</strong> 并只官方支持每个系列的最新版本。</p>
</div>
<div class="section" id="s-what-s-new-in-django-2-2">
<span id="s-whats-new-2-2"></span><span id="what-s-new-in-django-2-2"></span><span id="whats-new-2-2"></span><h2>Django 2.2 的新功能有哪些呢？<a class="headerlink" href="#what-s-new-in-django-2-2" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-constraints">
<span id="constraints"></span><h3>约束<a class="headerlink" href="#constraints" title="永久链接至标题">¶</a></h3>
<p>新的 <a class="reference internal" href="../ref/models/constraints.html#django.db.models.CheckConstraint" title="django.db.models.CheckConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">CheckConstraint</span></code></a> 和 <a class="reference internal" href="../ref/models/constraints.html#django.db.models.UniqueConstraint" title="django.db.models.UniqueConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">UniqueConstraint</span></code></a> 类允许添加自定义数据库约束。约束可以使用 <a class="reference internal" href="../ref/models/options.html#django.db.models.Options.constraints" title="django.db.models.Options.constraints"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Meta.constraints</span></code></a> 选项添加到模型中。</p>
</div>
<div class="section" id="s-minor-features">
<span id="minor-features"></span><h3>次要特性<a class="headerlink" href="#minor-features" title="永久链接至标题">¶</a></h3>
<div class="section" id="s-django-contrib-admin">
<span id="django-contrib-admin"></span><h4><a class="reference internal" href="../ref/contrib/admin/index.html#module-django.contrib.admin" title="django.contrib.admin: Django's admin site."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a><a class="headerlink" href="#django-contrib-admin" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>为 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.TabularInline" title="django.contrib.admin.TabularInline"><code class="xref py py-class docutils literal notranslate"><span class="pre">TabularInline</span></code></a> 的列标题添加了一个 CSS 类。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-auth">
<span id="django-contrib-auth"></span><h4><a class="reference internal" href="../topics/auth/index.html#module-django.contrib.auth" title="django.contrib.auth: Django's authentication framework."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a><a class="headerlink" href="#django-contrib-auth" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>如果接受，现在将 <code class="docutils literal notranslate"><span class="pre">HttpRequest</span></code> 作为 <a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.backends.RemoteUserBackend.configure_user" title="django.contrib.auth.backends.RemoteUserBackend.configure_user"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RemoteUserBackend.configure_user()</span></code></a> 的第一个位置参数传递。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-gis">
<span id="django-contrib-gis"></span><h4><a class="reference internal" href="../ref/contrib/gis/index.html#module-django.contrib.gis" title="django.contrib.gis: Geographic Information System (GIS) extensions for Django"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a><a class="headerlink" href="#django-contrib-gis" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>为 <a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.Envelope" title="django.contrib.gis.db.models.functions.Envelope"><code class="xref py py-class docutils literal notranslate"><span class="pre">Envelope</span></code></a> 函数添加了对 Oracle 数据库的支持。</li>
<li>为 <a class="reference internal" href="../ref/contrib/gis/geoquerysets.html#std-fieldlookup-coveredby"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">coveredby</span></code></a> 和 <a class="reference internal" href="../ref/contrib/gis/geoquerysets.html#std-fieldlookup-covers"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">covers</span></code></a> 查询添加了对 SpatiaLite 的支持。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-postgres">
<span id="django-contrib-postgres"></span><h4><a class="reference internal" href="../ref/contrib/postgres/index.html#module-django.contrib.postgres" title="django.contrib.postgres: PostgreSQL-specific fields and features"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.postgres</span></code></a><a class="headerlink" href="#django-contrib-postgres" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>对于 <a class="reference internal" href="../ref/contrib/postgres/aggregates.html#django.contrib.postgres.aggregates.ArrayAgg" title="django.contrib.postgres.aggregates.ArrayAgg"><code class="xref py py-class docutils literal notranslate"><span class="pre">ArrayAgg</span></code></a> 和 <a class="reference internal" href="../ref/contrib/postgres/aggregates.html#django.contrib.postgres.aggregates.StringAgg" title="django.contrib.postgres.aggregates.StringAgg"><code class="xref py py-class docutils literal notranslate"><span class="pre">StringAgg</span></code></a>，新的 <code class="docutils literal notranslate"><span class="pre">ordering</span></code> 参数确定了聚合元素的排序方式。</li>
<li>新的 <a class="reference internal" href="../ref/contrib/postgres/indexes.html#django.contrib.postgres.indexes.BTreeIndex" title="django.contrib.postgres.indexes.BTreeIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">BTreeIndex</span></code></a>、<a class="reference internal" href="../ref/contrib/postgres/indexes.html#django.contrib.postgres.indexes.HashIndex" title="django.contrib.postgres.indexes.HashIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">HashIndex</span></code></a> 和 <a class="reference internal" href="../ref/contrib/postgres/indexes.html#django.contrib.postgres.indexes.SpGistIndex" title="django.contrib.postgres.indexes.SpGistIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpGistIndex</span></code></a> 类允许在数据库中创建 <code class="docutils literal notranslate"><span class="pre">B-Tree</span></code>、<code class="docutils literal notranslate"><span class="pre">hash</span></code> 和 <code class="docutils literal notranslate"><span class="pre">SP-GiST</span></code> 索引。</li>
<li><a class="reference internal" href="../ref/contrib/postgres/indexes.html#django.contrib.postgres.indexes.BrinIndex" title="django.contrib.postgres.indexes.BrinIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">BrinIndex</span></code></a> 现在具有 <code class="docutils literal notranslate"><span class="pre">autosummarize</span></code> 参数。</li>
<li><a class="reference internal" href="../ref/contrib/postgres/search.html#django.contrib.postgres.search.SearchQuery" title="django.contrib.postgres.search.SearchQuery"><code class="xref py py-class docutils literal notranslate"><span class="pre">SearchQuery</span></code></a> 的新参数 <code class="docutils literal notranslate"><span class="pre">search_type</span></code> 允许搜索短语或原始表达式。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-staticfiles">
<span id="django-contrib-staticfiles"></span><h4><a class="reference internal" href="../ref/contrib/staticfiles.html#module-django.contrib.staticfiles" title="django.contrib.staticfiles: An app for handling static files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.staticfiles</span></code></a><a class="headerlink" href="#django-contrib-staticfiles" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>在 <a class="reference internal" href="../ref/contrib/staticfiles.html#cmdoption-collectstatic-ignore"><code class="xref std std-option docutils literal notranslate"><span class="pre">collectstatic</span> <span class="pre">--ignore</span></code></a> 选项中添加了路径匹配功能，以便可以使用像 <code class="docutils literal notranslate"><span class="pre">/vendor/*.js</span></code> 这样的模式。</li>
</ul>
</div>
<div class="section" id="s-database-backends">
<span id="database-backends"></span><h4>数据库后端<a class="headerlink" href="#database-backends" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>在 SQLite 上为 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.iterator" title="django.db.models.query.QuerySet.iterator"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.iterator()</span></code></a> 添加了结果流式传输功能。</li>
</ul>
</div>
<div class="section" id="s-generic-views">
<span id="generic-views"></span><h4>通用视图<a class="headerlink" href="#generic-views" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../ref/class-based-views/base.html#django.views.generic.base.View.setup" title="django.views.generic.base.View.setup"><code class="xref py py-meth docutils literal notranslate"><span class="pre">View.setup</span></code></a> 钩子在调用 <a class="reference internal" href="../ref/class-based-views/base.html#django.views.generic.base.View.dispatch" title="django.views.generic.base.View.dispatch"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dispatch()</span></code></a> 之前初始化视图属性。它允许 mixins 设置实例属性，以便在子类中重用。</li>
</ul>
</div>
<div class="section" id="s-internationalization">
<span id="internationalization"></span><h4>国际化<a class="headerlink" href="#internationalization" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>增加了对亚美尼亚语的支持和翻译。</li>
</ul>
</div>
<div class="section" id="s-management-commands">
<span id="management-commands"></span><h4>管理命令<a class="headerlink" href="#management-commands" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../ref/django-admin.html#cmdoption-force-color"><code class="xref std std-option docutils literal notranslate"><span class="pre">--force-color</span></code></a> 选项强制对命令输出进行着色。</li>
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-inspectdb"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">inspectdb</span></code></a> 现在会为 PostgreSQL 上的外部表创建模型。</li>
<li><a class="reference internal" href="../ref/django-admin.html#cmdoption-inspectdb-include-views"><code class="xref std std-option docutils literal notranslate"><span class="pre">inspectdb</span> <span class="pre">--include-views</span></code></a> 现在会为 Oracle 和 PostgreSQL 上的物化视图创建模型。</li>
<li>新的 <a class="reference internal" href="../ref/django-admin.html#cmdoption-inspectdb-include-partitions"><code class="xref std std-option docutils literal notranslate"><span class="pre">inspectdb</span> <span class="pre">--include-partitions</span></code></a> 选项允许在 PostgreSQL 上为分区表创建模型。在旧版本中，模型是在子表而不是父表中创建的。</li>
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-inspectdb"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">inspectdb</span></code></a> 现在可以为 Oracle 和 PostgreSQL 自动检测 <a class="reference internal" href="../ref/models/fields.html#django.db.models.DurationField" title="django.db.models.DurationField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DurationField</span></code></a>，以及为 SQLite 检测 <a class="reference internal" href="../ref/models/fields.html#django.db.models.AutoField" title="django.db.models.AutoField"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoField</span></code></a>。</li>
<li>在 Oracle 上，如果可用，<a class="reference internal" href="../ref/django-admin.html#django-admin-dbshell"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">dbshell</span></code></a> 会使用 <code class="docutils literal notranslate"><span class="pre">rlwrap</span></code> 包装。<code class="docutils literal notranslate"><span class="pre">rlwrap</span></code> 提供了命令历史记录和键盘输入的编辑功能。</li>
<li>新的 <a class="reference internal" href="../ref/django-admin.html#cmdoption-makemigrations-no-header"><code class="xref std std-option docutils literal notranslate"><span class="pre">makemigrations</span> <span class="pre">--no-header</span></code></a> 选项可以避免在生成的迁移文件中写入头部注释。这个选项也适用于 <a class="reference internal" href="../ref/django-admin.html#django-admin-squashmigrations"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">squashmigrations</span></code></a>。</li>
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-runserver"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">runserver</span></code></a> 现在可以使用 <a class="reference external" href="https://facebook.github.io/watchman/">Watchman</a> 来提高监视大量文件变化的性能。</li>
</ul>
</div>
<div class="section" id="s-migrations">
<span id="migrations"></span><h4>迁移<a class="headerlink" href="#migrations" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../ref/django-admin.html#cmdoption-migrate-plan"><code class="xref std std-option docutils literal notranslate"><span class="pre">migrate</span> <span class="pre">--plan</span></code></a> 选项会打印将执行的迁移操作列表。</li>
<li><code class="docutils literal notranslate"><span class="pre">NoneType</span></code> 现在可以在迁移中序列化。</li>
<li>现在可以为迁移 <a class="reference internal" href="../topics/migrations.html#custom-migration-serializers"><span class="std std-ref">注册自定义序列化程序</span></a>。</li>
</ul>
</div>
<div class="section" id="s-models">
<span id="models"></span><h4>模型<a class="headerlink" href="#models" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>添加了对 PostgreSQL 运算符类 (<a class="reference internal" href="../ref/models/indexes.html#django.db.models.Index.opclasses" title="django.db.models.Index.opclasses"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Index.opclasses</span></code></a>) 的支持。</li>
<li>添加了对部分索引 (<a class="reference internal" href="../ref/models/indexes.html#django.db.models.Index.condition" title="django.db.models.Index.condition"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Index.condition</span></code></a>) 的支持。</li>
<li>添加了 <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.NullIf" title="django.db.models.functions.NullIf"><code class="xref py py-class docutils literal notranslate"><span class="pre">NullIf</span></code></a> 和 <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Reverse" title="django.db.models.functions.Reverse"><code class="xref py py-class docutils literal notranslate"><span class="pre">Reverse</span></code></a> 数据库函数，以及许多 <a class="reference internal" href="../ref/models/database-functions.html#math-functions"><span class="std std-ref">数学数据库函数</span></a>。</li>
<li>将 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.bulk_create" title="django.db.models.query.QuerySet.bulk_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.bulk_create()</span></code></a> 的新参数 <code class="docutils literal notranslate"><span class="pre">ignore_conflicts</span></code> 设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 会告诉数据库忽略插入失败的行，即违反唯一性约束或其他检查的行。</li>
<li>新的 <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.ExtractIsoYear" title="django.db.models.functions.ExtractIsoYear"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExtractIsoYear</span></code></a> 函数从 <a class="reference internal" href="../ref/models/fields.html#django.db.models.DateField" title="django.db.models.DateField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateField</span></code></a> 和 <a class="reference internal" href="../ref/models/fields.html#django.db.models.DateTimeField" title="django.db.models.DateTimeField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateTimeField</span></code></a> 中提取 ISO-8601 周编号年，新的 <a class="reference internal" href="../ref/models/querysets.html#std-fieldlookup-iso_year"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">iso_year</span></code></a> 查询允许按 ISO-8601 周编号年进行查询。</li>
<li>新的 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.bulk_update" title="django.db.models.query.QuerySet.bulk_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.bulk_update()</span></code></a> 方法允许高效地更新多个模型实例上的特定字段。</li>
<li>Django 不再总是在执行单个查询时启动事务，例如 <code class="docutils literal notranslate"><span class="pre">Model.save()</span></code>, <code class="docutils literal notranslate"><span class="pre">QuerySet.update()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Model.delete()</span></code>。这通过减少数据库往返次数来提高自动提交的性能。</li>
<li>为 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.StdDev" title="django.db.models.StdDev"><code class="xref py py-class docutils literal notranslate"><span class="pre">StdDev</span></code></a> 和 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.Variance" title="django.db.models.Variance"><code class="xref py py-class docutils literal notranslate"><span class="pre">Variance</span></code></a> 函数添加了 SQLite 支持。</li>
<li>对于 <a class="reference internal" href="../ref/models/expressions.html#django.db.models.Aggregate" title="django.db.models.Aggregate"><code class="xref py py-class docutils literal notranslate"><span class="pre">Aggregate</span></code></a> 类，增加了 <code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code> 聚合的处理。在 <code class="docutils literal notranslate"><span class="pre">Aggregate</span></code> 子类上添加 <a class="reference internal" href="../ref/models/expressions.html#django.db.models.Aggregate.allow_distinct" title="django.db.models.Aggregate.allow_distinct"><code class="xref py py-attr docutils literal notranslate"><span class="pre">allow_distinct</span> <span class="pre">=</span> <span class="pre">True</span></code></a> 作为类属性，允许在初始化时指定一个 <code class="docutils literal notranslate"><span class="pre">distinct</span></code> 关键字参数，以确保聚合函数仅对 <code class="docutils literal notranslate"><span class="pre">expressions</span></code> 的每个不同值调用一次。</li>
<li>现在允许在具有中间模型的多对多关系上使用 <a class="reference internal" href="../ref/models/relations.html#django.db.models.fields.related.RelatedManager.add" title="django.db.models.fields.related.RelatedManager.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RelatedManager.add()</span></code></a>、<a class="reference internal" href="../ref/models/relations.html#django.db.models.fields.related.RelatedManager.create" title="django.db.models.fields.related.RelatedManager.create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create()</span></code></a>、<a class="reference internal" href="../ref/models/relations.html#django.db.models.fields.related.RelatedManager.remove" title="django.db.models.fields.related.RelatedManager.remove"><code class="xref py py-meth docutils literal notranslate"><span class="pre">remove()</span></code></a>、<a class="reference internal" href="../ref/models/relations.html#django.db.models.fields.related.RelatedManager.set" title="django.db.models.fields.related.RelatedManager.set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set()</span></code></a>、<code class="docutils literal notranslate"><span class="pre">get_or_create()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">update_or_create()</span></code> 方法。新的 <code class="docutils literal notranslate"><span class="pre">through_defaults</span></code> 参数用于指定新中间模型实例的值。</li>
</ul>
</div>
<div class="section" id="s-requests-and-responses">
<span id="requests-and-responses"></span><h4>请求和响应<a class="headerlink" href="#requests-and-responses" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>添加了 <a class="reference internal" href="../ref/request-response.html#django.http.HttpRequest.headers" title="django.http.HttpRequest.headers"><code class="xref py py-attr docutils literal notranslate"><span class="pre">HttpRequest.headers</span></code></a>，以便简单访问请求的头部信息。</li>
</ul>
</div>
<div class="section" id="s-serialization">
<span id="serialization"></span><h4>序列化<a class="headerlink" href="#serialization" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>现在可以通过将 <code class="docutils literal notranslate"><span class="pre">handle_forward_references=True</span></code> 传递给 <code class="docutils literal notranslate"><span class="pre">serializers.deserialize()</span></code> 来使用包含 <a class="reference internal" href="../topics/serialization.html#natural-keys-and-forward-references"><span class="std std-ref">前向引用</span></a> 的自然键反序列化数据。此外，<a class="reference internal" href="../ref/django-admin.html#django-admin-loaddata"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">loaddata</span></code></a> 现在会自动处理前向引用。</li>
</ul>
</div>
<div class="section" id="s-tests">
<span id="tests"></span><h4>测试<a class="headerlink" href="#tests" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../topics/testing/tools.html#django.test.SimpleTestCase.assertURLEqual" title="django.test.SimpleTestCase.assertURLEqual"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SimpleTestCase.assertURLEqual()</span></code></a> 断言检查给定的 URL，忽略查询字符串的顺序。<a class="reference internal" href="../topics/testing/tools.html#django.test.SimpleTestCase.assertRedirects" title="django.test.SimpleTestCase.assertRedirects"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertRedirects()</span></code></a> 使用了这个新的断言。</li>
<li>现在，测试 <a class="reference internal" href="../topics/testing/tools.html#django.test.Client" title="django.test.Client"><code class="xref py py-class docutils literal notranslate"><span class="pre">Client</span></code></a> 在 <code class="docutils literal notranslate"><span class="pre">content_type='application/json'</span></code> 时支持自动对列表和元组 <code class="docutils literal notranslate"><span class="pre">data</span></code> 进行 JSON 序列化。</li>
<li>新的 <a class="reference internal" href="../ref/settings.html#std-setting-TEST_ORACLE_MANAGED_FILES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">ORACLE_MANAGED_FILES</span></code></a> 测试数据库设置允许使用 Oracle 管理文件 (OMF) 表空间。</li>
<li>可延迟的数据库约束现在在 SQLite 3.20+ 上的每个 <a class="reference internal" href="../topics/testing/tools.html#django.test.TestCase" title="django.test.TestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestCase</span></code></a> 测试结束时进行检查，就像其他支持可延迟约束的后端一样。对于较旧版本的 SQLite，这些检查没有实现，因为在那里需要昂贵的表内省。</li>
<li><a class="reference internal" href="../topics/testing/advanced.html#django.test.runner.DiscoverRunner" title="django.test.runner.DiscoverRunner"><code class="xref py py-class docutils literal notranslate"><span class="pre">DiscoverRunner</span></code></a> 现在会跳过未被测试引用的数据库的设置。</li>
</ul>
</div>
<div class="section" id="s-urls">
<span id="urls"></span><h4>URLs<a class="headerlink" href="#urls" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../ref/urlresolvers.html#django.urls.ResolverMatch.route" title="django.urls.ResolverMatch.route"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ResolverMatch.route</span></code></a> 属性存储匹配的 URL 模式的路由。</li>
</ul>
</div>
<div class="section" id="s-validators">
<span id="validators"></span><h4>验证器<a class="headerlink" href="#validators" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/validators.html#django.core.validators.MaxValueValidator" title="django.core.validators.MaxValueValidator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MaxValueValidator</span></code></a>、<a class="reference internal" href="../ref/validators.html#django.core.validators.MinValueValidator" title="django.core.validators.MinValueValidator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MinValueValidator</span></code></a>、<a class="reference internal" href="../ref/validators.html#django.core.validators.MinLengthValidator" title="django.core.validators.MinLengthValidator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MinLengthValidator</span></code></a> 和 <a class="reference internal" href="../ref/validators.html#django.core.validators.MaxLengthValidator" title="django.core.validators.MaxLengthValidator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MaxLengthValidator</span></code></a> 现在接受可调用的 <code class="docutils literal notranslate"><span class="pre">limit_value</span></code>。</li>
</ul>
</div>
</div>
</div>
<div class="section" id="s-backwards-incompatible-changes-in-2-2">
<span id="s-backwards-incompatible-2-2"></span><span id="backwards-incompatible-changes-in-2-2"></span><span id="backwards-incompatible-2-2"></span><h2>2.2 版本中的不向后兼容变更<a class="headerlink" href="#backwards-incompatible-changes-in-2-2" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-database-backend-api">
<span id="database-backend-api"></span><h3>数据库后端 API<a class="headerlink" href="#database-backend-api" title="永久链接至标题">¶</a></h3>
<p>本节介绍了第三方数据库后端可能需要的更改。</p>
<ul class="simple">
<li>第三方数据库后端必须实现对表检查约束的支持，或将 <code class="docutils literal notranslate"><span class="pre">DatabaseFeatures.supports_table_check_constraints</span></code> 设置为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。</li>
<li>第三方数据库后端必须实现在插入时忽略约束或唯一性错误的支持，或将 <code class="docutils literal notranslate"><span class="pre">DatabaseFeatures.supports_ignore_conflicts</span></code> 设置为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。</li>
<li>第三方数据库后端必须实现对 <code class="docutils literal notranslate"><span class="pre">DurationField</span></code> 的内省，或将 <code class="docutils literal notranslate"><span class="pre">DatabaseFeatures.can_introspect_duration_field</span></code> 设置为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">DatabaseFeatures.uses_savepoints</span></code> 现在默认为 <code class="docutils literal notranslate"><span class="pre">True</span></code>。</li>
<li>第三方数据库后端必须实现对部分索引的支持，或将 <code class="docutils literal notranslate"><span class="pre">DatabaseFeatures.supports_partial_indexes</span></code> 设置为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。</li>
<li>移除了 <code class="docutils literal notranslate"><span class="pre">DatabaseIntrospection.table_name_converter()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">column_name_converter()</span></code>。第三方数据库后端可能需要代替实现 <code class="docutils literal notranslate"><span class="pre">DatabaseIntrospection.identifier_converter()</span></code>。在这种情况下，<code class="docutils literal notranslate"><span class="pre">DatabaseIntrospection.get_constraints()</span></code> 返回的约束名称必须通过 <code class="docutils literal notranslate"><span class="pre">identifier_converter()</span></code> 进行规范化。</li>
<li>索引的 SQL 生成从 <a class="reference internal" href="../ref/models/indexes.html#django.db.models.Index" title="django.db.models.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> 移动到 <code class="docutils literal notranslate"><span class="pre">SchemaEditor</span></code>，并添加了以下 <code class="docutils literal notranslate"><span class="pre">SchemaEditor</span></code> 方法：<ul>
<li><code class="docutils literal notranslate"><span class="pre">_create_primary_key_sql()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">_delete_primary_key_sql()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">_delete_index_sql()</span></code> （与 <code class="docutils literal notranslate"><span class="pre">_create_index_sql()</span></code> 配对使用）</li>
<li><code class="docutils literal notranslate"><span class="pre">_delete_unique_sql</span></code> （与 <code class="docutils literal notranslate"><span class="pre">_create_unique_sql()</span></code> 配对使用）</li>
<li><code class="docutils literal notranslate"><span class="pre">_delete_fk_sql()</span></code> （与 <code class="docutils literal notranslate"><span class="pre">_create_fk_sql()</span></code> 配对使用）</li>
<li><code class="docutils literal notranslate"><span class="pre">_create_check_sql()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">_delete_check_sql()</span></code></li>
</ul>
</li>
<li>移除了 <code class="docutils literal notranslate"><span class="pre">DatabaseWrapper.__init__()</span></code> 的第三个参数 <code class="docutils literal notranslate"><span class="pre">allow_thread_sharing</span></code>。</li>
</ul>
</div>
<div class="section" id="s-admin-actions-are-no-longer-collected-from-base-modeladmin-classes">
<span id="admin-actions-are-no-longer-collected-from-base-modeladmin-classes"></span><h3>不再从基本的 <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> 类中收集管理操作<a class="headerlink" href="#admin-actions-are-no-longer-collected-from-base-modeladmin-classes" title="永久链接至标题">¶</a></h3>
<p>例如，在较旧版本的 Django 中：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>


<span class="k">class</span> <span class="nc">BaseAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">SubAdmin</span><span class="p">(</span><span class="n">BaseAdmin</span><span class="p">):</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">SubAdmin</span></code> 将具有操作 <code class="docutils literal notranslate"><span class="pre">'a'</span></code> 和 <code class="docutils literal notranslate"><span class="pre">'b'</span></code>。</p>
<p>现在，<code class="docutils literal notranslate"><span class="pre">actions</span></code> 遵循标准的 Python 继承。要获得与以前相同的结果：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SubAdmin</span><span class="p">(</span><span class="n">BaseAdmin</span><span class="p">):</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="n">BaseAdmin</span><span class="o">.</span><span class="n">actions</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="s-id1">
<span id="id1"></span><h3><a class="reference internal" href="../ref/contrib/gis/index.html#module-django.contrib.gis" title="django.contrib.gis: Geographic Information System (GIS) extensions for Django"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a><a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>支持 GDAL 1.9 和 1.10 的功能已被移除。</li>
</ul>
</div>
<div class="section" id="s-transactiontestcase-serialized-data-loading">
<span id="transactiontestcase-serialized-data-loading"></span><h3><code class="docutils literal notranslate"><span class="pre">TransactionTestCase</span></code> 序列化数据加载<a class="headerlink" href="#transactiontestcase-serialized-data-loading" title="永久链接至标题">¶</a></h3>
<p>现在，在 <a class="reference internal" href="../topics/testing/tools.html#django.test.TransactionTestCase" title="django.test.TransactionTestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">TransactionTestCase</span></code></a> 的测试结束后，即在数据库刷新之后加载初始数据迁移。在旧版本中，这些数据在测试开始时加载，但这会阻止 <a class="reference internal" href="../ref/django-admin.html#cmdoption-test-keepdb"><code class="xref std std-option docutils literal notranslate"><span class="pre">test</span> <span class="pre">--keepdb</span></code></a> 选项正常工作（整个测试套件结束后数据库为空）。除非您已自定义了 <a class="reference internal" href="../topics/testing/tools.html#django.test.TransactionTestCase" title="django.test.TransactionTestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">TransactionTestCase</span></code></a> 的内部，否则这个变化不应影响您的测试。</p>
</div>
<div class="section" id="s-sqlparse-is-required-dependency">
<span id="sqlparse-is-required-dependency"></span><h3><code class="docutils literal notranslate"><span class="pre">sqlparse</span></code> 是必需的依赖项<a class="headerlink" href="#sqlparse-is-required-dependency" title="永久链接至标题">¶</a></h3>
<p>为了简化 Django 数据库处理的几个部分，现在 <a class="reference external" href="https://pypi.org/project/sqlparse/">sqlparse 0.2.2+</a> 是一个必需的依赖项。它会随着 Django 自动安装。</p>
</div>
<div class="section" id="s-cached-property-aliases">
<span id="cached-property-aliases"></span><h3><code class="docutils literal notranslate"><span class="pre">cached_property</span></code> 别名<a class="headerlink" href="#cached-property-aliases" title="永久链接至标题">¶</a></h3>
<p>在以下用法中：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.functional</span> <span class="kn">import</span> <span class="n">cached_property</span>


<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">base</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">...</span>

    <span class="n">alias</span> <span class="o">=</span> <span class="n">base</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">alias</span></code> 不会被缓存。在可以检测到问题的情况下（Python 3.6 及更高版本），此类用法现在会引发 <code class="docutils literal notranslate"><span class="pre">TypeError:</span> <span class="pre">Cannot</span> <span class="pre">assign</span> <span class="pre">the</span> <span class="pre">same</span> <span class="pre">cached_property</span> <span class="pre">to</span> <span class="pre">two</span> <span class="pre">different</span> <span class="pre">names</span> <span class="pre">('base'</span> <span class="pre">and</span> <span class="pre">'alias')</span></code>。</p>
<p>请改用以下方式：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">operator</span>


<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="o">...</span>

    <span class="n">alias</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="s2">&quot;base&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="s-permissions-for-proxy-models">
<span id="permissions-for-proxy-models"></span><h3>代理模型的权限<a class="headerlink" href="#permissions-for-proxy-models" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../topics/auth/default.html#proxy-models-permissions-topic"><span class="std std-ref">代理模型的权限</span></a> 现在使用代理模型的内容类型而不是具体模型的内容类型来创建。在运行 <a class="reference internal" href="../ref/django-admin.html#django-admin-migrate"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">migrate</span></code></a> 时，迁移将更新现有的权限。</p>
<p>在管理界面中，对于与其具体模型具有相同的 <code class="docutils literal notranslate"><span class="pre">app_label</span></code> 的代理模型，这个变化是透明的。然而，在旧版本中，对于具体模型具有不同 <code class="docutils literal notranslate"><span class="pre">app_label</span></code> 的代理模型的权限的用户不能访问管理中的模型。现在这个问题已经修复，但在升级之前，您可能希望审查这些代理模型的权限分配（<code class="docutils literal notranslate"><span class="pre">[add|view|change|delete]_myproxy</span></code>），以确保新的访问是合适的。</p>
<p>最后，代理模型的权限字符串必须更新以使用它们自己的 <code class="docutils literal notranslate"><span class="pre">app_label</span></code>。例如，对于继承自 <code class="docutils literal notranslate"><span class="pre">other_app.ConcreteModel</span></code> 的 <code class="docutils literal notranslate"><span class="pre">app.MyProxyModel</span></code>，请将 <code class="docutils literal notranslate"><span class="pre">user.has_perm('other_app.add_myproxymodel')</span></code> 更新为 <code class="docutils literal notranslate"><span class="pre">user.has_perm('app.add_myproxymodel')</span></code>。</p>
</div>
<div class="section" id="s-merging-of-form-media-assets">
<span id="merging-of-form-media-assets"></span><h3>合并表单 <code class="docutils literal notranslate"><span class="pre">Media</span></code> 资源<a class="headerlink" href="#merging-of-form-media-assets" title="永久链接至标题">¶</a></h3>
<p>现在，表单 <code class="docutils literal notranslate"><span class="pre">Media</span></code> 资源使用拓扑排序算法进行合并，因为旧的成对合并算法对某些情况不足够。不包含其依赖项的 CSS 和 JavaScript 文件现在可能会被错误地排序（而旧算法恰好由于巧合而产生了正确的结果）。</p>
<p>请审查所有的 <code class="docutils literal notranslate"><span class="pre">Media</span></code> 类以查找任何缺失的依赖项。例如，依赖于 <code class="docutils literal notranslate"><span class="pre">django.jQuery</span></code> 的小部件在 <a class="reference internal" href="../topics/forms/media.html#assets-as-a-static-definition"><span class="std std-ref">声明表单媒体资源</span></a> 时必须指定 <code class="docutils literal notranslate"><span class="pre">js=['admin/js/jquery.init.js',</span> <span class="pre">...]</span></code>。</p>
</div>
<div class="section" id="s-miscellaneous">
<span id="miscellaneous"></span><h3>杂项<a class="headerlink" href="#miscellaneous" title="永久链接至标题">¶</a></h3>
<ul>
<li><p class="first">为了提高可读性，<code class="docutils literal notranslate"><span class="pre">UUIDField</span></code> 表单字段现在会显示带有破折号的值，例如 <code class="docutils literal notranslate"><span class="pre">550e8400-e29b-41d4-a716-446655440000</span></code>，而不是 <code class="docutils literal notranslate"><span class="pre">550e8400e29b41d4a716446655440000</span></code>。</p>
</li>
<li><p class="first">在 SQLite 上，<code class="docutils literal notranslate"><span class="pre">PositiveIntegerField</span></code> 和 <code class="docutils literal notranslate"><span class="pre">PositiveSmallIntegerField</span></code> 现在包含一个检查约束，以防止在数据库中出现负值。如果您有现有的无效数据并运行重新创建表的迁移，您将看到 <code class="docutils literal notranslate"><span class="pre">CHECK</span> <span class="pre">constraint</span> <span class="pre">failed</span></code>。</p>
</li>
<li><p class="first">为了与 WSGI 服务器保持一致，测试客户端现在将 <code class="docutils literal notranslate"><span class="pre">Content-Length</span></code> 头设置为字符串而不是整数。</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/utils.html#django.utils.text.slugify" title="django.utils.text.slugify"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.text.slugify()</span></code></a> 的返回值不再标记为 HTML 安全。</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/templates/builtins.html#std-templatefilter-urlizetrunc"><code class="xref std std-tfilter docutils literal notranslate"><span class="pre">urlizetrunc</span></code></a>、<a class="reference internal" href="../ref/templates/builtins.html#std-templatefilter-truncatechars"><code class="xref std std-tfilter docutils literal notranslate"><span class="pre">truncatechars</span></code></a>、<a class="reference internal" href="../ref/templates/builtins.html#std-templatefilter-truncatechars_html"><code class="xref std std-tfilter docutils literal notranslate"><span class="pre">truncatechars_html</span></code></a>、<a class="reference internal" href="../ref/templates/builtins.html#std-templatefilter-truncatewords"><code class="xref std std-tfilter docutils literal notranslate"><span class="pre">truncatewords</span></code></a> 和 <a class="reference internal" href="../ref/templates/builtins.html#std-templatefilter-truncatewords_html"><code class="xref std std-tfilter docutils literal notranslate"><span class="pre">truncatewords_html</span></code></a> 模板过滤器使用的默认截断字符现在是真正的省略号字符（<code class="docutils literal notranslate"><span class="pre">…</span></code>）而不是 3 个点。您可能需要调整一些测试输出的比较。</p>
</li>
<li><p class="first">不再支持在模板文件系统加载器中使用字节串路径。</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/utils.html#django.utils.http.urlsafe_base64_encode" title="django.utils.http.urlsafe_base64_encode"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.http.urlsafe_base64_encode()</span></code></a> 现在返回一个字符串而不是字节字符串，并且 <a class="reference internal" href="../ref/utils.html#django.utils.http.urlsafe_base64_decode" title="django.utils.http.urlsafe_base64_decode"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.http.urlsafe_base64_decode()</span></code></a> 可能不再接受字节字符串作为参数。</p>
</li>
<li><p class="first">不再支持 <code class="docutils literal notranslate"><span class="pre">cx_Oracle</span></code> 版本低于 6.0。</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">mysqlclient</span></code> 的最低支持版本从 1.3.7 增加到 1.3.13。</p>
</li>
<li><p class="first">SQLite 的最低支持版本从 3.7.15 提高到 3.8.3 。</p>
</li>
<li><p class="first">为了提供更语义化的查询数据，<code class="docutils literal notranslate"><span class="pre">NullBooleanSelect</span></code> 现在呈现 <code class="docutils literal notranslate"><span class="pre">&lt;option&gt;</span></code> 的值为 <code class="docutils literal notranslate"><span class="pre">unknown</span></code>、<code class="docutils literal notranslate"><span class="pre">true</span></code> 和 <code class="docutils literal notranslate"><span class="pre">false</span></code>，而不是 <code class="docutils literal notranslate"><span class="pre">1</span></code>、<code class="docutils literal notranslate"><span class="pre">2</span></code> 和 <code class="docutils literal notranslate"><span class="pre">3</span></code>。为了向后兼容，旧值仍然被接受为数据。</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.models.Group.name" title="django.contrib.auth.models.Group.name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Group.name</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">max_length</span></code> 从 80 增加到 150 个字符。</p>
</li>
<li><p class="first">现在在运行于 SQLite 3.20+ 上的测试中，违反可延迟数据库约束的行为将报错，就像其他支持此类约束的后端一样。</p>
</li>
<li><p class="first">为了捕获使用错误，测试 <a class="reference internal" href="../topics/testing/tools.html#django.test.Client" title="django.test.Client"><code class="xref py py-class docutils literal notranslate"><span class="pre">Client</span></code></a> 和 <a class="reference internal" href="../ref/utils.html#django.utils.http.urlencode" title="django.utils.http.urlencode"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.http.urlencode()</span></code></a> 现在如果传递 <code class="docutils literal notranslate"><span class="pre">None</span></code> 作为要编码的值会引发 <code class="docutils literal notranslate"><span class="pre">TypeError</span></code>，因为 <code class="docutils literal notranslate"><span class="pre">None</span></code> 不能编码为 GET 和 POST 数据。要么传递空字符串，要么省略值。</p>
</li>
<li><p class="first">现在，<code class="docutils literal notranslate"><span class="pre">ping_google</span></code> 管理命令默认使用 <code class="docutils literal notranslate"><span class="pre">https</span></code> 而不是 <code class="docutils literal notranslate"><span class="pre">http</span></code> 作为站点地图的 URL。如果你的站点使用 http，请使用新的 <code class="docutils literal notranslate"><span class="pre">ping_google</span> <span class="pre">--sitemap-uses-http</span></code> 选项。如果你使用 <code class="docutils literal notranslate"><span class="pre">django.contrib.sitemaps.ping_google</span></code> 函数，请将新的 <code class="docutils literal notranslate"><span class="pre">sitemap_uses_https</span></code> 参数设置为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/django-admin.html#django-admin-runserver"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">runserver</span></code></a> 不再支持 <code class="docutils literal notranslate"><span class="pre">pyinotify</span></code> （已被 Watchman 替代）。</p>
</li>
<li><p class="first">当输入是 <code class="docutils literal notranslate"><span class="pre">Decimal</span></code> 时， <a class="reference internal" href="../ref/models/querysets.html#django.db.models.Avg" title="django.db.models.Avg"><code class="xref py py-class docutils literal notranslate"><span class="pre">Avg</span></code></a>、<a class="reference internal" href="../ref/models/querysets.html#django.db.models.StdDev" title="django.db.models.StdDev"><code class="xref py py-class docutils literal notranslate"><span class="pre">StdDev</span></code></a> 和 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.Variance" title="django.db.models.Variance"><code class="xref py py-class docutils literal notranslate"><span class="pre">Variance</span></code></a> 聚合函数现在返回 <code class="docutils literal notranslate"><span class="pre">Decimal</span></code> 而不是 <code class="docutils literal notranslate"><span class="pre">float</span></code>。</p>
</li>
<li><p class="first">如果没有迁移的应用与具有迁移的应用有关系，那么在 SQLite 上的测试将失败。这自从 Django 1.7 添加迁移以来一直是一个已记录的限制，但现在它失败得更可靠。您将看到类似于 <code class="docutils literal notranslate"><span class="pre">no</span> <span class="pre">such</span> <span class="pre">table:</span> <span class="pre">&lt;app_label&gt;_&lt;model&gt;</span></code> 的错误导致测试失败。这在一些具有测试中没有迁移的模型的第三方应用中观察到。您必须为这些模型添加迁移。</p>
</li>
<li><p class="first">在 <a class="reference internal" href="../topics/cache.html#django.core.cache.cache.delete" title="django.core.cache.cache.delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">cache.delete()</span></code></a> 或 <a class="reference internal" href="../topics/cache.html#django.core.cache.cache.get" title="django.core.cache.cache.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">cache.get()</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">key</span></code> 参数中提供整数现在会引发 <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(在 Python v3.12)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a>。</p>
</li>
<li><p class="first">由于已纳入 Transifex 的最新版本，某些语言的复数规则方程式已被更改。</p>
<div class="admonition note">
<p class="first admonition-title">备注</p>
<p class="last">在 Django 2.2.12 中添加了处理同一语言的 <code class="docutils literal notranslate"><span class="pre">.po</span></code> 文件中包含不同复数方程的能力。</p>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="s-features-deprecated-in-2-2">
<span id="s-deprecated-features-2-2"></span><span id="features-deprecated-in-2-2"></span><span id="deprecated-features-2-2"></span><h2>在 2.2 中被废弃的功能<a class="headerlink" href="#features-deprecated-in-2-2" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-model-meta-ordering-will-no-longer-affect-group-by-queries">
<span id="model-meta-ordering-will-no-longer-affect-group-by-queries"></span><h3>模型的 <code class="docutils literal notranslate"><span class="pre">Meta.ordering</span></code> 将不再影响 <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> 查询。<a class="headerlink" href="#model-meta-ordering-will-no-longer-affect-group-by-queries" title="永久链接至标题">¶</a></h3>
<p>模型的 <code class="docutils literal notranslate"><span class="pre">Meta.ordering</span></code> 影响 <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> 查询（例如 <code class="docutils literal notranslate"><span class="pre">.annotate().values()</span></code>）是常见的引发混淆的原因。现在，这种查询会发出一个弃用警告，建议添加一个 <code class="docutils literal notranslate"><span class="pre">order_by()</span></code> 以保留当前查询。从 Django 3.1 开始，在这种查询中将忽略 <code class="docutils literal notranslate"><span class="pre">Meta.ordering</span></code>。</p>
</div>
<div class="section" id="s-id2">
<span id="id2"></span><h3>杂项<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">django.utils.timezone.FixedOffset</span></code> 已被弃用，建议使用 <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.timezone" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime.timezone</span></code></a>。</li>
<li>未记录的 <code class="docutils literal notranslate"><span class="pre">QuerySetPaginator</span></code> 别名 <code class="docutils literal notranslate"><span class="pre">django.core.paginator.Paginator</span></code> 已被弃用。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.postgres</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">FloatRangeField</span></code> 模型和表单字段已被弃用，推荐使用新名称 <code class="docutils literal notranslate"><span class="pre">DecimalRangeField</span></code>，以匹配数据库中使用的 <code class="docutils literal notranslate"><span class="pre">numrange</span></code> 数据类型。</li>
<li><code class="docutils literal notranslate"><span class="pre">FILE_CHARSET</span></code> 设置已被弃用。从 Django 3.1 开始，从磁盘读取的文件必须是 UTF-8 编码的。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.staticfiles.storage.CachedStaticFilesStorage</span></code> 已被弃用，因为它存在无法解决的问题。请改用 <a class="reference internal" href="../ref/contrib/staticfiles.html#django.contrib.staticfiles.storage.ManifestStaticFilesStorage" title="django.contrib.staticfiles.storage.ManifestStaticFilesStorage"><code class="xref py py-class docutils literal notranslate"><span class="pre">ManifestStaticFilesStorage</span></code></a> 或第三方云存储。</li>
<li>现在，<a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.backends.RemoteUserBackend.configure_user" title="django.contrib.auth.backends.RemoteUserBackend.configure_user"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RemoteUserBackend.configure_user()</span></code></a> 方法的第一个位置参数是 <code class="docutils literal notranslate"><span class="pre">request</span></code>，如果该方法接受它的话。不支持不接受 <code class="docutils literal notranslate"><span class="pre">request</span></code> 参数的覆盖方法，将在 Django 3.1 中移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">SimpleTestCase.allow_database_queries</span></code>、<code class="docutils literal notranslate"><span class="pre">TransactionTestCase.multi_db</span></code> 和 <code class="docutils literal notranslate"><span class="pre">TestCase.multi_db</span></code> 属性已被弃用，推荐使用 <a class="reference internal" href="../topics/testing/tools.html#django.test.SimpleTestCase.databases" title="django.test.SimpleTestCase.databases"><code class="xref py py-attr docutils literal notranslate"><span class="pre">SimpleTestCase.databases</span></code></a>、<a class="reference internal" href="../topics/testing/tools.html#django.test.TransactionTestCase.databases" title="django.test.TransactionTestCase.databases"><code class="xref py py-attr docutils literal notranslate"><span class="pre">TransactionTestCase.databases</span></code></a> 和 <a class="reference internal" href="../topics/testing/tools.html#django.test.TestCase.databases" title="django.test.TestCase.databases"><code class="xref py py-attr docutils literal notranslate"><span class="pre">TestCase.databases</span></code></a>。这些新属性允许声明数据库依赖关系，以防止非默认数据库的意外查询在测试之间泄漏状态。以前的行为可以通过设置 <code class="docutils literal notranslate"><span class="pre">databases='__all__'</span></code> 来实现，即 <code class="docutils literal notranslate"><span class="pre">allow_database_queries=True</span></code> 和 <code class="docutils literal notranslate"><span class="pre">multi_db=True</span></code>。</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../contents.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">Django 2.2 版本发行说明</a><ul>
<li><a class="reference internal" href="#python-compatibility">Python 兼容性</a></li>
<li><a class="reference internal" href="#what-s-new-in-django-2-2">Django 2.2 的新功能有哪些呢？</a><ul>
<li><a class="reference internal" href="#constraints">约束</a></li>
<li><a class="reference internal" href="#minor-features">次要特性</a><ul>
<li><a class="reference internal" href="#django-contrib-admin"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-auth"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-gis"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-postgres"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.postgres</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-staticfiles"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.staticfiles</span></code></a></li>
<li><a class="reference internal" href="#database-backends">数据库后端</a></li>
<li><a class="reference internal" href="#generic-views">通用视图</a></li>
<li><a class="reference internal" href="#internationalization">国际化</a></li>
<li><a class="reference internal" href="#management-commands">管理命令</a></li>
<li><a class="reference internal" href="#migrations">迁移</a></li>
<li><a class="reference internal" href="#models">模型</a></li>
<li><a class="reference internal" href="#requests-and-responses">请求和响应</a></li>
<li><a class="reference internal" href="#serialization">序列化</a></li>
<li><a class="reference internal" href="#tests">测试</a></li>
<li><a class="reference internal" href="#urls">URLs</a></li>
<li><a class="reference internal" href="#validators">验证器</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-incompatible-changes-in-2-2">2.2 版本中的不向后兼容变更</a><ul>
<li><a class="reference internal" href="#database-backend-api">数据库后端 API</a></li>
<li><a class="reference internal" href="#admin-actions-are-no-longer-collected-from-base-modeladmin-classes">不再从基本的 <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> 类中收集管理操作</a></li>
<li><a class="reference internal" href="#id1"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a></li>
<li><a class="reference internal" href="#transactiontestcase-serialized-data-loading"><code class="docutils literal notranslate"><span class="pre">TransactionTestCase</span></code> 序列化数据加载</a></li>
<li><a class="reference internal" href="#sqlparse-is-required-dependency"><code class="docutils literal notranslate"><span class="pre">sqlparse</span></code> 是必需的依赖项</a></li>
<li><a class="reference internal" href="#cached-property-aliases"><code class="docutils literal notranslate"><span class="pre">cached_property</span></code> 别名</a></li>
<li><a class="reference internal" href="#permissions-for-proxy-models">代理模型的权限</a></li>
<li><a class="reference internal" href="#merging-of-form-media-assets">合并表单 <code class="docutils literal notranslate"><span class="pre">Media</span></code> 资源</a></li>
<li><a class="reference internal" href="#miscellaneous">杂项</a></li>
</ul>
</li>
<li><a class="reference internal" href="#features-deprecated-in-2-2">在 2.2 中被废弃的功能</a><ul>
<li><a class="reference internal" href="#model-meta-ordering-will-no-longer-affect-group-by-queries">模型的 <code class="docutils literal notranslate"><span class="pre">Meta.ordering</span></code> 将不再影响 <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> 查询。</a></li>
<li><a class="reference internal" href="#id2">杂项</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="2.2.1.html"
                          title="上一章">Django 2.2.1 版本发行说明</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="2.1.15.html"
                          title="下一章">Django 2.1.15 版本发行说明</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/releases/2.2.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">3月 29, 2024</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="2.2.1.html" title="Django 2.2.1 版本发行说明">previous</a>
     |
    <a href="index.html" title="发行说明" accesskey="U">up</a>
   |
    <a href="2.1.15.html" title="Django 2.1.15 版本发行说明">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>